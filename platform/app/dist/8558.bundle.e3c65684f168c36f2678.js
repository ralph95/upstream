"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8558],{75183:(e,t,n)=>{var r;n.d(t,{A:()=>a}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated",e.History="History",e.MetadataReferenceModified="MetadataReferenceModified",e.LabelChange="LabelChange"}(r||(r={}));const a=r},94021:(e,t,n)=>{var r;n.d(t,{A:()=>a}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",e.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",e.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",e.STACK_PREFETCH_COMPLETE="CORNERSTONE_TOOLS_STACK_PREFETCH_COMPLETE",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",e.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(r||(r={}));const a=r},18682:(e,t,n)=>{var r;n.d(t,{A:()=>a}),function(e){e.Labelmap="Labelmap",e.Contour="Contour",e.Surface="Surface"}(r||(r={}));const a=r},84093:(e,t,n)=>{var r;n.d(t,{A:()=>a}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.Interpolate="interpolate",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.AddPreview="addPreview",e.ComputeInnerCircleRadius="computeInnerCircleRadius",e.GetStatistics="getStatistics",e.EnsureImageVolumeFor3DManipulation="ensureImageVolumeFor3DManipulation",e.EnsureSegmentationVolumeFor3DManipulation="ensureSegmentationVolumeFor3DManipulation"}(r||(r={}));const a=r},66452:(e,t,n)=>{var r,a;n.d(t,{i:()=>r,q:()=>a}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button",e[e.Wheel=524288]="Wheel",e[e.Wheel_Primary=524289]="Wheel_Primary"}(r||(r={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(a||(a={}))},49892:(e,t,n)=>{var r;n.d(t,{A:()=>a}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(r||(r={}));const a=r},10401:(e,t,n)=>{var r;n.d(t,{H:()=>r}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(r||(r={}))},99737:(e,t,n)=>{n.r(t),n.d(t,{AnnotationStyleStates:()=>o,ChangeTypes:()=>T.A,Events:()=>i.A,KeyboardBindings:()=>a.q,MouseBindings:()=>a.i,SegmentationRepresentations:()=>S.A,StrategyCallbacks:()=>c.A,Swipe:()=>E.H,ToolModes:()=>O.A,WorkerTypes:()=>R});var r,a=n(66452),O=n(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(r||(r={}));const o=r;var s,i=n(94021),S=n(18682),E=n(10401),c=n(84093),T=n(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces",e.COMPUTE_STATISTICS="Computing Statistics",e.INTERPOLATE_LABELMAP="Interpolating Labelmap",e.COMPUTE_LARGEST_BIDIRECTIONAL="Computing Largest Bidirectional",e.GENERATE_CONTOUR_SETS="Generating Contour Sets"}(s||(s={}));const R=s},78558:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});const r=JSON.parse('{"UU":"@ohif/extension-cornerstone-dicom-rt"}').UU,a=`${r}.sopClassHandlerModule.dicom-rt`;var O=n(86326),o=n(42356),s=n(68523),i=n(5842);const{DicomMessage:S,DicomMetaDictionary:E}=i.Ay.data,c=i.Ay.data.Colors.dicomlab2RGB;const T=async({extensionManager:e,rtStructDisplaySet:t,headers:n})=>{const r=e.getModuleEntry("@ohif/extension-cornerstone.utilityModule.common"),{dicomLoaderService:a}=r.exports,O=await a.findDicomDataPromise(t,null,n),o=S.readFile(O),s=E.naturalizeDataset(o.dict);return s._meta=E.namifyDataset(o.meta),s};async function R(e,t,n){const r=e.getActiveDataSource()[0],{bulkDataURI:a}=r.getConfig?.()||{};t.isLoaded=!0;let O=t.instance;O=a&&a.enabled?await async function({instance:e,dataSource:t,extensionManager:n,rtStructDisplaySet:r,headers:a}){let O=e;if(!(O&&O.ROIContourSequence||(O=await T({extensionManager:n,rtStructDisplaySet:r,headers:a}),O&&O.ROIContourSequence)))return Promise.reject("Invalid instance object or ROIContourSequence");const o=new Map;for(const e of O.ROIContourSequence){const n=e.ReferencedROINumber;if(e&&e.ContourSequence)for(const r of e.ContourSequence){if(!r||!r.ContourData)return Promise.reject("Invalid Contour or ContourData");const e=r.ContourData;if(Array.isArray(e))o.has(n)?o.get(n).push(Promise.resolve(e)):o.set(n,[Promise.resolve(e)]);else{if(!e||!e.BulkDataURI)return Promise.reject(`Invalid ContourData: ${e}`);{const r=e.BulkDataURI;if(!t||!t.retrieve||!t.retrieve.bulkDataURI)return Promise.reject("Invalid dataSource object or retrieve function");const a=t.retrieve.bulkDataURI({BulkDataURI:r,StudyInstanceUID:O.StudyInstanceUID,SeriesInstanceUID:O.SeriesInstanceUID,SOPInstanceUID:O.SOPInstanceUID});o.has(n)?o.get(n).push(a):o.set(n,[a])}}}else o.set(n,[Promise.resolve([])])}const s=new Map;for(const[e,t]of o.entries())s.set(e,await Promise.allSettled(t));return O.ROIContourSequence.forEach(e=>{try{const t=e.ReferencedROINumber,n=s.get(t);e.ContourSequence&&e.ContourSequence.forEach((e,t)=>{const r=n[t];if("fulfilled"===r.status)if(Array.isArray(r.value)&&r.value.every(Number.isFinite))e.ContourData=r.value;else{const t=new Uint8Array(r.value),n=(new TextDecoder).decode(t);"string"==typeof n&&n.includes("\\")?e.ContourData=n.split("\\").map(parseFloat):e.ContourData=[]}else console.error(r.reason)})}catch(e){console.error(e)}}),O}({instance:O,dataSource:r,extensionManager:e,rtStructDisplaySet:t,headers:n}):await T({extensionManager:e,rtStructDisplaySet:t,headers:n});const{StructureSetROISequence:o,ROIContourSequence:s,RTROIObservationsSequence:i}=O,S={StructureSetLabel:O.StructureSetLabel,SeriesInstanceUID:O.SeriesInstanceUID,ROIContours:[],visible:!0,ReferencedSOPInstanceUIDsSet:new Set};for(let e=0;e<s.length;e++){const t=s[e],{ContourSequence:n}=t;if(!n)continue;const r=N(n),a=[];for(const e of r){const{ContourData:t,NumberOfContourPoints:n,ContourGeometricType:r,ContourImageSequence:O}=e,o=[];for(let e=0;e<3*n;e+=3)o.push({x:t[e],y:t[e+1],z:t[e+2]});const s=new Map([["CLOSED_PLANAR",!1],["OPEN_NONPLANAR",!1],["OPEN_PLANAR",!1],["POINT",!0]]);a.push({numberOfPoints:n,points:o,type:r,isSupported:s.get(r)??!1}),O?.ReferencedSOPInstanceUID&&S.ReferencedSOPInstanceUIDsSet.add(O?.ReferencedSOPInstanceUID)}I(S,o,i,t,a)}return S}function I(e,t,n,r,a){const O=t.find(e=>e.ROINumber===r.ReferencedROINumber),o={ROINumber:O.ROINumber,ROIName:O.ROIName,ROIGenerationAlgorithm:O.ROIGenerationAlgorithm,ROIDescription:O.ROIDescription,contourPoints:a,visible:!0,colorArray:[]};!function(e,t){let{ROIDisplayColor:n,RecommendedDisplayCIELabValue:r}=e;!n&&r&&(n=c(r));n&&(t.colorArray=[...n])}(r,o),n&&function(e,t,n){const r=t.find(e=>e.ReferencedROINumber===n);if(r){const{ObservationNumber:t,ROIObservationDescription:n,RTROIInterpretedType:a,ROIInterpreter:O}=r;e.RTROIObservations={ObservationNumber:t,ROIObservationDescription:n,RTROIInterpretedType:a,ROIInterpreter:O}}}(o,n,r.ReferencedROINumber),e.ROIContours.push(o)}function N(e){return Array.isArray(e)?e:[e]}const{sopClassDictionary:_}=o.Wp,u=[_.RTStructureSetStorage],l=new Set,d={};function D(e,t,n){const r=e[0],{StudyInstanceUID:O,SeriesInstanceUID:i,SOPInstanceUID:S,SeriesDescription:E,SeriesNumber:c,SeriesDate:T,SOPClassUID:I,wadoRoot:N,wadoUri:_,wadoUriRoot:D}=r,C={Modality:"RTSTRUCT",loading:!1,isReconstructable:!1,displaySetInstanceUID:o.Wp.guid(),SeriesDescription:E,SeriesNumber:c,SeriesDate:T,SOPInstanceUID:S,SeriesInstanceUID:i,StudyInstanceUID:O,SOPClassHandlerId:a,SOPClassUID:I,referencedImages:null,referencedSeriesInstanceUID:null,referencedDisplaySetInstanceUID:null,isDerivedDisplaySet:!0,isLoaded:!1,isHydrated:!1,structureSet:null,sopClassUids:u,instance:r,wadoRoot:N,wadoUriRoot:D,wadoUri:_,isOverlayDisplaySet:!0,label:E||`${s.A.t("Series")} ${c} - ${s.A.t("RTSTRUCT")}`};let A=r.ReferencedSeriesSequence;if(r.ReferencedFrameOfReferenceSequence&&!r.ReferencedSeriesSequence&&(r.ReferencedSeriesSequence=function(e){const t=[];return e.forEach(e=>{const{RTReferencedStudySequence:n}=e;n.forEach(e=>{const{RTReferencedSeriesSequence:n}=e;n.forEach(e=>{const n=[],{ContourImageSequence:r,SeriesInstanceUID:a}=e;r.forEach(e=>{n.push({ReferencedSOPInstanceUID:e.ReferencedSOPInstanceUID,ReferencedSOPClassUID:e.ReferencedSOPClassUID})});const O={SeriesInstanceUID:a,ReferencedInstanceSequence:n};t.push(O)})})}),t}(r.ReferencedFrameOfReferenceSequence),A=r.ReferencedSeriesSequence),!A)throw new Error("ReferencedSeriesSequence is missing for the RTSTRUCT");const L=A[0];C.referencedImages=r.ReferencedSeriesSequence.ReferencedInstanceSequence,C.referencedSeriesInstanceUID=L.SeriesInstanceUID;const{displaySetService:p}=t.services,f=p.getDisplaySetsForSeries(C.referencedSeriesInstanceUID);if(f&&0!==f.length){const e=f[0];C.referencedDisplaySetInstanceUID=e.displaySetInstanceUID,C.isReconstructable=e.isReconstructable}else{const{unsubscribe:e}=p.subscribe(p.EVENTS.DISPLAY_SETS_ADDED,({displaySetsAdded:t})=>{const n=t[0];n.SeriesInstanceUID===C.referencedSeriesInstanceUID&&(C.referencedDisplaySetInstanceUID=n.displaySetInstanceUID,C.isReconstructable=n.isReconstructable,e())})}return C.load=({headers:e,createSegmentation:r=!0})=>function(e,t,n,r,a=!0){const{SOPInstanceUID:O}=e,{segmentationService:o}=t.services;if((e.loading||e.isLoaded)&&d[O]&&l.has(e.displaySetInstanceUID))return d[O];e.loading=!0;const{unsubscribe:s}=o.subscribe(o.EVENTS.SEGMENTATION_LOADING_COMPLETE,t=>{t.rtDisplaySet?.displaySetInstanceUID===e.displaySetInstanceUID&&(l.add(e.displaySetInstanceUID),s())});return d[O]=new Promise(async(t,O)=>{try{if(!e.structureSet){const t=await R(n,e,r);e.structureSet=t}a&&await o.createSegmentationForRTDisplaySet(e),t()}catch(e){O(e)}finally{e.loading=!1}}),d[O]}(C,t,n,e,r),[C]}const C=function(e){const{servicesManager:t,extensionManager:n}=e;return[{name:"dicom-rt",sopClassUids:u,getDisplaySetsFromSeries:e=>D(e,t,n)}]};var A=n(99737);const L=({commandsManager:e,servicesManager:t})=>{const n=t.services,{displaySetService:r,viewportGridService:a}=n,O={hydrateRTSDisplaySet:({displaySet:t,viewportId:n})=>{if("RTSTRUCT"!==t.Modality)throw new Error("Display set is not an RTSTRUCT");const O=r.getDisplaySetByUID(t.referencedDisplaySetInstanceUID);e.runCommand("updateStoredSegmentationPresentation",{displaySet:t,type:A.SegmentationRepresentations.Contour}),e.runCommand("updateStoredPositionPresentation",{viewportId:n,displaySetInstanceUIDs:[O.displaySetInstanceUID]}),a.setDisplaySetsForViewport({viewportId:n,displaySetInstanceUIDs:[O.displaySetInstanceUID]})}};return{actions:O,definitions:{hydrateRTSDisplaySet:{commandFn:O.hydrateRTSDisplaySet,storeContexts:[],options:{}}},defaultContext:"cornerstone-dicom-rt"}};function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(null,arguments)}const f=O.lazy(()=>Promise.all([n.e(6563),n.e(1563),n.e(5400),n.e(7412),n.e(2108),n.e(7431),n.e(9548),n.e(7948),n.e(5349)]).then(n.bind(n,88414))),U=e=>O.createElement(O.Suspense,{fallback:O.createElement("div",null,"Loading...")},O.createElement(f,e)),P={id:r,getCommandsModule:L,getViewportModule:({servicesManager:e,extensionManager:t,commandsManager:n})=>[{name:"dicom-rt",component:r=>O.createElement(U,p({servicesManager:e,extensionManager:t,commandsManager:n},r))}],getSopClassHandlerModule:C}}}]);
//# sourceMappingURL=8558.bundle.e3c65684f168c36f2678.js.map