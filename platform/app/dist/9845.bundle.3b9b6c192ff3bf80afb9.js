"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9845],{69845:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var a=n(86326),r=n(96283);const s=function({commandsManager:e,toolGroupService:t,customizationService:n,toolGroupId:a}){const r=n.getCustomization("cornerstone.overlayViewportTools"),s=e.run("initializeSegmentLabelTool",{tools:r});return t.createToolGroupAndAddTools(a,s)};var i=n(37948);const o=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateCallback:r}){return i.utils.promptHydrationDialog({servicesManager:e,viewportId:n,displaySet:t,preHydrateCallbacks:a,hydrateCallback:r,type:"SEG"})};var l=n(99737),c=n(83641);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(null,arguments)}const u=function(e){const{servicesManager:t,commandsManager:n}=(0,c.Jg)(),{children:u,displaySets:d,viewportOptions:S}=e,m=S.viewportId,{displaySetService:g,toolGroupService:I,segmentationService:y,customizationService:v}=t.services,f=v.getCustomization("ui.loadingIndicatorTotalPercent"),E=`SEGToolGroup-${m}`;if(d.length>1)throw new Error("SEG viewport should only have a single display set");const w=d[0],[b,D]=(0,r.ihW)(),{setPositionPresentation:h}=(0,i.usePositionPresentationStore)(),[T,C]=(0,a.useState)(!w.isLoaded),[P,G]=(0,a.useState)({percentComplete:null,totalSegments:null}),M=(0,a.useRef)(null),{viewports:N,activeViewportId:k}=b,A=w.referencedDisplaySetInstanceUID;if(!A){const e=v.getCustomization("missingReferenceDisplaySetHandler"),{handled:t}=e();if(t)return}const O=g.getDisplaySetByUID(A),U=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:r}=a,s=Array.isArray(r)?r[0]:r,{SpacingBetweenSlices:i,SliceThickness:o}=s,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||i};return c}(O,w);M.current={displaySet:O,metadata:U};const L=(0,a.useCallback)(()=>a.createElement(i.OHIFCornerstoneViewport,p({},e,{displaySets:[w],viewportOptions:{viewportType:S.viewportType,toolGroupId:E,orientation:S.orientation,viewportId:S.viewportId,presentationIds:S.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t)}})),[m,w,E,e,S]);(0,a.useEffect)(()=>{T||m===k&&o({servicesManager:t,viewportId:m,segDisplaySet:w,hydrateCallback:async()=>(await n.runCommand("hydrateSecondaryDisplaySet",{displaySet:w,viewportId:m}),!0)})},[t,m,w,T,n,k]),(0,a.useEffect)(()=>{y.clearSegmentationRepresentations(m);const{unsubscribe:e}=y.subscribe(y.EVENTS.SEGMENTATION_LOADING_COMPLETE,e=>{if(e.segDisplaySet.displaySetInstanceUID===w.displaySetInstanceUID&&C(!1),w?.firstSegmentedSliceImageId&&S?.presentationIds){const{firstSegmentedSliceImageId:e}=w,{presentationIds:t}=S;h(t.positionPresentationId,{viewReference:{referencedImageId:e}})}});return()=>{e()}},[w]),(0,a.useEffect)(()=>{const{unsubscribe:e}=y.subscribe(y.EVENTS.SEGMENT_LOADING_COMPLETE,({percentComplete:e,numSegments:t})=>{G({percentComplete:e,totalSegments:t})});return()=>{e()}},[w]),(0,a.useEffect)(()=>{const e=g.subscribe(g.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=N.get(k);e.includes(t.displaySetInstanceUID)&&D.setDisplaySetsForViewport({viewportId:k,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe()}},[]),(0,a.useEffect)(()=>{let e=I.getToolGroup(E);if(!e)return n.runCommand("updateStoredSegmentationPresentation",{displaySet:w,type:l.SegmentationRepresentations.Labelmap}),y.clearSegmentationRepresentations(m),e=s({commandsManager:n,toolGroupService:I,customizationService:v,toolGroupId:E}),()=>{y.clearSegmentationRepresentations(m),I.destroyToolGroup(E)}},[]);let R=null;return M.current&&O.displaySetInstanceUID===M.current.displaySet.displaySetInstanceUID?(u&&u.length&&(R=u.map((e,t)=>e&&a.cloneElement(e,{viewportId:m,key:t}))),a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},T&&a.createElement(f,{className:"h-full w-full",totalNumbers:P.totalSegments,percentComplete:P.percentComplete,loadingText:"Loading SEG..."}),L(),R))):null}}}]);
//# sourceMappingURL=9845.bundle.3b9b6c192ff3bf80afb9.js.map