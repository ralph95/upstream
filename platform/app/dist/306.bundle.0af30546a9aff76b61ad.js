"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[306],{5057:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(53586),i=n(48080),a=n(92885),r=n(71209);function s(e,t){const n=e.image;if(!e.canvas||!e.image)return;const s=(0,o.A)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let o=n.render;o||(o=e.viewport.colormap?r.l:n.color?i.f:a.j),o(e,t)}const l=(0,o.A)()-s;n.stats.lastRenderTime=l,e.invalid=!1,e.needsRedraw=!1}},7808:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(45354);function i(e,t){const n=new o.d;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);let a=e.viewport.scale,r=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(r*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(a=e.viewport.displayedArea.columnPixelSpacing,r=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*r),n=e.canvas.width/(s*a);a=r=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(r*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,r),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},36931:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(12132),i=n(57162);function a(e,t,n,a){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return(0,o.A)();const r=(0,i.A)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:r,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==a?a:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},50584:(e,t,n)=>{n(49038),n(86252),n(90808),n(29625),n(50180),n(1271)},71851:(e,t,n)=>{n.d(t,{BlendModes:()=>l.A,CalibrationTypes:()=>h.A,Events:()=>i.A,GeometryType:()=>d.A,ImageQualityStatus:()=>p.A,InterpolationType:()=>s.A,MeshType:()=>g.A,MetadataModules:()=>v.A,OrientationAxis:()=>c.A,RenderingEngineModeEnum:()=>I.A,RequestType:()=>a.A,VOILUTFunctionType:()=>u.A,VideoEnums:()=>f,ViewportStatus:()=>m.A,ViewportType:()=>r.A});var o,i=n(32643),a=n(43213),r=n(41864),s=n(29310),l=n(63591),c=n(18735),d=n(91346),g=(n(86066),n(32731)),u=n(82501),h=(n(91369),n(38059)),m=n(1814),p=n(77474),f=n(13545),v=n(69850);!function(e){e.SUM="SUM",e.SUBTRACT="SUBTRACT",e.AVERAGE="AVERAGE"}(o||(o={}));n(6796);var I=n(8128)},15327:(e,t,n)=>{n.d(t,{BaseVolumeViewport:()=>l.A,CONSTANTS:()=>i,Enums:()=>o,StackViewport:()=>c.A,VolumeViewport:()=>s.A,addImageSlicesToViewports:()=>E.ge,addVolumesToViewports:()=>E.x,cache:()=>u.Ay,convertMapperToNotSharedMapper:()=>r.h,createVolumeActor:()=>a.A,eventTarget:()=>d.A,getEnabledElement:()=>h.Ay,getEnabledElementByIds:()=>h.b1,getEnabledElementByViewportId:()=>h.yj,getEnabledElements:()=>h.zb,getRenderingEngine:()=>g.lD,getRenderingEngines:()=>g.qO,getWebWorkerManager:()=>p.G_,metaData:()=>m,triggerEvent:()=>P.A,utilities:()=>M,volumeLoader:()=>x});var o=n(71851),i=n(76491),a=(n(90340),n(61640)),r=n(92099),s=(n(30135),n(94155)),l=(n(40893),n(95205)),c=n(79720),d=(n(32501),n(81466),n(10056),n(10364)),g=(n(78337),n(39536)),u=(n(50584),n(49038)),h=(n(91073),n(51159),n(86846)),m=n(74876),p=n(26896);const f=Symbol("DefaultSettings"),v=Symbol("RuntimeSettings"),I=Symbol("ObjectSettingsMap"),w=Symbol("Dictionary");class A{constructor(e){const t=Object.create(e instanceof A&&w in e?e[w]:null);Object.seal(Object.defineProperty(this,w,{value:t}))}set(e,t){return S(this[w],e,t,null)}get(e){return function(e,t){return e[t]}(this[w],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const o=t,i=o.slice(0,-1),a=0===i.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a||t.startsWith(o)||t===i)&&(delete e[t],++n);return n>0}return delete e[t]}(this[w],e+"")}forEach(e){b(this[w],e)}extend(){return new A(this)}import(e){y(e)&&Object.keys(e).forEach(t=>{S(this[w],t,e[t],null)})}dump(){const e={};return b(this[w],(t,n)=>{void 0!==n&&R(e,t,n)}),e}static assert(e){return e instanceof A?e:A.getRuntimeSettings()}static getDefaultSettings(e=null){let t=A[f];if(t instanceof A||(t=new A,A[f]=t),e){const n={};return t.forEach(o=>{if(o.startsWith(e)){const i=o.split(`${e}.`)[1];n[i]=t.get(o)}}),n}return t}static getRuntimeSettings(){let e=A[v];return e instanceof A||(e=new A(A.getDefaultSettings()),A[v]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof A)n=e;else if("object"==typeof e&&null!==e){let o=A[I];o instanceof WeakMap||(o=new WeakMap,A[I]=o),n=o.get(e),n instanceof A||(n=new A(A.assert(A.getObjectSettings(t))),o.set(e,n))}return n}static extendRuntimeSettings(){return A.getRuntimeSettings().extend()}}function b(e,t){for(const n in e)t(n,e[n])}function S(e,t,n,o){return!!function(e){let t,n,o;if("string"!=typeof e||(t=e.length-1)<0)return!1;o=-1;for(;(n=e.indexOf(".",o+1))>=0;){if(n-o<2||n===t)return!1;o=n}return!0}(t)&&(y(n)?function(e,t,n,o){let i;if(o.has(n))return S(e,t,null,o);o.add(n),i=0;for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(S(e,0===a.length?t:`${t}.${a}`,n[a],o)||++i);return o.delete(n),0===i}(e,t,n,o instanceof WeakSet?o:new WeakSet):(e[t]=n,!0))}function y(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function R(e,t,n){const o=t.indexOf(".");if(o>=0){const i=t.slice(0,o);let a=e[i];if("object"!=typeof a||null===a){const t=a;a={},void 0!==t&&(a[""]=t),e[i]=a}R(a,t.slice(o+1,t.length),n)}else e[t]=n}A.getDefaultSettings().set("useCursors",!0);var x=n(87142),M=(n(80068),n(89926),n(36822),n(33592)),P=n(69372),E=(n(55500),n(55509),n(56074),n(40661))},80068:(e,t,n)=>{n.d(t,{createAndCacheDerivedImages:()=>A,createAndCacheLocalImage:()=>b,loadAndCacheImage:()=>I,loadImage:()=>v});var o=n(49038),i=n(32643),a=n(10364),r=n(27119),s=n(99576),l=n(69372),c=n(80221),d=n(24623),g=(n(51159),n(74876)),u=n(6796);const h={};let m;function p(e,t){const n=o.Ay.getImageLoadObject(e);if(n)return f(n.promise,e),n;const i=e.split(":")[0],a=h[i]||m;if(!a)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${i}'`);const r=a(e,t);return f(r.promise,e),r}function f(e,t){Promise.resolve(e).then(e=>{!function(e){if(!e.voxelManager){const{width:t,height:n,numberOfComponents:o}=e,i=d.A.createImageVoxelManager({scalarData:e.getPixelData(),width:t,height:n,numberOfComponents:o});e.voxelManager=i,e.getPixelData=()=>i.getScalarData(),delete e.imageFrame.pixelData}}(e),(0,l.A)(a.A,i.A.IMAGE_LOADED,{image:e})}).catch(e=>{const n={imageId:t,error:e};(0,l.A)(a.A,i.A.IMAGE_LOAD_FAILED,n)})}function v(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return p(e,t).promise}function I(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=p(e,t);return o.Ay.getImageLoadObject(e)||o.Ay.putImageLoadObject(e,n),n.promise}function w(e,t={}){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,c.A)()}`);const{imageId:n,skipCreateBuffer:i,onCacheAdd:a,voxelRepresentation:l}=t,d=g.get("imagePlaneModule",e),u=d.rows*d.columns,{TypedArrayConstructor:h}=(0,s.h)(t.targetBuffer?.type,u),m=new h(i?1:u),p=n,f=g.get("imagePlaneModule",e);r.A.add(p,{type:"imagePlaneModule",metadata:f});const v=g.get("generalSeriesModule",e);r.A.add(p,{type:"generalSeriesModule",metadata:v}),r.A.add(p,{type:"generalImageModule",metadata:{instanceNumber:t.instanceNumber}});const I=g.get("imagePixelModule",e);r.A.add(p,{type:"imagePixelModule",metadata:{...I,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const w=b(n,{scalarData:m,onCacheAdd:a,skipCreateBuffer:i,targetBuffer:{type:m.constructor.name},voxelRepresentation:l,dimensions:[d.columns,d.rows],spacing:[d.columnPixelSpacing,d.rowPixelSpacing],origin:d.imagePositionPatient,direction:d.imageOrientationPatient,frameOfReferenceUID:d.frameOfReferenceUID,referencedImageId:e});return w.referencedImageId=e,o.Ay.getImageLoadObject(n)||o.Ay.putImageSync(n,w),w}function A(e,t={}){if(0===e.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[];return e.map((e,o)=>{const i={imageId:t?.getDerivedImageId?.(e)||`derived:${(0,c.A)()}`,...t};return n.push(i.imageId),w(e,{...i,instanceNumber:o+1})})}function b(e,t){const{scalarData:n,origin:i,direction:a,targetBuffer:l,skipCreateBuffer:c,onCacheAdd:g,frameOfReferenceUID:h,voxelRepresentation:m,referencedImageId:p}=t,f=t.dimensions,v=t.spacing;if(!f||!v)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const I=f[0],w=f[1],A=v[0],b=v[1],S={frameOfReferenceUID:h,rows:w,columns:I,imageOrientationPatient:a??[1,0,0,0,1,0],rowCosines:a?a.slice(0,3):[1,0,0],columnCosines:a?a.slice(3,6):[0,1,0],imagePositionPatient:i??[0,0,0],pixelSpacing:[b,A],rowPixelSpacing:b,columnPixelSpacing:A},y=I*w,R=n.length/y;let x,M,P,E;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");x=n}else if(!c){const{TypedArrayConstructor:e}=(0,s.h)(l?.type,y);x=new e(y)}if(x instanceof Uint8Array)M=8,P=8,E=7;else if(x instanceof Uint16Array)M=16,P=16,E=15;else if(x instanceof Int16Array)M=16,P=16,E=15;else{if(!(x instanceof Float32Array))throw new Error("Unsupported scalarData type");M=32,P=32,E=31}const D={samplesPerPixel:1,photometricInterpretation:x.length>f[0]*f[1]?"RGB":"MONOCHROME2",rows:w,columns:I,bitsAllocated:M,bitsStored:P,highBit:E},C={imagePlaneModule:S,imagePixelModule:D};["imagePlaneModule","imagePixelModule"].forEach(t=>{r.A.add(e,{type:t,metadata:C[t]||{}})});const T=e,L=m===u.A.RLE&&d.A.createRLEImageVoxelManager({dimensions:f,id:T})||d.A.createImageVoxelManager({height:w,width:I,numberOfComponents:R,scalarData:x,id:T});let _=x[0],O=x[0];for(let e=1;e<x.length;e++)x[e]<_&&(_=x[e]),x[e]>O&&(O=x[e]);const V={imageId:e,intercept:0,windowCenter:0,windowWidth:0,color:"RGB"===D.photometricInterpretation,numberOfComponents:D.samplesPerPixel,dataType:l?.type,slope:1,minPixelValue:_,maxPixelValue:O,rows:D.rows,columns:D.columns,getCanvas:void 0,height:D.rows,width:D.columns,rgba:void 0,columnPixelSpacing:S.columnPixelSpacing,rowPixelSpacing:S.rowPixelSpacing,FrameOfReferenceUID:S.frameOfReferenceUID,invert:!1,getPixelData:()=>L.getScalarData(),voxelManager:L,sizeInBytes:n.byteLength,referencedImageId:p};return g?.(V),o.Ay.putImageSync(V.imageId,V),V}},56750:(e,t,n)=>{n.d(t,{A:()=>o});class o{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map(e=>Number(e));return 1===n.length?n[0]:n}static imageIdToFrameEnd(e){const t=this.imageIdToFrames(e);return Array.isArray(t)?t[1]:t}static imageIdToFrameStart(e){const t=this.imageIdToFrames(e);return Array.isArray(t)?t[0]:t}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const o=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${o}`)}}},13876:(e,t,n)=>{n.d(t,{A:()=>o});class o{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:t=1024,dimensions:n=3,growSize:o=128}=e,i=t*n;this.growSize=o,this.array=new ArrayBuffer(i*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let t=0;t<this._length;t++)e(this.getPoint(t),t)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const t=this._dimensions*e;return this.data.subarray(t,t+this._dimensions)}getPointArray(e){const t=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let e=0;e<this._dimensions;e++)t.push(this.data[e+n]);return t}grow(e=1,t=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+t,o=new ArrayBuffer(n*this._dimensions*this._byteSize),i=new Float32Array(o);i.set(this.data),this.data=i,this.array=o}reverse(){const e=Math.floor(this._length/2);for(let t=0;t<e;t++){const e=t*this._dimensions,n=(this._length-1-t)*this._dimensions;for(let t=0;t<this._dimensions;t++){const o=this.data[e+t];this.data[e+t]=this.data[n+t],this.data[n+t]=o}}}getTypedArray(){return this.data}push(e){this.grow(1);const t=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+t]=e[n];this._length++}map(e){const t=[];for(let n=0;n<this._length;n++)t.push(e(this.getPoint(n),n));return t}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:t,y:n,z:o}=e;return this.forEach(e=>{t.push(e[0]),n.push(e[1]),o&&o.push(e[2])}),e}static fromXYZ({x:e,y:t,z:n}){const i=o.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=t[o],i.data[a++]=n?n[o]:0;return i._length=e.length,i}subselect(e=10,t=0){const n=new o({initialSize:e,dimensions:this._dimensions});for(let o=0;o<e;o++){const i=(t+Math.floor(this.length*o/e))%this.length;n.push(this.getPoint(i))}return n}static create3(e=128,t){e=Math.max(e,t?.length||0);const n=new o({initialSize:e,dimensions:3});return t&&t.forEach(e=>n.push(e)),n}static create2(e=128){return new o({initialSize:e,dimensions:2})}}},22191:(e,t,n)=>{n.d(t,{A:()=>o});class o{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const t=new o("as iterator");return e.then(e=>{try{t.add(e,!0)}catch(e){t.reject(e)}},e=>{t.reject(e)}),t}add(e,t=!1){this.nextValue=e,this.done||=t,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(void 0!==this.nextValue&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,t)=>{this.waiting.resolve=e,this.waiting.reject=t})),await this.waiting.promise}yield this.nextValue}async forEach(e,t){let n=0;try{for await(const o of this){const{done:i}=this;try{await e(o,i,n),n++}catch(e){if(!i){console.warn("Caught exception in intermediate value",e);continue}if(!t)throw e;t(e,i)}}}catch(e){if(!t)throw e;t(e,!0)}}generate(e,t){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},e=>{this.reject(e),t?t(e):console.warn("Couldn't process because",e)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}},67645:(e,t,n)=>{n.d(t,{A:()=>s});const o=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],i=[[0,-1,0],[0,1,0]],a=[[0,-1,0],[0,1,0],[0,0,-1]],r=[[0,-1,0],[0,1,0],[0,0,1]];class s{static copyMap(e,t){for(const[n,o]of t.rows)e.rows.set(n,structuredClone(o))}constructor(e,t,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(e){e.fill(0);this.forEach((t,n,o)=>{const{start:i,end:a,value:r}=n;for(let n=i;n<a;n++)e[t+n]=r})},this.get=e=>{const t=e%this.jMultiple,n=(e-t)/this.jMultiple,o=this.getRLE(t,n);return o?.value??this.defaultValue},this.getRun=(e,t)=>{const n=e+t*this.height;return this.rows.get(n)},this.set=(e,t)=>{if(void 0===t)return;const n=e%this.width,o=(e-n)/this.width,i=this.rows.get(o);if(!i)return void this.rows.set(o,[{start:n,end:n+1,value:t}]);const a=this.findIndex(i,n),r=i[a],s=i[a-1];if(!r)return s&&s.value===t&&s.end===n?void s.end++:void(i[a]={start:n,end:n+1,value:t});const{start:l,end:c,value:d}=r;if(t===d&&n>=l)return;const g={start:n,end:n+1,value:t},u=n>l,h=u?a+1:a,m=u?r:s;let p=u?i[a+1]:r;if(m?.value===t&&m?.end===n)return m.end++,void(p?.value===t&&p.start===n+1?(m.end=p.end,i.splice(a,1)):p?.start===n&&(p.start++,p.start===p.end&&(i.splice(a,1),p=i[a],p?.start===n+1&&p.value===t&&(m.end=p.end,i.splice(a,1)))));if(p?.value===t&&p.start===n+1)return p.start--,void(m?.end>n&&(m.end=n,m.end===m.start&&i.splice(a,1)));if(p?.start===n&&p.end===n+1){p.value=t;const e=i[a+1];return void(e?.start==n+1&&e.value===t&&(i.splice(a+1,1),p.end=e.end))}n===p?.start&&p.start++,u&&c>n+1?i.splice(h,0,g,{start:n+1,end:m.end,value:m.value}):i.splice(h,0,g),m?.end>n&&(m.end=n)},this.width=e,this.height=t,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*t}static{this.getScalarData=function(e=Uint8ClampedArray){const t=new e(this.frameSize);return this.map.updateScalarData(t),t}}toIJK(e){const t=e%this.jMultiple;return[t,(e-t)/this.jMultiple%this.height,Math.floor(e/this.kMultiple)]}toIndex([e,t,n]){return e+n*this.kMultiple+t*this.jMultiple}getRLE(e,t,n=0){const o=this.rows.get(t+n*this.height);if(!o)return;const i=o[this.findIndex(o,e)];return e>=i?.start?i:void 0}has(e){const t=e%this.jMultiple,n=(e-t)/this.jMultiple,o=this.getRLE(t,n);return void 0!==o?.value}delete(e){const t=e%this.width,n=(e-t)/this.width,o=this.rows.get(n);if(!o)return;const i=this.findIndex(o,t),a=o[i];if(!a||a.start>t)return;if(a.end===t+1)return a.end--,void(a.start>=a.end&&(o.splice(i,1),o.length||this.rows.delete(n)));if(a.start===t)return void a.start++;const r={value:a.value,start:t+1,end:a.end};a.end=t,o.splice(i+1,0,r)}findIndex(e,t){for(let n=0;n<e.length;n++){const{end:o}=e[n];if(t<o)return n}return e.length}forEach(e,t){const n=t?.rowModified;for(const[t,o]of this.rows){const i=n?[...o]:o;for(const n of i)e(t*this.width,n,o)}}forEachRow(e){for(const[t,n]of this.rows)e(t*this.width,n)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,t){t?t.fill(0):t=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:o,numComps:i}=this;for(let a=0;a<o;a++){const o=this.getRun(a,e);if(o)if(1===i)for(const e of o){const o=a*n,{start:i,end:r,value:s}=e;for(let e=i;e<r;e++)t[o+e]=s}else for(const e of o){const o=a*n*i,{start:r,end:s,value:l}=e;for(let e=r;e<s;e+=i)for(let n=0;n<i;n++)t[o+e+n]=l[n]}}return t}floodFill(e,t,n,o,i){const a=this.getRLE(e,t,n);if(!a)throw new Error(`Initial point ${e},${t},${n} isn't in the RLE`);const r=[[a,t,n]],s=a.value;if(s===o)throw new Error(`source (${s}) and destination (${o}) are identical`);return this.flood(r,s,o,i)}flood(e,t,n,o){let i=0;const{planar:a=!0,diagonals:r=!0,singlePlane:s=!1}=o||{},l={planar:a,diagonals:r,singlePlane:s};for(;e.length;){const o=e.pop(),[a]=o;if(a.value!==t)continue;a.value=n,i+=a.end-a.start;const r=this.findAdjacents(o,l).filter(e=>e&&e[0].value===t);e.push(...r)}return i}fillFrom(e,t){for(let n=t[2][0];n<=t[2][1];n++)for(let o=t[1][0];o<=t[1][1];o++){let i,a;for(let r=t[0][0];r<=t[0][1];r++){const t=e(r,o,n);void 0!==t?(a||(a=[],this.rows.set(o+n*this.height,a)),i&&i.value!==t&&(i=void 0),i||(i={start:r,end:r,value:t},a.push(i)),i.end++):i=void 0}}}findAdjacents(e,{diagonals:t=!0,planar:n=!0,singlePlane:s=!1}){const[l,c,d,g]=e,{start:u,end:h}=l,m=u>0&&this.getRLE(u-1,c,d),p=h<this.width&&this.getRLE(h,c,d),f=t?[u>0?u-1:u,h<this.width?h+1:h]:[u,h],v=[];m&&v.push([m,c,d]),p&&v.push([p,c,d]);for(const e of g||(s?i:o)){const[,t,l]=e,u=t+c,h=l+d;if(u<0||u>=this.height)continue;if(h<0||h>=this.depth)continue;const m=this.getRun(u,h);if(m)for(const e of m){const t=g||s&&i||n&&l>0&&r||n&&l<0&&a||o;e.end<=f[0]||e.start>=f[1]||v.push([e,u,h,t])}}return v}}},98039:(e,t,n)=>{function o(e){return i(e,"vtkVolume")||i(e,"vtkImageSlice")}function i(e,t){const n="isA"in e?e:e.actor;return!!n&&!!n.isA(t)}n.d(t,{N:()=>i,e:()=>o})},96833:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(642),i=n(99341);function a(e,t){const n=t.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:a}=function(e){let t=1/0,n=-1/0;for(let o=0;o<e.length;o+=4)t=Math.min(t,e[o]),n=Math.max(n,e[o]);const o=(n-t)/2;return{shiftRange:[-o,o],min:t,max:n}}(n),r=a[0],s=a[1]-a[0],l=o.Ay.newInstance(),c=[];for(let e=0;e<n.length;e+=4){let t=n[e];const o=n[e+1],i=n[e+2],a=n[e+3];t=(t-r)/s,c.push([t,o,i,a])}!function(e,t,n){const o=t[1]-t[0],i=e.map(([e,n,i,a])=>[e*o+t[0],n,i,a]);n.removeAllPoints(),i.forEach(([e,t,o,i])=>n.addRGBPoint(e,t,o,i))}(c,a,l),e.getProperty().setRGBTransferFunction(0,l);const d=t.scalarOpacity.split(" ").splice(1).map(parseFloat),g=i.Ay.newInstance(),u=[];for(let e=0;e<d.length;e+=2){let t=d[e];const n=d[e+1];t=(t-r)/s,u.push([t,n])}!function(e,t,n){const o=t[1]-t[0],i=e.map(([e,n])=>[e*o+t[0],n]);n.removeAllPoints(),i.forEach(([e,t])=>n.addPoint(e,t))}(u,a,g);const h=e.getProperty();h.setScalarOpacity(0,g);const[m,p,f,v]=t.gradientOpacity.split(" ").splice(1).map(parseFloat);h.setUseGradientOpacity(0,!0),h.setGradientOpacityMinimumValue(0,m),h.setGradientOpacityMinimumOpacity(0,p),h.setGradientOpacityMaximumValue(0,f),h.setGradientOpacityMaximumOpacity(0,v),"1"===t.interpolation&&h.setInterpolationTypeToFastLinear(),h.setShade("1"===t.shade);const I=parseFloat(t.ambient),w=parseFloat(t.diffuse),A=parseFloat(t.specular),b=parseFloat(t.specularPower);h.setAmbient(I),h.setDiffuse(w),h.setSpecular(A),h.setSpecularPower(b)}},91979:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(39536),i=n(24724);const a=e=>{const t=function(e){const t=(0,o.qO)(),n=[];return t.forEach(t=>{const o=(0,i.A)(e);o.length&&n.push({renderingEngine:t,viewportIds:o.map(e=>e.id)})}),n}(e);t?.length&&t.forEach(({renderingEngine:e,viewportIds:t})=>{e.hasBeenDestroyed||e.renderViewports(t)})}},89131:(e,t,n)=>{n.d(t,{KP:()=>r,SJ:()=>a});var o=n(74876),i=n(71851);function a(e){const t={...o.get(i.MetadataModules.IMAGE_PLANE,e)};return t.columnPixelSpacing||(t.columnPixelSpacing=1),t.rowPixelSpacing||(t.rowPixelSpacing=1),t.columnCosines||(t.columnCosines=[0,1,0]),t.rowCosines||(t.rowCosines=[1,0,0]),t.imagePositionPatient||(t.imagePositionPatient=[0,0,0]),t.imageOrientationPatient||(t.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),t}function r(e){const t=e.imageId,{pixelRepresentation:n,bitsAllocated:r,bitsStored:s,highBit:l,photometricInterpretation:c,samplesPerPixel:d}=o.get("imagePixelModule",t),{windowWidth:g,windowCenter:u,voiLUTFunction:h}=e,{modality:m}=o.get("generalSeriesModule",t),p=o.get("scalingModule",t),f=o.get(i.MetadataModules.CALIBRATION,t),v=function(e){return Object.values(i.VOILUTFunctionType).includes(e)?e:i.VOILUTFunctionType.LINEAR}(h);return{calibration:f,scalingFactor:p,voiLUTFunction:v,modality:m,imagePlaneModule:a(t),imagePixelModule:{bitsAllocated:r,bitsStored:s,samplesPerPixel:d,highBit:l,photometricInterpretation:c,pixelRepresentation:n,windowWidth:g,windowCenter:u,modality:m,voiLUTFunction:v}}}},42384:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(3823),i=n(74876),a=n(26896);function r(e){const{imagePositionPatient:t,imageOrientationPatient:n}=i.get("imagePlaneModule",e[0]),r=o.eR.fromValues(n[0],n[1],n[2]),s=o.eR.fromValues(n[3],n[4],n[5]),l=o.eR.create();o.eR.cross(l,r,s);const c=o.eR.fromValues(t[0],t[1],t[2]);let d;function g(e){const{imagePositionPatient:t}=i.get("imagePlaneModule",e),n=o.eR.create(),a=o.eR.fromValues(t[0],t[1],t[2]);return o.eR.sub(n,c,a),o.eR.dot(n,l)}if("wadouri"===e[0].split(":")[0]){const t=[e[0],e[Math.floor(e.length/2)]],n=(g(t[0]),g(t[1]),i.get("imagePlaneModule",t[1]));if(!n)throw new Error("Incomplete metadata required for volume construction.");const a=o.eR.create(),r=o.eR.fromValues(n.imagePositionPatient[0],n.imagePositionPatient[1],n.imagePositionPatient[2]);o.eR.sub(a,c,r);const s=o.eR.dot(a,l);d=Math.abs(s)/Math.floor(e.length/2)}else{const t=e.map(e=>({distance:g(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance);const n=t.length;d=Math.abs(t[n-1].distance-t[0].distance)/(n-1)}const{sliceThickness:u,spacingBetweenSlices:h}=i.get("imagePlaneModule",e[0]),{strictZSpacingForVolumeViewport:m}=(0,a.D0)().rendering;return 0!==d&&!isNaN(d)||m||(h?(console.debug("Could not calculate spacing. Using spacingBetweenSlices"),d=h):u?(console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),d=u):(console.debug("Could not calculate spacing. The VolumeViewport visualization is compromised. Setting spacing to 1 to render"),d=1)),d}},84061:(e,t,n)=>{function o(e,t,n){return Math.max(t,Math.min(n,e))}n.d(t,{A:()=>o,q:()=>o})},13859:(e,t,n)=>{n.r(t),n.d(t,{findMatchingColormap:()=>u,getColormap:()=>d,getColormapNames:()=>g,getMaxOpacity:()=>I,getThresholdValue:()=>v,registerColormap:()=>c,setColorMapTransferFunctionForVolumeActor:()=>h,updateOpacity:()=>m,updateThreshold:()=>p});var o=n(660),i=n(642),a=n(99341),r=n(74638),s=n(98039);const l=new Map;function c(e){e.name=e.name||e.Name,l.set(e.name,e)}function d(e){return l.get(e)}function g(){return Array.from(l.keys())}function u(e,t){const n=o.A.rgbPresetNames.map(e=>o.A.getPresetByName(e)),i=g().map(e=>d(e)),a=n.concat(i).find(t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,r.Ay)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0});if(!a)return null;const l=[];if((0,s.N)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:a.Name};for(let t=0;t<e.length;t+=2)l.push({value:e[t],opacity:e[t+1]})}return{name:a.Name,...Array.isArray(l)&&l.length>0&&{opacity:l},..."number"==typeof l&&{opacity:l}}}function h(e){const{volumeActor:t,preset:n,opacity:a=.9,threshold:r=null,colorRange:s=[0,5]}=e;t.getMapper().setSampleDistance(1);const l=i.Ay.newInstance(),c=n||o.A.getPresetByName("hsv");l.applyColorMap(c),l.setMappingRange(s[0],s[1]),t.getProperty().setRGBTransferFunction(0,l),f(t,a,r)}function m(e,t){f(e,t,v(e))}function p(e,t){f(e,I(e),t)}function f(e,t,n){const o=e.getMapper().getInputData().get("voxelManager");if(!o?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const i=o.voxelManager.getRange(),r=a.Ay.newInstance();if(null!==n){const e=.001*Math.abs(i[1]-i[0]),o=Math.max(i[0],Math.min(i[1],n));r.addPoint(i[0],0),r.addPoint(o-e,0),r.addPoint(o,t),r.addPoint(i[1],t)}else r.addPoint(i[0],t),r.addPoint(i[1],t);e.getProperty().setScalarOpacity(0,r)}function v(e){const t=e.getProperty().getScalarOpacity(0);if(!t)return null;const n=t.getDataPointer();if(!n||n.length<=4)return null;for(let e=0;e<n.length-2;e+=2){n[e];const t=n[e+1],o=n[e+2],i=n[e+3];if(0===t&&i>0)return o}return null}function I(e){const t=e.getProperty().getScalarOpacity(0);if(!t)return 1;const n=t.getDataPointer();if(!n||0===n.length)return 1;let o=0;for(let e=1;e<n.length;e+=2)n[e]>o&&(o=n[e]);return o}},74657:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(642);function i(e){const t=o.Ay.newInstance();let n=0,i=1024;return void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,i=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(i,1,1,1),t}},40256:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(642),i=n(42008),a=n(68136),r=n(58977);function s(e,t=1024){const{windowWidth:n,windowCenter:s}=a.toWindowLevel(e.lower,e.upper),l=Array.from({length:t},(e,n)=>(n+1)/(t+2)).flatMap(e=>[(0,r.i)(e,s,n),e,e,e,.5,0]),c=o.Ay.newInstance();return c.buildFunctionFromArray(i.Ay.newInstance({values:l,numberOfComponents:6})),c}},63470:(e,t,n)=>{function o(e,t,n=0){const o=[];for(let i=n;i<e.length;i+=t)o.push(i);return o}n.d(t,{A:()=>o})},99949:(e,t,n)=>{function o(e){if(null===e||"object"!=typeof e)return e;if("function"==typeof e)return e;if("function"==typeof structuredClone)return e;if(Array.isArray(e))return e.map(o);{const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=o(e[n]));return t}}n.d(t,{G:()=>o})},20286:(e,t,n)=>{function o(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return(t>>>0).toString(36)}n.d(t,{A:()=>o})},88619:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(3823),i=n(74876),a=n(7608),r=n(85008),s=n(76491);const l=a.coreLog.getLogger("utilities","getClosestImageId");function c(e,t,n,a){const{direction:c,spacing:d,imageIds:g}=e,{ignoreSpacing:u=!1}=a||{};if(!g?.length)return;const h=c.slice(6,9),m=o.eR.dot(h,n);if(Math.abs(m)<1-s.EPSILON)return;let p,f;if(!u){p=(0,r.A)({direction:c,spacing:d},n)/2}let v=1/0;for(let e=0;e<g.length;e++){const a=g[e],r=i.get("imagePlaneModule",a);if(!r?.imagePositionPatient){l.warn(`Missing imagePositionPatient for imageId: ${a}`);continue}const{imagePositionPatient:s}=r,c=o.eR.create();o.eR.sub(c,t,s);const d=Math.abs(o.eR.dot(c,n));u?d<v&&(v=d,f=a):d<p&&d<v&&(v=d,f=a)}return void 0===f&&l.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),f}},53932:(e,t,n)=>{n.d(t,{T:()=>r});var o=n(3823),i=n(76491),a=n(89131);function r(e){const{imagePlaneModule:t,imagePixelModule:n,voiLUTFunction:r,modality:s,scalingFactor:l,calibration:c}=(0,a.KP)(e);let{rowCosines:d,columnCosines:g}=t;null!=d&&null!=g||(d=[1,0,0],g=[0,1,0]);const u=o.eR.fromValues(d[0],d[1],d[2]),h=o.eR.fromValues(g[0],g[1],g[2]),m=o.eR.create();o.eR.cross(m,u,h);let p=t.imagePositionPatient;null==p&&(p=[0,0,0]);const f=t.columnPixelSpacing||e.columnPixelSpacing,v=t.rowPixelSpacing||e.rowPixelSpacing,I=e.columns,w=e.rows,A=i.EPSILON;n.photometricInterpretation||e.sizeInBytes!==3*e.width*e.height||(e.numberOfComponents=3);return{numberOfComponents:e.numberOfComponents||function(e){let t=1;("RGB"===e||e?.includes("YBR")||"PALETTE COLOR"===e)&&(t=3);return t}(n.photometricInterpretation),origin:p,direction:[...u,...h,...m],dimensions:[I,w,1],spacing:[f,v,A],numVoxels:I*w*1,imagePlaneModule:t,imagePixelModule:n,bitsAllocated:n.bitsAllocated,voiLUTFunction:r,modality:s,scalingFactor:l,calibration:c,scanAxisNormal:m}}},47476:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(20537),i=n(65292);const a=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:a}=(0,i.A)(e,t);if(!a)return;const{viewPlaneNormal:r,focalPoint:s}=t,l=e.getActors().find(e=>e.referencedId===a.volumeId||e.uid===a.volumeId);l||console.warn("No actor found for with actorUID of",a.volumeId);const c=l.actor,d=(0,o.A)(c,r,s),{min:g,max:u,current:h}=d,m=Math.round((u-g)/n)+1;let p=(h-g)/(u-g)*m;return p=Math.floor(p),p>m-1?p=m-1:p<0&&(p=0),{numberOfSlices:m,imageIndex:p}}},32173:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(74876);function i(e){const t=o.get("modalityLutModule",e)||{},n=o.get("generalSeriesModule",e)||{},{modality:i}=n,a={rescaleSlope:t.rescaleSlope||1,rescaleIntercept:t.rescaleIntercept??0,modality:i},r=o.get("scalingModule",e)||{};return{...a,..."PT"===i&&{suvbw:r.suvbw,suvbsa:r.suvbsa,suvlbm:r.suvlbm},..."RTDOSE"===i&&{doseGridScaling:r.DoseGridScaling,doseSummation:r.DoseSummation,doseType:r.DoseType,doseUnit:r.DoseUnit}}}},20537:(e,t,n)=>{n.d(t,{A:()=>d});var o=n(89265),i=n(15105),a=n(76491);const r=a.EPSILON*a.EPSILON,s=e=>Math.abs(Math.abs(e)-1)<r,l=(e,t)=>s(e[t])||s(e[t+1])||s(e[t+2]),c=e=>l(e,0)&&l(e,3)&&l(e,6);function d(e,t,n){const a=e.getMapper().getInputData();let r;const s=a.getDirection();if(c(s))r=(0,i.A)(e);else{const[e,t,n]=a.getDimensions();r=[[0,0,0],[e-1,0,0],[0,t-1,0],[e-1,t-1,0],[0,0,n-1],[e-1,0,n-1],[0,t-1,n-1],[e-1,t-1,n-1]].map(e=>a.indexToWorld(e))}const l=o.A.buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);r.forEach(e=>l.apply(e));const d=[...n];l.apply(d);const g=d[0];let u=1/0,h=-1/0;for(let e=0;e<8;e++){const t=r[e][0];t>h&&(h=t),t<u&&(u=t)}return{min:u,max:h,current:g,actor:e,viewPlaneNormal:t,focalPoint:n}}},85008:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(3823);function i(e,t){const{direction:n,spacing:i}=e,a=n.slice(0,3),r=n.slice(3,6),s=n.slice(6,9),l=[o.eR.dot(a,t),o.eR.dot(r,t),o.eR.dot(s,t)],c=o.eR.create();o.eR.set(c,l[0]*i[0],l[1]*i[1],l[2]*i[2]);return o.eR.length(c)}},65292:(e,t,n)=>{n.d(t,{A:()=>d});var o=n(49038),i=n(76491),a=n(85008),r=n(87142),s=n(12437);const l=1+i.EPSILON,c=e=>!!(0,r.getVolumeLoaderSchemes)().find(t=>{return n=e.volumeId,(o=t)===n.substring(0,Math.min(n.length,o.length));var n,o});function d(e,t,n,i=!1){const{viewPlaneNormal:a}=t,r=e.getActors();if(!r.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const d=r.map(e=>{const t=e.referencedId??e.uid;return o.Ay.getVolume(t)}).filter(e=>!!e);if(n){const t=(0,s.A)(n),o=d.findIndex(e=>t.includes(e.volumeId)),l=d[o],{uid:c}=r[o];return{imageVolume:l,spacingInNormalDirection:g(l,a,e,i),actorUID:c}}if(!d.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const u={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},h=d.find(c);for(let t=0;t<d.length;t++){const n=d[t];if(h&&!c(n))continue;const o=g(n,a,e);o*l<u.spacingInNormalDirection&&(u.spacingInNormalDirection=o,u.imageVolume=n,u.actorUID=r[t].uid)}return u}function g(e,t,n,o=!1){const{slabThickness:i}=n.getProperties();let r=i;return i&&o||(r=(0,a.A)(e,t)),r}},24724:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(39536);const i=function(e){const t=(0,o.qO)(),n=[];return t.forEach(t=>{const o=t.getVolumeViewports().filter(t=>t.hasVolumeId(e));n.push(...o)}),n}},70210:(e,t,n)=>{function o(e){let t=[];const[n,o]=e.getRange();e.getTable(n,o,1024,t),t=t.filter((e,t)=>t%3==0);const i=[...Array(1024).keys()].map((e,t)=>n+(o-n)/1023*t),a=t[256],r=Math.log((1-a)/a),s=i[256],l=t[768],c=Math.log((1-l)/l),d=i[768],g=Math.round(4*(d-s)/(r-c)),u=Math.round(s+g*r/4);return[Math.round(u-g/2),Math.round(u+g/2)]}n.d(t,{A:()=>o})},15105:(e,t,n)=>{function o(e){const t=e.getMapper().getInputData(),n=t.extentToBounds(t.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}n.d(t,{A:()=>o})},12437:(e,t,n)=>{n.d(t,{A:()=>o});const o=e=>{const t="volumeId:",n=e.includes(t)?e.substring(9):e,o=n.indexOf("sliceIndex=");return-1===o?n:n.substring(0,o-1)}},4031:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(20537),i=n(65292);const a=function(e,t,n=!1){const a=e.getCamera(),{focalPoint:r,viewPlaneNormal:s}=a,{spacingInNormalDirection:l,actorUID:c}=(0,i.A)(e,a,t,n);if(!c)throw new Error(`Could not find image volume with id ${t} in the viewport`);const d=e.getActor(c);if(!d)return console.warn("No actor found for with actorUID of",c),null;const g=d.actor;return{sliceRange:(0,o.A)(g,s,r),spacingInNormalDirection:l,camera:a}}},61375:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(4031);const i=function(e,t,n=!1){const{sliceRange:i,spacingInNormalDirection:a,camera:r}=(0,o.A)(e,t,n),{min:s,max:l,current:c}=i,d=Math.round((l-s)/a),g=(c-s)/(l-s)*d;return{numScrollSteps:d,currentStepIndex:Math.round(g),sliceRangeInfo:{sliceRange:i,spacingInNormalDirection:a,camera:r}}}},30169:(e,t,n)=>{n.d(t,{a:()=>o});const o=e=>Object.values(e).some(e=>"number"==typeof e&&!Number.isInteger(e))},38883:(e,t,n)=>{function o(e){return Array.isArray(e)?e.some(e=>Number.isNaN(e)):Number.isNaN(e)}n.d(t,{A:()=>o})},39537:(e,t,n)=>{function o(e){const t=e.indexOf(":");return e.substring(t+1)}n.d(t,{A:()=>o})},17791:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(74876);const i=new Map,a="imageRetrieveConfiguration",r={IMAGE_RETRIEVE_CONFIGURATION:a,clear:()=>{i.clear()},add:(e,t)=>{i.set(e,t)},clone:()=>new Map(i),restore:e=>{i.clear(),e.forEach((e,t)=>{i.set(t,e)})},get:(e,...t)=>{if(e===a)return t.map(e=>i.get(e)).find(e=>void 0!==e)}};(0,o.addProvider)(r.get.bind(r));const s=r},33592:(e,t,n)=>{n.r(t),n.d(t,{FrameRange:()=>pt.A,HistoryMemo:()=>i,PointsManager:()=>xe.A,ProgressiveIterator:()=>Ue.A,RLEVoxelMap:()=>Je.A,VoxelManager:()=>Ke.A,actorIsA:()=>ge.N,applyPreset:()=>Re.A,asArray:()=>Q,autoLoad:()=>Et.A,buildMetadata:()=>It.KP,calculateNeighborhoodStats:()=>Bt,calculateSpacingBetweenImageIds:()=>Ut.A,calculateViewportsSpatialRegistration:()=>Ae,calibratedPixelSpacingMetadataProvider:()=>R,clamp:()=>x.A,clip:()=>Lt,color:()=>r,colormap:()=>ct,convertStackToVolumeViewport:()=>Ze,convertToGrayscale:()=>et,convertVolumeToStackViewport:()=>$e,createLinearRGBTransferFunction:()=>u.A,createSigmoidRGBTransferFunction:()=>d.A,createSubVolume:()=>Vt,decimate:()=>ke.A,deepClone:()=>Ct.G,deepEqual:()=>mt,deepMerge:()=>Me.A,eventListener:()=>o,fnv1aHash:()=>ft.A,generateVolumePropsFromImageIds:()=>qe.D,genericMetadataProvider:()=>_e.A,getBufferConfiguration:()=>Ge.h,getClosestImageId:()=>P.A,getClosestStackImageIndexForPoint:()=>me,getCurrentVolumeViewportSlice:()=>fe,getDynamicVolumeInfo:()=>Pt,getImageDataMetadata:()=>vt.T,getImageLegacy:()=>Ce,getImageSliceDataForVolumeViewport:()=>de.A,getMinMax:()=>f,getPixelSpacingInformation:()=>Wt,getRandomSampleFromArray:()=>ot,getRuntimeId:()=>b,getScalingParameters:()=>Pe.A,getSliceRange:()=>le.A,getSpacingInNormalDirection:()=>E.A,getTargetVolumeAndSpacingInNormalDir:()=>D.A,getViewportImageCornersInWorld:()=>be,getViewportImageIds:()=>nt,getViewportModality:()=>qt,getViewportsWithImageURI:()=>ue,getViewportsWithVolumeId:()=>O.A,getVoiFromSigmoidRGBTransferFunction:()=>g.A,getVolumeActorCorners:()=>C.A,getVolumeDirectionVectors:()=>Nt,getVolumeId:()=>at.A,getVolumeSliceRangeInfo:()=>re.A,getVolumeViewportScrollInfo:()=>se.A,getVolumeViewportsContainingSameVolumes:()=>_,hasFloatScalingParameters:()=>rt.a,hasNaNValues:()=>ye.A,imageIdToURI:()=>S.A,imageRetrieveMetadataProvider:()=>Be.A,imageToWorldCoords:()=>ae,indexWithinDimensions:()=>T,invertRgbTransferFunction:()=>c.A,isEqual:()=>Oe.n4,isEqualAbs:()=>Oe.Ph,isEqualNegative:()=>Oe.WC,isImageActor:()=>ge.e,isNumber:()=>Oe.Et,isOpposite:()=>M,isPTPrescaledWithSUV:()=>j,isValidVolume:()=>Ve,isVideoTransferSyntax:()=>We,jumpToSlice:()=>Ot,loadImageToCanvas:()=>Y,logger:()=>kt,makeVolumeMetadata:()=>Le.A,planar:()=>he,pointInShapeCallback:()=>st.ii,renderToCanvasCPU:()=>K,renderToCanvasGPU:()=>z,roundNumber:()=>Qe,roundToPrecision:()=>Xe,scaleArray:()=>Dt,scaleRgbTransferFunction:()=>h,scroll:()=>_t,snapFocalPointToSlice:()=>ce.A,sortImageIdsAndGetSpacing:()=>Te.A,spatialRegistrationMetadataProvider:()=>we,splitImageIdsBy4DTags:()=>Mt,transferFunctionUtils:()=>dt,transformIndexToWorld:()=>N.A,transformWorldToIndex:()=>V.A,transformWorldToIndexContinuous:()=>V.p,triggerEvent:()=>m.A,updatePlaneRestriction:()=>Gt.O,updateVTKImageDataWithCornerstoneImage:()=>Ne.J,uuidv4:()=>p.A,windowLevel:()=>lt,worldToImageCoords:()=>ie});var o={};n.r(o),n.d(o,{MultiTargetEventListenerManager:()=>l,TargetEventListeners:()=>s});var i={};n.r(i),n.d(i,{DefaultHistoryMemo:()=>oe,HistoryMemo:()=>ne});var a,r={};n.r(r),n.d(r,{hexToRgb:()=>ht,rgbToHex:()=>ut}),function(e){e[e.None=0]="None",e[e.Capture=1]="Capture",e[e.Bubble=2]="Bubble"}(a||(a={}));class s{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return 0===this._eventListeners.size&&0===this._children.size}addEventListener(e,t,n){const o=e.indexOf(".");if(-1!==o){const i=e.substring(0,o);let a=this._children.get(i);a||(a=new s(this._target),this._children.set(i,a)),e=e.substring(o+1),a.addEventListener(e,t,n)}else this._addEventListener(e,t,n)}removeEventListener(e,t,n){const o=e.indexOf(".");if(-1!==o){const i=e.substring(0,o),a=this._children.get(i);if(!a)return;e=e.substring(o+1),a.removeEventListener(e,t,n),a.isEmpty&&this._children.delete(i)}else this._removeEventListener(e,t,n)}reset(){Array.from(this._children.entries()).forEach(([e,t])=>{if(t.reset(),!t.isEmpty)throw new Error("Child is not empty and cannot be removed");this._children.delete(e)}),this._unregisterAllEvents()}_addEventListener(e,t,n){let o=this._eventListeners.get(e);o||(o=new Map,this._eventListeners.set(e,o));const i=n?.capture??!1?a.Capture:a.Bubble,r=o.get(t)??a.None;r&i?console.warn("A listener is already registered for this phase"):(o.set(t,r|i),this._target.addEventListener(e,t,n))}_removeEventListener(e,t,n){const o=n?.capture??!1?a.Capture:a.Bubble,i=this._eventListeners.get(e);if(!i)return;(t?[t]:Array.from(i.keys())).forEach(t=>{const r=i.get(t)??a.None;if(!!!(r&o))return;this._target.removeEventListener(e,t,n);const s=r^o;s===a.None?i.delete(t):i.set(t,s)}),i.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,t){Array.from(t.entries()).forEach(([t,n])=>{for(let o=a.Capture;n;o<<=1){if(!(n&o))continue;const i=o===a.Capture;this.removeEventListener(e,t,{capture:i}),n^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,t])=>{this._unregisterAllListeners(e,t)})}}class l{constructor(){this._targetsEventListeners=new Map}addEventListener(e,t,n,o){let i=this._targetsEventListeners.get(e);i||(i=new s(e),this._targetsEventListeners.set(e,i)),i.addEventListener(t,n,o)}removeEventListener(e,t,n,o){const i=this._targetsEventListeners.get(e);i&&(i.removeEventListener(t,n,o),i.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,t])=>{t.reset(),this._targetsEventListeners.delete(e)})}}var c=n(50134),d=n(40256),g=n(70210),u=n(74657);function h(e,t){const n=e.getSize();for(let o=0;o<n;o++){const n=[];e.getNodeValue(o,n),n[1]=n[1]*t,n[2]=n[2]*t,n[3]=n[3]*t,e.setNodeValue(o,n)}}var m=n(69372),p=n(80221);function f(e){let t,n=e[0],o=e[0];const i=e.length;for(let a=1;a<i;a++)t=e[a],n=Math.min(n,t),o=Math.max(o,t);return{min:n,max:o}}const v=Symbol("LastRuntimeId"),I={},w=4294967295,A="-";function b(e,t,n){return function(e,t,n){let o=e[t];o instanceof Array||(o=[0],Object.defineProperty(e,t,{value:o}));for(let e=!0,t=0;e&&t<o.length;++t){let i=0|o[t];i<n?(e=!1,i+=1):(i=0,t+1===o.length&&o.push(0)),o[t]=i}return o}(null!==e&&"object"==typeof e?e:I,v,("number"==typeof n&&n>0?n:w)>>>0).join("string"==typeof t?t:A)}var S=n(39537);const y={},R={add:(e,t)=>{const n=(0,S.A)(e);y[n]=t},get:(e,t)=>{if("calibratedPixelSpacing"===e){const e=(0,S.A)(t);return y[e]}}};var x=n(84061);function M(e,t,n=1e-5){return Math.abs(e[0]+t[0])<n&&Math.abs(e[1]+t[1])<n&&Math.abs(e[2]+t[2])<n}var P=n(88619),E=n(85008),D=n(65292),C=n(15105);function T(e,t){return!(e[0]<0||e[0]>=t[0]||e[1]<0||e[1]>=t[1]||e[2]<0||e[2]>=t[2])}var L=n(39536);const _=function(e,t){let n;n=t?[(0,L.lD)(t)]:(0,L.qO)();const o=[];return n.forEach(t=>{const n=e.getActors(),i=t.getVolumeViewports();for(const e of i){const t=e.getActors();if(t.length!==n.length)continue;n.every(({uid:e})=>t.find(t=>e===t.uid))&&o.push(e)}}),o};var O=n(24724),V=n(38669),N=n(94741),U=n(80068),k=n(74876),B=n(71851),F=n(51159),W=n(3823),G=n(30135),q=n(54072);const j=e=>e.preScale.scaled&&e.preScale.scalingParameters.suvbw;function z(e,t,n=void 0,o="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!(e&&e instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!t.imageId,r=!a&&t,s=a&&t,l=`renderGPUViewport-${r.imageId||s.volumeId}`,c=document.createElement("div"),d=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const g=e.width,u=e.height;c.style.width=`${g/d+G.p8}px`,c.style.height=`${u/d+G.p8}px`,c.style.visibility="hidden",c.style.position="absolute",document.body.appendChild(c);const h=l.split(":").join("-");c.setAttribute("viewport-id-for-remove",h);const m=(0,G.Ay)(c),p=(0,L.lD)(o)||new q.A(o);let f=p.getViewport(l);if(!f){const e={viewportId:l,type:a?B.ViewportType.ORTHOGRAPHIC:B.ViewportType.STACK,element:c,defaultOptions:{...i,suppressEvents:!0}};p.enableElement(e),f=p.getViewport(l)}return new Promise(o=>{let g=!1,{viewReference:u}=i;const v=t=>{if(g)return;if(u){const e=u;return u=null,f.setViewReference(e),void f.render()}e.getContext("2d").drawImage(m,0,0,m.width,m.height,0,0,e.width,e.height);const n=f.canvasToWorld([0,0]),i=f.canvasToWorld([m.width/d,0]),a=f.canvasToWorld([0,m.height/d]),r=W.eR.sub([0,0,0],f.canvasToWorld([1/d,0]),n),s=W.eR.sub([0,0,0],f.canvasToWorld([0,1/d]),n);g=!0,c.removeEventListener(B.Events.IMAGE_RENDERED,v),setTimeout(()=>{p.disableElement(l);document.querySelectorAll(`[viewport-id-for-remove="${h}"]`).forEach(e=>{e.remove()})},0),o({origin:n,bottomLeft:a,topRight:i,thicknessMm:1,rightVector:r,downVector:s})};c.addEventListener(B.Events.IMAGE_RENDERED,v),a?f.setVolumes([s],!1,!0):f.renderImageObject(t),f.resetCamera(),"PT"!==n||j(r)||f.setProperties({voiRange:{lower:r.minPixelValue,upper:r.maxPixelValue}}),f.render()})}var Z=n(36931),H=n(7808),$=n(5057);function K(e,t,n,o,i){if(t.volumeId)throw new Error("Unsupported volume rendering for CPU");const a=t,r={canvas:e,viewport:(0,Z.A)(e,a,n),image:a,renderingTools:{}};r.transform=(0,H.A)(r);return new Promise((e,t)=>{(0,$.A)(r,true),e(null)})}var J=n(49038);function Y(e){const{canvas:t,imageId:n,viewReference:o,requestType:i=B.RequestType.Thumbnail,priority:a=-5,renderingEngineId:r="_thumbnails",useCPURendering:s=!1,thumbnail:l=!1,imageAspect:c=!1,viewportOptions:d}=e,g=o?.volumeId,u=g&&!n,h=o&&d?{...d,viewReference:o}:d,m=s?K:z;return new Promise((e,o)=>{function d(n,i){const{modality:a}=k.get("generalSeriesModule",i)||{},d=!u&&n,g=u&&n;d&&(d.isPreScaled=d.isPreScaled||d.preScale?.scaled),l&&(t.height=256,t.width=256),c&&d&&(t.width=d&&t.height*d.width/d.height),t.style.width=t.width/devicePixelRatio+"px",t.style.height=t.height/devicePixelRatio+"px",g&&s&&o(new Error("CPU rendering of volume not supported")),m(t,n,a,r,h).then(e)}function p(e,t){console.error(e,t),o(e)}const f={useRGBA:!!s,requestType:i};if(g){const e=J.Ay.getVolume(g);e||o(new Error(`Volume id ${g} not found in cache`));d(e,e.imageIds[0])}else F.A.addRequest(function(e,t,n){return(0,U.loadAndCacheImage)(e,n).then(t=>{d.call(this,t,e)},t=>{p.call(this,t,e)})}.bind(null,n,null,f),i,{imageId:n},a)})}var X=n(10364);function Q(e){return Array.isArray(e)?e:[e]}const ee="CORNERSTONE_TOOLS_HISTORY_UNDO",te="CORNERSTONE_TOOLS_HISTORY_REDO";class ne{constructor(e="Tools",t=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.isRecordingGrouped=!1,this.label=e,this._size=t}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}get canUndo(){return this.undoAvailable>0}get canRedo(){return this.redoAvailable>0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const t=this.ring[this.position];for(const e of Q(t).reverse())e.restoreMemo(!0),this.dispatchHistoryEvent({item:e,isUndo:!0});e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return!!(this.undoAvailable>0&&e(this.ring[this.position]))&&(this.undo(),!0)}dispatchHistoryEvent({item:e,isUndo:t}){e.id&&X.A.dispatchEvent(new CustomEvent(t?ee:te,{detail:{isUndo:t,id:e.id,operationType:e.operationType||"annotation",memo:e}}))}redo(e=1){for(;e>0&&this.redoAvailable>0;){const t=(this.position+1)%this.size,n=this.ring[t];for(const e of Q(n).reverse())e.restoreMemo(!1),this.dispatchHistoryEvent({item:e,isUndo:!1});e--,this.position=t,this.undoAvailable++,this.redoAvailable--}}initializeGroupItem(){this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=[]}startGroupRecording(){this.isRecordingGrouped=!0,this.initializeGroupItem()}rollbackUnusedGroupItem(){this.ring[this.position]=void 0,this.position=(this.position-1)%this._size,this.undoAvailable--}endGroupRecording(){this.isRecordingGrouped=!1;const e=this.ring[this.position];Array.isArray(e)&&0===e.length&&this.rollbackUnusedGroupItem()}pushGrouped(e){const t=this.ring[this.position];if(Array.isArray(t))return t.push(e),e;throw new Error("Last item should be an array for grouped memos.")}push(e){if(!e)return;const t=e.restoreMemo?e:e.createMemo?.();return t?this.isRecordingGrouped?this.pushGrouped(t):(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=t,t):void 0}}const oe=new ne;const ie=function(e,t){const n=(0,k.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:o,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:r,rowPixelSpacing:s}=n;r||=1,s||=1;const l=W.eR.create();W.eR.scaleAndAdd(l,a,o,-r/2),W.eR.scaleAndAdd(l,l,i,-s/2);const c=W.eR.create();return W.eR.sub(c,t,l),[W.eR.dot(c,i)/s,W.eR.dot(c,o)/r]};function ae(e,t){const n=(0,k.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:o,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:r,rowPixelSpacing:s}=n;r||=1,s||=1;const l=W.eR.create();return W.eR.scaleAndAdd(l,a,i,s*(t[0]-.5)),W.eR.scaleAndAdd(l,l,o,r*(t[1]-.5)),Array.from(l)}var re=n(4031),se=n(61375),le=n(20537),ce=n(80500),de=n(47476),ge=n(98039);function ue(e){const t=(0,L.qO)(),n=[];return t.forEach(t=>{t.getViewports().forEach(t=>{t.hasImageURI(e)&&n.push(t)})}),n}var he=n(52268);function me(e,t){const n=function(e,t){const n=t.getImageIds(),o=t.getCurrentImageIdIndex();if(0===n.length)return null;const i=t=>{const n=function(e){const t=k.get("imagePlaneModule",e);if(!(t&&t.rowCosines instanceof Array&&3===t.rowCosines.length&&t.columnCosines instanceof Array&&3===t.columnCosines.length&&t.imagePositionPatient instanceof Array&&3===t.imagePositionPatient.length))return null;const{rowCosines:n,columnCosines:o,imagePositionPatient:i}=t,a=W.eR.set(W.eR.create(),...n),r=W.eR.set(W.eR.create(),...o),s=W.eR.cross(W.eR.create(),a,r);return{rowCosines:n,columnCosines:o,imagePositionPatient:i,planeNormal:s}}(t);if(!n)return null;const o=he.planeEquation(n.planeNormal,n.imagePositionPatient);return he.planeDistanceToPoint(o,e)},a={distance:i(n[o])??1/0,index:o},r=n.slice(o+1);for(let e=0;e<r.length;e++){const t=i(r[e]);if(null!==t){if(!(t<=a.distance))break;a.distance=t,a.index=e+o+1}}const s=n.slice(0,o);for(let e=s.length-1;e>=0;e--){const t=i(s[e]);if(null!==t&&t!==a.distance){if(!(t<a.distance))break;a.distance=t,a.index=e}}return a.distance===1/0?null:a}(e,t);return n?n.index:null}var pe=n(51919);function fe(e){const{width:t,height:n}=e.getCanvas(),{sliceToIndexMatrix:o,indexToSliceMatrix:i}=e.getSliceViewInfo(),a=(0,pe.e)(e,[0,0]),r=(0,pe.e)(e,[t-1,0]),s=(0,pe.e)(e,[0,n-1]),l=W.eR.sub(W.eR.create(),r,a),c=W.eR.sub(W.eR.create(),s,a),d=W.eR.cross(W.eR.create(),l,c);W.eR.normalize(l,l),W.eR.normalize(c,c),W.eR.normalize(d,d);const g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])),u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]));if(!W.Fd.equals(1,g)||!W.Fd.equals(1,u))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:h}=e.getImageData(),m=e.getSliceViewInfo(),p=h.getSliceData(m);return{width:m.width,height:m.height,scalarData:p,sliceToIndexMatrix:o,indexToSliceMatrix:i}}const ve={},Ie={add:(e,t)=>{const[n,o]=e,i=`${n}_${o}`;ve[i]||(ve[i]={}),ve[i]=t},get:(e,t,n)=>{if("spatialRegistrationModule"!==e)return;const o=`${t}_${n}`;if(ve[o])return ve[o];const i=`${n}_${t}`;return ve[i]?W.pB.invert(W.pB.create(),ve[i]):void 0}};(0,k.addProvider)(Ie.get.bind(Ie));const we=Ie;const Ae=function(e,t){const n=e.getSliceIndex(),o=t.getSliceIndex(),i=(0,k.get)("imagePlaneModule",n.toString()),a=(0,k.get)("imagePlaneModule",o.toString());if(!i||!a)return void console.log("Viewport spatial registration requires image plane module");const{imageOrientationPatient:r}=a;if(!i.imageOrientationPatient.every((e,t)=>Math.abs(e-r[t])<.05))return void console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,a?.imageOrientationPatient);const s=i.imagePositionPatient,l=a.imagePositionPatient,c=W.eR.subtract(W.eR.create(),s,l),d=W.pB.fromTranslation(W.pB.create(),c);we.add([e.id,t.id],d)};function be(e){const{imageData:t,dimensions:n}=e.getImageData()||{};if(!t||!n)return[];const{canvas:o}=e,i=window.devicePixelRatio,a=[o.width/i,0],r=[o.width/i,o.height/i],s=[0,o.height/i],l=e.canvasToWorld([0,0]),c=e.canvasToWorld(a),d=e.canvasToWorld(r),g=e.canvasToWorld(s),u=t.worldToIndex(l),h=t.worldToIndex(c),m=t.worldToIndex(d),p=t.worldToIndex(g);return function({dimensions:e,imageData:t,topLeftImage:n,topRightImage:o,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:r,topRightWorld:s,bottomRightWorld:l,bottomLeftWorld:c}){const d=Se(n,e)?r:t.indexToWorld([0,0,0]),g=Se(o,e)?s:t.indexToWorld([e[0]-1,0,0]),u=Se(i,e)?l:t.indexToWorld([e[0]-1,e[1]-1,0]),h=Se(a,e)?c:t.indexToWorld([0,e[1]-1,0]);return[d,g,h,u]}({dimensions:n,imageData:t,topLeftImage:u,topRightImage:h,bottomRightImage:m,bottomLeftImage:p,topLeftWorld:l,topRightWorld:c,bottomRightWorld:d,bottomLeftWorld:g})}function Se(e,t){return e[0]>0||e[0]<t[0]-1||e[1]>0||e[1]<t[1]-1||e[2]>0||e[2]<t[2]-1}var ye=n(38883),Re=n(96833),xe=n(13876),Me=n(74268),Pe=n(32173),Ee=n(79720),De=n(86846);const Ce=function(e){const t=(0,De.Ay)(e);if(!t)return;const{viewport:n}=t;if(!(n instanceof Ee.A))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()};var Te=n(90537),Le=n(1865),_e=n(27119),Oe=n(74638);function Ve(e){if(e.length<=1)return!1;const t=e[0],{modality:n,seriesInstanceUID:o}=k.get("generalSeriesModule",t),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:r,columns:s,rows:l,usingDefaultValues:c}=k.get("imagePlaneModule",t);if(c)return!1;const d={modality:n,imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:r,columns:s,rows:l,seriesInstanceUID:o};let g=!0;for(let t=0;t<e.length;t++){const n=e[t],{modality:o,seriesInstanceUID:i}=k.get("generalSeriesModule",n),{imageOrientationPatient:a,pixelSpacing:r,columns:s,rows:l}=k.get("imagePlaneModule",n);if(i!==d.seriesInstanceUID){g=!1;break}if(o!==d.modality){g=!1;break}if(s!==d.columns){g=!1;break}if(l!==d.rows){g=!1;break}if(!(0,Oe.Ay)(a,d.imageOrientationPatient)){g=!1;break}if(!(0,Oe.Ay)(r,d.pixelSpacing)){g=!1;break}}return g}var Ne=n(45278),Ue=n(22191),ke=n(63470),Be=n(17791);const Fe=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function We(e){if(!e)return!1;return(Array.isArray(e)?e:[e]).find(e=>Fe.has(e))}var Ge=n(99576),qe=n(9734),je=n(40661),ze=n(87142);async function Ze({viewport:e,options:t={}}){const n=e.getRenderingEngine();let o=t.volumeId||`${(0,p.A)()}`;if(0===o.split(":").length){o=`${(0,ze.getUnknownVolumeLoaderSchema)()}:${o}`}const{id:i,element:a}=e,r=t.viewportId||i,s=e.getImageIds(),l=e.getViewPresentation(),c=e.getViewReference();n.enableElement({viewportId:r,type:B.ViewportType.ORTHOGRAPHIC,element:a,defaultOptions:{background:t.background,orientation:t.orientation}});(await(0,ze.createAndCacheVolume)(o,{imageIds:s})).load();const d=n.getViewport(r);await(0,je.A7)(n,[{volumeId:o}],[r]);const g=()=>{d.render(),a.removeEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,g)};return a.addEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,g),d.setViewPresentation(l),d.setViewReference(c),d.render(),d}var He=n(86252);async function $e({viewport:e,options:t}){const n=e,{id:o,element:i}=n,a=e.getRenderingEngine(),{background:r}=t,s=t.viewportId||o,l=J.Ay.getVolume(n.getVolumeId());if(!(l instanceof He.Q))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const c={viewportId:s,type:B.ViewportType.STACK,element:i,defaultOptions:{background:r}},d=n.getViewReference();a.enableElement(c);const g=a.getViewport(s);return await g.setStack(l.imageIds),g.setViewReference(d),g.render(),g}var Ke=n(24623),Je=n(67645),Ye=n(76491);function Xe(e){return Math.round(e/Ye.EPSILON)*Ye.EPSILON}const Qe=function e(t,n=2){if(Array.isArray(t))return t.map(t=>e(t,n)).join(", ");if(null==t||""===t)return"NaN";t=Number(t);const o=Math.abs(t);if(o<1e-4)return`${t}`;const i=o>=100?n-2:o>=10?n-1:o>=1?n:o>=.1?n+1:o>=.01?n+2:o>=.001?n+3:n+4;return t.toFixed(i)};function et(e,t,n){const o=e.length===t*n*4,i=e.length===t*n*3;if(o||i){const i=new Float32Array(t*n);let a=0,r=0;const s=o?4:3;for(let o=0;o<t;o++)for(let t=0;t<n;t++){const t=e[a],n=e[a+1],o=e[a+2];i[r]=(t+n+o)/3,a+=s,r++}return i}return e}var tt=n(90340);const nt=function(e){if(e instanceof tt.PX){return J.Ay.getVolume(e.getVolumeId()).imageIds}if(e.getImageIds)return e.getImageIds()};function ot(e,t){const n=[...e];return t>=n.length?(it(n),n):(it(n),n.slice(0,t))}function it(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}var at=n(12437),rt=n(30169),st=n(56577),lt=n(68136),ct=n(13859),dt=n(8126);function gt(e){const t=e.toString(16);return 1==t.length?"0"+t:t}function ut(e,t,n){return"#"+gt(e)+gt(t)+gt(n)}function ht(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function mt(e,t){if(e===t)return!0;if(null==e||null==t)return!1;try{return JSON.stringify(e)===JSON.stringify(t)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),e===t}}var pt=n(56750),ft=n(20286),vt=n(53932),It=n(89131);function wt(e,t){const n={};let o=[];const i=Object.keys(e);for(let a=0;a<i.length;a++){const r=new Set,s=e[i[a]];for(let e=0;e<s.length;e++){const o=t(s[e].imageId)||0;if(n[o]=n[o]||[],n[o].push({imageId:s[e].imageId}),r.add(o),r.size-1<e)return}if(0==a)o=Array.from(r);else if(!Rt(o,r))return}return n}function At(e,t){const n=k.get(t,e);try{return parseFloat(n)}catch{return}}function bt(e){const t=k.get("20011003",e);try{const{InlineBinary:e}=t;if(e){const t=atob(e),n=new ArrayBuffer(t.length),o=new DataView(n);for(let e=0;e<t.length;e++)o.setUint8(e,t.charCodeAt(e));return new Float32Array(n)[0]}return parseFloat(t)}catch{return}}function St(e){let t=k.get("0019100c",e)||k.get("0019100C",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e)),parseFloat(t)}catch{return}}function yt(e){let t=k.get("00431039",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e).split("//")),parseFloat(t[0])%1e5}catch{return}}function Rt(e,t){if(e.length!=t.size)return!1;for(let n=0;n<e.length;n++)if(!t.has(e[n]))return!1;return!0}function xt(e){const t=k.get("petImageModule",e);return t?t.frameReferenceTime:0}const Mt=function(e){const t=function(e){const t=e.map(e=>{const{imagePositionPatient:t}=k.get("imagePlaneModule",e)||{};return{imageId:e,imagePositionPatient:t}});if(!t.every(e=>e.imagePositionPatient))return null;const n=(o="imagePositionPatient",t.reduce((e,t)=>((e[t[o]]=e[t[o]]||[]).push(t),e),{}));var o;const i=Object.keys(n),a=n[i[0]].length;return 1===a?null:i.every(e=>n[e].length===a)?n:null}(e);if(!t)return{imageIdGroups:[e],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],o=[e=>At(e,n[0]),e=>At(e,n[1]),e=>At(e,n[2]),e=>At(e,n[3]),e=>At(e,n[4]),bt,St,yt,xt];for(let e=0;e<o.length;e++){const i=wt(t,o[e]);if(i){return{imageIdGroups:Object.keys(i).map(Number.parseFloat).sort((e,t)=>e-t).map(e=>i[e].map(e=>e.imageId)),splittingTag:n[e]}}}return{imageIdGroups:[e],splittingTag:null}};const Pt=function(e){const{imageIdGroups:t,splittingTag:n}=Mt(e);return{isDynamicVolume:t.length>1,timePoints:t,splittingTag:n}};var Et=n(91979);function Dt(e,t){const n=e.length,{rescaleSlope:o,rescaleIntercept:i,suvbw:a}=t;if("PT"===t.modality&&"number"==typeof a)for(let t=0;t<n;t++)e[t]=a*(e[t]*o+i);else for(let t=0;t<n;t++)e[t]=e[t]*o+i;return e}var Ct=n(99949);function Tt(e,t,n){return Math.min(Math.max(t,e),n)}const Lt=Tt;function _t(e,t){if(!(0,De.Ay)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof tt.hS&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:o,scrollSlabs:i}=t;if(e instanceof tt.PX)!function(e,t,n,o=!1){const i=o,{numScrollSteps:a,currentStepIndex:r,sliceRangeInfo:s}=(0,se.A)(e,t,i);if(!s)return;const{sliceRange:l,spacingInNormalDirection:c,camera:d}=s,{focalPoint:g,viewPlaneNormal:u,position:h}=d,{newFocalPoint:p,newPosition:f}=(0,ce.A)(g,h,l,u,c,n);e.setCamera({focalPoint:p,position:f}),e.render();const v=r+n,I={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:r,numScrollSteps:a,currentImageId:e.getCurrentImageId()};(v>a||v<0)&&e.getCurrentImageId()?(0,m.A)(X.A,B.Events.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,I):(0,m.A)(X.A,B.Events.VOLUME_VIEWPORT_SCROLL,I)}(e,n,o,i);else{const n=e.getCurrentImageIdIndex();if(n+o>e.getImageIds().length-1||n+o<0){const e={imageIdIndex:n,direction:o};(0,m.A)(X.A,B.Events.STACK_SCROLL_OUT_OF_BOUNDS,e)}e.scroll(o,t.debounceLoading,t.loop)}}async function Ot(e,t={}){const{imageIndex:n,debounceLoading:o,volumeId:i}=t,a=(0,De.Ay)(e);if(!a)throw new Error("Element has been disabled");const{viewport:r}=a,{imageIndex:s,numberOfSlices:l}=function(e,t){if(e instanceof Ee.A)return{numberOfSlices:e.getImageIds().length,imageIndex:t?e.getTargetImageIdIndex():e.getCurrentImageIdIndex()};return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getSliceIndex()}}(r,o),c=function(e,t){const n=e-1;return Lt(t,0,n)}(l,n);_t(r,{delta:c-s,debounceLoading:o,volumeId:i})}function Vt(e,t,n={}){const o=J.Ay.getVolume(e);if(!o)throw new Error(`Referenced volume with id ${e} does not exist.`);const{metadata:i,spacing:a,direction:r,dimensions:s}=o,{minX:l,maxX:c,minY:d,maxY:g,minZ:u,maxZ:h}=t,m=[Math.min(l,c),Math.min(d,g),Math.min(u,h)],f=(0,N.A)(o.imageData,m),v=[Math.abs(c-l)+1,Math.abs(g-d)+1,Math.abs(h-u)+1],{targetBuffer:I}=n,w={metadata:i,dimensions:v,spacing:a,origin:f,direction:r,targetBuffer:I,scalarData:"Float32Array"===I?.type?new Float32Array(v[0]*v[1]*v[2]):void 0},A=(0,ze.createLocalVolume)((0,p.A)(),w),b=A.voxelManager.getCompleteScalarDataArray(),S=v[0]*v[1],y=s[0]*s[1],R=o.voxelManager.getCompleteScalarDataArray();for(let e=0;e<v[2];e++)for(let t=0;t<v[1];t++){const n=(0,N.A)(A.imageData,[0,t,e]),i=(0,V.A)(o.imageData,n),a=i[2]*y+i[1]*s[0]+i[0],r=R.slice(a,a+v[0]),l=e*S+t*v[0];b.set(r,l)}return A.voxelManager.setCompleteScalarDataArray(b),A}function Nt(e,t){const{viewUp:n,viewPlaneNormal:o}=t,i=(0,V.p)(e,[0,0,0]),a=W.eR.negate(W.eR.create(),n),r=W.eR.negate(W.eR.create(),o),s=W.eR.cross(W.eR.create(),a,r),l=W.eR.sub(W.eR.create(),(0,V.p)(e,a),i),c=W.eR.sub(W.eR.create(),(0,V.p)(e,r),i);W.eR.normalize(l,l),W.eR.normalize(c,c);return{worldVecRowDir:s,worldVecColDir:a,worldVecSliceDir:r,ijkVecRowDir:W.eR.cross(W.eR.create(),l,c),ijkVecColDir:l,ijkVecSliceDir:c}}var Ut=n(42384),kt=n(7608);function Bt(e,t,n,o){const[i,a,r]=t,s=i*a;let l=0,c=0,d=0;const[g,u,h]=n.map(Math.round);for(let t=h-o;t<=h+o;t++)if(!(t<0||t>=r))for(let n=u-o;n<=u+o;n++)if(!(n<0||n>=a))for(let a=g-o;a<=g+o;a++){if(a<0||a>=i)continue;const o=e[t*s+n*i+a];l+=o,c+=o*o,d++}if(0===d){const t=h*s+u*i+g;if(t>=0&&t<e.length){return{mean:e[t],stdDev:0,count:1}}return{mean:0,stdDev:0,count:0}}const m=l/d,p=c/d-m*m;return{mean:m,stdDev:Math.sqrt(Math.max(0,p)),count:d}}const Ft=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function Wt(e){const{PixelSpacing:t,SOPClassUID:n,SequenceOfUltrasoundRegions:o}=e;if(o)return function(e){const{SequenceOfUltrasoundRegions:t}=e,n=Array.isArray(t);if(n&&t.length>1)return void console.warn("Sequence of Ultrasound Regions > one entry. This is not yet implemented, all measurements will be shown in pixels.");const{PhysicalDeltaX:o,PhysicalDeltaY:i}=n?t[0]:t;return{PixelSpacing:[10*Math.abs(o),10*Math.abs(i)]}}(e);return Ft.has(n)?function(e){const{PixelSpacing:t,ImagerPixelSpacing:n,EstimatedRadiographicMagnificationFactor:o,PixelSpacingCalibrationType:i,PixelSpacingCalibrationDescription:a}=e,r=!0;if(!n)return{PixelSpacing:t,type:B.CalibrationTypes.UNKNOWN,isProjection:r};if(!t)return o?{PixelSpacing:n.map(e=>e/o),type:B.CalibrationTypes.ERMF,isProjection:r}:(console.warn("EstimatedRadiographicMagnificationFactor was not present. Unable to correct ImagerPixelSpacing."),{PixelSpacing:n,type:B.CalibrationTypes.PROJECTION,isProjection:r});return(0,Oe.n4)(t,n)?{PixelSpacing:t,type:B.CalibrationTypes.PROJECTION,isProjection:r}:i||a?{PixelSpacing:t,type:B.CalibrationTypes.CALIBRATED,isProjection:r,PixelSpacingCalibrationType:i,PixelSpacingCalibrationDescription:a}:{PixelSpacing:t,type:B.CalibrationTypes.UNKNOWN,isProjection:r}}(e):{PixelSpacing:t,type:B.CalibrationTypes.NOT_APPLICABLE,isProjection:!1}}var Gt=n(41365);const qt=(e,t)=>function(e,t,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(e.modality)return e.modality;if(e.setVolumes){if(!(t=t??e.getVolumeId())||!n)return;return n(t).metadata.Modality}throw new Error("Invalid viewport type")}(e,t,J.Ay.getVolume)},50134:(e,t,n)=>{function o(e){if(!e)return;const t=e.getSize();for(let n=0;n<t;n++){const t=[];e.getNodeValue(n,t),t[1]=1-t[1],t[2]=1-t[2],t[3]=1-t[3],e.setNodeValue(n,t)}}n.d(t,{A:()=>o})},74638:(e,t,n)=>{function o(e,t,n){return Math.abs(e-t)<=n}function i(e){return"number"==typeof e}function a(e){return e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>0&&"number"==typeof e[0]}function r(e,t,n=1e-5){return typeof e==typeof t&&null!==e&&null!==t&&(i(e)&&i(t)?o(e,t,n):!(!a(e)||!a(t))&&function(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!o(e[i],t[i],n))return!1;return!0}(e,t,n))}n.d(t,{Ay:()=>u,Et:()=>g,Ph:()=>d,WC:()=>c,n4:()=>r});const s=e=>"number"==typeof e?-e:e?.map?e.map(s):!e,l=e=>"number"==typeof e?Math.abs(e):e?.map?e.map(l):e,c=(e,t,n=void 0)=>r(e,s(t),n),d=(e,t,n=void 0)=>r(l(e),l(t),n);function g(e){return Array.isArray(e)?g(e[0]):isFinite(e)&&!isNaN(e)}const u=r},7608:(e,t,n)=>{n.r(t),n.d(t,{aiLog:()=>g,coreLog:()=>l,cs3dLog:()=>s,dicomConsistencyLog:()=>h,examplesLog:()=>u,getLogger:()=>r,getRootLogger:()=>a,imageConsistencyLog:()=>m,loaderLog:()=>d,toolsLog:()=>c});var o=n(4367);const i=n.n(o)().noConflict();function a(e){const t=i.getLogger(e[0]);return t.getLogger=(...t)=>a(`${e}.${t.join(".")}`),t}function r(...e){return a(e.join("."))}"undefined"!=typeof window&&(window.log=i);const s=a("cs3d"),l=s.getLogger("core"),c=s.getLogger("tools"),d=s.getLogger("dicomImageLoader"),g=s.getLogger("ai"),u=s.getLogger("examples"),h=r("consistency","dicom"),m=r("consistency","image")},1865:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(74876);function i(e){const t=e[0],{pixelRepresentation:n,bitsAllocated:i,bitsStored:a,highBit:r,photometricInterpretation:s,samplesPerPixel:l}=(0,o.get)("imagePixelModule",t),c=[],d=(0,o.get)("voiLutModule",t);let g;if(d){const{windowWidth:e,windowCenter:t}=d;if(g=d?.voiLUTFunction,Array.isArray(e))for(let n=0;n<e.length;n++)c.push({windowWidth:e[n],windowCenter:t[n]});else c.push({windowWidth:e,windowCenter:t})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:h}=(0,o.get)("generalSeriesModule",t),{imageOrientationPatient:m,pixelSpacing:p,frameOfReferenceUID:f,columns:v,rows:I}=(0,o.get)("imagePlaneModule",t);return{BitsAllocated:i,BitsStored:a,SamplesPerPixel:l,HighBit:r,PhotometricInterpretation:s,PixelRepresentation:n,Modality:u,ImageOrientationPatient:m,PixelSpacing:p,FrameOfReferenceUID:f,Columns:v,Rows:I,voiLut:c,VOILUTFunction:g,SeriesInstanceUID:h}}},52268:(e,t,n)=>{n.r(t),n.d(t,{isPointOnPlane:()=>c,linePlaneIntersection:()=>a,planeDistanceToPoint:()=>l,planeEquation:()=>r,threePlaneIntersection:()=>s});var o=n(3823),i=n(76491);function a(e,t,n){const[o,i,a]=e,[r,s,l]=t,[c,d,g,u]=n,h=r-o,m=s-i,p=l-a,f=-1*(c*o+d*i+g*a-u)/(c*h+d*m+g*p);return[h*f+o,m*f+i,p*f+a]}function r(e,t,n=!1){const[o,i,a]=e,r=o*t[0]+i*t[1]+a*t[2];if(n){const e=Math.sqrt(o*o+i*i+a*a);return[o/e,i/e,a/e,r/e]}return[o,i,a,r]}function s(e,t,n){const[i,a,r,s]=e,[l,c,d,g]=t,[u,h,m,p]=n,f=o.w0.fromValues(i,l,u,a,c,h,r,d,m),v=o.w0.fromValues(s,g,p,a,c,h,r,d,m),I=o.w0.fromValues(i,l,u,s,g,p,r,d,m),w=o.w0.fromValues(i,l,u,a,c,h,s,g,p);return[o.w0.determinant(v)/o.w0.determinant(f),o.w0.determinant(I)/o.w0.determinant(f),o.w0.determinant(w)/o.w0.determinant(f)]}function l(e,t,n=!1){const[o,i,a,r]=e,[s,l,c]=t,d=o*s+i*l+a*c-r,g=Math.abs(d)/Math.sqrt(o*o+i*i+a*a);return(n?Math.sign(d):1)*g}function c(e,t,n=i.EPSILON){return l(t,e)<n}},56577:(e,t,n)=>{n.d(t,{X6:()=>a,ii:()=>i});var o=n(87784);function i(e,t){const{pointInShapeFn:n,callback:i,boundsIJK:a,returnPoints:r=!1}=t;let s;if(e.getScalarData)s=e.getScalarData();else{const t=e.getPointData().getScalars();if(t)s=t.getData();else{const{voxelManager:t}=e.get("voxelManager")||{};t&&(s=t.getCompleteScalarDataArray())}}const l=e.getDimensions(),c=[[0,l[0]],[0,l[1]],[0,l[2]]],d=function({imageData:e,bounds:t,scalarData:n,pointInShapeFn:i,callback:a}){const[[r,s],[l,c],[d,g]]=t,{numComps:u}=e,h=e.getDimensions(),m=(0,o.P)(e),p=[0,0,0],f=u||n.length/h[2]/h[1]/h[0],v=h[0]*f,I=h[1]*v,w=[];for(let e=d;e<=g;e++){p[2]=e;const t=e*I;for(let e=l;e<=c;e++){p[1]=e;const o=t+e*v;for(let e=r;e<=s;e++){p[0]=e;const t=m(p);if(i(t,p)){const i=o+e*f;let r;r=f>2?[n[i],n[i+1],n[i+2]]:n[i],w.push({value:r,index:i,pointIJK:p,pointLPS:t.slice()}),a({value:r,index:i,pointIJK:p,pointLPS:t})}}}}return w}({imageData:e,bounds:a||c,scalarData:s,pointInShapeFn:n,callback:i});return r?d:void 0}function a({voxelManager:e,bounds:t,imageData:n,pointInShapeFn:i,callback:a,returnPoints:r}){const[[s,l],[c,d],[g,u]]=t,h=(0,o.P)(n),m=[0,0,0],p=[];for(let t=g;t<=u;t++){m[2]=t;for(let t=c;t<=d;t++){m[1]=t;for(let t=s;t<=l;t++){m[0]=t;const n=h(m);if(i(n,m)){const t=e.toIndex(m),o=e.getAtIndex(t);r&&p.push({value:o,index:t,pointIJK:[...m],pointLPS:n.slice()}),a?.({value:o,index:t,pointIJK:m,pointLPS:n})}}}}return p}},80500:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(3823);function i(e,t,n,i,a,r){const{min:s,max:l,current:c}=n,d=o.eR.create();o.eR.sub(d,t,e);const g=Math.round((l-s)/a),u=(c-s)/(l-s)*g;let h=Math.round(u),m=[e[0]-i[0]*u*a,e[1]-i[1]*u*a,e[2]-i[2]*u*a];h+=r,h>g?h=g:h<0&&(h=0);const p=h*a;m=[m[0]+i[0]*p,m[1]+i[1]*p,m[2]+i[2]*p];return{newFocalPoint:m,newPosition:[m[0]+d[0],m[1]+d[1],m[2]+d[2]]}}},90537:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(3823),i=n(74876),a=n(42384);function r(e,t){const{imagePositionPatient:n,imageOrientationPatient:r}=i.get("imagePlaneModule",e[0]);if(!t){const e=o.eR.fromValues(r[0],r[1],r[2]),n=o.eR.fromValues(r[3],r[4],r[5]);t=o.eR.create(),o.eR.cross(t,e,n)}const s="wadouri"===e[0].split(":")[0],l=(0,a.A)(e);let c;function d(e){const{imagePositionPatient:a}=i.get("imagePlaneModule",e),r=o.eR.create();return o.eR.sub(r,n,a),o.eR.dot(r,t)}if(s){const t=[e[0],e[Math.floor(e.length/2)]];c=e;d(t[0])-d(t[1])<0&&c.reverse()}else{const t=e.map(e=>({distance:d(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance),c=t.map(e=>e.imageId)}const{imagePositionPatient:g}=i.get("imagePlaneModule",c[0]);return{zSpacing:l,origin:g,sortedImageIds:c}}},8126:(e,t,n)=>{function o(e){const t=e.getSize(),n=[];for(let o=0;o<t;o++){const t=[];e.getNodeValue(o,t),n.push(t)}return n}function i(e,t){t?.length&&(e.removeAllPoints(),t.forEach(t=>{e.addRGBPoint(...t)}))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>o,setTransferFunctionNodes:()=>i})},51919:(e,t,n)=>{n.d(t,{e:()=>i});var o=n(38669);function i(e,t){const{imageData:n}=e.getImageData(),i=e.canvasToWorld(t);return(0,o.A)(n,i)}},94741:(e,t,n)=>{function o(e,t){return e.indexToWorld(t)}n.d(t,{A:()=>o})},38669:(e,t,n)=>{function o(e,t){return e.worldToIndex(t).map(Math.round)}function i(e,t){return e.worldToIndex(t)}n.d(t,{A:()=>o,p:()=>i})},41365:(e,t,n)=>{n.d(t,{O:()=>r});var o=n(74638),i=n(3823);const a=.95;function r(e,t){if(!e?.length||!t.FrameOfReferenceUID)return;t.planeRestriction||={FrameOfReferenceUID:t.FrameOfReferenceUID,point:e[0],inPlaneVector1:null,inPlaneVector2:null};const{planeRestriction:n}=t;if(1===e.length)return n.inPlaneVector1=null,n.inPlaneVector2=null,n;const r=i.eR.sub(i.eR.create(),e[0],e[Math.floor(e.length/2)]);i.eR.normalize(r,r),n.inPlaneVector1=r,n.inPlaneVector2=null;const s=e.length;if(s>2)for(let t=Math.floor(s/3);t<s;t++){const r=i.eR.sub(i.eR.create(),e[t],e[0]),s=i.eR.length(r);if(!(0,o.n4)(s,0)&&i.eR.dot(r,n.inPlaneVector1)<s*a)return i.eR.normalize(r,r),n.inPlaneVector2=r,n}return n}},45278:(e,t,n)=>{function o(e,t){const n=t.voxelManager.getScalarData();if(!e.getPointData)return;const o=e.getPointData().getScalars().getData();if(t.color&&t.rgba){const e=new Uint8Array(t.columns*t.rows*3);for(let o=0;o<t.columns*t.rows;o++)e[3*o]=n[4*o],e[3*o+1]=n[4*o+1],e[3*o+2]=n[4*o+2];t.rgba=!1,t.getPixelData=()=>e,o.set(e)}else o.set(n);e.modified()}n.d(t,{J:()=>o})},68136:(e,t,n)=>{n.r(t),n.d(t,{toLowHighRange:()=>a,toWindowLevel:()=>i});var o=n(82501);n(58977);function i(e,t){return{windowWidth:Math.abs(t-e)+1,windowCenter:(e+t+1)/2}}function a(e,t,n=o.A.LINEAR){if(n===o.A.LINEAR||n===o.A.SAMPLED_SIGMOID)return{lower:t-.5-(e-1)/2,upper:t-.5+(e-1)/2};if(n===o.A.LINEAR_EXACT)return{lower:t-e/2,upper:t+e/2};throw new Error("Invalid VOI LUT function")}},93952:()=>{},95074:(e,t,n)=>{n(97181),n(85899),n(56442)},74347:(e,t,n)=>{n.d(t,{draw:()=>o.A,drawCircle:()=>i.A,drawHandles:()=>a.A,drawLine:()=>r.A,drawLinkedTextBox:()=>c.A,drawPath:()=>l.A,drawPolyline:()=>s.A,drawRect:()=>d.A,drawRectByCoordinates:()=>g.A});var o=n(18262),i=n(12004),a=(n(85856),n(95074),n(56745)),r=(n(94042),n(92118));var s=n(98812),l=n(17311);n(97181),n(85899),n(56442);var c=n(1595),d=n(97530),g=n(75076);n(26290)},75183:(e,t,n)=>{var o;n.d(t,{A:()=>i}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated",e.History="History",e.MetadataReferenceModified="MetadataReferenceModified",e.LabelChange="LabelChange"}(o||(o={}));const i=o},10401:(e,t,n)=>{var o;!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(o||(o={}))},6802:(e,t,n)=>{n.d(t,{O8:()=>o.removeAnnotation,Rh:()=>o.getAnnotations,lC:()=>o.addAnnotation});n(67013),n(2076),n(17343);var o=n(82056);n(97)},59475:(e,t,n)=>{n.d(t,{_6:()=>u});var o=n(15327),i=n(99737),a=n(642),r=n(99341),s=n(49906),l=n(92686),c=n(75419);const d={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};function g(e){const t=a.Ay.newInstance(),n=r.Ay.newInstance();return n.addPoint(0,0),e===i.SegmentationRepresentations.Labelmap?{cfun:t,ofun:n}:{}}const u=new class{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=o.utilities.uuidv4(),this.state=Object.freeze(o.utilities.deepClone(d)),this.uid=e}getState(){return this.state}updateState(e){const t=o.utilities.deepClone(this.state);e(t),this.state=Object.freeze(t)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(o.utilities.deepClone(d))}getSegmentation(e){return this.state.segmentations.find(t=>t.segmentationId===e)}updateSegmentation(e,t){this.updateState(n=>{const o=n.segmentations.find(t=>t.segmentationId===e);o?Object.assign(o,t):console.warn(`Segmentation with id ${e} not found. Update aborted.`)}),(0,s.triggerSegmentationModified)(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(t=>{const n=o.utilities.deepClone(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const e=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=e}t.segmentations.push(n)}),(0,c.R)(e.segmentationId)}removeSegmentation(e){this.updateState(t=>{const n=t.segmentations.filter(t=>t.segmentationId!==e);t.segmentations.splice(0,t.segmentations.length,...n)}),(0,s.triggerSegmentationRemoved)(e)}addSegmentationRepresentation(e,t,n,a){if(!(0,o.getEnabledElementByViewportId)(e))return;this.getSegmentationRepresentations(e,{type:n,segmentationId:t}).length>0?console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",t):(this.updateState(o=>{o.viewportSegRepresentations[e]||(o.viewportSegRepresentations[e]=[],l.Y.setRenderInactiveSegmentations(e,!0)),n!==i.SegmentationRepresentations.Labelmap?this.addDefaultSegmentationRepresentation(o,e,t,n,a):this.addLabelmapRepresentation(o,e,t,a)}),(0,s.triggerSegmentationRepresentationModified)(e,t,n))}addDefaultSegmentationRepresentation(e,t,n,o,i){const a=e.segmentations.find(e=>e.segmentationId===n);if(!a)return;const r={};Object.keys(a.segments).forEach(e=>{r[Number(e)]={visible:!0}}),e.viewportSegRepresentations[t].push({segmentationId:n,type:o,active:!0,visible:!0,colorLUTIndex:i?.colorLUTIndex||0,segments:r,config:{...g(o),...i}}),this._setActiveSegmentation(e,t,n)}addLabelmapRepresentation(e,t,n,a=g(i.SegmentationRepresentations.Labelmap)){if(!(0,o.getEnabledElementByViewportId)(t))return;const r=this.getSegmentation(n);if(!r)return;const{representationData:s}=r;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,t,n,i.SegmentationRepresentations.Labelmap,a);this.processLabelmapRepresentationAddition(t,n),this.addDefaultSegmentationRepresentation(e,t,n,i.SegmentationRepresentations.Labelmap,a)}async processLabelmapRepresentationAddition(e,t){const n=(0,o.getEnabledElementByViewportId)(e);if(!n)return;const i=this.getSegmentation(t);if(!i)return;const a=n.viewport instanceof o.BaseVolumeViewport,{representationData:r}=i,s="volumeId"in r.Labelmap;n.viewport;a||s||this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,t,n,o){const i=t.getCurrentImageId();let a=!1;for(const o of n){t.isReferenceViewable({referencedImageId:o},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(i,o),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:i,labelmapImageId:o}))}return o&&o(t,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(i):void 0}updateLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),r=(0,o.getEnabledElementByViewportId)(e).viewport;return this._updateLabelmapSegmentationReferences(t,r,a,null)}_updateAllLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),r=(0,o.getEnabledElementByViewportId)(e).viewport;this._updateLabelmapSegmentationReferences(t,r,a,(e,t,n)=>{e.getImageIds().forEach((o,i)=>{for(const a of n){e.isReferenceViewable({referencedImageId:a,sliceIndex:i},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(t).set(o,a),this._updateLabelmapImageIdReferenceMap({segmentationId:t,referenceImageId:o,labelmapImageId:a}))}})})}getLabelmapImageIds(e){const t=e.Labelmap;let n;if(t.imageIds)n=t.imageIds;else if(!n&&t.volumeId){const e=t.volumeId;n=o.cache.getVolume(e).imageIds}return n}getLabelmapImageIdsForImageId(e,t){const n=this._generateMapKey({segmentationId:t,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(n)}getCurrentLabelmapImageIdsForViewport(e,t){const n=(0,o.getEnabledElementByViewportId)(e);if(!n)return;const i=n.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(i,t)}getCurrentLabelmapImageIdForViewport(e,t){const n=(0,o.getEnabledElementByViewportId)(e);if(!n)return;if(!this._stackLabelmapImageIdReferenceMap.has(t))return;const i=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(t).get(i)}getStackSegmentationImageIdsForViewport(e,t){if(!this.getSegmentation(t))return[];this._updateAllLabelmapSegmentationImageReferences(e,t);const{viewport:n}=(0,o.getEnabledElementByViewportId)(e),i=n.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(t);return i.map(e=>a.get(e))}removeSegmentationRepresentationsInternal(e,t){const n=[];return this.updateState(o=>{if(!o.viewportSegRepresentations[e])return;const i=o.viewportSegRepresentations[e];let a=!1;if(!t||Object.values(t).every(e=>void 0===e))n.push(...i),delete o.viewportSegRepresentations[e];else{const{segmentationId:r,type:s}=t;o.viewportSegRepresentations[e]=i.filter(e=>{const t=r&&s&&e.segmentationId===r&&e.type===s||r&&!s&&e.segmentationId===r||!r&&s&&e.type===s;return t&&(n.push(e),e.active&&(a=!0)),!t}),0===o.viewportSegRepresentations[e].length?delete o.viewportSegRepresentations[e]:a&&(o.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,t){const n=this.removeSegmentationRepresentationsInternal(e,t);n.forEach(t=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t.segmentationId,t.type)});const o=this.getSegmentationRepresentations(e);return o.length>0&&o[0].active&&(0,s.triggerSegmentationRepresentationModified)(e,o[0].segmentationId,o[0].type),n}removeSegmentationRepresentation(e,t,n){const o=this.removeSegmentationRepresentationsInternal(e,t);return n||o.forEach(({segmentationId:t,type:n})=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t,n)}),o}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:t,labelmapImageId:n}){const o=this._generateMapKey({segmentationId:e,referenceImageId:t});if(!this._labelmapImageIdReferenceMap.has(o))return void this._labelmapImageIdReferenceMap.set(o,[n]);const i=this._labelmapImageIdReferenceMap.get(o),a=Array.from(new Set([...i,n]));this._labelmapImageIdReferenceMap.set(o,a)}_setActiveSegmentation(e,t,n){const o=e.viewportSegRepresentations[t];o&&o.forEach(e=>{e.active=e.segmentationId===n})}setActiveSegmentation(e,t){this.updateState(n=>{const o=n.viewportSegRepresentations[e];o&&o.forEach(e=>{e.active=e.segmentationId===t})}),(0,s.triggerSegmentationRepresentationModified)(e,t)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const t=this.state.viewportSegRepresentations[e].find(e=>e.active);return t?this.getSegmentation(t.segmentationId):void 0}getSegmentationRepresentations(e,t={}){const n=this.state.viewportSegRepresentations[e];return n?t.type||t.segmentationId?n.filter(e=>{const n=!t.type||e.type===t.type,o=!t.segmentationId||e.segmentationId===t.segmentationId;return n&&o}):n:[]}getSegmentationRepresentation(e,t){return this.getSegmentationRepresentations(e,t)[0]}getSegmentationRepresentationVisibility(e,t){const n=this.getSegmentationRepresentation(e,t);return n?.visible}setSegmentationRepresentationVisibility(e,t,n){this.updateState(o=>{const i=this.getSegmentationRepresentations(e,t);i&&i.forEach(e=>{e.visible=n,Object.entries(e.segments).forEach(([e,t])=>{t.visible=n})})}),(0,s.triggerSegmentationRepresentationModified)(e,t.segmentationId,t.type)}addColorLUT(e,t){this.updateState(n=>{n.colorLUT[t]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[t]=o.utilities.deepClone(e)})}removeColorLUT(e){this.updateState(t=>{delete t.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(e=>e.slice(-Math.round(.15*e.length))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,t])=>({viewportId:e,representations:t}))}getSegmentationRepresentationsBySegmentationId(e){const t=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,o])=>{const i=o.filter(t=>t.segmentationId===e);i.length>0&&t.push({viewportId:n,representations:i})}),t}_generateMapKey({segmentationId:e,referenceImageId:t}){return`${e}-${t}`}}("DEFAULT")},26228:(e,t,n)=>{n.d(t,{getActiveSegmentation:()=>i});var o=n(67165);n(59475);function i(e){return(0,o.T)(e)}},4714:(e,t,n)=>{n(15327),n(59475),n(70906),n(93952)},30935:(e,t,n)=>{n(59475),n(49906),n(99737),n(15327)},93733:(e,t,n)=>{n.d(t,{getSegmentIndexColor:()=>r,setSegmentIndexColor:()=>s});n(4714);var o=n(50409),i=n(93210),a=n(49906);function r(e,t,n){const a=(0,i.r$)(e,{segmentationId:t});if(!a||0===a.length)return null;const r=a[0],{colorLUTIndex:s}=r,l=(0,o.B)(s);let c=l[n];if(!c){if("number"!=typeof n)return console.warn(`Can't create colour for LUT index ${n}`),null;c=l[n]=[0,0,0,0]}return c}function s(e,t,n,o){const i=r(e,t,n);for(let e=0;e<o.length;e++)i[e]=o[e];(0,a.triggerSegmentationRepresentationModified)(e,t)}},70906:(e,t,n)=>{n(59475)},93210:(e,t,n)=>{n.d(t,{Ut:()=>a,r$:()=>i});var o=n(59475);function i(e,t={}){return o._6.getSegmentationRepresentations(e,t)}function a(e,t){const n=o._6;if(!t.segmentationId||!t.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const i=n.getSegmentationRepresentations(e,t);return i?.[0]}},70758:(e,t,n)=>{n(59475)},42568:(e,t,n)=>{n(33283),n(59475)},63427:(e,t,n)=>{n(59475),n(49906),n(53662)},53662:(e,t,n)=>{n(18682),n(684),n(25894),n(93210),n(15327),n(59475),n(67014)},26795:(e,t,n)=>{n.d(t,{getLockedSegmentIndices:()=>i});var o=n(33283);n(2076),n(49906),n(31994);function i(e){const t=(0,o.T)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segments:n}=t;return Object.keys(n).filter(e=>n[e].locked).map(e=>parseInt(e))}},98870:(e,t,n)=>{n.d(t,{getCurrentLabelmapImageIdForViewport:()=>o.vl});n(33283),n(70758),n(30935),n(63427),n(53662),n(4714),n(50409),n(70906),n(59475);n(42568),n(58859);var o=n(97577);n(78231);n(93210)},78231:(e,t,n)=>{n(59475)},98484:(e,t,n)=>{n(33283)},31994:(e,t,n)=>{n(98484),n(16493),n(10407),n(53097),n(96629),n(38928),n(19741),n(85512),n(68362),n(64540)},48145:(e,t,n)=>{n.d(t,{A:()=>i});let o={};const i=o},25072:(e,t,n)=>{var o=n(3823),i=n(15327),a=n(4096),r=n(85817),s=n(27730),l=n(82056),c=n(2076),d=n(29601),g=n(44049),u=n(74347),h=n(85204),m=n(99737),p=n(60810),f=n(93258),v=n(473),I=n(7001),w=n(58640),A=n(76712);const{transformWorldToIndex:b}=i.utilities;class S extends r.EC{static{this.toolName="Bidirectional"}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:y}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles;let c=r.worldToCanvas(l[0]),d=r.worldToCanvas(l[1]),g={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},u=f.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]);return u<=o||(c=r.worldToCanvas(l[2]),d=r.worldToCanvas(l[3]),g={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},u=f.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]),u<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o);const r=(0,i.getEnabledElement)(o),{renderingEngine:s}=r;(0,w.A)(a),(0,I.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,r=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex(e=>e===n);const c=(0,p.getViewportIdsWithToolToRender)(a,this.getToolName());(0,I.hideElementCursor)(a),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(a);const d=(0,i.getEnabledElement)(a),{renderingEngine:g}=d;(0,w.A)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:r,newAnnotation:s,hasMoved:c}=this.editData,{data:d}=a;if(s&&!c)return;this.doneEditMemo(),d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,I.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=d.handles,t=o.eR.distance(e[0],e[1]);if(o.eR.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],i=[...e[1]],a=o.Zc.create();o.Zc.set(a,t[1][0]-t[0][0],t[1][1]-t[1][0]);const r=o.Zc.create();o.Zc.set(r,-a[1],a[0]);const s=o.Zc.create();let l;o.Zc.set(s,i[0]-n[0],i[1]-n[0]),l=o.Zc.dot(s,r)>0?[n,i]:[i,n],d.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(a.annotationUID),(0,w.A)(r),s&&(0,g.triggerAnnotationCompleted)(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{viewport:s}=r,{worldToCanvas:l}=s,{annotation:c,viewportIdsToRender:d,handleIndex:u,newAnnotation:h}=this.editData;this.createMemo(a,c,{newAnnotation:h});const{data:p}=c,f=n.world;p.handles.points[u]=[...f];const v=p.handles.points.map(l),I={start:{x:v[0][0],y:v[0][1]},end:{x:v[1][0],y:v[1][1]}},A=(v[2][0],v[2][1],v[3][0],v[3][1],o.Zc.distance(v[0],v[1])/3),b=I.start.x-I.end.x,S=I.start.y-I.end.y,y=Math.sqrt(b*b+S*S),R=b/y,x=S/y,M=(I.start.x+I.end.x)/2,P=(I.start.y+I.end.y)/2,E=M+A*x,D=P-A*R,C=M-A*x,T=P+A*R;p.handles.points[2]=s.canvasToWorld([E,D]),p.handles.points[3]=s.canvasToWorld([C,T]),c.invalidated=!0,(0,w.A)(d),(0,g.triggerAnnotationModified)(c,a,m.ChangeTypes.HandlesUpdated),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:r,newAnnotation:s}=this.editData;this.createMemo(n,o,{newAnnotation:s});const{data:l}=o;if(r){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),o.invalidated=!0}else this._dragModifyHandle(e),o.invalidated=!0;(0,w.A)(i),o.invalidated&&(0,g.triggerAnnotationModified)(o,n,m.ChangeTypes.HandlesUpdated)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{viewport:s}=r,{annotation:l,handleIndex:c}=this.editData,{data:d}=l,g=n.world,u=[s.worldToCanvas(d.handles.points[0]),s.worldToCanvas(d.handles.points[1]),s.worldToCanvas(d.handles.points[2]),s.worldToCanvas(d.handles.points[3])],h={start:{x:u[0][0],y:u[0][1]},end:{x:u[1][0],y:u[1][1]}},m={start:{x:u[2][0],y:u[2][1]},end:{x:u[3][0],y:u[3][1]}},p=[...g],v=s.worldToCanvas(p);if(0===c||1===c){const e=u[0===c?1:0],t=o.Zc.set(o.Zc.create(),v[0]-e[0],v[1]-e[1]),n=o.Zc.set(o.Zc.create(),u[c][0]-e[0],u[c][1]-e[1]);o.Zc.normalize(t,t),o.Zc.normalize(n,n);const i={start:{x:e[0],y:e[1]},end:{x:v[0],y:v[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(i,m))return;const a=e,r=this._getSignedAngle(n,t);let l=u[2][0],g=u[2][1],h=u[3][0],f=u[3][1];l-=a[0],g-=a[1],h-=a[0],f-=a[1];const I=l*Math.cos(r)-g*Math.sin(r),w=l*Math.sin(r)+g*Math.cos(r),A=h*Math.cos(r)-f*Math.sin(r),b=h*Math.sin(r)+f*Math.cos(r);l=I+a[0],g=w+a[1],h=A+a[0],f=b+a[1];const S=s.canvasToWorld([l,g]),y=s.canvasToWorld([h,f]);d.handles.points[c]=p,d.handles.points[2]=S,d.handles.points[3]=y}else{const e=2===c?3:2,t={longLineSegment:{start:h.start,end:h.end},shortLineSegment:{start:m.start,end:m.end}},n=o.Zc.subtract(o.Zc.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),i=o.Zc.normalize(o.Zc.create(),n),a=o.Zc.subtract(o.Zc.create(),[v[0],v[1]],[u[c][0],u[c][1]]),r=o.Zc.length(a),l=this._getSignedAngle(i,a),g=Math.cos(l)*r,I=o.Zc.scaleAndAdd(o.Zc.create(),[u[e][0],u[e][1]],i,g);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:v[0],y:v[1]},end:{x:I[0],y:I[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!f.intersectLine([v[0],v[1]],[I[0],I[1]],[h.start.x,h.start.y],[h.end.x,h.end.y]))return;d.handles.points[e]=s.canvasToWorld(I),d.handles.points[c]=p}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,I.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,w.A)(n),o&&(0,g.triggerAnnotationCompleted)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{h.wk.isInteractingWithTool=!0,e.addEventListener(m.Events.MOUSE_UP,this._endCallback),e.addEventListener(m.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(m.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(m.Events.TOUCH_TAP,this._endCallback),e.addEventListener(m.Events.TOUCH_END,this._endCallback),e.addEventListener(m.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{h.wk.isInteractingWithTool=!1,e.removeEventListener(m.Events.MOUSE_UP,this._endCallback),e.removeEventListener(m.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(m.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(m.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(m.Events.TOUCH_END,this._endCallback),e.removeEventListener(m.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{h.wk.isInteractingWithTool=!0,e.addEventListener(m.Events.MOUSE_UP,this._endCallback),e.addEventListener(m.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(m.Events.TOUCH_END,this._endCallback),e.addEventListener(m.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(m.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.wk.isInteractingWithTool=!1,e.removeEventListener(m.Events.MOUSE_UP,this._endCallback),e.removeEventListener(m.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(m.Events.TOUCH_END,this._endCallback),e.removeEventListener(m.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(m.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:i}=o;let a=(0,l.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),s=o.getRenderingEngine(),g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const l=a[i],{annotationUID:h,data:m}=l,{points:p,activeHandleIndex:f}=m.handles,I=p.map(e=>o.worldToCanvas(e));g.annotationUID=h;const{color:w,lineWidth:b,lineDash:S,shadow:y}=this.getAnnotationStyle({annotation:l,styleSpecifier:g});if(m.cachedStats[r]&&null!=m.cachedStats[r].unit?l.invalidated&&this._throttledCalculateCachedStats(l,s,e):(m.cachedStats[r]={length:null,width:null,unit:null},this._calculateCachedStats(l,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let R;if(!(0,d.isAnnotationVisible)(h))continue;(0,c.isAnnotationLocked)(h)||this.editData||null===f||(R=[I[f]]);const x=Boolean((0,A.h)("showHandlesAlways",{}));if(R||x){const e="0";(0,u.drawHandles)(t,h,e,x?I:R,{color:w})}const M=`${h}-line-1`,P=`${h}-line-2`,E="0";(0,u.drawLine)(t,h,E,I[0],I[1],{color:w,lineDash:S,lineWidth:b,shadow:y},M);const D="1";(0,u.drawLine)(t,h,D,I[2],I[3],{color:w,lineDash:S,lineWidth:b,shadow:y},P),n=!0;const C=this.getLinkedTextBoxStyle(g,l);if(!C.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const T=this.configuration.getTextLines(m,r);if(!T||0===T.length)continue;let L;m.handles.textBox.hasMoved||(L=(0,v.getTextBoxCoordsCanvas)(I),m.handles.textBox.worldPosition=o.canvasToWorld(L));const _=o.worldToCanvas(m.handles.textBox.worldPosition),O="1",V=(0,u.drawLinkedTextBox)(t,h,O,T,_,I,{},C),{x:N,y:U,width:k,height:B}=V;m.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([N,U]),topRight:o.canvasToWorld([N+k,U]),bottomLeft:o.canvasToWorld([N,U+B]),bottomRight:o.canvasToWorld([N+k,U+B])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.Zc.create();o.Zc.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.Zc.normalize(n,n);const i={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!f.intersectLine([i.start.x,i.start.y],[i.end.x,i.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:i}=n.viewport,r=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],c=o.handles.points[3],{cachedStats:d}=o,u=Object.keys(d);for(let e=0;e<u.length;e++){const t=u[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:o,dimensions:i}=n,g=b(o,r),h=b(o,s),m=b(o,l),p=b(o,c),f=[g,h],v=[m,p],{scale:I,unit:w}=(0,a.Op)(n,f),{scale:A,unit:S}=(0,a.Op)(n,v),y=this._calculateLength(r,s)/I,R=this._calculateLength(l,c)/A,x=y>R?y:R,M=y>R?R:y,P=y>R?w:S,E=y>R?S:w;this._isInsideVolume(g,h,m,p,i)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[t]={length:x,width:M,unit:P,widthUnit:E}}const h=e.invalidated;return e.invalidated=!1,h&&(0,g.triggerAnnotationModified)(e,i,m.ChangeTypes.StatsUpdated),d},this._isInsideVolume=(e,t,n,o,a)=>i.utilities.indexWithinDimensions(e,a)&&i.utilities.indexWithinDimensions(t,a)&&i.utilities.indexWithinDimensions(n,a)&&i.utilities.indexWithinDimensions(o,a),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,s.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,i=n.world;this.isDrawing=!0;const a=this.createAnnotation(e,[[...i],[...i],[...i],[...i]]);(0,l.addAnnotation)(a,o);const r=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:a,viewportIdsToRender:r,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,I.hideElementCursor)(o),e.preventDefault(),(0,w.A)(r),a}static{this.hydrate=(e,t,n)=>{const o=(0,i.getEnabledElementByViewportId)(e);if(!o)return;const{FrameOfReferenceUID:a,referencedImageId:r,viewPlaneNormal:s,instance:c,viewport:d}=this.hydrateBase(S,o,t[0],n),[g,u]=t,[h,m]=g,[p,f]=u,v=[h,m,p,f],{toolInstance:I,...A}=n||{},b={annotationUID:n?.annotationUID||i.utilities.uuidv4(),data:{handles:{points:v,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:r,...A}};return(0,l.addAnnotation)(b,d.element),(0,w.A)([d.id]),b}}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}}function y(e,t){const{cachedStats:n,label:o}=e,{length:a,width:r,unit:s}=n[t],l=[];return o&&l.push(o),void 0===a||l.push(`L: ${i.utilities.roundNumber(a)} ${s||s}`,`W: ${i.utilities.roundNumber(r)} ${s}`),l}},48736:(e,t,n)=>{var o=n(15327),i=n(3823),a=n(99737),r=n(17492),s=n(1989),l=n(56789),c=n(33852),d=n(74347),g=n(7001),u=n(58640),h=n(23631),m=n(40905);class p extends h.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.kr,ERASE_INSIDE_CIRCLE:c.r,FILL_INSIDE_SPHERE:r.Jq,ERASE_INSIDE_SPHERE:s._,THRESHOLD_INSIDE_CIRCLE:l.q,THRESHOLD_INSIDE_SPHERE:r.rd,THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL:r.Sw},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25,useCenterSegmentIndex:!1,preview:{enabled:!1,previewColors:{0:[255,255,255,128]},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[a.StrategyCallbacks.AcceptPreview]:{method:a.StrategyCallbacks.AcceptPreview,bindings:[{key:"Enter"}]},[a.StrategyCallbacks.RejectPreview]:{method:a.StrategyCallbacks.RejectPreview,bindings:[{key:"Escape"}]},[a.StrategyCallbacks.Interpolate]:{method:a.StrategyCallbacks.Interpolate,bindings:[{key:"i"}],configuration:{useBallStructuringElement:!0,noUseDistanceTransform:!0,noUseExtrapolation:!0}},interpolateExtrapolation:{method:a.StrategyCallbacks.Interpolate,bindings:[{key:"e"}],configuration:{}}}}}){super(e,t),this._lastDragInfo=null,this.onSetToolPassive=e=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=e=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:r}=t,s=(0,o.getEnabledElement)(n),{viewport:l}=s;this._editData=this.createEditData(n),this._activateDraw(n),(0,g.hideElementCursor)(n),e.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const c=i.Zc.clone(r.canvas),d=l.canvasToWorld([c[0],c[1]]);this._lastDragInfo={canvas:c,world:i.eR.clone(d)};const h=this._hoverData||this.createHoverData(n);(0,u.A)(h.viewportIdsToRender);const m=this.getOperationData(n);return this.applyActiveStrategyCallback(s,m,a.StrategyCallbacks.OnInteractionStart),!0},this.mouseMoveCallback=e=>{if(this.mode===a.ToolModes.Active){if(this.updateCursor(e),!this.configuration.preview.enabled)return;const{previewTimeMs:t,previewMoveDistance:n,dragMoveDistance:o}=this.configuration.preview,{currentPoints:a,element:r}=e.detail,{canvas:s}=a,{startPoint:l,timer:c,timerStart:d,isDrag:g}=this._previewData;if(g)return;const u=i.Zc.distance(s,l),h=Date.now()-d;if((u>n||h>t&&u>o)&&(c&&(window.clearTimeout(c),this._previewData.timer=null),g||this.rejectPreview(r)),!this._previewData.timer){const e=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:e,startPoint:s,element:r})}}},this.previewCallback=()=>{if(this._previewData.isDrag)return void(this._previewData.timer=null);this._previewData.timer=null;const e=this.getOperationData(this._previewData.element),t=(0,o.getEnabledElement)(this._previewData.element);if(!t)return;const{viewport:n}=t,i=this.configuration.activeStrategy,r=(0,m.S)({operationData:e,viewport:n,strategy:i});if(!e)return;const s=this.createMemo(e.segmentationId,r.segmentationVoxelManager);this._previewData.preview=this.applyActiveStrategyCallback((0,o.getEnabledElement)(this._previewData.element),{...e,...r,memo:s},a.StrategyCallbacks.Preview)},this._dragCallback=e=>{const t=e.detail,{element:n,currentPoints:a}=t,r=(0,o.getEnabledElement)(n),{viewport:s}=r;this.updateCursor(e);const{viewportIdsToRender:l}=this._hoverData;(0,u.A)(l);const c=i.Zc.distance(a.canvas,this._previewData.startPoint),{dragTimeMs:d,dragMoveDistance:g}=this.configuration.preview;if(!this._previewData.isDrag&&Date.now()-this._previewData.timerStart<d&&c<g)return;if(this._previewData.timer&&(window.clearTimeout(this._previewData.timer),this._previewData.timer=null),!this._lastDragInfo){const e=this._previewData.startPoint,t=s.canvasToWorld([e[0],e[1]]);this._lastDragInfo={canvas:i.Zc.clone(e),world:i.eR.clone(t)}}const h=a.canvas,m=s.canvasToWorld([h[0],h[1]]);this._hoverData=this.createHoverData(n,h),this._calculateCursor(n,h);const p=this.getOperationData(n);p.strokePointsWorld=[i.eR.clone(this._lastDragInfo.world),i.eR.clone(m)],this._previewData.preview=this.applyActiveStrategy(r,p);const f=i.Zc.clone(h);this._lastDragInfo={canvas:f,world:i.eR.clone(m)},this._previewData.element=n,this._previewData.timerStart=Date.now()+d,this._previewData.isDrag=!0,this._previewData.startPoint=f},this._endCallback=e=>{const t=e.detail,{element:n}=t,i=(0,o.getEnabledElement)(n),r=this.getOperationData(n);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(i,r),this.doneEditMemo(),this._deactivateDraw(n),(0,g.resetElementCursor)(n),this.updateCursor(e),this._editData=null,this._lastDragInfo=null,this.applyActiveStrategyCallback(i,r,a.StrategyCallbacks.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(n)},this._activateDraw=e=>{e.addEventListener(a.Events.MOUSE_UP,this._endCallback),e.addEventListener(a.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(a.Events.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(a.Events.MOUSE_UP,this._endCallback),e.removeEventListener(a.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(a.Events.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas;this._hoverData=this.createHoverData(n,i),this._calculateCursor(n,i),this._hoverData&&(0,u.A)(this._hoverData.viewportIdsToRender)}_calculateCursor(e,t){const n=(0,o.getEnabledElement)(e),{viewport:a}=n,{canvasToWorld:r}=a,s=a.getCamera(),{brushSize:l}=this.configuration,c=i.eR.fromValues(s.viewUp[0],s.viewUp[1],s.viewUp[2]),d=i.eR.fromValues(s.viewPlaneNormal[0],s.viewPlaneNormal[1],s.viewPlaneNormal[2]),g=i.eR.create();i.eR.cross(g,c,d);const u=r([t[0],t[1]]),h=i.eR.create(),m=i.eR.create(),p=i.eR.create(),f=i.eR.create();for(let e=0;e<=2;e++)h[e]=u[e]-c[e]*l,m[e]=u[e]+c[e]*l,p[e]=u[e]-g[e]*l,f[e]=u[e]+g[e]*l;if(!this._hoverData)return;const{brushCursor:v}=this._hoverData,{data:I}=v;void 0===I.handles&&(I.handles={}),I.handles.points=[h,m,p,f];const w=this.configuration.activeStrategy,A=this.configuration.strategies[w];"function"==typeof A?.computeInnerCircleRadius&&A.computeInnerCircleRadius({configuration:this.configuration,viewport:a}),I.invalidated=!1}getStatistics(e,t){if(!e)return;const n=(0,o.getEnabledElement)(e);return this.applyActiveStrategyCallback(n,this.getOperationData(e),a.StrategyCallbacks.GetStatistics,t)}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const t=(0,o.getEnabledElement)(e);t&&(this.applyActiveStrategyCallback(t,this.getOperationData(e),a.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1)}acceptPreview(e=this._previewData.element){e&&super.acceptPreview(e)}interpolate(e,t){if(!e)return;const n=(0,o.getEnabledElement)(e);this._previewData.preview=this.applyActiveStrategyCallback(n,this.getOperationData(e),a.StrategyCallbacks.Interpolate,t.configuration),this._previewData.isDrag=!0}invalidateBrushCursor(){if(void 0===this._hoverData)return;const{data:e}=this._hoverData.brushCursor,{viewport:t}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(t)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const o=this._hoverData.brushCursor;if(!0===o.data.invalidated){const{centerCanvas:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const i=o.metadata;if(!i)return;const a=i.brushCursorUID,r=o.data,{points:s}=r.handles,l=s.map(e=>n.worldToCanvas(e)),c=l[0],g=l[1],u=[Math.floor((c[0]+g[0])/2),Math.floor((c[1]+g[1])/2)],h=Math.abs(c[1]-Math.floor((c[1]+g[1])/2)),m=`rgb(${i.segmentColor?.slice(0,3)||[0,0,0]})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,d.drawCircle)(t,a,"0",u,h,{color:m,lineDash:0===this.centerSegmentIndexInfo.segmentIndex?[1,2]:null});const{dynamicRadiusInCanvas:p}=this.configuration?.threshold||{dynamicRadiusInCanvas:0};if(p){const e="1";(0,d.drawCircle)(t,a,e,u,p,{color:m})}}}p.toolName="Brush"},56789:(e,t,n)=>{n.d(t,{C$:()=>h,kr:()=>I,mu:()=>p,pB:()=>f,q:()=>w});var o=n(3823),i=n(15327),a=n(72282),r=n(55887),s=n(99737),l=n(11990),c=n(62783);const{transformWorldToIndex:d,transformIndexToWorld:g,isEqual:u}=i.utilities;function h(e){const[t,n,o,i]=e;return[[o[0],n[1]],[i[0],t[1]],[o[0],t[1]],[i[0],n[1]]]}const m={[s.StrategyCallbacks.Initialize]:e=>{const{points:t,viewport:n,segmentationImageData:i,viewUp:r,viewPlaneNormal:s}=e;if(!t)return;const l=o.eR.create();t.length>=2?(o.eR.add(l,t[0],t[1]),o.eR.scale(l,l,.5)):o.eR.copy(l,t[0]),e.centerWorld=l,e.centerIJK=d(i,l);const c=t.length>=2?o.eR.distance(t[0],t[1])/2:0,g=h(t.map(e=>n.worldToCanvas(e))).map(e=>n.canvasToWorld(e)),u=o.eR.fromValues(r[0],r[1],r[2]);o.eR.normalize(u,u);const m=o.eR.fromValues(s[0],s[1],s[2]);o.eR.normalize(m,m);const f=o.eR.create();o.eR.cross(f,u,m),o.eR.normalize(f,f);const v=(e.strokePointsWorld&&e.strokePointsWorld.length>0?e.strokePointsWorld:[e.centerWorld]).map(e=>o.eR.clone(e)),I=v.flatMap(e=>function(e,t,n,i){const a=o.eR.fromValues(e[0],e[1],e[2]),r=o.eR.create();o.eR.scaleAndAdd(r,a,t,i);const s=o.eR.create();o.eR.scaleAndAdd(s,a,t,-i);const l=o.eR.create();o.eR.scaleAndAdd(l,a,n,i);const c=o.eR.create();return o.eR.scaleAndAdd(c,a,n,-i),[s,r,c,l]}(e,u,f,c)),w=I.map(e=>d(i,e)),A=(0,a.getBoundingBoxAroundShapeIJK)(w,i.getDimensions());e.strokePointsWorld=v,e.isInObject=p(g,{strokePointsWorld:v,segmentationImageData:i,radius:c}),e.isInObjectBoundsIJK=A}};function p(e=[],t={}){if(!e||4!==e.length)throw new Error("createPointInEllipse: cornersInWorld must have 4 points");const[n,i,a,r]=e,s=o.eR.create();o.eR.add(s,n,i),o.eR.scale(s,s,.5);const l=o.eR.create();o.eR.subtract(l,r,n);const d=o.eR.length(l)/2;o.eR.normalize(l,l);const h=o.eR.create();o.eR.subtract(h,a,n);const m=o.eR.length(h)/2;o.eR.normalize(h,h);const p=o.eR.create();o.eR.cross(p,l,h),o.eR.normalize(p,p);const f=t.radius??Math.max(d,m),v=function(e,t){if(!e.length||t<=0)return null;const n=t*t,o=e.map(e=>[e[0],e[1],e[2]]),i=[];for(let e=1;e<o.length;e++){const t=o[e-1],n=o[e],a=n[0]-t[0],r=n[1]-t[1],s=n[2]-t[2],l=a*a+r*r+s*s;i.push({start:t,vector:[a,r,s],lengthSquared:l})}return e=>{if(!e)return!1;for(const t of o){const o=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];if(o*o+i*i+a*a<=n)return!0}for(const{start:t,vector:o,lengthSquared:a}of i){if(0===a){const o=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];if(o*o+i*i+a*a<=n)return!0;continue}const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],l=i*o[0]+r*o[1]+s*o[2],c=Math.max(0,Math.min(1,l/a)),d=t[0]+o[0]*c,g=t[1]+o[1]*c,u=t[2]+o[2]*c,h=e[0]-d,m=e[1]-g,p=e[2]-u;if(h*h+m*m+p*p<=n)return!0}return!1}}(t.strokePointsWorld||[],f);if(u(d,m)){const e={center:s,radius:d,radius2:d*d};return(n,o)=>{let i=n;return!i&&o&&t.segmentationImageData&&(i=g(t.segmentationImageData,o)),!!i&&(!!v?.(i)||(0,c.d)(e,i))}}return(e,i)=>{let a=e;if(!a&&i&&t.segmentationImageData&&(a=g(t.segmentationImageData,i)),!a)return!1;if(v?.(a))return!0;const r=o.eR.create();o.eR.subtract(r,a,s);const c=o.eR.dot(r,p),u=o.eR.create();o.eR.scaleAndAdd(u,r,p,-c);const f=o.eR.create(),I=o.eR.create();o.eR.subtract(I,s,n),o.eR.subtract(f,u,I);const w=o.eR.dot(f,l),A=o.eR.dot(f,h);return w*w/(d*d)+A*A/(m*m)<=1}}const f=new r.A("Circle",l.A.regionFill,l.A.setValue,m,l.A.determineSegmentIndex,l.A.preview,l.A.labelmapStatistics),v=new r.A("CircleThreshold",l.A.regionFill,l.A.setValue,m,l.A.determineSegmentIndex,l.A.dynamicThreshold,l.A.threshold,l.A.preview,l.A.islandRemoval,l.A.labelmapStatistics),I=f.strategyFunction,w=v.strategyFunction},10088:(e,t,n)=>{var o=n(3823),i=n(15327),a=n(72282),r=n(55887),s=n(99737),l=n(11990);const{transformWorldToIndex:c}=i.utilities,d={[s.StrategyCallbacks.Initialize]:e=>{const{points:t,viewport:n,segmentationImageData:r}=e;if(!t)return;const s=o.eR.fromValues(0,0,0);t.forEach(e=>{o.eR.add(s,s,e)}),o.eR.scale(s,s,1/t.length),e.centerWorld=s,e.centerIJK=c(r,s);const{boundsIJK:l,pointInShapeFn:d}=function(e,t,n){let r=t.map(e=>c(n,e));r=r.map(e=>e.map(e=>Math.round(e)));const s=(0,a.getBoundingBoxAroundShapeIJK)(r,n.getDimensions()),[l,d,g,u]=t,h=o.eR.create(),m=o.eR.create();o.eR.subtract(h,d,l),o.eR.subtract(m,u,l);const p=o.eR.length(h),f=o.eR.length(m);o.eR.normalize(h,h),o.eR.normalize(m,m);const v=o.eR.create();o.eR.cross(v,h,m),o.eR.normalize(v,v);const I=n.getDirection(),w=n.getSpacing(),{viewPlaneNormal:A}=e.getCamera(),b=i.utilities.getSpacingInNormalDirection({direction:I,spacing:w},A),S=e=>{const t=o.eR.create();o.eR.subtract(t,e,l);const n=o.eR.dot(t,h),i=o.eR.dot(t,m),a=Math.abs(o.eR.dot(t,v));return n>=-b&&n<=p+b&&i>=-b&&i<=f+b&&a<=b};return{boundsIJK:s,pointInShapeFn:S}}(n,t,r);e.isInObject=d,e.isInObjectBoundsIJK=l}};const g=new r.A("Rectangle",l.A.regionFill,l.A.setValue,d,l.A.determineSegmentIndex,l.A.preview,l.A.labelmapStatistics),u=new r.A("RectangleThreshold",l.A.regionFill,l.A.setValue,d,l.A.determineSegmentIndex,l.A.dynamicThreshold,l.A.threshold,l.A.preview,l.A.islandRemoval,l.A.labelmapStatistics);g.strategyFunction,u.strategyFunction},99522:(e,t,n)=>{n.d(t,{fillInsideCircle:()=>o.kr});n(10088);var o=n(56789)},64485:(e,t,n)=>{n.d(t,{x:()=>a});var o=n(15327),i=(n(82056),n(3823));function a(e,t,n){const a=e.getImageIds();if(!a||!a.length)return;const r=a.map(e=>{const{imagePositionPatient:a}=o.metaData.get("imagePlaneModule",e),r=function(e,t,n){const o=i.eR.create();i.eR.sub(o,e,t);const a=i.eR.dot(o,n);return Math.abs(a)}(t,a,n);return{imageId:e,distance:r}});return r.sort((e,t)=>e.distance-t.distance),r[0].imageId}},76802:()=>{},87063:(e,t,n)=>{n.d(t,{g:()=>r});var o=n(15327);const{EPSILON:i}=o.CONSTANTS;function a(e,t,n=!1){let o=1/0,a=n?-1/0:0,r=1/0,s=n?-1/0:0,l=1/0,c=n?-1/0:0;const d=3===e[0]?.length;for(let t=0;t<e.length;t++){const n=e[t];o=Math.min(n[0],o),a=Math.max(n[0],a),r=Math.min(n[1],r),s=Math.max(n[1],s),d&&(l=Math.min(n[2]??l,l),c=Math.max(n[2]??c,c))}return t?(o=Math.max(n?t[0]+i:0,o),a=Math.min(n?t[0]-i:t[0]-1,a),r=Math.max(n?t[1]+i:0,r),s=Math.min(n?t[1]-i:t[1]-1,s),d&&3===t.length&&(l=Math.max(n?t[2]+i:0,l),c=Math.min(n?t[2]-i:t[2]-1,c))):n||(o=Math.max(0,o),a=Math.min(1/0,a),r=Math.max(0,r),s=Math.min(1/0,s),d&&(l=Math.max(0,l),c=Math.min(1/0,c))),d?[[o,a],[r,s],[l,c]]:[[o,a],[r,s],null]}function r(e,t){return a(e,t,!1)}},72282:(e,t,n)=>{n.d(t,{getBoundingBoxAroundShapeIJK:()=>o.g});n(76802);var o=n(87063)},56534:(e,t,n)=>{n.d(t,{addContourSegmentationAnnotation:()=>i.V,createPolylineHole:()=>a.rK,removeContourSegmentationAnnotation:()=>o.M});n(62854),n(15327),n(6802);var o=n(37354),i=n(85263);n(44049);n(29031),n(21536),n(78130),n(3444),n(49941),n(1318);var a=n(65172);n(98916),n(86591),n(52634),n(63890)},46228:(e,t,n)=>{function o(e,t,n){let i=-1;if(t.forEach((t,n)=>{i>=0||t.a==e.b&&(i=n)}),i>=0){const e=t[i];return t.splice(i,1),n.push(e.b),n[0]==e.b?{remainingLines:t,contourPoints:n,type:"CLOSED_PLANAR"}:o(e,t,n)}return{remainingLines:t,contourPoints:n,type:"OPEN_PLANAR"}}function i(e){if(0==e.length)return[];const t=[],n=e.shift();t.push(n.a),t.push(n.b);const a=o(n,e,t);if(0==a.remainingLines.length)return[{type:a.type,contourPoints:a.contourPoints}];{const e=i(a.remainingLines);return e.push({type:a.type,contourPoints:a.contourPoints}),e}}function a(e){return i(e)}n.d(t,{d1:()=>a})},98013:(e,t,n)=>{var o=n(15327);n(3823);const{isEqual:i}=o.utilities},37546:(e,t,n)=>{function o(e,t=!1){const n=e.getPoints(),o=e.getLines(),i=new Array(n.getNumberOfPoints()).fill(0).map((e,t)=>n.getPoint(t).slice()),a=new Array(o.getNumberOfCells()).fill(0).map((e,t)=>{const n=o.getCell(3*t).slice();return{a:n[0],b:n[1]}});if(t)return{points:i,lines:a};const r=[];for(const[e,t]of i.entries()){const n=r.findIndex(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]);if(n>=0)a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t));else{const n=r.length;r.push(t),a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t))}}return{points:r,lines:a.filter(e=>e.a!==e.b)}}n.d(t,{v:()=>o})},473:(e,t,n)=>{n.d(t,{getTextBoxCoordsCanvas:()=>o.A});var o=n(1239)},4096:(e,t,n)=>{n.d(t,{Op:()=>g});var o=n(15327);const{CalibrationTypes:i}=o.Enums,a="px",r="voxels",s=[1,2,3,4],l=["3,3","4,7"],c={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm²",9:"cm²/s",12:"degrees"},d="²",g=(e,t)=>{const{calibration:n,hasPixelSpacing:g}=e;let u=g?"mm":a;const h=g?"mm³":r;let m=u+d,p=1,f="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:u,areaUnit:m,scale:p,volumeUnit:h};if(n.type===i.UNCALIBRATED)return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};if(n.sequenceOfUltrasoundRegions){let e,i;if(Array.isArray(t)&&2===t.length)[e,i]=t;else if("function"==typeof t){const n=t();e=n[0],i=n[1]}let g=n.sequenceOfUltrasoundRegions.filter(t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&i[0]>=t.regionLocationMinX0&&i[0]<=t.regionLocationMaxX1&&i[1]>=t.regionLocationMinY0&&i[1]<=t.regionLocationMaxY1);if(!g?.length)return{unit:u,areaUnit:m,scale:p,volumeUnit:h};if(g=g.filter(e=>s.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)),!g.length)return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};const v=g[0],I=Math.abs(v.physicalDeltaX),w=Math.abs(v.physicalDeltaY);if(!o.utilities.isEqual(I,w,.001))return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};p=1/I,f="US Region",u=c[v.physicalUnitsXDirection]||"unknown",m=u+d}else n.scale&&(p=n.scale);return[i.ERMF,i.USER,i.ERROR,i.PROJECTION,i.CALIBRATED,i.UNKNOWN].includes(n?.type)&&(f=n.type),{unit:u+(f?` ${f}`:""),areaUnit:m+(f?` ${f}`:""),scale:p,volumeUnit:h+(f?` ${f}`:"")}}},4296:(e,t,n)=>{n.d(t,{l:()=>l});var o=n(15327),i=n(3823),a=n(72282);const{transformWorldToIndex:r}=o.utilities;function s(e,t,n){const[o,s]=e,l=i.eR.fromValues((o[0]+s[0])/2,(o[1]+s[1])/2,(o[2]+s[2])/2),c=i.eR.distance(o,s)/2,{boundsIJK:d,topLeftWorld:g,bottomRightWorld:u}=function(e,t,n,o,s){const l=e.getDimensions(),{row:c,column:d,normal:g}=t,u=i.eR.create(),h=i.eR.create();i.eR.scaleAndAdd(u,o,g,s),i.eR.scaleAndAdd(h,o,g,-s),i.eR.scaleAndAdd(u,u,d,-s),i.eR.scaleAndAdd(h,h,d,s),i.eR.scaleAndAdd(u,u,c,-s),i.eR.scaleAndAdd(h,h,c,s);const m=r(e,u),p=r(e,h),f=n.map(t=>r(e,t)),v=(0,a.getBoundingBoxAroundShapeIJK)([m,p,...f],l);return{boundsIJK:v,topLeftWorld:u,bottomRightWorld:h}}(t,n,e,l,c);return{boundsIJK:d,centerWorld:l,radiusWorld:c,topLeftWorld:g,bottomRightWorld:u}}function l(e,t,n){if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const o=n.getCamera(),a=i.eR.fromValues(o.viewUp[0],o.viewUp[1],o.viewUp[2]),r=i.eR.fromValues(o.viewPlaneNormal[0],o.viewPlaneNormal[1],o.viewPlaneNormal[2]),l=i.eR.create();i.eR.cross(l,a,r);return s(e,t,{row:l,normal:r,column:i.eR.negate(i.eR.create(),a)})}},39848:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(15327),i=n(77609);function a(e,t){const n=(0,o.getEnabledElement)(e),{renderingEngineId:a,viewportId:r}=n,s=(0,i.getToolGroupForViewport)(r,a);if(!s)return[];const l=[],c=Object.keys(s.toolOptions);for(let e=0;e<c.length;e++){const n=c[e],o=s.toolOptions[n];if(o&&t.includes(o.mode)){const e=s.getToolInstance(n);l.push(e)}}return l}},88638:()=>{},25963:(e,t,n)=>{n(3823)},83923:(e,t,n)=>{n(25963)},28364:(e,t,n)=>{n.d(t,{I:()=>i,t:()=>o});class o{}class i{constructor(e){this.storePointData=e.storePointData}getStatistics(){console.debug("InstanceCalculator getStatistics called")}}},73262:(e,t,n)=>{n.d(t,{BasicStatsCalculator:()=>o.O});var o=n(69013);n(28364)},77081:(e,t,n)=>{n(82216)},87009:()=>{},95527:(e,t,n)=>{n.d(t,{point:()=>o,polyline:()=>i});n(88638),n(73262),n(77081),n(87009),n(93258);var o=n(82216),i=n(92984);n(33657),n(23324),n(83923)},18989:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(73149);function i(e,t,n){return(0,o.A)(e,t,n).distanceSquared}},73149:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(82216);function i(e,t,n){let i;const a=(0,o.distanceToPointSquared)(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(i=e),!i){const o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/a;i=o<0?e:o>1?t:[e[0]+o*(t[0]-e[0]),e[1]+o*(t[1]-e[1])]}return{point:[...i],distanceSquared:(0,o.distanceToPointSquared)(n,i)}}},93258:(e,t,n)=>{n.d(t,{distanceToPoint:()=>o.A,distanceToPointSquared:()=>i.A,intersectLine:()=>a.A,isPointOnLineSegment:()=>r.A});var o=n(86978),i=n(18989),a=(n(73149),n(81205)),r=n(91818)},91818:(e,t,n)=>{n.d(t,{A:()=>i});const o=.01;function i(e,t,n){const i=e[0]<=t[0]?e[0]:t[0],a=e[0]>=t[0]?e[0]:t[0],r=e[1]<=t[1]?e[1]:t[1],s=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=i-o&&n[0]<=a+o&&n[1]>=r-o&&n[1]<=s+o))return!1;const l=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(l>=0?l:-l)<=o}},82216:(e,t,n)=>{function o(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,o,i=0]=e,[a,r,s=0]=t,l=a-n,c=r-o,d=s-i;return l*l+c*c+d*d}function i(e,t){return Math.sqrt(o(e,t))}function a(e,t){const[n,o]=e,[i,a]=t;return[2*i-n,2*a-o]}n.r(t),n.d(t,{distanceToPoint:()=>i,distanceToPointSquared:()=>o,mirror:()=>a})},97792:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(15327),i=n(3823);const a=(e,t,n,a)=>{const{xDir:r,yDir:s,spacing:l}=a,c=(0,o.getEnabledElement)(e),{viewport:d}=c;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const g=d.canvasToWorld(t[t.length-1]),u=d.canvasToWorld(n),h=i.eR.create();i.eR.subtract(h,u,g);const m=Math.abs(i.eR.dot(h,r)),p=Math.abs(i.eR.dot(h,s)),f=Math.max(Math.floor(m/l[0]),Math.floor(p/l[0]));if(f>1){const e=t[t.length-1],o=i.Zc.dist(e,n),a=i.Zc.create();i.Zc.subtract(a,n,e),i.Zc.set(a,a[0]/o,a[1]/o);const r=o/f;for(let n=1;n<=f;n++)t.push([e[0]+r*a[0]*n,e[1]+r*a[1]*n])}else t.push(n);return f}},56777:(e,t,n)=>{function o(e,t,n,o){let r=!1;const s=e[0]<t[0]?e[0]:t[0],l=e[1]<t[1]?e[1]:t[1],c=e[0]>t[0]?e[0]:t[0],d=e[1]>t[1]?e[1]:t[1],g=n[0]<o[0]?n[0]:o[0],u=n[1]<o[1]?n[1]:o[1],h=n[0]>o[0]?n[0]:o[0],m=n[1]>o[1]?n[1]:o[1];if(s>h||c<g||l>m||d<u)return!1;const p=[i(e,t,n),i(e,t,o),i(n,o,e),i(n,o,t)];return p[0]!==p[1]&&p[2]!==p[3]||((0===p[0]&&a(e,n,t)||0===p[1]&&a(e,o,t)||0===p[2]&&a(n,e,o)||0===p[3]&&a(n,t,o))&&(r=!0),r)}function i(e,t,n){const o=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===o?0:o>0?1:2}function a(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}n.d(t,{A:()=>o})},68385:(e,t,n)=>{n.d(t,{S:()=>p});var o,i,a,r=n(82216),s=n(37135),l=n(46513),c=n(42436),d=n(405),g=n(11377),u=n(3823),h=n(10812);function m(e){for(let t=0,n=e.length;t<n;t++){const o=e[t];o.next||(o.next=e[t===n-1?0:t+1])}}function p(e,t){const n=(0,g.A)(e),p=(0,g.A)(t),f=u.eR.dot(p,n);u.Fd.equals(1,f)||(t=t.slice().reverse());if(!(0,d.A)(t,e)&&(0,c.A)(t,e))return t.slice();const{targetPolylinePoints:v}=function(e,t){const n=[],c=[],d=new Map;let g=(0,l.A)(t,e[0])?a.Exiting:a.Entering;for(let c=0,u=e.length;c<u;c++){const m=e[c],p=(0,l.A)(t,m),f={type:o.Vertex,coordinates:m,position:p?i.Inside:i.Outside,visited:!1,next:null};n.push(f);const v=e[c===u-1?0:c+1],I=(0,s.A)(t,m,v).map(e=>{const n=e[0],o=t[e[0]],i=t[e[1]],a=(0,h.A)(m,v,o,i);return{sourceLineSegmentId:n,coordinate:a,targetStartPointDistSquared:r.distanceToPointSquared(m,a)}});I.sort((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared),I.forEach(e=>{const{sourceLineSegmentId:t,coordinate:r}=e,s={type:o.Intersection,coordinates:r,position:i.Edge,direction:g,visited:!1,next:null},l={...s,direction:a.Unknown,cloned:!0};g===a.Entering?s.next=l:l.next=s;let c=d.get(t);c||(c=[],d.set(t,c)),n.push(s),c.push(l),g*=-1})}for(let e=0,n=t.length;e<n;e++){const n=e,i=t[e],a={type:o.Vertex,coordinates:i,visited:!1,next:null};c.push(a);const s=d.get(n);s?.length&&s.map(e=>({intersectionPoint:e,lineSegStartDistSquared:r.distanceToPointSquared(i,e.coordinates)})).sort((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared).map(({intersectionPoint:e})=>e).forEach(e=>c.push(e))}return m(n),m(c),{targetPolylinePoints:n,sourcePolylinePoints:c}}(e,t),I=function(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===i.Outside&&n.type===o.Vertex)return n}for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===i.Outside)return n}}(v);if(!I)return e.slice();const w=[I.coordinates];let A=I.next,b=0;const S=e.length+t.length+1e3;for(;A!==I&&b<S;)if(b++,A.type===o.Intersection&&A.cloned)A=A.next;else if(w.push(A.coordinates),A=A.next,!A){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}return b>=S&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),w}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(o||(o={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(i||(i={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(a||(a={}))},46513:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(19246);function i(e,t,n={closed:void 0}){if(e.length<3)return!1;const a=e.length;let r=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(i(e,t))return!1;const c=!(void 0===s?(0,o.A)(e):s),d=e.length-(c?1:2);for(let n=0;n<=d;n++){const o=e[n],i=e[n===a-1?0:n+1],s=o[0]>=i[0]?o[0]:i[0],l=o[1]>=i[1]?o[1]:i[1],c=o[1]<=i[1]?o[1]:i[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=o[0]===i[0];if(!e){const n=(t[1]-o[1])*(i[0]-o[0])/(i[1]-o[1])+o[0];e=t[0]<=n}r+=e?1:0}}return!!(r%2)}},58754:(e,t,n)=>{function o(e){if(e.length<3)return e.slice();const t=e.map(e=>[e[0],e[1]]).sort((e,t)=>e[0]===t[0]?e[1]-t[1]:e[0]-t[0]);function n(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}const o=[];for(const e of t){for(;o.length>=2&&n(o[o.length-2],o[o.length-1],e)<=0;)o.pop();o.push(e)}const i=[];for(let e=t.length-1;e>=0;e--){const o=t[e];for(;i.length>=2&&n(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}return o.pop(),i.pop(),o.concat(i)}n.d(t,{A:()=>o})},98122:(e,t,n)=>{function o(e,t){let n=e;const o=t?.numDimensions||2,i=3===o;if(!Array.isArray(e[0])){const t=e,a=t.length/o;n=new Array(t.length/o);for(let e=0,r=a;e<r;e++)n[e]=[t[e*o],t[e*o+1]],i&&n[e].push(t[e*o+2])}let a=1/0,r=1/0,s=-1/0,l=-1/0,c=1/0,d=-1/0;for(let e=0,t=n.length;e<t;e++){const[t,o,g]=n[e];a=a<t?a:t,r=r<o?r:o,s=s>t?s:t,l=l>o?l:o,i&&(c=c<g?c:g,d=d>g?d:g)}return i?{minX:a,maxX:s,minY:r,maxY:l,minZ:c,maxZ:d}:{minX:a,maxX:s,minY:r,maxY:l}}n.d(t,{A:()=>o})},86909:(e,t,n)=>{function o(e){const t=e.length;let n=0,o=t-1;for(let i=0;i<t;i++)n+=(e[o][0]+e[i][0])*(e[o][1]-e[i][1]),o=i;return Math.abs(n/2)}n.d(t,{A:()=>o})},32979:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(3823),i=n(56777);function a(e,t,n,a=!0){let r,s;a?(s=e.length-1,r=0):(s=0,r=1);const l=[];for(let o=r;o<e.length;o++){const a=e[s],r=e[o];(0,i.A)(t,n,a,r)&&l.push([s,o]),s=o}if(0===l.length)return;const c=[];l.forEach(n=>{const i=[e[n[0]],e[n[1]]],a=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];c.push(o.Zc.distance(a,t))});const d=Math.min(...c);return{segment:l[c.indexOf(d)],distance:d}}},4338:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(56777);function i(e,t,n,i=!0){let a,r;i?(r=e.length-1,a=0):(r=0,a=1);for(let i=a;i<e.length;i++){const a=e[r],s=e[i];if((0,o.A)(t,n,a,s))return[r,i];r=i}}},50932:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(37135),i=n(10812);function a(e,t,n,a=!0){const r=[],s=(0,o.A)(e,t,n,a);for(let o=0;o<s.length;o++){const a=e[s[o][0]],l=e[s[o][1]],c=(0,i.A)(t,n,a,l);r.push(c)}return r}},37135:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(56777);function i(e,t,n,i=!0){const a=[],r=e.length,s=r-(i?1:2);for(let i=0;i<=s;i++){const s=e[i],l=i===r-1?0:i+1,c=e[l];(0,o.A)(t,n,s,c)&&a.push([i,l])}return a}},10812:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(93258);const i=.01;function a(e,t,n,a){const r=[t[0]-e[0],t[1]-e[1]],s=[a[0]-n[0],a[1]-n[1]],l=s[1]*r[0]-s[0]*r[1];if((l>=0?l:-l)<i){const i=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],r=[n[0]<a[0]?n[0]:a[0],n[0]>a[0]?n[0]:a[0],n[1]<a[1]?n[1]:a[1],n[1]>a[1]?n[1]:a[1]];if(!(i[0]<=r[1]&&i[1]>=r[0]&&i[2]<=r[3]&&i[3]>=r[2]))return;if(!(o.isPointOnLineSegment(e,t,n)||o.isPointOnLineSegment(e,t,a)||o.isPointOnLineSegment(n,a,e)))return;return[.5*((i[0]>r[0]?i[0]:r[0])+(i[1]<r[1]?i[1]:r[1])),.5*((i[2]>r[2]?i[2]:r[2])+(i[3]<r[3]?i[3]:r[3]))]}let c=e[1]-n[1],d=e[0]-n[0];const g=r[0]*c-r[1]*d;c=(s[0]*c-s[1]*d)/l,d=g/l;return[e[0]+c*r[0],e[1]+c*r[1]]}},11377:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(63113);function i(e){const t=(0,o.A)(e);return[0,0,t/Math.abs(t)]}},43490:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(3823);function i(e){const t=function(e){const t=o.eR.create(),n=e[0];for(let o=0,i=e.length;o<i;o++){const a=e[o],r=e[o===i-1?0:o+1],s=a[0]-n[0],l=a[1]-n[1],c=a[2]-n[2],d=r[0]-n[0],g=r[1]-n[1],u=r[2]-n[2];t[0]+=l*u-c*g,t[1]+=c*d-s*u,t[2]+=s*g-l*d}return o.eR.scale(t,t,.5),t}(e);return o.eR.normalize(t,t)}},61785:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(15327),i=n(3823);const a=.001,r=(e,t)=>{let n,r,s;if(e instanceof o.StackViewport){const t=e.getImageData();if(!t)return;r=t.direction.slice(0,3),s=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:o,spacing:l}=t,{viewPlaneNormal:c,viewUp:d}=e.getCamera(),g=o.slice(0,3),u=o.slice(3,6),h=o.slice(6,9),m=i.eR.create();i.eR.cross(m,d,c);const p=Math.abs(i.eR.dot(m,g)),f=Math.abs(i.eR.dot(m,u)),v=Math.abs(i.eR.dot(m,h));let I;if(Math.abs(1-p)<a)I=l[0],r=g;else if(Math.abs(1-f)<a)I=l[1],r=u;else{if(!(Math.abs(1-v)<a))throw new Error("No support yet for oblique plane planar contours");I=l[2],r=h}const w=Math.abs(i.eR.dot(d,g)),A=Math.abs(i.eR.dot(d,u)),b=Math.abs(i.eR.dot(d,h));let S;if(Math.abs(1-w)<a)S=l[0],s=g;else if(Math.abs(1-A)<a)S=l[1],s=u;else{if(!(Math.abs(1-b)<a))throw new Error("No support yet for oblique plane planar contours");S=l[2],s=h}n=[I,S]}return{spacing:[n[0]/t,n[1]/t],xDir:r,yDir:s}}},4239:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(63113);function i(e){return(0,o.A)(e)>=0?1:-1}},405:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(4338);function i(e,t){for(let n=0,i=e.length;n<i;n++){const a=e[n],r=e[n===i-1?0:n+1],s=(0,o.A)(t,a,r);if(2===s?.length)return!0}return!1}},70112:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(3823),i=n(46513),a=n(63113),r=n(36039);function s(e,t){if(e.length<3||t.length<3)return[];let n=t.slice();const s=(0,a.A)(e),l=(0,a.A)(n);if(Math.abs(s)<r.p8||Math.abs(l)<r.p8)return[];s<0&&(e=e.slice().reverse()),l<0&&(n=n.slice().reverse());const c=n,d=[];for(let t=0;t<e.length;t++){const i=e[t],a=e[(t+1)%e.length];for(let e=0;e<n.length;e++){const s=n[e],l=n[(e+1)%n.length],c=(0,r.O4)(i,a,s,l);if(c){const n=Math.sqrt(o.Zc.squaredDistance(i,a)),g=Math.sqrt(o.Zc.squaredDistance(s,l));d.push({coord:[...c],seg1Idx:t,seg2Idx:e,alpha1:n<r.p8?0:Math.sqrt(o.Zc.squaredDistance(i,c))/n,alpha2:g<r.p8?0:Math.sqrt(o.Zc.squaredDistance(s,c))/g})}}}if(0===d.length)return(0,i.A)(c,e[0])&&e.every(e=>(0,i.A)(c,e))?[[...e.map(e=>[...e])]]:(0,i.A)(e,n[0])&&n.every(t=>(0,i.A)(e,t))?[[...n.map(e=>[...e])]]:[];const g=(e,t,n)=>{const o=[];let i=0;for(let a=0;a<e.length;a++){const s=e[a];o.push({id:`${t}_v${i++}`,coordinates:[...s],type:r.n7.Vertex,originalPolyIndex:t,originalVertexIndex:a,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:r.lG.Unknown});const l=n.filter(e=>(0===t?e.seg1Idx:e.seg2Idx)===a).sort((e,n)=>(0===t?e.alpha1:e.alpha2)-(0===t?n.alpha1:n.alpha2));for(const e of l){if(o.length>0&&(0,r.Sk)(o[o.length-1].coordinates,e.coord)){const n=o[o.length-1];n.isIntersection||(n.isIntersection=!0,n.intersectionInfo=e,n.alpha=0===t?e.alpha1:e.alpha2,n.type=r.n7.Intersection);continue}o.push({id:`${t}_i${i++}`,coordinates:[...e.coord],type:r.n7.Intersection,originalPolyIndex:t,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:0===t?e.alpha1:e.alpha2,intersectionInfo:e,intersectionDir:r.lG.Unknown})}}const a=[];if(o.length>0){a.push(o[0]);for(let e=1;e<o.length;e++)if((0,r.Sk)(o[e].coordinates,a[a.length-1].coordinates)){const t=a[a.length-1];o[e].isIntersection&&o[e].intersectionInfo&&(t.isIntersection=!0,t.intersectionInfo=o[e].intersectionInfo,t.alpha=o[e].alpha,t.type=r.n7.Intersection)}else a.push(o[e])}if(a.length>1&&(0,r.Sk)(a[0].coordinates,a[a.length-1].coordinates)){const e=a[0],t=a.pop();t.isIntersection&&!e.isIntersection&&t.intersectionInfo&&(e.isIntersection=!0,e.intersectionInfo=t.intersectionInfo,e.alpha=t.alpha,e.type=r.n7.Intersection)}if(a.length>0)for(let e=0;e<a.length;e++)a[e].next=a[(e+1)%a.length],a[e].prev=a[(e-1+a.length)%a.length];return a},u=g(e,0,d),h=g(n,1,d);if(0===u.length||0===h.length)return[];u.forEach(e=>{if(e.isIntersection&&e.intersectionInfo){const t=e.intersectionInfo,n=h.find(n=>n.isIntersection&&n.intersectionInfo&&(0,r.Sk)(n.coordinates,e.coordinates)&&n.intersectionInfo.seg1Idx===t.seg1Idx&&n.intersectionInfo.seg2Idx===t.seg2Idx);if(n){e.partnerNode=n,n.partnerNode=e;const t=o.Zc.subtract(o.Zc.create(),e.coordinates,e.prev.coordinates),a=o.Zc.subtract(o.Zc.create(),n.next.coordinates,n.coordinates),s=t[0]*a[1]-t[1]*a[0];if(s>r.p8)e.intersectionDir=r.lG.Entering,n.intersectionDir=r.lG.Exiting;else if(s<-r.p8)e.intersectionDir=r.lG.Exiting,n.intersectionDir=r.lG.Entering;else{const t=[(e.prev.coordinates[0]+e.coordinates[0])/2,(e.prev.coordinates[1]+e.coordinates[1])/2];(0,i.A)(c,t)?(e.intersectionDir=r.lG.Exiting,n.intersectionDir=r.lG.Entering):(e.intersectionDir=r.lG.Entering,n.intersectionDir=r.lG.Exiting)}}else e.isIntersection=!1,e.intersectionInfo=void 0}});const m=[];for(const e of u){if(!e.isIntersection||e.visited||e.intersectionDir!==r.lG.Entering)continue;let t=[],n=e,o=!0;const i=e;let l=0;const c=2*(u.length+h.length);u.forEach(e=>e.processedInPath=!1),h.forEach(e=>e.processedInPath=!1);do{if(l++>c){console.warn("Intersection: Max iterations in path tracing.",i.id,n.id),t=[];break}if(n.processedInPath&&n!==i){console.warn("Intersection: Path processing loop detected, discarding path segment.",i.id,n.id),t=[];break}n.processedInPath=!0,n.visited=!0,0!==t.length&&(0,r.Sk)(t[t.length-1],n.coordinates)||t.push([...n.coordinates]);let e=!1;n.isIntersection&&n.partnerNode&&(o?(n=n.partnerNode,o=!1,e=!0):(n=n.partnerNode,o=!0,e=!0)),n=n.next}while(n!==i||o&&0!==n.originalPolyIndex||!o&&1!==n.originalPolyIndex);if(l>c||0===t.length||t.length>0&&(0,r.Sk)(t[0],t[t.length-1])&&t.pop(),t.length>=3){const e=(0,a.A)(t);(s>0&&e<0||s<0&&e>0)&&t.reverse(),m.push(t.map(e=>[...e]))}}return m}},8361:(e,t,n)=>{n.d(t,{i:()=>a});var o=n(46513),i=n(28502);function a(e,t,n={}){const{sharedDimensionIndex:a,projectedPolyline:r}=(0,i.p)(t),{holes:s}=n,l=[];if(s)for(let e=0;e<s.length;e++){const t=s[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(a+1)%3],t[e][(a+2)%3]]);l.push(n)}const c=[e[(a+1)%3],e[(a+2)%3]];return(0,o.A)(r,c,{holes:l})}},80514:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(3823);const i=(e,t,n,i)=>{const a=[e[0]-t[0],e[1]-t[1]],r=[n[0]-t[0],n[1]-t[1]],s=a[0]*r[0]+a[1]*r[1];if(s<0)return!1;const l=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===l)return!1;const c=s/l,d=[r[0]/l,r[1]/l],g=[d[0]*c,d[1]*c],u=[t[0]+g[0],t[1]+g[1]];return!(o.Zc.distance(e,u)>i)&&!(o.Zc.distance(t,u)>o.Zc.distance(t,n))}},82265:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(3823);const i=(e,t,n)=>o.Zc.dist(e,t)<n},28502:(e,t,n)=>{n.d(t,{p:()=>a});var o=n(15327);const i=1e-6;function a(e){let t;const n=o.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every((t,n,o)=>Math.abs(t[e]-o[0][e])<i)){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const a=[],r=(t+1)%3,s=(t+2)%3;for(let t=0;t<e.length;t++)a.push([e[t][r],e[t][s]]);return{sharedDimensionIndex:t,projectedPolyline:a}}},36039:(e,t,n)=>{n.d(t,{O4:()=>l,Sk:()=>s,lG:()=>d,n7:()=>c,p8:()=>a});var o=n(15327),i=n(3823);const a=1e-7;function r(e,t){return e[0]*t[1]-e[1]*t[0]}function s(e,t){return o.utilities.isEqual(e,t,a)}function l(e,t,n,o){const l=i.Zc.subtract(i.Zc.create(),t,e),c=i.Zc.subtract(i.Zc.create(),o,n),d=r(l,c),g=i.Zc.subtract(i.Zc.create(),n,e),u=r(g,l);if(Math.abs(d)<a){if(Math.abs(u)<a){const r=i.Zc.dot(l,l),d=i.Zc.dot(c,c);if(r<a||d<a)return s(e,n)||s(e,o)?e:s(t,n)||s(t,o)?t:null;const g=i.Zc.dot(i.Zc.subtract(i.Zc.create(),n,e),l)/r,u=i.Zc.dot(i.Zc.subtract(i.Zc.create(),o,e),l)/r,h=i.Zc.dot(i.Zc.subtract(i.Zc.create(),e,n),c)/d,m=i.Zc.dot(i.Zc.subtract(i.Zc.create(),t,n),c)/d,p=e=>e>=-a&&e<=1+a;if(p(g)){if(s(n,i.Zc.scaleAndAdd(i.Zc.create(),e,l,g)))return n}if(p(u)){if(s(o,i.Zc.scaleAndAdd(i.Zc.create(),e,l,u)))return o}if(p(h)){if(s(e,i.Zc.scaleAndAdd(i.Zc.create(),n,c,h)))return e}if(p(m)){if(s(t,i.Zc.scaleAndAdd(i.Zc.create(),n,c,m)))return t}}return null}const h=r(g,c)/d,m=u/d;return h>=-a&&h<=1+a&&m>=-a&&m<=1+a?[e[0]+h*l[0],e[1]+h*l[1]]:null}var c,d;!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(c||(c={})),function(e){e[e.Entering=0]="Entering",e[e.Exiting=1]="Exiting",e[e.Unknown=2]="Unknown"}(d||(d={}))},6521:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(3823),i=n(63113),a=n(36039),r=n(46513),s=n(15346);function l(e,t){if(e.length<3)return[];if(t.length<3)return[e.slice()];const n=t.slice();if((0,s.A)(e,t))return[];const l=(0,i.A)(e),c=(0,i.A)(n);Math.sign(l)===Math.sign(c)&&Math.abs(c)>a.p8&&n.reverse();const d=[];for(let t=0;t<e.length;t++){const i=e[t],r=e[(t+1)%e.length];for(let e=0;e<n.length;e++){const s=n[e],l=n[(e+1)%n.length],c=(0,a.O4)(i,r,s,l);if(c){const n=Math.sqrt(o.Zc.squaredDistance(i,r)),g=Math.sqrt(o.Zc.squaredDistance(s,l));d.push({coord:c,seg1Idx:t,seg2Idx:e,alpha1:n<a.p8?0:Math.sqrt(o.Zc.squaredDistance(i,c))/n,alpha2:g<a.p8?0:Math.sqrt(o.Zc.squaredDistance(s,c))/g})}}}const g=(e,t,n)=>{const o=[];let i=0;for(let r=0;r<e.length;r++){const s=e[r];o.push({id:`${t}_v${i++}`,coordinates:s,type:a.n7.Vertex,originalPolyIndex:t,originalVertexIndex:r,next:null,prev:null,isIntersection:!1,visited:!1});const l=n.filter(e=>(0===t?e.seg1Idx:e.seg2Idx)===r).sort((e,n)=>(0===t?e.alpha1:e.alpha2)-(0===t?n.alpha1:n.alpha2));for(const e of l)o.length>0&&(0,a.Sk)(o[o.length-1].coordinates,e.coord)?o[o.length-1].isIntersection||(o[o.length-1].isIntersection=!0,o[o.length-1].intersectionInfo=e,o[o.length-1].alpha=0===t?e.alpha1:e.alpha2):o.push({id:`${t}_i${i++}`,coordinates:e.coord,type:a.n7.Intersection,originalPolyIndex:t,next:null,prev:null,isIntersection:!0,visited:!1,alpha:0===t?e.alpha1:e.alpha2,intersectionInfo:e})}const r=[];if(o.length>0){r.push(o[0]);for(let e=1;e<o.length;e++)(0,a.Sk)(o[e].coordinates,r[r.length-1].coordinates)?o[e].isIntersection&&(r[r.length-1].isIntersection=!0,r[r.length-1].intersectionInfo=o[e].intersectionInfo,r[r.length-1].alpha=o[e].alpha):r.push(o[e])}if(r.length>0)for(let e=0;e<r.length;e++)r[e].next=r[(e+1)%r.length],r[e].prev=r[(e-1+r.length)%r.length];return r},u=g(e,0,d),h=g(n,1,d);u.forEach(e=>{if(e.isIntersection){const n=e.intersectionInfo,i=h.find(t=>t.isIntersection&&(0,a.Sk)(t.coordinates,e.coordinates)&&t.intersectionInfo.seg1Idx===n.seg1Idx&&t.intersectionInfo.seg2Idx===n.seg2Idx);if(i){e.partnerNode=i,i.partnerNode=e;const n=e.prev.coordinates,s=e.coordinates,l=i.next.coordinates,c=(o.Zc.subtract(o.Zc.create(),s,n),o.Zc.subtract(o.Zc.create(),l,s),[(e.prev.coordinates[0]+e.coordinates[0])/2,(e.prev.coordinates[1]+e.coordinates[1])/2]),d=(0,r.A)(t,c);e.intersectionDir=d?a.lG.Exiting:a.lG.Entering}else e.isIntersection=!1}}),u.forEach(e=>delete e.intersectionInfo),h.forEach(e=>delete e.intersectionInfo);const m=[];for(let e=0;e<u.length;e++){const n=u[e];if(n.visited||n.isIntersection)continue;if((0,r.A)(t,n.coordinates))continue;const o=[];let i=n,s=!0,l=0;const c=2*(u.length+h.length);do{if(l++>c){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}i.visited=!0,0!==o.length&&(0,a.Sk)(o[o.length-1],i.coordinates)||o.push(i.coordinates),i.isIntersection&&(s?i.intersectionDir===a.lG.Entering&&i.partnerNode&&(i=i.partnerNode,s=!1):i.partnerNode?(i=i.partnerNode,s=!0):console.warn("Subtraction: Intersection on source without partner.")),i=i.next}while(i!==n||!s);o.length>=3&&((0,a.Sk)(o[0],o[o.length-1])&&o.pop(),o.length>=3&&m.push(o))}return m}},33657:(e,t,n)=>{n.d(t,{distanceToPoint:()=>o.A});var o=n(87105)},23324:(e,t,n)=>{n(90554),n(35381)},35381:(e,t,n)=>{},13165:(e,t,n)=>{n.d(t,{filterAnnotationsForDisplay:()=>a.A,filterAnnotationsWithinSamePlane:()=>c.W});var o=n(36374),i=n(35489),a=n(94418),r=n(62514),s=n(57063),l=n(30698),c=n(40770);o.A,i.A,r.A,a.A,s.R,l.Y,c.W,s.p},60199:(e,t,n)=>{n.d(t,{H:()=>r});var o=n(3823),i=n(60213);const a=.01;function r(e,t,n={maxMajor:0,maxMinor:0}){const{points:r}=e.polyData,{maxMinor:s,maxMajor:l}=n;let c,d=l*l,g=s*s;for(let e=0;e<r.length;e++)for(let n=e+1;n<r.length;n++){const s=r[e],l=r[n],u=o.eR.sqrDist(s,l);u<d||(u-a<d+a&&c||t.testCenter(s,l)&&(0,i.pW)(s,l,t)&&(d=u-a,c=[e,n],g=0))}if(!c)return;d=Math.sqrt(d+a);const u=r[c[0]],h=r[c[1]],m=o.eR.sub(o.eR.create(),u,h);let p;o.eR.scale(m,m,1/d);for(let e=0;e<r.length;e++)for(let n=e+1;n<r.length;n++){const s=r[e],l=r[n],c=o.eR.sqrDist(s,l);if(c<=g)continue;const d=o.eR.sub(o.eR.create(),s,l);Math.abs(o.eR.dot(d,m))/Math.sqrt(c)>a||t.testCenter(s,l)&&(0,i.pW)(s,l,t)&&(g=c,p=[e,n])}if(!p)return;g=Math.sqrt(g);return{majorAxis:[u,h],minorAxis:[r[p[0]],r[p[1]]],maxMajor:d,maxMinor:g,...e}}},14957:(e,t,n)=>{n(77609),n(48736)},60213:(e,t,n)=>{n.d(t,{On:()=>a,pW:()=>i});n(15327);var o=n(3823);function i(e,t,n){const i=n.toIJK(e),a=n.toIJK(t),r=o.eR.create(),{testIJK:s}=n,l=o.eR.sub(o.eR.create(),i,a),c=Math.round(Math.max(...l.map(Math.abs)));if(c<2)return!0;const d=o.eR.scale(o.eR.create(),l,1/c);for(let e=1;e<c;e++)if(o.eR.scaleAndAdd(r,a,d,e),!s(r))return!1;return!0}function a({dimensions:e,imageData:t,voxelManager:n,segmentIndex:i,containedSegmentIndices:a}){const r=e[0],s=r*e[1];return{testCenter:(e,l)=>{const c=o.eR.add(o.eR.create(),e,l).map(e=>e/2),d=t.worldToIndex(c).map(Math.round),[g,u,h]=d,m=g+u*r+h*s,p=n.getAtIndex(m);return p===i||a?.has(p)},toIJK:e=>t.worldToIndex(e),testIJK:e=>{const[t,o,l]=e,c=Math.round(t)+Math.round(o)*r+Math.round(l)*s,d=n.getAtIndex(c);return d===i||a?.has(d)}}}},94779:(e,t,n)=>{n.d(t,{_:()=>r});var o=n(15327),i=n(56069),a=n(77609);function r(e){e.forEach(e=>{const t=(0,a.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach(e=>{const{renderingEngineId:t,viewportId:n}=e,a=(0,o.getRenderingEngine)(t);if(!a)return void console.warn(`RenderingEngine not available for ${t}`);const r=a.getViewport(n);(0,i.A)(r.element)})})}},58640:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(15327),i=n(56069);const a=function(e){e.length&&e.forEach(e=>{const t=(0,o.getEnabledElementByViewportId)(e);if(!t)return void console.warn(`Viewport not available for ${e}`);const{viewport:n}=t;if(!n)return void console.warn(`Viewport not available for ${e}`);const a=n.element;(0,i.A)(a)})}},60810:(e,t,n)=>{n.d(t,{getViewportIdsWithToolToRender:()=>o.A});n(3198),n(9356);var o=n(14543);n(67514)},6477:(e,t,n)=>{var o=n(99178),i=n(15327),a=n(68915);class r{static{this.calculators=new Map}static{this.indices=[]}static{this.mode="collective"}static statsInit(e){const{storePointData:t,indices:n,mode:o}=e;this.mode=o,this.indices=n,this.calculators.clear(),"individual"===this.mode?n.forEach(e=>{this.calculators.set(e,new a.C3({storePointData:t}))}):this.calculators.set(n,new a.C3({storePointData:t}))}static statsCallback(e){const{segmentIndex:t,...n}=e;if(!t)throw new Error("Segment index is required for stats calculation");const o="individual"===this.mode?this.calculators.get(t):this.calculators.get(this.indices);if(!o)throw new Error(`No calculator found for segment ${t}`);o.statsCallback(n)}static getStatistics(e){if("individual"===this.mode){const t={};return this.calculators.forEach((n,o)=>{t[o]=n.getStatistics(e)}),t}return this.calculators.get(this.indices).getStatistics(e)}}n(8582),n(52323),n(4334),n(97492);var s=n(99737),l=n(18682),c=n(93210),d=n(67014),g=n(25894),u=n(684),h=n(68040),m=n(85204),p=n(37590),f=n(77609);const v={[l.A.Labelmap]:u.Ay,[l.A.Contour]:g.A,[l.A.Surface]:d.Ay},I=p.A.toolName;new class{constructor(){this._needsRender=new Set,this._pendingRenderQueue=[],this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>(0,i.getRenderingEngines)().flatMap(e=>e.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed();if(Array.from(this._needsRender).forEach(e=>{this._triggerRender(e)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._pendingRenderQueue.length>0){const e=this._pendingRenderQueue.shift();e&&e.length>0&&this._setViewportsToBeRenderedNextFrame(e)}}}renderSegmentationsForViewport(e){const t=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(t)}renderSegmentation(e){const t=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(t)}_getViewportIdsForSegmentation(e){const t=this._getAllViewports(),n=[];for(const o of t){const t=o.id;if(e){const o=(0,c.r$)(t,{segmentationId:e});o?.length>0&&n.push(t)}else{const e=(0,c.r$)(t);e?.length>0&&n.push(t)}}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){this._animationFrameSet?this._pendingRenderQueue.push(e):(e.forEach(e=>{this._needsRender.add(e)}),this._render())}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,c.r$)(e);if(!t?.length)return;const{viewport:n}=(0,i.getEnabledElementByViewportId)(e)||{};if(!n)return;const o=[],a=t.map(e=>{e.type===s.SegmentationRepresentations.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const t=v[e.type];try{const i=t.render(n,e);o.push(i)}catch(e){console.error(e)}return Promise.resolve({segmentationId:e.segmentationId,type:e.type})});Promise.allSettled(a).then(e=>{const t=e.filter(e=>"fulfilled"===e.status).map(e=>e.value);n.element.addEventListener(i.Enums.Events.IMAGE_RENDERED,function e(n){const{element:o,viewportId:a}=n.detail;o.removeEventListener(i.Enums.Events.IMAGE_RENDERED,e),t.forEach(e=>{const t={viewportId:a,segmentationId:e.segmentationId,type:e.type};(0,i.triggerEvent)(i.eventTarget,s.Events.SEGMENTATION_RENDERED,{...t})})}),n.render()})}_addPlanarFreeHandToolIfAbsent(e){I in m.wk.tools||(0,h.Gx)(p.A);const t=(0,f.getToolGroupForViewport)(e.id);t.hasTool(I)||(t.addTool(I),t.setToolPassive(I))}};n(17014),n(49492),n(73706),n(13276),n(14514),n(22592),n(58640),n(14957);n(25758),n(98870),n(6802),n(92984),n(59452);n(91963);n(3823),n(4296);const{transformWorldToIndex:w}=i.utilities;const{transformWorldToIndex:A}=i.utilities;n(2397),n(67912),n(30722),n(83075),n(38440),n(21345),n(33283),n(49906),n(93952),n(4714),n(59475),n(58859),n(60740);n(12853),n(78773),n(88274);var b=n(28906),S=n(87275);class y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,t){return this.oriented||e<t?e*t*.5*(e*t+1)+t:t*e*.5*(t*e+1)+e}insertUniqueEdge(e,t,n){const o=this.computeEdgeKey(e,t);let i=this.edgeMap.get(o);return i||(i={key:o,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(o,i)),i}insertEdge(e,t,n){const o=this.computeEdgeKey(e,t),i={key:o,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(o,i),i}isInsertedEdge(e,t){const n=this.computeEdgeKey(e,t);return this.edgeMap.get(n)}static getEdgePointIds(e){const t=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(t+1)*t;return[n,t-n]}}var R={newInstance:function(){return new y((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oriented)}};const x=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],M=[[0,1],[1,3],[2,3],[0,2]];var P={getCase:function(e){return x[e]},getEdge:function(e){return M[e]}};const{vtkErrorMacro:E,vtkDebugMacro:D}=b.m;function C(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],o=[],i=[],a=R.newInstance();e.getPixelScalars=(e,t,i,a,r,s)=>{const[l,c,d]=e;n[0]=d*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+a[r],n[2]=n[0]+a[s],n[3]=n[2]+a[r];for(let e=0;e<4;++e)o[e]=i[n[e]]},e.getPixelPoints=(e,t,n,o,a)=>{const r=e[o],s=e[a];i[0]=t[o]+r*n[o],i[1]=t[a]+s*n[a],i[2]=i[0]+n[o],i[3]=i[1],i[4]=i[0],i[5]=i[1]+n[a],i[6]=i[2],i[7]=i[5]},e.produceLines=(r,s,l,c,d,g,u,h,m,p,f)=>{const v=s[t.slicingMode],I=[1,2,8,4],w=[];let A;e.getPixelScalars(s,l,g,m,p,f);let b=0;for(let e=0;e<4;e++)o[e]>=r&&(b|=I[e]);const S=P.getCase(b);if(S[0]<0)return;e.getPixelPoints(s,c,d,p,f);const y=c[t.slicingMode]+v*d[t.slicingMode];for(let e=0;S[e]>=0;e+=2){h.push(2);for(let s=0;s<2;s++){const l=P.getEdge(S[e+s]);if(A=void 0,t.mergePoints&&(A=a.isInsertedEdge(n[l[0]],n[l[1]])?.value),void 0===A){const e=(r-o[l[0]])/(o[l[1]]-o[l[0]]),s=i.slice(2*l[0],2*(l[0]+1)),c=i.slice(2*l[1],2*(l[1]+1));w[p]=s[0]+e*(c[0]-s[0]),w[f]=s[1]+e*(c[1]-s[1]),w[t.slicingMode]=y,A=u.length/3,u.push(w[0],w[1],w[2]),t.mergePoints&&a.insertEdge(n[l[0]],n[l[1]],A)}h.push(A)}}},e.requestData=(n,o)=>{const i=n[0];if(!i)return void E("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void E("Invalid or missing slicing mode");console.time("msquares");const r=i.getOrigin(),s=i.getSpacing(),l=i.getDimensions(),c=i.getExtent(),d=i.computeIncrements(c),g=i.getPointData().getScalars().getData(),[u,h]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),m=[],p=[];let f=Math.round(t.slice);f>=l[t.slicingMode]&&(f=0);const v=[0,0,0];v[t.slicingMode]=f;for(let n=0;n<t.contourValues.length;++n){for(let o=0;o<l[h]-1;++o){v[h]=o;for(let o=0;o<l[u]-1;++o)v[u]=o,e.produceLines(t.contourValues[n],v,l,r,s,g,m,p,d,u,h)}a.initialize()}const I=S.Ay.newInstance();I.getPoints().setData(new Float32Array(m),3),I.getLines().setData(new Uint32Array(p)),o[0]=I,D("Produced output"),console.timeEnd("msquares")}}const T={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function L(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,T,n),b.m.obj(e,t),b.m.algo(e,t,1,1),b.m.setGet(e,t,["slicingMode","slice","mergePoints"]),b.m.algo(e,t,1,1),C(e,t)}var _={newInstance:b.m.newInstance(L,"vtkImageMarchingSquares"),extend:L},O=n(42008),V=n(58498),N=n(37546),U=n(46228),k=n(60199),B=n(60213);const{VoxelManager:F}=i.utilities,W={createVoxelManager:(e,t)=>F.createScalarVolumeVoxelManager({dimensions:e,scalarData:t}),createDataStructure:e=>{const{scalarData:t,dimensions:n,spacing:o,origin:i,direction:a}=e;return{voxelManager:W.createVoxelManager(n,t),dimensions:n,spacing:o,origin:i,direction:a,scalarData:t}},createVTKImageData:(e,t,n,o,i)=>{const a=V.Ay.newInstance();if(a.setDimensions(e),a.setOrigin(t),a.setDirection(n),a.setSpacing(o),!i)return a;const r=O.Ay.newInstance({name:"Scalars",numberOfComponents:1,values:i});return a.getPointData().setScalars(r),a},processSegmentStatistics:({segVoxelManager:e,imageVoxelManager:t,indices:n,bounds:o,imageData:i})=>{e.forEach(({value:e,pointIJK:o,pointLPS:i,index:a})=>{if(-1===n.indexOf(e))return;const s=t.getAtIndex(a);r.statsCallback({segmentIndex:e,value:s,pointIJK:o,pointLPS:i})},{boundsIJK:o||t.getDefaultBounds(),imageData:i})},performMarchingSquares:(e,t=null,n=null)=>{const o={};null!==t&&(o.slice=t),null!==n&&(o.slicingMode=n);const i=_.newInstance(o);return i.setInputData(e),i.setContourValues([1]),i.setMergePoints(!1),i.getOutputData()},createContoursFromPolyData:(e,t=null)=>{const n=(0,N.v)(e);if(n.points?.length){return{contours:(0,U.d1)(n.lines),polyData:n}}return null},createSegmentsFromIndices:e=>[null,...e.map(e=>({segmentIndex:e}))],getArgsFromInfo:e=>{const{segmentationInfo:t,imageInfo:n}=e;return{segmentation:t&&W.createDataStructure(t),image:n&&W.createDataStructure(n)}},calculateSegmentsStatisticsVolume:e=>{const{mode:t,indices:n,unit:o}=e,{segmentation:i,image:a}=W.getArgsFromInfo(e),{voxelManager:s,spacing:l}=i,{voxelManager:c}=a,d=W.createVTKImageData(i.dimensions,i.origin,i.direction,i.spacing);r.statsInit({storePointData:!1,indices:n,mode:t}),W.processSegmentStatistics({segVoxelManager:s,imageVoxelManager:c,indices:n,imageData:d});return r.getStatistics({spacing:l,mode:t,unit:o})},computeMetabolicStats({segmentationInfo:e,imageInfo:t}){const{scalarData:n,dimensions:o,spacing:i,origin:a,direction:r}=e,{spacing:s,dimensions:l,direction:c,origin:d,scalarData:g}=t,u=W.createVoxelManager(e.dimensions,e.scalarData),h=W.createVoxelManager(l,g);let m=0,p=0;const f=u.getScalarDataLength();for(let e=0;e<f;e++)0!==u.getAtIndex(e)&&(m+=h.getAtIndex(e),p++);return{tmtv:.001*p*i[0]*i[1]*i[2],tlg:(p>0?m/p:0)*p*s[0]*s[1]*s[2]*.001}},calculateSegmentsStatisticsStack:e=>{const{segmentationInfo:t,imageInfo:n,indices:o,mode:i}=e;r.statsInit({storePointData:!0,indices:o,mode:i});for(let e=0;e<t.length;e++){const i=t[e],a=n[e],r=[i.dimensions[0],i.dimensions[1],1],s=W.createVoxelManager(r,i.scalarData),l=W.createVoxelManager(r,a.scalarData),c=W.createVTKImageData(r,i.origin,i.direction,i.spacing);W.processSegmentStatistics({segVoxelManager:s,imageVoxelManager:l,indices:o,imageData:c})}const a=t[0].spacing;return r.getStatistics({spacing:a,mode:i})},getSegmentLargestBidirectionalInternal:e=>{const{segmentationInfo:t,imageInfo:n,indices:o,mode:i,isStack:a}=e;let r;return({segmentation:r}=a?W.getArgsFromInfo({segmentationInfo:t[0]}):W.getArgsFromInfo(e)),a?W.calculateBidirectionalStack({segmentationInfo:t,indices:o,mode:i}):W.calculateVolumetricBidirectional({segmentation:r,indices:o,mode:i})},findLargestBidirectionalFromContours:(e,t,n)=>{let o;for(const n of e){const e=(0,k.H)(n,t,o);e&&(o=e)}return o?{segmentIndex:n,majorAxis:o.majorAxis,minorAxis:o.minorAxis,maxMajor:o.maxMajor,maxMinor:o.maxMinor}:null},calculateBidirectionalStack:({segmentationInfo:e,indices:t,mode:n})=>{const o=W.createSegmentsFromIndices(t);let i=[];for(let t=0;t<e.length;t++){const n=e[t],a=n.dimensions,r=n.scalarData,{spacing:s,direction:l,origin:c}=n,d=W.createVoxelManager(a,r),g=a[0]*a[1];for(let e=1;e<o.length;e++){const t=o[e];if(!t)continue;const n=t.segmentIndex;if(W.isSliceEmptyForSegmentVolume(0,r,g,n))continue;const u=[],h=new Uint8Array(r.length);for(let e=0;e<r.length;e++)h[e]=r[e]===n?1:0;const m=O.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:h}),p=W.createVTKImageData(a,c,l,[s[0],s[1],1]);p.getPointData().setScalars(m);try{const e=W.performMarchingSquares(p,null,2),t=W.createContoursFromPolyData(e);t&&u.push(t)}catch(e){console.warn(e)}const f=(0,B.On)({dimensions:a,imageData:p,voxelManager:d,segmentIndex:n}),v=W.findLargestBidirectionalFromContours(u,f,n);v&&i.push(v)}}return i},calculateVolumetricBidirectional:({segmentation:e,indices:t,mode:n})=>{const{voxelManager:o,dimensions:i,origin:a,direction:r,spacing:s}=e,l=W.createVTKImageData(i,a,r,s),c=W.generateContourSetsFromLabelmapVolume({segmentation:e,indices:t,imageData:l,mode:n}),d=[];for(let e=0;e<c.length;e++){const t=c[e],{segmentIndex:n}=t.segment,a=t.sliceContours,r=(0,B.On)({dimensions:i,imageData:l,voxelManager:o,segmentIndex:n}),s=W.findLargestBidirectionalFromContours(a,r,n);s&&d.push(s)}return d},generateContourSetsFromLabelmapVolume:e=>{const{segmentation:t,indices:n}=e,{dimensions:o,scalarData:i,origin:a,direction:r,spacing:s}=t;let l=e.imageData;l||(l=W.createVTKImageData(o,a,r,s));const c=o[2],d=o[0]*o[1],g=W.createSegmentsFromIndices(n);for(let e=0;e<c;e++)for(let t=0;t<o[1];t++){const n=t*o[0]+e*d;i[n]=0,i[n+o[0]-1]=0}const u=[],h=g.length;for(let e=0;e<h;e++){const t=g[e];if(!t)continue;const n=t.segmentIndex,o=[],a=O.Ay.newInstance({name:"Scalars",numberOfComponents:1,size:d*c,dataType:"Uint8Array"});for(let e=0;e<c;e++){if(W.isSliceEmptyForSegmentVolume(e,i,d,n))continue;const t=e*d;try{for(let e=0;e<d;e++){i[e+t]===n?a.setValue(e+t,1):a.setValue(e,0)}const r=V.Ay.newInstance();r.shallowCopy(l),r.getPointData().setScalars(a);const s=W.performMarchingSquares(r,e),c=W.createContoursFromPolyData(s,e);c&&o.push(c)}catch(t){console.warn(e),console.warn(t)}}const r={sliceContours:o,segment:t};u.push(r)}return u},isSliceEmptyForSegmentVolume:(e,t,n,o)=>{const i=e*n,a=i+n;for(let e=i;e<a;e++)if(t[e]===o)return!1;return!0}};(0,o.p)(W)},62612:(e,t,n)=>{n.d(t,{Ay:()=>o});var o={AttributeCopyOperations:{COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},AttributeLimitTypes:{MAX:0,EXACT:1,NOLIMIT:2},AttributeTypes:{SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},CellGhostTypes:{DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DesiredOutputPrecision:{DEFAULT:0,SINGLE:1,DOUBLE:2},PointGhostTypes:{DUPLICATEPOINT:1,HIDDENPOINT:2},ghostArrayName:"vtkGhostType"}},58498:(e,t,n)=>{n.d(t,{Ay:()=>h});var o=n(28906),i=n(16632),a=n(21734),r=n(69147),s=n(24964),l=n(85278),c=n(3823);const{vtkErrorMacro:d}=o.m;const g={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:l.e.EMPTY};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,g,n),r.Ay.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=c.w0.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),o.m.get(e,t,["indexToWorld","worldToIndex"]),o.m.setGetArray(e,t,["origin","spacing"],3),o.m.setGetArray(e,t,["direction"],9),o.m.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return d("instance deleted - cannot call any method"),!1;for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];const a=1===o.length?o[0]:o;if(6!==a.length)return!1;const r=t.extent.some((e,t)=>e!==a[t]);return r&&(t.extent=a.slice(),t.dataDescription=s.A.getDataDescriptionFromExtent(t.extent),e.modified()),r},e.setDimensions=function(){let n,o,i;if(t.deleted)d("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],o=e[1],i=e[2]}else{if(3!==arguments.length)return void d("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,o-1,0,i-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const o=e.getDimensions();if(0===o[0]||0===o[1]||0===o[2])return d("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(t.dataDescription){case l.e.EMPTY:return null;case l.e.SINGLE_POINT:break;case l.e.X_LINE:i[0]=n;break;case l.e.Y_LINE:i[1]=n;break;case l.e.Z_LINE:i[2]=n;break;case l.e.XY_PLANE:i[0]=n%o[0],i[1]=n/o[0];break;case l.e.YZ_PLANE:i[1]=n%o[1],i[2]=n/o[1];break;case l.e.XZ_PLANE:i[0]=n%o[0],i[2]=n/o[0];break;case l.e.XYZ_GRID:i[0]=n%o[0],i[1]=n/o[0]%o[1],i[2]=n/(o[0]*o[1]);break;default:d("Invalid dataDescription")}const a=[0,0,0];return e.indexToWorld(i,a),a},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>a.Ay.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>a.Ay.inflate([...t.extent],.5),e.computeTransforms=()=>{c.pB.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],c.pB.scale(t.indexToWorld,t.indexToWorld,t.spacing),c.pB.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.Ay.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.Ay.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>a.Ay.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=[0,0,0,0,0,0];e.worldToIndexBounds(t,o);const r=[0,0,0],s=[0,0,0];a.Ay.computeCornerPoints(o,r,s),(0,i.b)(r,r),(0,i.b)(s,s);const l=e.getDimensions();(0,i.c)(r,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],r),(0,i.c)(s,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],s);const c=l[0],d=l[0]*l[1],g=e.getPointData().getScalars().getData();let u=-1/0,h=1/0,m=0,p=0,f=0;for(let e=r[2];e<=s[2];e++)for(let t=r[1];t<=s[1];t++){let i=r[0]+t*c+e*d;for(let a=r[0];a<=s[0];a++){if(!n||n([a,t,e],o)){const e=g[i];e>u&&(u=e),e<h&&(h=e),m+=e*e,p+=e,f+=1}++i}}const v=f>0?p/f:0,I=f?Math.abs(m/f-v*v):0;return{minimum:h,maximum:u,average:v,variance:I,sigma:Math.sqrt(I),count:f}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let o=0;o<3;++o)t[o]=n,n*=e[2*o+1]-e[2*o]+1;return t},e.computeOffsetIndex=t=>{let[n,o,i]=t;const a=e.getExtent(),r=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(a,r);return Math.floor((Math.round(n)-a[0])*s[0]+(Math.round(o)-a[2])*s[1]+(Math.round(i)-a[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),o=e.worldToIndex(t);for(let e=0;e<3;++e)if(o[e]<n[2*e]||o[e]>n[2*e+1])return d(`GetScalarPointer: Pixel ${o} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(o)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=o)return d(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${o}`),NaN;const i=e.getOffsetIndexFromWorld(t);return Number.isNaN(i)?i:e.getPointData().getScalars().getComponent(i,n)}}(e,t)}var h={newInstance:o.m.newInstance(u,"vtkImageData"),extend:u}},642:(e,t,n)=>{n.d(t,{Ay:()=>I});var o=n(28906),i=n(16632),a=n(80993),r=n(25128);const{ColorSpace:s,Scale:l}=r.Ay,{ScalarMappingTarget:c}=a.Ay,{vtkDebugMacro:d,vtkErrorMacro:g,vtkWarningMacro:u}=o.m;function h(e,t){const n=e[0],o=e[1],i=e[2],a=Math.sqrt(n*n+o*o+i*i),r=a>.001?Math.acos(n/a):0,s=r>.001?Math.atan2(i,o):0;t[0]=a,t[1]=r,t[2]=s}function m(e,t){if(e[0]>=t-.1)return e[2];const n=e[1]*Math.sqrt(t*t-e[0]*e[0])/(e[0]*Math.sin(e[1]));return e[2]>-.3*Math.PI?e[2]+n:e[2]-n}function p(e,t,n,o){const a=[],r=[];(0,i.N)(t,a),(0,i.N)(n,r);const s=[],l=[];h(a,s),h(r,l);let c=e;if(s[1]>.05&&l[1]>.05&&function(e,t){let n=e-t;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}(s[2],l[2])>.33*Math.PI){let t=Math.max(s[0],l[0]);t=Math.max(88,t),e<.5?(l[0]=t,l[1]=0,l[2]=0,c*=2):(s[0]=t,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&l[1]>.05?s[2]=m(l,s[0]):l[1]<.05&&s[1]>.05&&(l[2]=m(s,l[0]));const d=[];d[0]=(1-c)*s[0]+c*l[0],d[1]=(1-c)*s[1]+c*l[1],d[2]=(1-c)*s[2]+c*l[2];const g=[];!function(e,t){const n=e[0],o=e[1],i=e[2];t[0]=n*Math.cos(o),t[1]=n*Math.sin(o)*Math.cos(i),t[2]=n*Math.sin(o)*Math.sin(i)}(d,g),(0,i.O)(g,o)}const f={clamping:!0,colorSpace:s.RGB,hSVWrap:!0,scale:l.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,f,n),a.Ay.extend(e,t,n),t.table=[],t.nodes=[],t.nanColor=[.5,0,0,1],t.belowRangeColor=[0,0,0,1],t.aboveRangeColor=[1,1,1,1],t.buildTime={},o.m.obj(t.buildTime),o.m.get(e,t,["buildTime","mappingRange"]),o.m.setGet(e,t,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:s},{type:"enum",name:"scale",enum:l}]),o.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),o.m.getArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkColorTransferFunction"),e.getSize=()=>t.nodes.length,e.addRGBPoint=(t,n,o,i)=>e.addRGBPointLong(t,n,o,i,.5,0),e.addRGBPointLong=function(n,o,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(r<0||r>1)return g("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return g("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const l={x:n,r:o,g:i,b:a,midpoint:r,sharpness:s};t.nodes.push(l),e.sortAndUpdateRange();let c=0;for(;c<t.nodes.length&&t.nodes[c].x!==n;c++);return c<t.nodes.length?c:-1},e.addHSVPoint=(t,n,o,i)=>e.addHSVPointLong(t,n,o,i,.5,0),e.addHSVPointLong=function(t,n,o,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=[],c=[n,o,a];return(0,i.h)(c,l),e.addRGBPoint(t,l[0],l[1],l[2],r,s)},e.setNodes=n=>{if(t.nodes!==n){const o=JSON.stringify(t.nodes);t.nodes=n;const i=JSON.stringify(t.nodes);if(e.sortAndUpdateRange()||o!==i)return e.modified(),!0}return!1},e.sortAndUpdateRange=()=>{const n=JSON.stringify(t.nodes);t.nodes.sort((e,t)=>e.x-t.x);const o=JSON.stringify(t.nodes),i=e.updateRange();return i||n===o?i:(e.modified(),!0)},e.updateRange=()=>{const n=[2];n[0]=t.mappingRange[0],n[1]=t.mappingRange[1];const o=t.nodes.length;return o?(t.mappingRange[0]=t.nodes[0].x,t.mappingRange[1]=t.nodes[o-1].x):(t.mappingRange[0]=0,t.mappingRange[1]=0),(n[0]!==t.mappingRange[0]||n[1]!==t.mappingRange[1])&&(e.modified(),!0)},e.removePoint=n=>{let o=0;for(;o<t.nodes.length&&t.nodes[o].x!==n;o++);const i=o;if(o>=t.nodes.length)return-1;let a=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(a=e.updateRange()),a||e.modified(),i},e.movePoint=(n,o)=>{if(n!==o){e.removePoint(o);for(let i=0;i<t.nodes.length;i++)if(t.nodes[i].x===n){t.nodes[i].x=o,e.sortAndUpdateRange();break}}},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addRGBSegment=(n,o,i,a,r,s,l,c)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=r?t.nodes.splice(e,1):e++;e.addRGBPointLong(n,o,i,a,.5,0),e.addRGBPointLong(r,s,l,c,.5,0),e.modified()},e.addHSVSegment=(t,n,o,a,r,s,l,c)=>{const d=[n,o,a],g=[s,l,c],u=[],h=[];(0,i.h)(d,u),(0,i.h)(g,h),e.addRGBSegment(t,u[0],u[1],u[2],r,h[0],h[1],h[2])},e.mapValue=t=>{const n=[];return e.getColor(t,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},e.getColor=(n,o)=>{if(t.indexedLookup){const t=e.getSize(),i=e.getAnnotatedValueIndexInternal(n);if(i<0||0===t){const t=e.getNanColorByReference();o[0]=t[0],o[1]=t[1],o[2]=t[2]}else{const n=[];e.getNodeValue(i%t,n),o[0]=n[1],o[1]=n[2],o[2]=n[3]}return}e.getTable(n,n,1,o)},e.getRedValue=t=>{const n=[];return e.getColor(t,n),n[0]},e.getGreenValue=t=>{const n=[];return e.getColor(t,n),n[1]},e.getBlueValue=t=>{const n=[];return e.getColor(t,n),n[2]},e.getTable=(n,o,a,r)=>{const c=Number(n),d=Number(o);if((0,i.i)(c)||(0,i.i)(d)){for(let e=0;e<a;e++)r[3*e+0]=t.nanColor[0],r[3*e+1]=t.nanColor[1],r[3*e+2]=t.nanColor[2];return}let u=0;const h=t.nodes.length;let m=0,f=0,v=0;0!==h&&(m=t.nodes[h-1].r,f=t.nodes[h-1].g,v=t.nodes[h-1].b);let I=0,w=0,A=0;const b=[0,0,0],S=[0,0,0];let y=0,R=0;const x=[];let M=t.scale===l.LOG10;M&&(M=t.mappingRange[0]>0);let P=0,E=0,D=0;M&&(P=Math.log10(c),E=Math.log10(d));for(let n=0;n<a;n++){const o=3*n;if(a>1?M?(D=P+n/(a-1)*(E-P),I=10**D):I=c+n/(a-1)*(d-c):M?(D=.5*(P+E),I=10**D):I=.5*(c+d),t.discretize){const e=t.mappingRange;if(I>=e[0]&&I<=e[1]){const n=t.numberOfValues,o=e[1]-e[0];if(n<=1)I=e[0]+o/2;else{const t=(I-e[0])/o,a=(0,i.K)(n*t);I=e[0]+a/(n-1)*o}}}for(;u<h&&I>t.nodes[u].x;)u++,u<h&&(w=t.nodes[u-1].x,A=t.nodes[u].x,M&&(w=Math.log10(w),A=Math.log10(A)),b[0]=t.nodes[u-1].r,S[0]=t.nodes[u].r,b[1]=t.nodes[u-1].g,S[1]=t.nodes[u].g,b[2]=t.nodes[u-1].b,S[2]=t.nodes[u].b,y=t.nodes[u-1].midpoint,R=t.nodes[u-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(I>t.mappingRange[1])r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseAboveRangeColor()?(r[o]=t.aboveRangeColor[0],r[o+1]=t.aboveRangeColor[1],r[o+2]=t.aboveRangeColor[2]):(r[o]=m,r[o+1]=f,r[o+2]=v));else if(I<t.mappingRange[0]||(0,i.L)(I)&&I<0)r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseBelowRangeColor()?(r[o]=t.belowRangeColor[0],r[o+1]=t.belowRangeColor[1],r[o+2]=t.belowRangeColor[2]):h>0&&(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b));else if(0===u&&(Math.abs(I-c)<1e-6||t.discretize))h>0?(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b):(r[o]=0,r[o+1]=0,r[o+2]=0);else{let e=0;if(e=M?(D-w)/(A-w):(I-w)/(A-w),e=e<y?.5*e/y:.5+.5*(e-y)/(1-y),R>.99){if(e<.5){r[o]=b[0],r[o+1]=b[1],r[o+2]=b[2];continue}r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2];continue}if(R<.01){if(t.colorSpace===s.RGB)r[o]=(1-e)*b[0]+e*S[0],r[o+1]=(1-e)*b[1]+e*S[1],r[o+2]=(1-e)*b[2]+e*S[2];else if(t.colorSpace===s.HSV){const n=[],a=[];(0,i.M)(b,n),(0,i.M)(S,a),t.hSVWrap&&(n[0]-a[0]>.5||a[0]-n[0]>.5)&&(n[0]>a[0]?n[0]-=1:a[0]-=1);const s=[];s[0]=(1-e)*n[0]+e*a[0],s[0]<0&&(s[0]+=1),s[1]=(1-e)*n[1]+e*a[1],s[2]=(1-e)*n[2]+e*a[2],(0,i.h)(s,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]}else if(t.colorSpace===s.LAB){const t=[],n=[];(0,i.N)(b,t),(0,i.N)(S,n);const a=[];a[0]=(1-e)*t[0]+e*n[0],a[1]=(1-e)*t[1]+e*n[1],a[2]=(1-e)*t[2]+e*n[2],(0,i.O)(a,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]}else t.colorSpace===s.DIVERGING?(p(e,b,S,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]):g("ColorSpace set to invalid value.",t.colorSpace);continue}e<.5?e=.5*(2*e)**(1+10*R):e>.5&&(e=1-.5*(2*(1-e))**(1+10*R));const n=e*e,a=n*e,l=2*a-3*n+1,c=-2*a+3*n,d=a-2*n+e,u=a-n;let h,m;if(t.colorSpace===s.RGB)for(let e=0;e<3;e++)h=S[e]-b[e],m=(1-R)*h,r[o+e]=l*b[e]+c*S[e]+d*m+u*m;else if(t.colorSpace===s.HSV){const e=[],n=[];(0,i.M)(b,e),(0,i.M)(S,n),t.hSVWrap&&(e[0]-n[0]>.5||n[0]-e[0]>.5)&&(e[0]>n[0]?e[0]-=1:n[0]-=1);const a=[];for(let t=0;t<3;t++)h=n[t]-e[t],m=(1-R)*h,a[t]=l*e[t]+c*n[t]+d*m+u*m,0===t&&a[t]<0&&(a[t]+=1);(0,i.h)(a,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]}else if(t.colorSpace===s.LAB){const e=[],t=[];(0,i.N)(b,e),(0,i.N)(S,t);const n=[];for(let o=0;o<3;o++)h=t[o]-e[o],m=(1-R)*h,n[o]=l*e[o]+c*t[o]+d*m+u*m;(0,i.O)(n,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]}else t.colorSpace===s.DIVERGING?(p(e,b,S,x),r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2]):g("ColorSpace set to invalid value.");for(let e=0;e<3;e++)r[o+e]=r[o+e]<0?0:r[o+e],r[o+e]=r[o+e]>1?1:r[o+e]}}},e.getUint8Table=function(n,o,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getMTime()<=t.buildTime&&t.tableSize===i&&t.tableWithAlpha!==a)return t.table;if(0===t.nodes.length)return g("Attempting to lookup a value with no points in the function"),t.table;const r=a?4:3;t.tableSize===i&&t.tableWithAlpha===a||(t.table=new Uint8Array(i*r),t.tableSize=i,t.tableWithAlpha=a);const s=[];e.getTable(n,o,i,s);for(let e=0;e<i;e++)t.table[e*r+0]=Math.floor(255*s[3*e+0]+.5),t.table[e*r+1]=Math.floor(255*s[3*e+1]+.5),t.table[e*r+2]=Math.floor(255*s[3*e+2]+.5),a&&(t.table[e*r+3]=255);return t.buildTime.modified(),t.table},e.buildFunctionFromArray=n=>{e.removeAllPoints();const o=n.getNumberOfComponents();for(let e=0;e<n.getNumberOfTuples();e++)switch(o){case 3:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:.5,sharpness:0});break;case 4:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:.5,sharpness:0});break;case 5:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)});break;case 6:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)})}e.sortAndUpdateRange()},e.buildFunctionFromTable=(n,o,i,a)=>{let r=0;e.removeAllPoints(),i>1&&(r=(o-n)/(i-1));for(let e=0;e<i;e++){const o={x:n+r*e,r:a[3*e],g:a[3*e+1],b:a[3*e+2],sharpness:0,midpoint:.5};t.nodes.push(o)}e.sortAndUpdateRange()},e.getNodeValue=(e,n)=>e<0||e>=t.nodes.length?(g("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].r,n[2]=t.nodes[e].g,n[3]=t.nodes[e].b,n[4]=t.nodes[e].midpoint,n[5]=t.nodes[e].sharpness,1),e.setNodeValue=(n,o)=>{if(n<0||n>=t.nodes.length)return g("Index out of range!"),-1;const i=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].r=o[1],t.nodes[n].g=o[2],t.nodes[n].b=o[3],t.nodes[n].midpoint=o[4],t.nodes[n].sharpness=o[5],i!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.getNumberOfAvailableColors=()=>{if(t.indexedLookup&&e.getSize())return e.getSize();if(t.tableSize)return t.tableSize;const n=t.nodes?.length??0;return Math.max(4094,n)},e.getIndexedColor=(t,n)=>{const o=e.getSize();if(o>0&&t>=0){const i=[];e.getNodeValue(t%o,i);for(let e=0;e<3;++e)n[e]=i[e+1];return void(n[3]=1)}const i=e.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1},e.fillFromDataPointer=(t,n)=>{if(!(t<=0)&&n){e.removeAllPoints();for(let o=0;o<t;o++)e.addRGBPoint(n[4*o],n[4*o+1],n[4*o+2],n[4*o+3])}},e.setMappingRange=(n,o)=>{const i=[n,o],a=e.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0])return void g("attempt to set zero width color range");const r=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*r;for(let e=0;e<t.nodes.length;++e)t.nodes[e].x=t.nodes[e].x*r+s;t.mappingRange[0]=i[0],t.mappingRange[1]=i[1],e.modified()},e.adjustRange=n=>{const o=e.getRange(),i=[];o[0]<n[0]?(e.getColor(n[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])):(e.getColor(o[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])),o[1]>n[1]?(e.getColor(n[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])):(e.getColor(o[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return 1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{if(t.nodes.length<2)return-1;let e=Number.MAX_VALUE;for(let n=0;n<t.nodes.length-1;n++){const o=t.nodes[n+1].x-t.nodes[n].x;o<e&&(e=o)}return e},e.mapScalarsThroughTable=(n,o,i,a)=>{0!==e.getSize()?t.indexedLookup?e.mapDataIndexed(n,o,i,a):e.mapData(n,o,i,a):d("Transfer Function Has No Points!")},e.mapData=(t,n,o,i)=>{if(0===e.getSize())return void u("Transfer Function Has No Points!");const a=Math.floor(255*e.getAlpha()+.5),r=t.getNumberOfTuples(),s=t.getNumberOfComponents(),l=n.getData(),d=t.getData(),g=[];if(o===c.RGBA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,g),l[4*t]=Math.floor(255*g[0]+.5),l[4*t+1]=Math.floor(255*g[1]+.5),l[4*t+2]=Math.floor(255*g[2]+.5),l[4*t+3]=a}if(o===c.RGB)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,g),l[3*t]=Math.floor(255*g[0]+.5),l[3*t+1]=Math.floor(255*g[1]+.5),l[3*t+2]=Math.floor(255*g[2]+.5)}if(o===c.LUMINANCE)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,g),l[t]=Math.floor(76.5*g[0]+150.45*g[1]+28.05*g[2]+.5)}if(o===c.LUMINANCE_ALPHA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,g),l[2*t]=Math.floor(76.5*g[0]+150.45*g[1]+28.05*g[2]+.5),l[2*t+1]=a}},e.applyColorMap=n=>{const o=JSON.stringify(t.colorSpace);n.ColorSpace&&(t.colorSpace=s[n.ColorSpace.toUpperCase()],void 0===t.colorSpace&&(g(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),t.colorSpace=s.RGB));let i=o!==JSON.stringify(t.colorSpace);const a=i||JSON.stringify(t.nanColor);if(n.NanColor)for(t.nanColor=[].concat(n.NanColor);t.nanColor.length<4;)t.nanColor.push(1);i=i||a!==JSON.stringify(t.nanColor);const r=i||JSON.stringify(t.nodes);if(n.RGBPoints){const e=n.RGBPoints.length;t.nodes=[];const o=.5,i=0;for(let a=0;a<e;a+=4)t.nodes.push({x:n.RGBPoints[a],r:n.RGBPoints[a+1],g:n.RGBPoints[a+2],b:n.RGBPoints[a+3],midpoint:o,sharpness:i})}const l=e.sortAndUpdateRange(),c=!l&&(i||r!==JSON.stringify(t.nodes));return c&&e.modified(),l||c}}(e,t)}var I={newInstance:o.m.newInstance(v,"vtkColorTransferFunction"),extend:v,...r.Ay}},9175:(e,t,n)=>{n.r(t),n.d(t,{add:()=>d,angle:()=>B,bezier:()=>T,ceil:()=>m,clone:()=>a,copy:()=>l,create:()=>i,cross:()=>E,dist:()=>$,distance:()=>b,div:()=>H,divide:()=>h,dot:()=>P,equals:()=>q,exactEquals:()=>G,floor:()=>p,forEach:()=>X,fromValues:()=>s,hermite:()=>C,inverse:()=>x,len:()=>J,length:()=>r,lerp:()=>D,max:()=>v,min:()=>f,mul:()=>Z,multiply:()=>u,negate:()=>R,normalize:()=>M,random:()=>L,rotateX:()=>N,rotateY:()=>U,rotateZ:()=>k,round:()=>I,scale:()=>w,scaleAndAdd:()=>A,set:()=>c,sqrDist:()=>K,sqrLen:()=>Y,squaredDistance:()=>S,squaredLength:()=>y,str:()=>W,sub:()=>z,subtract:()=>g,transformMat3:()=>O,transformMat4:()=>_,transformQuat:()=>V,zero:()=>F});var o=n(24457);function i(){var e=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function a(e){var t=new o.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function r(e){var t=e[0],n=e[1],o=e[2];return Math.hypot(t,n,o)}function s(e,t,n){var i=new o.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function c(e,t,n,o){return e[0]=t,e[1]=n,e[2]=o,e}function d(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function g(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function u(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function h(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function m(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function p(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function f(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function v(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function I(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function w(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function A(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e[2]=t[2]+n[2]*o,e}function b(e,t){var n=t[0]-e[0],o=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,o,i)}function S(e,t){var n=t[0]-e[0],o=t[1]-e[1],i=t[2]-e[2];return n*n+o*o+i*i}function y(e){var t=e[0],n=e[1],o=e[2];return t*t+n*n+o*o}function R(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function x(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function M(e,t){var n=t[0],o=t[1],i=t[2],a=n*n+o*o+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function P(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function E(e,t,n){var o=t[0],i=t[1],a=t[2],r=n[0],s=n[1],l=n[2];return e[0]=i*l-a*s,e[1]=a*r-o*l,e[2]=o*s-i*r,e}function D(e,t,n,o){var i=t[0],a=t[1],r=t[2];return e[0]=i+o*(n[0]-i),e[1]=a+o*(n[1]-a),e[2]=r+o*(n[2]-r),e}function C(e,t,n,o,i,a){var r=a*a,s=r*(2*a-3)+1,l=r*(a-2)+a,c=r*(a-1),d=r*(3-2*a);return e[0]=t[0]*s+n[0]*l+o[0]*c+i[0]*d,e[1]=t[1]*s+n[1]*l+o[1]*c+i[1]*d,e[2]=t[2]*s+n[2]*l+o[2]*c+i[2]*d,e}function T(e,t,n,o,i,a){var r=1-a,s=r*r,l=a*a,c=s*r,d=3*a*s,g=3*l*r,u=l*a;return e[0]=t[0]*c+n[0]*d+o[0]*g+i[0]*u,e[1]=t[1]*c+n[1]*d+o[1]*g+i[1]*u,e[2]=t[2]*c+n[2]*d+o[2]*g+i[2]*u,e}function L(e,t){t=t||1;var n=2*o.RANDOM()*Math.PI,i=2*o.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=i*t,e}function _(e,t,n){var o=t[0],i=t[1],a=t[2],r=n[3]*o+n[7]*i+n[11]*a+n[15];return r=r||1,e[0]=(n[0]*o+n[4]*i+n[8]*a+n[12])/r,e[1]=(n[1]*o+n[5]*i+n[9]*a+n[13])/r,e[2]=(n[2]*o+n[6]*i+n[10]*a+n[14])/r,e}function O(e,t,n){var o=t[0],i=t[1],a=t[2];return e[0]=o*n[0]+i*n[3]+a*n[6],e[1]=o*n[1]+i*n[4]+a*n[7],e[2]=o*n[2]+i*n[5]+a*n[8],e}function V(e,t,n){var o=n[0],i=n[1],a=n[2],r=n[3],s=t[0],l=t[1],c=t[2],d=i*c-a*l,g=a*s-o*c,u=o*l-i*s,h=i*u-a*g,m=a*d-o*u,p=o*g-i*d,f=2*r;return d*=f,g*=f,u*=f,h*=2,m*=2,p*=2,e[0]=s+d+h,e[1]=l+g+m,e[2]=c+u+p,e}function N(e,t,n,o){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(o)-i[2]*Math.sin(o),a[2]=i[1]*Math.sin(o)+i[2]*Math.cos(o),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function U(e,t,n,o){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(o)+i[0]*Math.cos(o),a[1]=i[1],a[2]=i[2]*Math.cos(o)-i[0]*Math.sin(o),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function k(e,t,n,o){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(o)-i[1]*Math.sin(o),a[1]=i[0]*Math.sin(o)+i[1]*Math.cos(o),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function B(e,t){var n=e[0],o=e[1],i=e[2],a=t[0],r=t[1],s=t[2],l=Math.sqrt(n*n+o*o+i*i)*Math.sqrt(a*a+r*r+s*s),c=l&&P(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function F(e){return e[0]=0,e[1]=0,e[2]=0,e}function W(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function q(e,t){var n=e[0],i=e[1],a=e[2],r=t[0],s=t[1],l=t[2];return Math.abs(n-r)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-s)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-l)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}var j,z=g,Z=u,H=h,$=b,K=S,J=r,Y=y,X=(j=i(),function(e,t,n,o,i,a){var r,s;for(t||(t=3),n||(n=0),s=o?Math.min(o*t+n,e.length):e.length,r=n;r<s;r+=t)j[0]=e[r],j[1]=e[r+1],j[2]=e[r+2],i(j,j,a),e[r]=j[0],e[r+1]=j[1],e[r+2]=j[2];return e})},38153:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(18642),i=n(33760);function a(e){let t,n,a;function s(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=o.A,n=(t,n)=>(0,o.A)(e(t),n),a=(t,n)=>e(t)-n):(t=e===o.A||e===i.A?e:r,n=e,a=e),{left:s,center:function(e,t,n=0,o=e.length){const i=s(e,t,n,o-1);return i>n&&a(e[i-1],t)>-a(e[i],t)?i-1:i},right:function(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<=0?i=t+1:a=t}while(i<a)}return i}}}function r(){return 0}},44779:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(43183);function i(){return(0,o.A)(arguments)}},80136:(e,t,n)=>{n.d(t,{A:()=>o});const o=e=>()=>e},20825:(e,t,n)=>{function o(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}n.d(t,{A:()=>o})},20919:(e,t,n)=>{function o(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e(o/(t-1));return n}n.d(t,{A:()=>o})},66822:(e,t,n)=>{function o(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}n.d(t,{A:()=>o})}}]);
//# sourceMappingURL=306.bundle.0af30546a9aff76b61ad.js.map