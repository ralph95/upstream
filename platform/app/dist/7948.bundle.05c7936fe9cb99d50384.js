"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7948],{38007:(e,t,n)=>{n.d(t,{Ne:()=>s.N,uY:()=>i,eH:()=>l.e,Lt:()=>o.L});n(9234),n(19214),n(73421);var o=n(79063),a=n(86326),r=n(96283);function i(e){const[t,n]=(0,a.useState)(!1),[o]=(0,r.ihW)(),{activeViewportId:i}=o,s=i===e,l=(0,a.useCallback)(()=>{const t=document.querySelector(`[data-viewportid="${e}"]`),o=t?.closest(".viewport-wrapper")||t;if(!o)return null;let a=o.getBoundingClientRect(),r=!1;const i=()=>{a=o.getBoundingClientRect()},s=e=>{const t=(o=e.clientX,i=e.clientY,o>=a.left&&o<=a.right&&i>=a.top&&i<=a.bottom);var o,i;t!==r&&(r=t,n(t))};let l;const c=()=>{clearTimeout(l),l=setTimeout(i,10)};return window.addEventListener("resize",c),document.addEventListener("mousemove",s),i(),()=>{window.removeEventListener("resize",c),document.removeEventListener("mousemove",s),clearTimeout(l)}},[e]);return(0,a.useEffect)(()=>l(),[l]),(0,a.useMemo)(()=>({isHovered:t,isActive:s}),[t,s])}var s=n(10225),l=(n(84535),n(47488))},9234:(e,t,n)=>{n.d(t,{c:()=>r});var o=n(96283),a=n(79063);function r(){const[e]=(0,o.ihW)(),t=e?.activeViewportId;return(0,a.L)({viewportId:t})}},84535:(e,t,n)=>{n.d(t,{R:()=>s});var o=n(86326),a=n(42356),r=n(10225),i=n(15327);function s({viewportId:e}){const{servicesManager:t}=(0,a.Jg)(),{cornerstoneViewportService:n,trackedMeasurementsService:s,measurementService:l}=t.services,{backgroundDisplaySet:c}=(0,r.N)(e),[d,m]=(0,o.useState)(!1),[p,u]=(0,o.useState)(!1),[g,S]=(0,o.useState)([]),I=(0,o.useCallback)(()=>{if(!l||!c?.SeriesInstanceUID||!d)return void S([]);const e=c.SeriesInstanceUID,t=l.getMeasurements(t=>t.referenceSeriesUID===e).map(e=>e.uid);S(t)},[l,c,d]),v=(0,o.useCallback)(()=>{if(!s||!c?.SeriesInstanceUID)return void m(!1);const t=s.getTrackedSeries();if(!t?.length)return void m(!1);const o=n?.getCornerstoneViewport(e),a=c.SeriesInstanceUID;if(o instanceof i.BaseVolumeViewport){const e=o?.getCurrentImageId();if(!e)return void m(!1)}const r=t.includes(a);m(r)},[e,c,n,s]);return(0,o.useEffect)(()=>{I()},[d,I]),(0,o.useEffect)(()=>{if(!s)return;u(s.isTrackingEnabled()),v();const e=[s.subscribe(s.EVENTS.TRACKING_ENABLED,()=>u(!0)),s.subscribe(s.EVENTS.TRACKING_DISABLED,()=>u(!1)),s.subscribe(s.EVENTS.TRACKED_SERIES_CHANGED,()=>v()),s.subscribe(s.EVENTS.SERIES_ADDED,()=>v()),s.subscribe(s.EVENTS.SERIES_REMOVED,()=>v())];return l&&[l.EVENTS.MEASUREMENT_ADDED,l.EVENTS.RAW_MEASUREMENT_ADDED,l.EVENTS.MEASUREMENT_UPDATED,l.EVENTS.MEASUREMENT_REMOVED,l.EVENTS.MEASUREMENTS_CLEARED].forEach(t=>{e.push(l.subscribe(t,()=>I()))}),()=>{e.forEach(e=>e.unsubscribe())}},[s,l,v,I]),{isTracked:d,isLocked:p,seriesInstanceUID:c?.SeriesInstanceUID,trackedMeasurementUIDs:g}}},19214:(e,t,n)=>{n.d(t,{d:()=>s});var o=n(86326),a=n(62051),r=n.n(a),i=n(42356);function s({measurementFilter:e}={measurementFilter:()=>!0}){const{servicesManager:t}=(0,i.Jg)(),{measurementService:n,displaySetService:a}=t.services,[s,l]=(0,o.useState)([]);return(0,o.useEffect)(()=>{const t=()=>{const t=n.getMeasurements(e).map(e=>function(e,t){const{referenceSeriesUID:n}=e,o=t.getDisplaySetsForSeries(n);if(!o[0]?.instances)throw new Error('The tracked measurements panel should only be tracking "stack" displaySets.');const{findingSites:a,finding:r,label:i,displayText:s}=e,l=a?.[0],c=i||r?.text||l?.text||"(empty)",d={primary:[],secondary:s?.secondary||[]};return s&&d.primary.push(...s.primary),a&&a.forEach(e=>{e?.text&&e.text!==c&&d.primary.push(e.text)}),r&&r.text&&r.text!==c&&d.primary.push(r.text),{...e,displayText:d,label:c}}(e,a));l(e=>JSON.stringify(e)!==JSON.stringify(t)?t:e)},o=r()(t,100);t();const i=[n.EVENTS.MEASUREMENT_ADDED,n.EVENTS.RAW_MEASUREMENT_ADDED,n.EVENTS.MEASUREMENT_UPDATED,n.EVENTS.MEASUREMENT_REMOVED,n.EVENTS.MEASUREMENTS_CLEARED].map(e=>n.subscribe(e,o).unsubscribe);return()=>{i.forEach(e=>e()),o.cancel()}},[n,e,a]),s}},73421:(e,t,n)=>{n.d(t,{j:()=>c});var o=n(86326),a=n(62051),r=n.n(a),i=n(12505),s=n(42356);function l(e,t){const{label:n,segments:o}=e,a=t.getCustomization("panelSegmentation.readableText");function r(e,t=0){const n=[],o="  ".repeat(t);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const l=e[s],c=a?.[s];if(!c)continue;"object"!=typeof l||null===l||Array.isArray(l)?n.push(`${o}${c}: ${(0,i.Wf)(l,2)}`):(n.length>0&&n.push(""),n.push(`${o}${c}`),n.push(...r(l,t+1)))}return n}const s=e=>{const t={primary:[],secondary:[]};if(e.cachedStats){const n=r(e.cachedStats);t.primary=n}return t},l={};return Object.entries(o).forEach(([e,t])=>{l[e]={...t,displayText:s(t)}}),{...e,label:n,segments:l}}function c(e){const{subscribeToDataModified:t=!1,debounceTime:n=0}=e||{},{servicesManager:a}=(0,s.Jg)(),{segmentationService:i,customizationService:c}=a.services,[d,m]=(0,o.useState)([]);return(0,o.useEffect)(()=>{const e=()=>{const e=i.getSegmentations();if(!e?.length)return void m([]);const t=e.map(e=>l(e,c));m(t)},o=n>0?r()(e,n,{leading:!0,trailing:!0}):e;e();const a=[i.subscribe(i.EVENTS.SEGMENTATION_MODIFIED,o),i.subscribe(i.EVENTS.SEGMENTATION_REMOVED,o)];return t&&a.push(i.subscribe(i.EVENTS.SEGMENTATION_DATA_MODIFIED,o)),()=>{a.forEach(e=>e.unsubscribe()),n>0&&o.cancel()}},[i,c,n,t]),d}},10225:(e,t,n)=>{n.d(t,{N:()=>d});var o=n(86326),a=n(42356),r=n(96283),i=n(15327);const s=["SEG","RTSTRUCT"];const l=(e,t)=>e.isOverlayable===t.isOverlayable?0:e.isOverlayable?-1:1;const c=(e,t)=>a.Wp.isLowPriorityModality(e.Modality)?1:-1;function d(e,t){const{servicesManager:n}=(0,a.Jg)(),{displaySetService:d,segmentationService:m}=n.services,[p,u]=(0,r.ihW)(),g=e||p.activeViewportId,{includeBackground:S=!0,includeForeground:I=!0,includeOverlay:v=!0,includePotentialOverlay:y=!0,includePotentialForeground:f=!0,includePotentialBackground:h=!0}=t||{},w=h,E=(0,o.useMemo)(()=>w?d.getActiveDisplaySets():[],[d,w]),b=v,[D,T]=(0,o.useState)(b?m.getSegmentationRepresentations(g):[]);(0,o.useEffect)(()=>{T(b?m.getSegmentationRepresentations(g):[]);const e=b?[m.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,m.EVENTS.SEGMENTATION_REPRESENTATION_REMOVED].map(e=>m.subscribe(e,()=>{T(m.getSegmentationRepresentations(g))})):[];return()=>{e.forEach(e=>e.unsubscribe())}},[m,g,b]);const C=(0,o.useMemo)(()=>v?D.map(e=>d.getDisplaySetByUID(e.segmentationId)):[],[v,D,d]),O=(0,o.useMemo)(()=>C.map(e=>e.displaySetInstanceUID),[C]),N=S||I||y||f,{viewportDisplaySets:M=[],enhancedDisplaySets:V=[]}=(0,o.useMemo)(()=>N&&function({viewportId:e,services:t}){const{displaySetService:n,viewportGridService:o}=t,a=o.getDisplaySetsUIDsForViewport(e);if(!a?.length)return{viewportDisplaySets:[],enhancedDisplaySets:[]};const r=n.getActiveDisplaySets().filter(e=>!a.includes(e.displaySetInstanceUID)),l=a.map(e=>n.getDisplaySetByUID(e)),c=i.utilities.isValidVolume(l[0].imageIds||[]),d=l[0];return{viewportDisplaySets:l,enhancedDisplaySets:r.map(e=>{if(!d.isReconstructable)return{...e,isOverlayable:!1};if(e.unsupported)return{...e,isOverlayable:!1};if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==d.FrameOfReferenceUID)return{...e,isOverlayable:!1};if(!s.includes(e.Modality)){if(!c)return{...e,isOverlayable:!1};const t=e.imageIds||e.images?.map(e=>e.imageId);if(!e.isMultiFrame&&t?.length>0&&!i.utilities.isValidVolume(t))return{...e,isOverlayable:!1}}return{...e,isOverlayable:!0}})}}({viewportId:g,services:{displaySetService:d,viewportGridService:u}})||{viewportDisplaySets:[],enhancedDisplaySets:[]},[g,d,u,N]),R=(0,o.useMemo)(()=>S&&M.length>0?M[0]:void 0,[S,M]),U=(0,o.useMemo)(()=>I&&R?M.filter(e=>!s.includes(e.Modality)&&e.displaySetInstanceUID!==R.displaySetInstanceUID):[],[I,M,R]),A=(0,o.useMemo)(()=>U.map(e=>e.displaySetInstanceUID),[U]),x=(0,o.useMemo)(()=>y?V.filter(e=>s.includes(e.Modality)&&!O.includes(e.displaySetInstanceUID)&&e.isOverlayable).sort(l):[],[y,V,O]),P=(0,o.useMemo)(()=>f?V.filter(e=>!s.includes(e.Modality)&&!A.includes(e.displaySetInstanceUID)&&e.isOverlayable).sort(c):[],[f,V,A]),F=(0,o.useMemo)(()=>h&&R?E.filter(e=>!s.includes(e.Modality)&&e.displaySetInstanceUID!==R.displaySetInstanceUID&&!O.includes(e.displaySetInstanceUID)&&!A.includes(e.displaySetInstanceUID)).sort(c):[],[h,E,R,O,A]),L={allDisplaySets:E||[],viewportDisplaySets:M||[]};return S&&(L.backgroundDisplaySet=R),I&&(L.foregroundDisplaySets=U),v&&(L.overlayDisplaySets=C),y&&(L.potentialOverlayDisplaySets=x),f&&(L.potentialForegroundDisplaySets=P),h&&(L.potentialBackgroundDisplaySets=F),L}},47488:(e,t,n)=>{n.d(t,{A:()=>u,e:()=>p});var o=n(86326),a=n(42356),r=n(10225),i=n(15327),s=n(93813);const l=e=>{switch(e){case s.ij.LeftMiddle:return"left";case s.ij.RightMiddle:return"right";case s.ij.BottomMiddle:return"bottom";case s.ij.TopMiddle:return"top";default:return"bottom"}},c=e=>Math.pow(e,.2),d=e=>Math.pow(e,5),m=({viewportId:e,cornerstoneViewportService:t})=>t.getCornerstoneViewport(e)instanceof i.VolumeViewport3D;function p(e,t){const{servicesManager:n,commandsManager:s}=(0,a.Jg)(),{cornerstoneViewportService:p,colorbarService:u,customizationService:S}=n.services,[I,v]=(0,o.useState)(m({viewportId:e,cornerstoneViewportService:p})),[y,f]=(0,o.useState)(u.hasColorbar(e)),[h,w]=(0,o.useState)(t?.location?l(t.location):"bottom"),[E,b]=(0,o.useState)(),D=o.useRef(),[T,C]=(0,o.useState)(),[O,N]=(0,o.useState)(),[M,V]=(0,o.useState)(),[R,U]=(0,o.useState)({min:0,max:255}),{viewportDisplaySets:A}=(0,r.N)(e),{displaySetService:x}=n.services,P=(0,o.useMemo)(()=>t?.displaySetInstanceUID?t.displaySetInstanceUID:A&&A.length>0?A[0].displaySetInstanceUID:void 0,[t?.displaySetInstanceUID,A]),F=e?p.getViewportInfo(e):null,{presets:L,colorbarProperties:_,volumeRenderingPresets:k,volumeRenderingQualityRange:G}=function(e){const t=e.getCustomization("cornerstone.windowLevelPresets"),n=e.getCustomization("cornerstone.colorbar"),{volumeRenderingPresets:o=[],volumeRenderingQualityRange:a={min:0,max:1,step:.1}}=e.getCustomization("cornerstone.3dVolumeRendering")||{};return{presets:t,colorbarProperties:n,volumeRenderingPresets:o,volumeRenderingQualityRange:a}}(S),z=F?.getViewportOptions().background,B=!!z&&i.utilities.isEqual(z,[1,1,1]),$=(0,o.useMemo)(()=>A?.filter(e=>L?.[e.Modality]).map(e=>({displaySetInstanceUID:e.displaySetInstanceUID,modality:e.Modality,presets:L[e.Modality]}))||[],[A,L]);(0,o.useEffect)(()=>{if(!P)return;const t=x.getDisplaySetByUID(P);if(!t?.imageIds?.length)return;const n=p.getCornerstoneViewport(e);if(!n)return;if(!(n instanceof i.BaseVolumeViewport))return;const o=n.getAllVolumeIds().find(e=>e.includes(P));if(!o)return;const a=n.getImageData(o);if(!a)return;const r=a.imageData,{voxelManager:s}=r.get("voxelManager"),l=s.getRange();U({min:l[0],max:l[1]})},[P,x,p,e]);const j=(0,o.useMemo)(()=>{if(!P||0===$.length)return[];const e=$.find(e=>e.displaySetInstanceUID===P);return e?e.presets:[]},[$,P]);(0,o.useEffect)(()=>{v(m({viewportId:e,cornerstoneViewportService:p}));const t=p.getCornerstoneViewport(e);if(t&&P)try{let e;if(t instanceof i.StackViewport)e=t.getProperties(),e.voiRange&&(b(e.voiRange),D.current=e.voiRange);else if(t instanceof i.BaseVolumeViewport){const n=t.getAllVolumeIds().find(e=>e.includes(P));if(n){if(e=t.getProperties(n),e?.voiRange&&(b(e.voiRange),D.current=e.voiRange),void 0!==e?.colormap?.opacity){const t=Array.isArray(e.colormap.opacity)?e.colormap.opacity.reduce((e,t)=>Math.max(e,t),0):e.colormap.opacity;C(t),N(d(t))}e?.colormap&&void 0!==e.colormap.threshold&&V(e.colormap.threshold)}}}catch(e){console.error("Error initializing VOI range:",e)}},[p,e,P]),(0,o.useEffect)(()=>{if(!e)return;const t=()=>{const t=u.hasColorbar(e);f(t)};t();const{unsubscribe:n}=u.subscribe(u.EVENTS.STATE_CHANGED,t);return()=>{n()}},[u,e]),(0,o.useEffect)(()=>{if(!e||!P)return;const t=p.getCornerstoneViewport(e);if(!t)return;const n=t.element;if(!n)return;const o=e=>{const{range:t}=e.detail;if(!t)return;D.current&&g(D.current,t)||(D.current=t,b(t))},a=e=>{const{colormap:t}=e.detail;t&&(void 0!==t.threshold&&V(t.threshold),void 0!==t.opacity&&(C(t.opacity),N(d(t.opacity))))};return n.addEventListener(i.Enums.Events.VOI_MODIFIED,o),n.addEventListener(i.Enums.Events.COLORMAP_MODIFIED,a),()=>{n.removeEventListener(i.Enums.Events.VOI_MODIFIED,o),n.removeEventListener(i.Enums.Events.COLORMAP_MODIFIED,a)}},[e,P,p,d]);const W=(0,o.useCallback)(()=>{if(!P)throw new Error("No active display set instance UID is available");if(0===A?.length)throw new Error("No display sets are available for this viewport");const e=A?.some(e=>e.displaySetInstanceUID===P);if(!e)throw new Error(`Display set with UID ${P} is not present in the viewport`);return P},[P,A]),H=(0,o.useCallback)(t=>{if(!e)return;const n=W(),{lower:o,upper:a}=i.utilities.windowLevel.toLowHighRange(t.windowWidth,t.windowCenter),r={lower:o,upper:a};D.current&&g(D.current,r)||(D.current=r,b(r),s.run({commandName:"setViewportWindowLevel",commandOptions:{...t,viewportId:e,displaySetInstanceUID:n},context:"CORNERSTONE"}))},[s,e,W]),q=(0,o.useCallback)(t=>{if(e&&(!D.current||!g(D.current,t))){D.current=t,b(t);const n=i.utilities.windowLevel.toWindowLevel(t.lower,t.upper),o=W();s.run({commandName:"setViewportWindowLevel",commandOptions:{...n,viewportId:e,displaySetInstanceUID:o},context:"CORNERSTONE"})}},[e,s,W]),Y=(0,o.useCallback)(t=>{if(!e)return;if(0===A?.length)return;if(!_)return;const{width:n,colorbarTickPosition:o,colorbarInitialColormap:a}=_;let r=o||"top";r="left"===h||"right"===h?"left"===h?"right":"left":"top"===h?"bottom":"top";const i={viewportId:e,colormaps:_.colormaps||{},ticks:{position:r},width:n,position:h,activeColormapName:a||"Grayscale",...t};B&&(i.ticks={position:r,style:{font:"13px Inter",color:"#000000",maxNumTicks:8,tickSize:5,tickWidth:1,labelMargin:3}});const l=A.map(e=>e.displaySetInstanceUID);try{s.run("toggleViewportColorbar",{viewportId:e,options:i,displaySetInstanceUIDs:l})}catch(e){console.error("Error toggling colorbar:",e)}},[s,e,_,B,A,h]),J=(0,o.useCallback)(({colormap:t,opacity:n=1,immediate:o=!1})=>{if(!e)return;const a=W();void 0!==n&&C(n),s.run({commandName:"setViewportColormap",commandOptions:{viewportId:e,colormap:t,displaySetInstanceUID:a,opacity:n,immediate:o},context:"CORNERSTONE"})},[s,e,W]),K=(0,o.useCallback)(t=>{if(!e)return;const n=p.getCornerstoneViewport(e);if(!(n&&n instanceof i.BaseVolumeViewport))return;C(t),N(d(t));const o=W(),a=n.getAllVolumeIds().find(e=>e.includes(o));if(!a)return;const r={...n.getProperties(a).colormap||{},opacity:t};n.setProperties({colormap:r},a),n.render()},[p,e,W,d]),Q=(0,o.useCallback)(e=>{const t=c(e);K(t)},[c,K]),Z=(0,o.useCallback)(t=>{if(!e)return;const n=p.getCornerstoneViewport(e);if(!(n&&n instanceof i.BaseVolumeViewport))return;V(t);const o=W(),a=n.getAllVolumeIds().find(e=>e.includes(o));a&&(console.debug("ðŸš€ ~ thresholdValue:",t),n.setProperties({colormap:{threshold:t}},a),n.render())},[p,e,W]),X=(0,o.useMemo)(()=>{if(!e||!P||!A?.length)return null;try{const t=p.getCornerstoneViewport(e);if(!t)return null;if(t instanceof i.StackViewport){const{colormap:e}=t.getProperties();return e||(_?.colormaps?.find(e=>"Grayscale"===e.Name)||_?.colormaps?.[0])}const n=t.getActors(),o=n?.find(e=>e.referencedId?.includes(P));if(!o)return _?.colormaps?.find(e=>"Grayscale"===e.Name)||_?.colormaps?.[0];const{colormap:a}=t.getProperties(o.referencedId);return a||(_?.colormaps?.find(e=>"Grayscale"===e.Name)||_?.colormaps?.[0])}catch(e){return console.error("Error getting viewport colormap:",e),_?.colormaps?.find(e=>"Grayscale"===e.Name)||_?.colormaps?.[0]}},[p,e,P,A,_?.colormaps]),ee=(0,o.useCallback)(t=>{if(!e)return;const n=W();s.run({commandName:"setVolumesPreset",commandOptions:{preset:t,viewportId:e,displaySetInstanceUID:n}})},[s,e,W]),te=(0,o.useCallback)(t=>{e&&s.run({commandName:"setVolumeRenderingQuality",commandOptions:{quality:t,viewportId:e}})},[s,e]),ne=(0,o.useCallback)(({ambient:t,diffuse:n,specular:o})=>{e&&s.run({commandName:"setVolumeLighting",commandOptions:{ambient:t,diffuse:n,specular:o,viewportId:e}})},[s,e]),oe=(0,o.useCallback)(t=>{e&&s.run({commandName:"setVolumeShading",commandOptions:{enabled:t,viewportId:e}})},[s,e]);return{is3DVolume:I,isViewportBackgroundLight:B,setWindowLevel:H,setVOIRange:q,voiRange:E,windowLevel:i.utilities.windowLevel.toWindowLevel(E?.lower,E?.upper),hasColorbar:y,toggleColorbar:Y,setColormap:J,colormap:X,opacity:T,setOpacity:K,opacityLinear:O,setOpacityLinear:Q,threshold:M,setThreshold:Z,pixelValueRange:R,setVolumeRenderingPreset:ee,setVolumeRenderingQuality:te,setVolumeLighting:ne,setVolumeShading:oe,viewportDisplaySets:A,colorbarProperties:_,colorbarPosition:h,setColorbarPosition:w,windowLevelPresets:j,allWindowLevelPresets:$,volumeRenderingPresets:k,volumeRenderingQualityRange:G}}const u=p;function g(e,t,n=.001){return!(!e||!t)&&(Math.abs(e.lower-t.lower)<n&&Math.abs(e.upper-t.upper)<n)}},79063:(e,t,n)=>{n.d(t,{L:()=>d});var o=n(86326),a=n(62051),r=n.n(a),i=n(12505),s=n(42356);const l=["SM","OT","DOC","ECG"];function c(e,t){const{label:n,segments:o}=e,a=t.getCustomization("panelSegmentation.readableText");function r(e,t=0){const n=[],o="  ".repeat(t);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const l=e[s],c=a?.[s];if(!c)continue;"object"!=typeof l||null===l||Array.isArray(l)?n.push(`${o}${c}: ${(0,i.Wf)(l,2)}`):(n.length>0&&n.push(""),n.push(`${o}${c}`),n.push(...r(l,t+1)))}return n}const s=e=>{const t={primary:[],secondary:[]};if(e.cachedStats){const n=r(e.cachedStats);t.primary=n}return t},l={};return Object.entries(o).forEach(([e,t])=>{l[e]={...t,displayText:s(t)}}),{...e,label:n,segments:l}}function d({viewportId:e,subscribeToDataModified:t=!1,debounceTime:n=0}){const{servicesManager:a}=(0,s.Jg)(),{segmentationService:i,viewportGridService:d,customizationService:m,displaySetService:p}=a.services,[u,g]=(0,o.useState)({segmentationsWithRepresentations:[],disabled:!1});return(0,o.useEffect)(()=>{const o=()=>{const t=d.getDisplaySetsUIDsForViewport(e);if(!t?.length)return;const n=p.getDisplaySetByUID(t[0]);if(!n)return;if(l.includes(n.Modality))return void g(e=>({segmentationsWithRepresentations:[],disabled:!0}));const o=i.getSegmentations();if(!o?.length)return void g(e=>({segmentationsWithRepresentations:[],disabled:!1}));const a=i.getSegmentationRepresentations(e),r=new Map;a.forEach(e=>{r.has(e.segmentationId)||r.set(e.segmentationId,e)});const s=Array.from(r.values()).map(e=>({representation:e,segmentation:c(i.getSegmentation(e.segmentationId),m)}));g({segmentationsWithRepresentations:s,disabled:!1})},a=n>0?r()(o,n,{leading:!0,trailing:!0}):o;o();const s=[i.subscribe(i.EVENTS.SEGMENTATION_MODIFIED,a),i.subscribe(i.EVENTS.SEGMENTATION_REMOVED,a),i.subscribe(i.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,a),d.subscribe(d.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,a),d.subscribe(d.EVENTS.GRID_STATE_CHANGED,a)];return t&&s.push(i.subscribe(i.EVENTS.SEGMENTATION_DATA_MODIFIED,a)),()=>{s.forEach(e=>e.unsubscribe()),n>0&&a.cancel()}},[i,d,m,p,n,t,e]),u}},37948:(e,t,n)=>{n.r(t),n.d(t,{AccordionGroup:()=>ai,CloneChildren:()=>ni,Colorbar:()=>To,Colormap:()=>Do,CornerstoneViewportDownloadForm:()=>hn,DYNAMIC_VOLUME_LOADER_SCHEME:()=>Pa,DicomUpload:()=>Xt,Enums:()=>m,ImageOverlayViewerTool:()=>U,MeasumentsMenu:()=>Bi,MeasurementOrAdditionalFindingSets:()=>gi,MeasurementsOrAdditionalFindings:()=>Ii,OHIFCornerstoneViewport:()=>ts,PanelMeasurement:()=>Oi,PanelSegmentation:()=>zr,PlanarFreehandROI:()=>ie,RectangleROI:()=>le,SeriesMeasurementTrigger:()=>Ki,SeriesMeasurements:()=>Qi,StudyMeasurements:()=>Ti,StudyMeasurementsActions:()=>hi,StudySummaryFromMetadata:()=>fi,Types:()=>r,VOLUME_LOADER_SCHEME:()=>xa,VolumeLighting:()=>Ro,VolumeRenderingOptions:()=>Ao,VolumeRenderingPresets:()=>No,VolumeRenderingQuality:()=>Mo,VolumeShade:()=>Uo,VolumeShift:()=>Vo,WindowLevel:()=>Co,WindowLevelActionMenu:()=>xo,WindowLevelActionMenuContent:()=>Po,WindowLevelActionMenuWrapper:()=>Lo,default:()=>rs,dicomLoaderService:()=>wr,findNearbyToolData:()=>Ye,getActiveViewportEnabledElement:()=>E,getEnabledElement:()=>h.kJ,getSOPInstanceAttributes:()=>_,groupByDisplaySet:()=>Ji,groupByNamedSets:()=>Si,groupByStudy:()=>Di,measurementMappingUtils:()=>a,setEnabledElement:()=>h.ye,toolNames:()=>A,useActiveViewportSegmentationRepresentations:()=>Pr.c,useLutPresentationStore:()=>at.I,useMeasurementTracking:()=>Jo.R,useMeasurements:()=>Fr.d,usePositionPresentationStore:()=>rt.q,useSegmentationPresentationStore:()=>it.v,useSegmentations:()=>Mi.j,useSelectedSegmentationsForViewportStore:()=>Sn,useSynchronizersStore:()=>pn.U,utils:()=>Gi});var o={};n.r(o),n.d(o,{rM:()=>c,yK:()=>d,Ay:()=>m});var a={};n.r(a),n.d(a,{getDisplayUnit:()=>W,getFirstAnnotationSelected:()=>j,getHandlesFromPoints:()=>z,getSOPInstanceAttributes:()=>_,isAnnotationSelected:()=>B,setAnnotationSelected:()=>$});var r={};n.r(r);var i=n(86326),s=n(15327),l=n(4667);const c="Cornerstone3DTools",d="0.1",m={CORNERSTONE_3D_TOOLS_SOURCE_NAME:c,CORNERSTONE_3D_TOOLS_SOURCE_VERSION:d};var p=n(42356),u=n(19742),g=n(43213),S=n(79453);const{registerVolumeLoader:I}=s.volumeLoader;var v=n(75165),y=n(56983),f=n(39548),h=n(71353);function w(e){const{element:t}=(0,h.kJ)(e)||{};return(0,s.getEnabledElement)(t)}function E(e){const{activeViewportId:t}=e.getState();return w(t)}const{calibrateImageSpacing:b}=l.utilities;class D extends l.LengthTool{constructor(...e){super(...e),this._renderingViewport=void 0,this._lengthToolRenderAnnotation=this.renderAnnotation,this.renderAnnotation=(e,t)=>{const{viewport:n}=e;return this._renderingViewport=n,this._lengthToolRenderAnnotation(e,t)}}_getTextLines(e,t){const[n,o]=e.handles.points.map(e=>this._renderingViewport.worldToCanvas(e));return[`${Math.round(100*function(e,t){const n=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(n*n+o*o)}(n,o))/100}px`]}}D.toolName="CalibrationLine";const T=D;function C(e,t){const{uiDialogService:n,viewportGridService:o}=e.services,a=t.detail,{annotation:{metadata:r,data:i}}=a,{referencedImageId:s}=r,l=E(o),{viewport:c}=l,d=Math.round(100*function(e,t){const n=e[0]-t[0],o=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(n*n+o*o+a*a)}(i.handles.points[0],i.handles.points[1]))/100;return new Promise((e,t)=>{n?(0,f.callInputDialog)({uiDialogService:n,title:"Calibration",placeholder:"Actual Physical distance (mm)",defaultValue:`${d}`}).then(t=>{(e=>{const t=e/d;b(s,c.getRenderingEngine(),{type:"User",scale:1/t})})(Number.parseFloat(t)),e(!0)}):t("UIDialogService is not initiated")})}var O=n(12505);const N=new Map,M={add:(e,t)=>{N.get(e)!==t&&N.set(e,t)},get:(e,t)=>{if(!Array.isArray(t)&&"overlayPlaneModule"===e)return N.get(t)}};s.metaData.addProvider(M.get,1e4);const V=M;class R extends l.AnnotationDisplayTool{constructor(e={},t={supportedInteractionTypes:[],configuration:{fillColor:[255,127,127,255]}}){super(e,t),this.onSetToolDisabled=()=>{},this.renderAnnotation=(e,t)=>{const{viewport:n}=e,o=this.getReferencedImageId(n);if(!o)return;const a=s.metaData.get("overlayPlaneModule",o),r=a?.overlays;return r?.length?(r.forEach(e=>{e.x||=0,e.y||=0}),R.addOverlayPlaneModule(o,a),this._getCachedStat(o,a,this.configuration.fillColor).then(n=>{n.overlays.forEach(n=>{this._renderOverlay(e,t,n)})}),!0):void 0}}getReferencedImageId(e){if(e instanceof s.VolumeViewport)return;return this.getTargetId(e).split("imageId:")[1]}_renderOverlay(e,t,n){const{viewport:o}=e,a=this.getReferencedImageId(o);if(!a)return;const{_id:r,columns:i,rows:c,x:d,y:m}=n,p=s.utilities.imageToWorldCoords(a,[d-1,m-1]),u=o.worldToCanvas(p),g=s.utilities.imageToWorldCoords(a,[i,c]),S=o.worldToCanvas(g),I=`image-overlay-${r}`,v=t.getSvgNode(I),y={"data-id":I,width:S[0]-u[0],height:S[1]-u[1],x:u[0],y:u[1],href:n.dataUrl};if(isNaN(y.x)||isNaN(y.y)||isNaN(y.width)||isNaN(y.height))return console.warn("Invalid rendering attribute for image overlay",y["data-id"]),!1;if(v)l.drawing.setAttributesIfNecessary(y,v),t.setNodeTouched(I);else{const e=document.createElementNS("http://www.w3.org/2000/svg","image");l.drawing.setNewAttributesIfValid(y,e),t.appendNode(e,I)}return!0}async _getCachedStat(e,t,n){if(0===t.overlays.filter(e=>e.pixelData&&!e.dataUrl).length)return t;const o=await Promise.all(t.overlays.filter(e=>e.pixelData).map(async(e,t)=>{let o=null;if(e.pixelData.Value)o=e.pixelData.Value;else if(e.pixelData instanceof Array)o=e.pixelData[0];else if(e.pixelData.retrieveBulkData)o=await e.pixelData.retrieveBulkData();else if(e.pixelData.InlineBinary){const t=(0,O.Vk)(e.pixelData.InlineBinary);o=await t.arrayBuffer()}if(!o)return;const a=this._renderOverlayToDataUrl({width:e.columns,height:e.rows},e.color||n,o);return{...e,_id:(0,O.Os)(),dataUrl:a,color:n}}));return t.overlays=o,t}_isSameColor(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}_renderOverlayToDataUrl({width:e,height:t},n,o){const a=new DataView(o),r=e*t,i=document.createElement("canvas");i.width=e,i.height=t;const s=i.getContext("2d");s.clearRect(0,0,e,t),s.globalCompositeOperation="copy";const l=s.getImageData(0,0,e,t),c=l.data;for(let e=0,t=0,o=0;e<r;e++)a.getUint8(o)&1<<t&&(c[4*e]=n[0],c[4*e+1]=n[1],c[4*e+2]=n[2],c[4*e+3]=n[3]),t>=7?(t=0,o++):t++;return s.putImageData(l,0,0),i.toDataURL()}}R.toolName="ImageOverlayViewer",R.addOverlayPlaneModule=V.add;const U=R;const A={Pan:l.PanTool.toolName,ArrowAnnotate:l.ArrowAnnotateTool.toolName,WindowLevel:l.WindowLevelTool.toolName,StackScroll:l.StackScrollTool.toolName,Zoom:l.ZoomTool.toolName,VolumeRotate:l.VolumeRotateTool.toolName,MipJumpToClick:l.MIPJumpToClickTool.toolName,Length:l.LengthTool.toolName,DragProbe:l.DragProbeTool.toolName,Probe:l.ProbeTool.toolName,RectangleROI:l.RectangleROITool.toolName,RectangleROIThreshold:l.RectangleROIThresholdTool.toolName,EllipticalROI:l.EllipticalROITool.toolName,CircleROI:l.CircleROITool.toolName,Bidirectional:l.BidirectionalTool.toolName,Angle:l.AngleTool.toolName,CobbAngle:l.CobbAngleTool.toolName,Magnify:l.MagnifyTool.toolName,Crosshairs:l.CrosshairsTool.toolName,Brush:l.BrushTool.toolName,PaintFill:l.PaintFillTool.toolName,ReferenceLines:l.ReferenceLinesTool.toolName,CalibrationLine:T.toolName,TrackballRotateTool:l.TrackballRotateTool.toolName,CircleScissors:l.CircleScissorsTool.toolName,RectangleScissors:l.RectangleScissorsTool.toolName,SphereScissors:l.SphereScissorsTool.toolName,ImageOverlayViewer:U.toolName,AdvancedMagnify:l.AdvancedMagnifyTool.toolName,UltrasoundDirectional:l.UltrasoundDirectionalTool.toolName,UltrasoundAnnotation:l.UltrasoundPleuraBLineTool.toolName,SplineROI:l.SplineROITool.toolName,LivewireContour:l.LivewireContourTool.toolName,PlanarFreehandROI:l.PlanarFreehandROITool.toolName,OrientationMarker:l.OrientationMarkerTool.toolName,WindowLevelRegion:l.WindowLevelRegionTool.toolName,PlanarFreehandContourSegmentation:l.PlanarFreehandContourSegmentationTool.toolName,SegmentBidirectional:l.SegmentBidirectionalTool.toolName,SegmentSelect:l.SegmentSelectTool.toolName,SegmentLabel:l.SegmentLabelTool.toolName,LabelmapSlicePropagation:v.Bj.toolName,MarkerLabelmap:v.pY.toolName,RegionSegmentPlus:l.RegionSegmentPlusTool.toolName,LivewireContourSegmentation:l.LivewireContourSegmentationTool.toolName,SculptorTool:l.SculptorTool.toolName,SplineContourSegmentation:l.SplineContourSegmentationTool.toolName,LabelMapEditWithContourTool:l.LabelMapEditWithContourTool.toolName},x=["Length","EllipticalROI","CircleROI","Bidirectional","ArrowAnnotate","Angle","CobbAngle","Probe","RectangleROI","PlanarFreehandROI","SplineROI","LivewireContour","UltrasoundDirectionalTool","UltrasoundPleuraBLineTool","SCOORD3DPoint","SegmentBidirectional"];var P=n(47807);const F=e=>P.locking.isAnnotationLocked(e),L=e=>P.visibility.isAnnotationVisible(e);function _(e,t,n){if(e)return function(e){const t=s.metaData.get("instance",e);return{SOPInstanceUID:t.SOPInstanceUID,SeriesInstanceUID:t.SeriesInstanceUID,StudyInstanceUID:t.StudyInstanceUID,frameNumber:t.frameNumber||1}}(e);const{metadata:o}=n,a=function({metadata:e,displaySetService:t}){const{volumeId:n}=e;if(n){const o=t.getDisplaySetsBy(e=>n.includes(e.uid))[0];if(o)return o;console.warn("Unable to find volumeId",n),e.volumeId=null}if(!e.FrameOfReferenceUID)throw new Error("No volumeId and no FrameOfReferenceUID provided. Could not find matching displaySet.");const o=Array.from(t.getDisplaySetCache().values()).find(t=>t.instance?.FrameOfReferenceUID===e.FrameOfReferenceUID);if(!o)throw new Error("Could not find matching displaySet for the provided FrameOfReferenceUID.");return o}({metadata:o,displaySetService:t}),{StudyInstanceUID:r,SeriesInstanceUID:i}=a;return{SOPInstanceUID:void 0,SeriesInstanceUID:i,StudyInstanceUID:r}}const k={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{length:p,unit:u="mm"}=o;i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,length:p})}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{length:o,SeriesNumber:a,SOPInstanceUID:r,frameNumber:i,unit:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===r);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${i}`:"";if(null==o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${s}`),n.secondary.push(`S: ${a}${d}${m}`),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:Length"),e.forEach(e=>{const{length:t,unit:n}=e;o.push("Length"),a.push(t),o.push("Unit"),a.push(n)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const G=k;function z(e){if(e.longAxis&&e.shortAxis){const t={};return t.start=e.longAxis[0],t.end=e.longAxis[1],t.perpendicularStart=e.longAxis[0],t.perpendicularEnd=e.longAxis[1],t}return e.map((e,t)=>t%10==0?{start:e}:{end:e}).reduce((e,t)=>Object.assign(e,{...t}),{})}function B(e){return l.annotation.selection.isAnnotationSelected(e)}function $(e,t){B(e)!==t&&l.annotation.selection.setAnnotationSelected(e,t)}function j(e){const[t]=l.annotation.selection.getAnnotationsSelected()||[];if(t)return l.annotation.state.getAnnotation(t)}const W=e=>null==e?"":e,H={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a={}}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{length:p,width:u,unit:g}=o;i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:g,length:p,width:u})}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{length:o,width:a,unit:r,SeriesNumber:i,SOPInstanceUID:s,frameNumber:l}=e[0],c=p.Wp.roundNumber(o,2),d=p.Wp.roundNumber(a,2),m=t.instances.find(e=>e.SOPInstanceUID===s);let u;m&&(u=m.InstanceNumber);const g=u?` I: ${u}`:"",S=t.isMultiFrame?` F: ${l}`:"";return n.primary.push(`L: ${c} ${W(r)}`),n.primary.push(`W: ${d} ${W(r)}`),n.secondary.push(`S: ${i}${g}${S}`),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:Bidirectional"),e.forEach(e=>{const{length:t,width:n,unit:r}=e;o.push("Length","Width","Unit"),a.push(t,n,r)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const q=H,Y=(e,t,n)=>{if(Array.isArray(e)&&e.length>0){const o=e.map(e=>p.Wp.roundNumber(e,2));return`${n.charAt(0).toUpperCase()+n.slice(1)}: ${o.join(", ")} ${W(t)}`}const o=p.Wp.roundNumber(e,2);return`${n.charAt(0).toUpperCase()+n.slice(1)}: ${o} ${W(t)}`},J={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[],s=new Set;return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:l,SeriesInstanceUID:c,frameNumber:d}=_(r,t,e),m=t.getDisplaySetsForSeries(c)[0],{SeriesNumber:p}=m,{mean:u,stdDev:g,max:S,area:I,Modality:v,areaUnit:y,modalityUnit:f}=o;v&&s.has(v)||(v&&s.add(v),i.push({SeriesInstanceUID:c,SOPInstanceUID:l,SeriesNumber:p,frameNumber:d,Modality:v,unit:f,areaUnit:y,mean:u,stdDev:g,max:S,area:I}))}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:a,frameNumber:r,areaUnit:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${r}`:"",m=p.Wp.roundNumber(o,2);return n.primary.push(`${m} ${W(i)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:a}=e,r=Y(o,t,"max");n.primary.push(r),n.secondary.push(`S: ${a}${c}${d}`)}),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,metadata:i,isLocked:c,isVisible:d,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:EllipticalROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:r,area:i,unit:s,areaUnit:l}=e;t&&s&&r&&i&&(o.push(`max (${s})`,`mean (${s})`,`std (${s})`,"Area","Unit"),a.push(r,t,n,i,l))}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const K=J,Q={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a={}}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[],s=new Set;return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:l,SeriesInstanceUID:c,frameNumber:d}=_(r,t,e),m=t.getDisplaySetsForSeries(c)[0],{SeriesNumber:p}=m,{mean:u,stdDev:g,max:S,area:I,Modality:v,areaUnit:y,modalityUnit:f,perimeter:h,radiusUnit:w}=o;v&&s.has(v)||(s.add(v),i.push({SeriesInstanceUID:c,SOPInstanceUID:l,SeriesNumber:p,frameNumber:d,Modality:v,unit:f,mean:u,stdDev:g,max:S,area:I,areaUnit:y,perimeter:h,radiusUnit:w}))}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:a,frameNumber:r,areaUnit:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${r}`:"";if(!isNaN(o)){const e=p.Wp.roundNumber(o||0,2);n.primary.push(`${e} ${W(i)}`)}return e.forEach(e=>{const{unit:t,perimeter:o,radiusUnit:a,max:r,SeriesNumber:i}=e;if(isNaN(r)){if(o&&!isNaN(o)){const e=Y(o,a,"perimeter");n.primary.push(e)}}else{const e=Y(r,t,"max");n.primary.push(e)}n.secondary.push(`S: ${i}${c}${d}`)}),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:CircleROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:r,area:i,unit:s,areaUnit:l}=e;t&&s&&r&&i&&(o.push(`max (${s})`,`mean (${s})`,`std (${s})`,"Area","Unit"),a.push(r,t,n,i,l))}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const Z=Q,X={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:p,FrameOfReferenceUID:u}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:g,SeriesInstanceUID:S,StudyInstanceUID:I}=_(p,t,r);let v;v=g?t.getDisplaySetForSOPInstanceUID(g,S):t.getDisplaySetsForSeries(S)[0];const{points:y,textBox:f}=s.handles,h=function(e,t){const{metadata:n,data:o}=e,{text:a}=o,{referencedImageId:r}=n,i=[],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d;return i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,text:a}),i}(r,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{SeriesNumber:o,SOPInstanceUID:a,frameNumber:r,text:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${r}`:"";i&&n.primary.push(i);return n.secondary.push(`S: ${o}${c}${d}`),n}(h,v);return{uid:l,SOPInstanceUID:g,FrameOfReferenceUID:u,points:y,textBox:f,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:S,referenceStudyUID:I,referencedImageId:p,frameNumber:h[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:ArrowAnnote"),e.forEach(e=>{const{text:t}=e;o.push("Text"),a.push(t)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(h,y,u)}}};const ee=X,te={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Cobb Angle tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!a)return;if(!Object.keys(a).length)return;const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{angle:p}=o,u="Â°";i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,angle:p})}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{angle:o,unit:a,SeriesNumber:r,SOPInstanceUID:i,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===i);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0===o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${W(a)}`),n.secondary.push(`S: ${r}${d}${m}`),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w?.[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:CobbAngle"),e.forEach(e=>{const{angle:t,unit:n}=e;o.push(`Angle (${n})`),a.push(t)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const ne=te,oe={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return;const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{angle:p}=o,u="Â°";i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,angle:p})}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{angle:o,unit:a,SeriesNumber:r,SOPInstanceUID:i,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===i);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0===o)return n;const u=p.Wp.roundNumber(o,2);return n.primary.push(`${u} ${W(a)}`),n.secondary.push(`S: ${r}${d}${m}`),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,frameNumber:w?.[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:Angle"),e.forEach(e=>{const{angle:t,unit:n}=e;o.push(`Angle (${n})`),a.push(t)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g),referencedImageId:u}}};const ae=oe,re={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.debug("PlanarFreehandROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:S,SeriesInstanceUID:I,frameNumber:v,StudyInstanceUID:y}=_(u,t,r);let f;f=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const h=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!a)return;if(!Object.keys(a).length)return[];const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:S,Modality:I,areaUnit:v,modalityUnit:y}=o;i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:y,mean:p,stdDev:u,max:g,area:S,areaUnit:v})}),i}(r,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:a,frameNumber:r,areaUnit:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${r}`:"",m=p.Wp.roundNumber(o||0,2);return n.primary.push(`${m} ${W(i)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:a}=e,r=Y(o,t,"max");n.primary.push(r),n.secondary.push(`S: ${a}${c}${d}`)}),n}(h,f);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:s.contour.polyline,textBox:s.handles.textBox,metadata:i,frameNumber:v,referenceSeriesUID:I,referenceStudyUID:y,referencedImageId:u,toolName:i.toolName,displaySetInstanceUID:f.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t){const{PlanarFreehandROI:n}=t.getCustomization("cornerstone.measurements"),{report:o}=n,a=[],r=[];a.push("AnnotationType"),r.push("Cornerstone:PlanarFreehandROI");const{metadata:i,data:s}=e,l=s.cachedStats[`imageId:${i.referencedImageId}`];o.forEach(({name:e,value:t})=>{a.push(e),l[t]?r.push(l[t]):r.push("not available")}),i.FrameOfReferenceUID&&(a.push("FrameOfReferenceUID"),r.push(i.FrameOfReferenceUID));s.contour.polyline&&(a.push("points"),r.push(s.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:a,values:r}}(r,a),isLocked:c,isVisible:d}}};const ie=re,se={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Rectangle ROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[],s=new Set;return Object.keys(a).forEach(o=>{const l=a[o],{SOPInstanceUID:c,SeriesInstanceUID:d,frameNumber:m}=_(r,t,e),p=t.getDisplaySetsForSeries(d)[0],{SeriesNumber:u}=p,{mean:g,stdDev:S,max:I,area:v,Modality:y,modalityUnit:f,areaUnit:h}=l;y&&s.has(y)||(y&&s.add(y),i.push({SeriesInstanceUID:d,SOPInstanceUID:c,SeriesNumber:u,frameNumber:m,Modality:y,unit:f,mean:g,stdDev:S,metadata:n,max:I,area:v,areaUnit:h}))}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:a,frameNumber:r,areaUnit:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${r}`:"",m=p.Wp.roundNumber(o||0,2);return n.primary.push(`${m} ${W(i)}`),e.forEach(e=>{const{unit:t,max:o,SeriesNumber:a}=e;if(Number.isFinite(o)){const e=Y(o,t,"max");n.primary.push(e)}n.secondary.push(`S: ${a}${c}${d}`)}),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:RectangleROI"),e.forEach(e=>{const{mean:t,stdDev:n,max:r,area:i,unit:s,areaUnit:l}=e;t&&s&&r&&i&&(o.push("Maximum","Mean","Std Dev","Pixel Unit","Area","Unit"),a.push(r,t,n,s,i,l))}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g),isLocked:c,isVisible:d}}};const le=se,ce={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("SplineROI tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:S,SeriesInstanceUID:I,frameNumber:v,StudyInstanceUID:y}=_(u,t,r);let f;f=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const h=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{mean:p,stdDev:u,max:g,area:S,Modality:I,areaUnit:v,modalityUnit:y}=o;i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,Modality:I,unit:y,mean:p,stdDev:u,max:g,area:S,areaUnit:v})}),i}(r,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{area:o,SOPInstanceUID:a,frameNumber:r,areaUnit:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===a);let l;s&&(l=s.InstanceNumber);t.isMultiFrame;const c=p.Wp.roundNumber(o||0,2);return n.primary.push(`${c} ${W(i)}`),n}(h,f);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:s.contour.polyline,textBox:s.handles.textBox,metadata:i,frameNumber:v,referenceSeriesUID:I,referenceStudyUID:y,referencedImageId:u,toolName:i.toolName,displaySetInstanceUID:f.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t){const{SplineROI:n}=t.getCustomization("cornerstone.measurements"),{report:o}=n,a=[],r=[];a.push("AnnotationType"),r.push("Cornerstone:SplineROI");const{metadata:i,data:s}=e,l=s.cachedStats[`imageId:${i.referencedImageId}`];o.forEach(({name:e,value:t})=>{a.push(e),l[t]?r.push(l[t]):r.push("not available")}),i.FrameOfReferenceUID&&(a.push("FrameOfReferenceUID"),r.push(i.FrameOfReferenceUID));s.contour.polyline&&(a.push("points"),r.push(s.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:a,values:r}}(r,a),isLocked:c,isVisible:d}}};const de=ce,me={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Livewire tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:p,FrameOfReferenceUID:u}=i;if(!x.includes(m))throw new Error(`Tool ${m} not supported`);const{SOPInstanceUID:g,SeriesInstanceUID:S,frameNumber:I,StudyInstanceUID:v}=_(p,t,r);let y;return y=g?t.getDisplaySetForSOPInstanceUID(g,S):t.getDisplaySetsForSeries(S),{uid:l,SOPInstanceUID:g,FrameOfReferenceUID:u,points:s.contour.polyline,textBox:s.handles.textBox,metadata:i,frameNumber:I,referenceSeriesUID:S,referencedImageId:p,referenceStudyUID:v,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,isLocked:c,isVisible:d,displayText:pe(r,y,t),data:s.cachedStats,type:o(m),getReport:()=>function(e){const t=[],n=[];t.push("AnnotationType"),n.push("Cornerstone:Livewire");const{metadata:o,data:a}=e;o.FrameOfReferenceUID&&(t.push("FrameOfReferenceUID"),n.push(o.FrameOfReferenceUID));a.contour.polyline&&(t.push("points"),n.push(a.contour.polyline.map(e=>e.join(" ")).join(";")));return{columns:t,values:n}}(r)}}};function pe(e,t,n){const{metadata:o,data:a}=e,r={primary:[],secondary:[]};if(!a.cachedStats||!a.cachedStats[`imageId:${o.referencedImageId}`])return r;const{area:i,areaUnit:s}=a.cachedStats[`imageId:${o.referencedImageId}`],{SOPInstanceUID:l,frameNumber:c}=_(o.referencedImageId,n,e),d=t.instances.find(e=>e.SOPInstanceUID===l);let m;d&&(m=d.InstanceNumber);const u=m?` I: ${m}`:"",g=t.isMultiFrame?` F: ${c}`:"",{SeriesNumber:S}=t;let I=null;if(void 0!==S&&(I=`S: ${S}${u}${g}`),i){const e=p.Wp.roundNumber(i||0,2);r.primary.push(`${e} ${W(s)}`)}return I&&r.secondary.push(I),r}const ue=me,ge={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Probe tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f}=s.handles,h=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return;const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{value:p}=o,u="HU";i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:u,value:p})}),i}(r,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{value:o,unit:a,SeriesNumber:r,SOPInstanceUID:i,frameNumber:s}=e[0],l=t.instances.find(e=>e.SOPInstanceUID===i);let c;l&&(c=l.InstanceNumber);const d=c?` I: ${c}`:"",m=t.isMultiFrame?` F: ${s}`:"";if(void 0!==o){const e=p.Wp.roundNumber(o,2);n.primary.push(`${e} ${W(a)}`),n.secondary.push(`S: ${r}${d}${m}`)}return n}(h,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,metadata:i,isLocked:c,isVisible:d,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:h?.[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:Probe"),e.forEach(e=>{const{value:t,unit:n}=e;o.push(`Probe (${n})`),a.push(t)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(h,f,g)}}};const Se=ge,Ie={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("Length tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I);const{points:f}=s.handles,h=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return;const i=[];return Object.keys(a).forEach(e=>{const n=a[e];if(!r)throw new Error("Non-acquisition plane measurement mapping not supported");const{SOPInstanceUID:o,SeriesInstanceUID:s,frameNumber:l}=_(r),c=t.getDisplaySetForSOPInstanceUID(o,s,l),{SeriesNumber:d}=c,{xValues:m,yValues:p,units:u,isUnitless:g,isHorizontal:S}=n;i.push({SeriesInstanceUID:s,SOPInstanceUID:o,SeriesNumber:d,frameNumber:l,xValues:m,yValues:p,units:u,isUnitless:g,isHorizontal:S})}),i}(r,t),w=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{xValues:o,yValues:a,units:r,isUnitless:i,SeriesNumber:s,SOPInstanceUID:l,frameNumber:c}=e[0],d=t.instances.find(e=>e.SOPInstanceUID===l);let m;d&&(m=d.InstanceNumber);const u=m?` I: ${m}`:"",g=t.isMultiFrame?` F: ${c}`:"",S=`S: ${s}${u}${g}`;if(void 0===o||void 0===a)return n;if(i)n.primary.push(`${p.Wp.roundNumber(o[0],2)} ${r[0]}`);else{const e=Math.abs(o[1]-o[0]),t=Math.abs(a[1]-a[0]);n.primary.push(`${p.Wp.roundNumber(e)} ${r[0]}`),n.primary.push(`${p.Wp.roundNumber(t)} ${r[1]}`)}return n.secondary.push(S),n}(h,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,frameNumber:h?.[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:w,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:UltrasoundDirectional"),e.forEach(e=>{const{xValues:t,yValues:n,units:r,isUnitless:i}=e;if(i)o.push("Length"+r[0]),a.push(p.Wp.roundNumber(t[0],2));else{const e=Math.abs(t[1]-t[0]),i=Math.abs(n[1]-n[0]);o.push("Time"+r[0]),a.push(p.Wp.roundNumber(e,2)),o.push("Length"+r[1]),a.push(p.Wp.roundNumber(i,2))}}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(h,f,g),isLocked:c,isVisible:d}}};const ve=Ie,ye={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.debug("SegmentBidirectional tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:u,FrameOfReferenceUID:g}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:S,SeriesInstanceUID:I,StudyInstanceUID:v}=_(u,t,r);let y;y=S?t.getDisplaySetForSOPInstanceUID(S,I):t.getDisplaySetsForSeries(I)[0];const{points:f,textBox:h}=s.handles,w=function(e,t){const{metadata:n,data:o}=e,{cachedStats:a}=o,{referencedImageId:r}=n;if(!Object.keys(a).length)return[];const i=[];return Object.keys(a).forEach(n=>{const o=a[n],{SOPInstanceUID:s,SeriesInstanceUID:l,frameNumber:c}=_(r,t,e),d=t.getDisplaySetsForSeries(l)[0],{SeriesNumber:m}=d,{length:p,width:u,unit:g}=o;i.push({SeriesInstanceUID:l,SOPInstanceUID:s,SeriesNumber:m,frameNumber:c,unit:g,length:p,width:u})}),i}(r,t),E=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{length:o,width:a,unit:r,SeriesNumber:i,SOPInstanceUID:s,frameNumber:l}=e[0],c=p.Wp.roundNumber(o,2),d=p.Wp.roundNumber(a,2),m=t.instances.find(e=>e.SOPInstanceUID===s);let u;m&&(u=m.InstanceNumber);const g=u?` I: ${u}`:"",S=t.isMultiFrame?` F: ${l}`:"";return n.primary.push(`L: ${c} ${W(r)}`),n.primary.push(`W: ${d} ${W(r)}`),n.secondary.push(`S: ${i}${g}${S}`),n}(w,y);return{uid:l,SOPInstanceUID:S,FrameOfReferenceUID:g,points:f,textBox:h,isLocked:c,isVisible:d,metadata:i,referenceSeriesUID:I,referenceStudyUID:v,referencedImageId:u,frameNumber:w[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:y.displaySetInstanceUID,label:s.label,displayText:E,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:SegmentBidirectional"),e.forEach(e=>{const{length:t,width:n,unit:r}=e;o.push("Length","Width","Unit"),a.push(t,n,r)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(w,f,g)}}};const fe=ye,he={toAnnotation:e=>{},toMeasurement:(e,t,n,o,a)=>{const{annotation:r}=e,{metadata:i,data:s,annotationUID:l}=r,c=F(l),d=L(l);if(!i||!s)return console.warn("UltrasoundPleuraBLine tool: Missing metadata or data"),null;const{toolName:m,referencedImageId:p,FrameOfReferenceUID:u}=i;if(!x.includes(m))throw new Error("Tool not supported");const{SOPInstanceUID:g,SeriesInstanceUID:S,StudyInstanceUID:I}=_(p);let v;v=g?t.getDisplaySetForSOPInstanceUID(g,S):t.getDisplaySetsForSeries(S);const{points:y}=s.handles,f=function(e,t){const{metadata:n}=e,{annotationType:o}=e.data,{referencedImageId:a}=n,r=[];if(!a)throw new Error("Non-acquisition plane measurement mapping not supported");const{SOPInstanceUID:i,SeriesInstanceUID:s,frameNumber:l}=_(a),c=t.getDisplaySetForSOPInstanceUID(i,s,l),{SeriesNumber:d}=c;return r.push({SeriesInstanceUID:s,SOPInstanceUID:i,SeriesNumber:d,frameNumber:l,annotationType:o}),r}(r,t),h=function(e,t){const n={primary:[],secondary:[]};if(!e||!e.length)return n;const{annotationType:o,SeriesNumber:a,SOPInstanceUID:r,frameNumber:i}=e[0],s=t.instances.find(e=>e.SOPInstanceUID===r);let l;s&&(l=s.InstanceNumber);const c=l?` I: ${l}`:"",d=t.isMultiFrame?` F: ${i}`:"",m=`S: ${a}${c}${d}`;return n.primary.push(`Annotation : ${o}`),n.secondary.push(m),n}(f,v);return{uid:l,SOPInstanceUID:g,FrameOfReferenceUID:u,points:y,metadata:i,referenceSeriesUID:S,referenceStudyUID:I,frameNumber:f?.[0]?.frameNumber||1,toolName:i.toolName,displaySetInstanceUID:v.displaySetInstanceUID,label:s.label,displayText:h,data:s.cachedStats,type:o(m),getReport:()=>function(e,t,n){const o=[],a=[];o.push("AnnotationType"),a.push("Cornerstone:UltrasoundPleuraBLine"),e.forEach(e=>{const{annotationType:t}=e;o.push("AnnotationType"),a.push(t)}),n&&(o.push("FrameOfReferenceUID"),a.push(n));t&&(o.push("points"),a.push(t.map(e=>e.join(" ")).join(";")));return{columns:o,values:a}}(f,y,u),isLocked:c,isVisible:d}}};const we=he,Ee=(e,t,n,o)=>{const a=e=>{const{POLYLINE:t,ELLIPSE:n,CIRCLE:o,RECTANGLE:a,BIDIRECTIONAL:r,POINT:i,ANGLE:s}=p.C5.VALUE_TYPES;return{Length:t,EllipticalROI:n,CircleROI:o,RectangleROI:a,PlanarFreehandROI:t,Bidirectional:r,ArrowAnnotate:i,CobbAngle:s,Angle:s,SplineROI:t,LivewireContour:t,Probe:i,UltrasoundDirectional:t,SegmentBidirectional:r}[e]};return{Length:{toAnnotation:G.toAnnotation,toMeasurement:e=>G.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},Bidirectional:{toAnnotation:q.toAnnotation,toMeasurement:e=>q.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2},{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},SegmentBidirectional:{toAnnotation:fe.toAnnotation,toMeasurement:e=>fe.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2},{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},EllipticalROI:{toAnnotation:K.toAnnotation,toMeasurement:e=>K.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ELLIPSE}]},CircleROI:{toAnnotation:Z.toAnnotation,toMeasurement:e=>Z.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.CIRCLE}]},RectangleROI:{toAnnotation:le.toAnnotation,toMeasurement:e=>le.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},PlanarFreehandROI:{toAnnotation:ie.toAnnotation,toMeasurement:e=>ie.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},SplineROI:{toAnnotation:de.toAnnotation,toMeasurement:e=>de.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},LivewireContour:{toAnnotation:ue.toAnnotation,toMeasurement:e=>ue.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE}]},ArrowAnnotate:{toAnnotation:ee.toAnnotation,toMeasurement:e=>ee.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POINT,points:1}]},Probe:{toAnnotation:Se.toAnnotation,toMeasurement:e=>Se.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POINT,points:1}]},CobbAngle:{toAnnotation:ne.toAnnotation,toMeasurement:e=>ne.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ANGLE}]},Angle:{toAnnotation:ae.toAnnotation,toMeasurement:e=>ae.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.ANGLE}]},UltrasoundDirectional:{toAnnotation:ve.toAnnotation,toMeasurement:e=>ve.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]},UltrasoundPleuraBLine:{toAnnotation:we.toAnnotation,toMeasurement:e=>we.toMeasurement(e,t,n,a,o),matchingCriteria:[{valueType:p.C5.VALUE_TYPES.POLYLINE,points:2}]}}};var be=n(53860);const{rM:De,yK:Te}=o,{removeAnnotation:Ce}=l.annotation.state,Oe=l.Enums.Events,Ne=({commandsManager:e,servicesManager:t,extensionManager:n})=>{const{measurementService:o,displaySetService:a,cornerstoneViewportService:r,customizationService:i}=t.services,l=((e,t,n,o)=>{const{Length:a,Bidirectional:r,EllipticalROI:i,CircleROI:s,ArrowAnnotate:l,Angle:c,CobbAngle:d,RectangleROI:m,PlanarFreehandROI:p,SplineROI:u,LivewireContour:g,Probe:S,UltrasoundDirectional:I,UltrasoundPleuraBLine:v,SegmentBidirectional:y}=Ee(e,t,n,o),f=e.createSource(De,Te);return e.addMapping(f,"Length",a.matchingCriteria,a.toAnnotation,a.toMeasurement),e.addMapping(f,"Crosshairs",a.matchingCriteria,()=>null,()=>null),e.addMapping(f,"Bidirectional",r.matchingCriteria,r.toAnnotation,r.toMeasurement),e.addMapping(f,"EllipticalROI",i.matchingCriteria,i.toAnnotation,i.toMeasurement),e.addMapping(f,"CircleROI",s.matchingCriteria,s.toAnnotation,s.toMeasurement),e.addMapping(f,"ArrowAnnotate",l.matchingCriteria,l.toAnnotation,l.toMeasurement),e.addMapping(f,"CobbAngle",d.matchingCriteria,d.toAnnotation,d.toMeasurement),e.addMapping(f,"Angle",c.matchingCriteria,c.toAnnotation,c.toMeasurement),e.addMapping(f,"RectangleROI",m.matchingCriteria,m.toAnnotation,m.toMeasurement),e.addMapping(f,"PlanarFreehandROI",p.matchingCriteria,p.toAnnotation,p.toMeasurement),e.addMapping(f,"SplineROI",u.matchingCriteria,u.toAnnotation,u.toMeasurement),e.addMapping(f,"CalibrationLine",a.matchingCriteria,a.toAnnotation,a.toMeasurement),e.addMapping(f,"LivewireContour",g.matchingCriteria,g.toAnnotation,g.toMeasurement),e.addMapping(f,"Probe",S.matchingCriteria,S.toAnnotation,S.toMeasurement),e.addMapping(f,"UltrasoundDirectionalTool",I.matchingCriteria,I.toAnnotation,I.toMeasurement),e.addMapping(f,"UltrasoundPleuraBLineTool",v.matchingCriteria,v.toAnnotation,v.toMeasurement),e.addMapping(f,"SegmentBidirectional",y.matchingCriteria,y.toAnnotation,y.toMeasurement),f})(o,a,r,i);Me({servicesManager:t,commandsManager:e,extensionManager:n});const{annotationToMeasurement:c,remove:d}=l;function m(e){try{const n=e.detail,{annotation:{metadata:o,annotationUID:a}}=n,{toolName:i}=o;e.type===g&&i===A.CalibrationLine?C(t,e).then(()=>{console.log("Calibration applied.")},()=>!0).finally(()=>{Ce(a),p(e),r.resize()}):(n.uid=a,c(i,n))}catch(e){console.warn("Failed to add measurement:",e)}}function p(e){try{const t=e.detail,{annotation:{annotationUID:n}}=t;o.getMeasurement(n)&&d(n,t)}catch(e){console.warn("Failed to remove measurement:",e)}}const u=Oe.ANNOTATION_ADDED,g=Oe.ANNOTATION_COMPLETED,S=Oe.ANNOTATION_MODIFIED,I=Oe.ANNOTATION_REMOVED,v=Oe.ANNOTATION_SELECTION_CHANGE;return s.eventTarget.addEventListener(u,m),s.eventTarget.addEventListener(g,m),s.eventTarget.addEventListener(S,function(e){try{const t=e.detail,{annotation:{metadata:n,annotationUID:a}}=t;if(!o.getMeasurement(a))return;const{toolName:r}=n;t.uid=a,c(r,t,!0)}catch(e){console.warn("Failed to update measurement:",e)}}),s.eventTarget.addEventListener(I,p),s.eventTarget.addEventListener(v,function(e){try{const t=e.detail,{added:n,removed:a}=t;a&&a.forEach(e=>o.setMeasurementSelected(e,!1)),n&&n.forEach(e=>o.setMeasurementSelected(e,!0))}catch(e){console.warn("Failed to select/unselect measurements:",e)}}),l},Me=({servicesManager:e,commandsManager:t,extensionManager:n})=>{const{measurementService:o,cornerstoneViewportService:a,viewportGridService:r}=e.services,{MEASUREMENT_REMOVED:i,MEASUREMENTS_CLEARED:s,MEASUREMENT_UPDATED:c,RAW_MEASUREMENT_ADDED:d}=o.EVENTS;o.subscribe(s,({measurements:e})=>{if(Object.keys(e).length){t.run("startRecordingForAnnotationGroup");for(const n of Object.values(e)){const{uid:e,source:o}=n;if(o.name!==De)continue;const a=l.annotation.state.getAnnotation(e);Ce(e),t.run("triggerCreateAnnotationMemo",{annotation:a,FrameOfReferenceUID:a.metadata.FrameOfReferenceUID,options:{deleting:!0}})}t.run("endRecordingForAnnotationGroup"),a.getRenderingEngine().render()}}),o.subscribe(c,({source:e,measurement:t,notYetUpdatedAtSource:n})=>{if(!e)return;if(e.name!==De)return;if(!1===n)return;const{uid:o,label:i,isLocked:s,isVisible:c}=t,d=l.annotation.state.getAnnotation(o),{data:m,metadata:p}=d;if(!m)return;if(m.label!==i){const e=E(r)?.viewport.element;(0,be.setAnnotationLabel)(d,e,i)}l.annotation.locking.setAnnotationLocked(o,s),l.annotation.visibility.setAnnotationVisibility(o,c);const u=a.getRenderingEngine().getViewports().map(e=>e.id);(0,be.triggerAnnotationRenderForViewportIds)(u)}),o.subscribe(d,({source:e,measurement:n,data:o,dataSource:a})=>{if(e.name!==De)return;const{referenceSeriesUID:r,referenceStudyUID:i,SOPInstanceUID:s,metadata:c}=n,d=p.H8.getInstance(i,r,s);let m,u=1;n?.metadata?.referencedImageId?(m=n.metadata.referencedImageId,u=_(n.metadata.referencedImageId).frameNumber):d&&(m=a.getImageIdsForInstance({instance:d}));const g=l.annotation.state.getAnnotationManager(),S={annotationUID:n.uid,highlighted:!1,isLocked:!1,invalidated:!0,metadata:{...c,toolName:n.toolName,FrameOfReferenceUID:n.FrameOfReferenceUID,referencedImageId:m},data:{...o.annotation.data||{},text:o.annotation.data.text,handles:{...o.annotation.data.handles},cachedStats:{...o.annotation.data.cachedStats},label:o.annotation.data.label,frameNumber:u}};g.addAnnotation(S),t.run("triggerCreateAnnotationMemo",{annotation:S,FrameOfReferenceUID:S.metadata.FrameOfReferenceUID,options:{newAnnotation:!0}})}),o.subscribe(i,({source:e,measurement:n})=>{if(e?.name&&e.name!==De)return;const o=l.annotation.state.getAnnotation(n);Ce(n),t.run("triggerCreateAnnotationMemo",{annotation:o,FrameOfReferenceUID:o.metadata.FrameOfReferenceUID,options:{deleting:!0}});a.getRenderingEngine().render()})};function Ve(e,t){const{viewportGridService:n,cornerstoneViewportService:o}=e.services,{viewports:a}=n.getState(),r=a.get(t);if("volume"!==r?.viewportOptions?.viewportType)return[];const i=o.getCornerstoneViewport(t),l=i?function(e){const t=e.getAllVolumeIds().map(e=>s.cache.getVolume(e));return t.find(e=>e.isDynamicVolume())??t[0]}(i):null;if(!l?.isDynamicVolume())return[];const{volumeId:c}=l;return Array.from(a.values()).filter(({viewportId:e})=>{const n=o.getCornerstoneViewport(e);return e!==t&&n?.hasVolumeId?.(c)}).map(({viewportId:e})=>({viewportId:e}))}const Re=function(e){const{cineService:t}=e.services;t.setServiceImplementation({getSyncedViewports:t=>Ve(e,t),playClip:(e,t)=>l.utilities.cine.playClip(e,t),stopClip:(e,t)=>l.utilities.cine.stopClip(e,t)})};const Ue=function(e){const{studyPrefetcherService:t}=e.services;t.requestType=s.Enums.RequestType.Prefetch,t.imageLoadPoolManager=s.imageLoadPoolManager,t.imageLoader=s.imageLoader,t.cache={isImageCached:e=>!!s.cache.getImageLoadObject(e)},t.imageLoadEventsManager={addEventListeners:(e,t)=>(s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOADED,e),s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_FAILED,t),[{unsubscribe:()=>s.eventTarget.removeEventListener(s.EVENTS.IMAGE_LOADED,e)},{unsubscribe:()=>s.eventTarget.removeEventListener(s.EVENTS.IMAGE_LOAD_FAILED,t)}])}};var Ae=n(19863),xe=n.n(Ae),Pe=n(15257),Fe=n.n(Pe),Le=n(6446),_e=n.n(Le);const ke=new Map,Ge=new Map;function ze({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n,viewportMatchDetails:o}){Ge.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return;if(!ke.has(t)){const{metadata:e}=n;ke.set(t,e.SeriesInstanceUID)}}const a=new Set;Ge.forEach((e,t)=>{e.forEach(e=>{const{volumeId:t}=e;a.add(t)})});const r=new Set;if(o.forEach(e=>{const{displaySetsInfo:t}=e;t.forEach(({displaySetInstanceUID:e})=>{r.add(e)})}),a.size!==r.size)return;const i=Array.from(ke.keys()).slice().map(e=>s.cache.getVolume(e)),l=[];i.forEach(e=>{const t=e.getImageLoadRequests?.()??[];if(!t.length||!t[0]||!t[0].imageId)return;const n=function(e){if(0===e.length)return[];if(1===e.length)return[{imageId:e[0],imageIdIndex:0}];const t=e.length-1,n=Math.floor(e.length/2);let o=n,a=n;const r=[{imageId:e[n],imageIdIndex:n}],i={currentPositionDownToMinimum:!1,currentPositionUpToMaximum:!1};for(0===n?i.currentPositionDownToMinimum=!0:n===t&&(i.currentPositionUpToMaximum=!0);!i.currentPositionDownToMinimum||!i.currentPositionUpToMaximum;)i.currentPositionDownToMinimum||(o--,r.push({imageId:e[o],imageIdIndex:o}),0===o&&(i.currentPositionDownToMinimum=!0)),i.currentPositionUpToMaximum||(a++,r.push({imageId:e[a],imageIdIndex:a}),a===t&&(i.currentPositionUpToMaximum=!0));return r}(t.map(e=>e.imageId)).map(({imageId:e})=>t.find(t=>t.imageId===e));l.push(n)});const c=Fe()(_e()(xe()(...l))),d=[];c.forEach(e=>{const{imageId:t}=e;l.forEach(e=>{const n=e.find(e=>e.imageId===t);n&&d.push(n)})});const m=s.Enums.RequestType.Prefetch;d.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:a})=>{const r=e.bind(null,n,o,a);s.imageLoadPoolManager.addRequest(r,m,t,0)}),ke.clear();const p=new Map(Ge);return Ge.clear(),p}const Be=new Map,$e=new Map;function je({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n}){$e.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return void console.log("interleaveNthLoader::No volume, can't load it");if(!Be.has(t)){const{metadata:e}=n;Be.set(t,e.SeriesInstanceUID)}}const o=function(e){if(!e||!e.length)return[];if(1===e.length)return e[0];const t=[...e],n=[];for(let e=0;t.length>0;e++)for(let o=0;o<t.length;o++){const a=t[o];e>=a.length?(t.splice(o,1),o--):n.push(a[e])}return n}(Array.from(Be.keys()).slice().map(e=>s.cache.getVolume(e)).map(e=>e.getImageLoadRequests?.()??[]).filter(e=>e?.[0]?.imageId).map(e=>function(e){const t=[[],[],[],[],[]],n=e.length/2-3,o=n+6;for(let a=0;a<e.length;a++)a<2||a>e.length-4||a>n&&a<o?t[0].push(e[a]):a%7==2?t[1].push(e[a]):a%7==5?t[2].push(e[a]):t[a%2+3].push(e[a]);return[...t[0],...t[1],...t[2],...t[3],...t[4]]}(e))),a=s.Enums.RequestType.Prefetch;o.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:r})=>{const i=e.bind(null,n,o,r);s.imageLoadPoolManager.addRequest(i,a,t,0)}),Be.clear();const r=new Map($e);return $e.clear(),r}const We=new Map,He=new Map;function qe({data:{viewportId:e,volumeInputArray:t},displaySetsMatchDetails:n,viewportMatchDetails:o}){He.set(e,t);for(const e of t){const{volumeId:t}=e,n=s.cache.getVolume(t);if(!n)return;if(!We.has(t)){const{metadata:e}=n;We.set(t,e.SeriesInstanceUID)}}const a=new Set;He.forEach((e,t)=>{e.forEach(e=>{const{volumeId:t}=e;a.add(t)})});const r=new Set;if(o.forEach(e=>{const{displaySetsInfo:t}=e;t.forEach(({displaySetInstanceUID:e})=>{r.add(e)})}),a.size!==r.size)return;const i=Array.from(We.keys()).slice().map(e=>s.cache.getVolume(e)),l=[];i.forEach(e=>{const t=e.getImageLoadRequests?.()??[];t?.[0]?.imageId&&l.push(t.reverse())});const c=Fe()(_e()(xe()(...l))),d=[];c.forEach(e=>{const{imageId:t}=e;l.forEach(e=>{const n=e.find(e=>e.imageId===t);n&&d.push(n)})});const m=s.Enums.RequestType.Prefetch;d.forEach(({callLoadImage:e,additionalDetails:t,imageId:n,imageIdIndex:o,options:a})=>{const r=e.bind(null,n,o,a);s.imageLoadPoolManager.addRequest(r,m,t,0)}),We.clear();const p=new Map(He);return He.clear(),p}const Ye=(e,t)=>{if(!t?.detail)return;const{element:n,currentPoints:o}=t.detail;return e.runCommand("getNearbyAnnotation",{element:n,canvasCoordinates:o?.canvas},"CORNERSTONE")},Je=l.Enums.Events;const Ke=function({cornerstoneViewportService:e,customizationService:t,commandsManager:n}){const o=e=>{const o=function(e){const t=e.detail.event.which,n=[];return e.detail.event.altKey&&n.push("alt"),e.detail.event.ctrlKey&&n.push("ctrl"),e.detail.event.shiftKey&&n.push("shift"),n.push("button"),n.push(t),n.join("")}(e);((e,o)=>{const a=t.getCustomization("cornerstoneViewportClickCommands")[e];if(!a)return;let r=null;a.some(e=>e.commandOptions?.requireNearbyToolData)&&(r=Ye(n,o));const i={nearbyToolData:r,event:o};n.run(a,i)})(o,e)};s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(t){const{viewportId:n,element:a}=t.detail;e.getViewportInfo(n)&&((0,h.ye)(n,a),a.addEventListener(Je.MOUSE_CLICK,o))}.bind(null)),s.eventTarget.addEventListener(s.EVENTS.ELEMENT_DISABLED,function(e){const{element:t}=e.detail;t.removeEventListener(Je.MOUSE_CLICK,o)}.bind(null))},Qe=l.Enums.Events;const Ze=function({customizationService:e,commandsManager:t}){const n=n=>{if(Ye(t,n))return;const o=function(e){const t=[];return e.detail.event.altKey&&t.push("alt"),e.detail.event.ctrlKey&&t.push("ctrl"),e.detail.event.shiftKey&&t.push("shift"),t.push("doubleClick"),t.join("")}(n),a=e.getCustomization("cornerstoneViewportClickCommands")[o];a&&t.run(a)};s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(e){const{element:t}=e.detail;t.addEventListener(Qe.MOUSE_DOUBLE_CLICK,n)}.bind(null)),s.eventTarget.addEventListener(s.EVENTS.ELEMENT_DISABLED,function(e){const{element:t}=e.detail;t.removeEventListener(Qe.MOUSE_DOUBLE_CLICK,n)}.bind(null))},Xe=[],et={viewportsWaiting:0};function tt(e){if("preRender"===e.detail.viewportStatus)return;const{W:t}=p.fX;p.Rm.timeEnd(t.DISPLAY_SETS_TO_FIRST_IMAGE),p.Rm.timeEnd(t.STUDY_TO_FIRST_IMAGE),p.Rm.timeEnd(t.SCRIPT_TO_VIEW),et.viewportsWaiting-=1,e.detail.element.removeEventListener(s.EVENTS.IMAGE_RENDERED,tt),et.viewportsWaiting||p.Rm.timeEnd(t.DISPLAY_SETS_TO_ALL_IMAGES)}const nt=[{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1],description:"Grayscale"},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0],description:"X Ray"},{ColorSpace:"RGB",Name:"Isodose",NanColor:[1,0,0],RGBPoints:[0,0,1,0,.1,.5,1,0,.2,1,1,0,.3,1,.66,0,.4,1,.33,0,.5,1,0,0],description:"Isodose"},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0],description:"HSV"},{ColorSpace:"RGB",Name:"hot_iron",RGBPoints:[0,.0039215686,.0039215686,.0156862745,.00392156862745098,.0039215686,.0039215686,.0156862745,.00784313725490196,.0039215686,.0039215686,.031372549,.011764705882352941,.0039215686,.0039215686,.0470588235,.01568627450980392,.0039215686,.0039215686,.062745098,.0196078431372549,.0039215686,.0039215686,.0784313725,.023529411764705882,.0039215686,.0039215686,.0941176471,.027450980392156862,.0039215686,.0039215686,.1098039216,.03137254901960784,.0039215686,.0039215686,.1254901961,.03529411764705882,.0039215686,.0039215686,.1411764706,.0392156862745098,.0039215686,.0039215686,.1568627451,.043137254901960784,.0039215686,.0039215686,.1725490196,.047058823529411764,.0039215686,.0039215686,.1882352941,.050980392156862744,.0039215686,.0039215686,.2039215686,.054901960784313725,.0039215686,.0039215686,.2196078431,.05882352941176471,.0039215686,.0039215686,.2352941176,.06274509803921569,.0039215686,.0039215686,.2509803922,.06666666666666667,.0039215686,.0039215686,.262745098,.07058823529411765,.0039215686,.0039215686,.2784313725,.07450980392156863,.0039215686,.0039215686,.2941176471,.0784313725490196,.0039215686,.0039215686,.3098039216,.08235294117647059,.0039215686,.0039215686,.3254901961,.08627450980392157,.0039215686,.0039215686,.3411764706,.09019607843137255,.0039215686,.0039215686,.3568627451,.09411764705882353,.0039215686,.0039215686,.3725490196,.09803921568627451,.0039215686,.0039215686,.3882352941,.10196078431372549,.0039215686,.0039215686,.4039215686,.10588235294117647,.0039215686,.0039215686,.4196078431,.10980392156862745,.0039215686,.0039215686,.4352941176,.11372549019607843,.0039215686,.0039215686,.4509803922,.11764705882352942,.0039215686,.0039215686,.4666666667,.12156862745098039,.0039215686,.0039215686,.4823529412,.12549019607843137,.0039215686,.0039215686,.4980392157,.12941176470588237,.0039215686,.0039215686,.5137254902,.13333333333333333,.0039215686,.0039215686,.5294117647,.13725490196078433,.0039215686,.0039215686,.5450980392,.1411764705882353,.0039215686,.0039215686,.5607843137,.1450980392156863,.0039215686,.0039215686,.5764705882,.14901960784313725,.0039215686,.0039215686,.5921568627,.15294117647058825,.0039215686,.0039215686,.6078431373,.1568627450980392,.0039215686,.0039215686,.6235294118,.1607843137254902,.0039215686,.0039215686,.6392156863,.16470588235294117,.0039215686,.0039215686,.6549019608,.16862745098039217,.0039215686,.0039215686,.6705882353,.17254901960784313,.0039215686,.0039215686,.6862745098,.17647058823529413,.0039215686,.0039215686,.7019607843,.1803921568627451,.0039215686,.0039215686,.7176470588,.1843137254901961,.0039215686,.0039215686,.7333333333,.18823529411764706,.0039215686,.0039215686,.7490196078,.19215686274509805,.0039215686,.0039215686,.7607843137,.19607843137254902,.0039215686,.0039215686,.7764705882,.2,.0039215686,.0039215686,.7921568627,.20392156862745098,.0039215686,.0039215686,.8078431373,.20784313725490197,.0039215686,.0039215686,.8235294118,.21176470588235294,.0039215686,.0039215686,.8392156863,.21568627450980393,.0039215686,.0039215686,.8549019608,.2196078431372549,.0039215686,.0039215686,.8705882353,.2235294117647059,.0039215686,.0039215686,.8862745098,.22745098039215686,.0039215686,.0039215686,.9019607843,.23137254901960785,.0039215686,.0039215686,.9176470588,.23529411764705885,.0039215686,.0039215686,.9333333333,.23921568627450984,.0039215686,.0039215686,.9490196078,.24313725490196078,.0039215686,.0039215686,.9647058824,.24705882352941178,.0039215686,.0039215686,.9803921569,.25098039215686274,.0039215686,.0039215686,.9960784314,.2549019607843137,.0039215686,.0039215686,.9960784314,.25882352941176473,.0156862745,.0039215686,.9803921569,.2627450980392157,.031372549,.0039215686,.9647058824,.26666666666666666,.0470588235,.0039215686,.9490196078,.27058823529411763,.062745098,.0039215686,.9333333333,.27450980392156865,.0784313725,.0039215686,.9176470588,.2784313725490196,.0941176471,.0039215686,.9019607843,.2823529411764706,.1098039216,.0039215686,.8862745098,.28627450980392155,.1254901961,.0039215686,.8705882353,.2901960784313726,.1411764706,.0039215686,.8549019608,.29411764705882354,.1568627451,.0039215686,.8392156863,.2980392156862745,.1725490196,.0039215686,.8235294118,.30196078431372547,.1882352941,.0039215686,.8078431373,.3058823529411765,.2039215686,.0039215686,.7921568627,.30980392156862746,.2196078431,.0039215686,.7764705882,.3137254901960784,.2352941176,.0039215686,.7607843137,.3176470588235294,.2509803922,.0039215686,.7490196078,.3215686274509804,.262745098,.0039215686,.7333333333,.3254901960784314,.2784313725,.0039215686,.7176470588,.32941176470588235,.2941176471,.0039215686,.7019607843,.3333333333333333,.3098039216,.0039215686,.6862745098,.33725490196078434,.3254901961,.0039215686,.6705882353,.3411764705882353,.3411764706,.0039215686,.6549019608,.34509803921568627,.3568627451,.0039215686,.6392156863,.34901960784313724,.3725490196,.0039215686,.6235294118,.35294117647058826,.3882352941,.0039215686,.6078431373,.3568627450980392,.4039215686,.0039215686,.5921568627,.3607843137254902,.4196078431,.0039215686,.5764705882,.36470588235294116,.4352941176,.0039215686,.5607843137,.3686274509803922,.4509803922,.0039215686,.5450980392,.37254901960784315,.4666666667,.0039215686,.5294117647,.3764705882352941,.4823529412,.0039215686,.5137254902,.3803921568627451,.4980392157,.0039215686,.4980392157,.3843137254901961,.5137254902,.0039215686,.4823529412,.38823529411764707,.5294117647,.0039215686,.4666666667,.39215686274509803,.5450980392,.0039215686,.4509803922,.396078431372549,.5607843137,.0039215686,.4352941176,.4,.5764705882,.0039215686,.4196078431,.403921568627451,.5921568627,.0039215686,.4039215686,.40784313725490196,.6078431373,.0039215686,.3882352941,.4117647058823529,.6235294118,.0039215686,.3725490196,.41568627450980394,.6392156863,.0039215686,.3568627451,.4196078431372549,.6549019608,.0039215686,.3411764706,.4235294117647059,.6705882353,.0039215686,.3254901961,.42745098039215684,.6862745098,.0039215686,.3098039216,.43137254901960786,.7019607843,.0039215686,.2941176471,.43529411764705883,.7176470588,.0039215686,.2784313725,.4392156862745098,.7333333333,.0039215686,.262745098,.44313725490196076,.7490196078,.0039215686,.2509803922,.4470588235294118,.7607843137,.0039215686,.2352941176,.45098039215686275,.7764705882,.0039215686,.2196078431,.4549019607843137,.7921568627,.0039215686,.2039215686,.4588235294117647,.8078431373,.0039215686,.1882352941,.4627450980392157,.8235294118,.0039215686,.1725490196,.4666666666666667,.8392156863,.0039215686,.1568627451,.4705882352941177,.8549019608,.0039215686,.1411764706,.4745098039215686,.8705882353,.0039215686,.1254901961,.4784313725490197,.8862745098,.0039215686,.1098039216,.48235294117647065,.9019607843,.0039215686,.0941176471,.48627450980392156,.9176470588,.0039215686,.0784313725,.49019607843137253,.9333333333,.0039215686,.062745098,.49411764705882355,.9490196078,.0039215686,.0470588235,.4980392156862745,.9647058824,.0039215686,.031372549,.5019607843137255,.9803921569,.0039215686,.0156862745,.5058823529411764,.9960784314,.0039215686,.0039215686,.5098039215686274,.9960784314,.0156862745,.0039215686,.5137254901960784,.9960784314,.031372549,.0039215686,.5176470588235295,.9960784314,.0470588235,.0039215686,.5215686274509804,.9960784314,.062745098,.0039215686,.5254901960784314,.9960784314,.0784313725,.0039215686,.5294117647058824,.9960784314,.0941176471,.0039215686,.5333333333333333,.9960784314,.1098039216,.0039215686,.5372549019607843,.9960784314,.1254901961,.0039215686,.5411764705882353,.9960784314,.1411764706,.0039215686,.5450980392156862,.9960784314,.1568627451,.0039215686,.5490196078431373,.9960784314,.1725490196,.0039215686,.5529411764705883,.9960784314,.1882352941,.0039215686,.5568627450980392,.9960784314,.2039215686,.0039215686,.5607843137254902,.9960784314,.2196078431,.0039215686,.5647058823529412,.9960784314,.2352941176,.0039215686,.5686274509803921,.9960784314,.2509803922,.0039215686,.5725490196078431,.9960784314,.262745098,.0039215686,.5764705882352941,.9960784314,.2784313725,.0039215686,.5803921568627451,.9960784314,.2941176471,.0039215686,.5843137254901961,.9960784314,.3098039216,.0039215686,.5882352941176471,.9960784314,.3254901961,.0039215686,.592156862745098,.9960784314,.3411764706,.0039215686,.596078431372549,.9960784314,.3568627451,.0039215686,.6,.9960784314,.3725490196,.0039215686,.6039215686274509,.9960784314,.3882352941,.0039215686,.6078431372549019,.9960784314,.4039215686,.0039215686,.611764705882353,.9960784314,.4196078431,.0039215686,.615686274509804,.9960784314,.4352941176,.0039215686,.6196078431372549,.9960784314,.4509803922,.0039215686,.6235294117647059,.9960784314,.4666666667,.0039215686,.6274509803921569,.9960784314,.4823529412,.0039215686,.6313725490196078,.9960784314,.4980392157,.0039215686,.6352941176470588,.9960784314,.5137254902,.0039215686,.6392156862745098,.9960784314,.5294117647,.0039215686,.6431372549019608,.9960784314,.5450980392,.0039215686,.6470588235294118,.9960784314,.5607843137,.0039215686,.6509803921568628,.9960784314,.5764705882,.0039215686,.6549019607843137,.9960784314,.5921568627,.0039215686,.6588235294117647,.9960784314,.6078431373,.0039215686,.6627450980392157,.9960784314,.6235294118,.0039215686,.6666666666666666,.9960784314,.6392156863,.0039215686,.6705882352941176,.9960784314,.6549019608,.0039215686,.6745098039215687,.9960784314,.6705882353,.0039215686,.6784313725490196,.9960784314,.6862745098,.0039215686,.6823529411764706,.9960784314,.7019607843,.0039215686,.6862745098039216,.9960784314,.7176470588,.0039215686,.6901960784313725,.9960784314,.7333333333,.0039215686,.6941176470588235,.9960784314,.7490196078,.0039215686,.6980392156862745,.9960784314,.7607843137,.0039215686,.7019607843137254,.9960784314,.7764705882,.0039215686,.7058823529411765,.9960784314,.7921568627,.0039215686,.7098039215686275,.9960784314,.8078431373,.0039215686,.7137254901960784,.9960784314,.8235294118,.0039215686,.7176470588235294,.9960784314,.8392156863,.0039215686,.7215686274509804,.9960784314,.8549019608,.0039215686,.7254901960784313,.9960784314,.8705882353,.0039215686,.7294117647058823,.9960784314,.8862745098,.0039215686,.7333333333333333,.9960784314,.9019607843,.0039215686,.7372549019607844,.9960784314,.9176470588,.0039215686,.7411764705882353,.9960784314,.9333333333,.0039215686,.7450980392156863,.9960784314,.9490196078,.0039215686,.7490196078431373,.9960784314,.9647058824,.0039215686,.7529411764705882,.9960784314,.9803921569,.0039215686,.7568627450980392,.9960784314,.9960784314,.0039215686,.7607843137254902,.9960784314,.9960784314,.0196078431,.7647058823529411,.9960784314,.9960784314,.0352941176,.7686274509803922,.9960784314,.9960784314,.0509803922,.7725490196078432,.9960784314,.9960784314,.0666666667,.7764705882352941,.9960784314,.9960784314,.0823529412,.7803921568627451,.9960784314,.9960784314,.0980392157,.7843137254901961,.9960784314,.9960784314,.1137254902,.788235294117647,.9960784314,.9960784314,.1294117647,.792156862745098,.9960784314,.9960784314,.1450980392,.796078431372549,.9960784314,.9960784314,.1607843137,.8,.9960784314,.9960784314,.1764705882,.803921568627451,.9960784314,.9960784314,.1921568627,.807843137254902,.9960784314,.9960784314,.2078431373,.8117647058823529,.9960784314,.9960784314,.2235294118,.8156862745098039,.9960784314,.9960784314,.2392156863,.8196078431372549,.9960784314,.9960784314,.2509803922,.8235294117647058,.9960784314,.9960784314,.2666666667,.8274509803921568,.9960784314,.9960784314,.2823529412,.8313725490196079,.9960784314,.9960784314,.2980392157,.8352941176470589,.9960784314,.9960784314,.3137254902,.8392156862745098,.9960784314,.9960784314,.3333333333,.8431372549019608,.9960784314,.9960784314,.3490196078,.8470588235294118,.9960784314,.9960784314,.3647058824,.8509803921568627,.9960784314,.9960784314,.3803921569,.8549019607843137,.9960784314,.9960784314,.3960784314,.8588235294117647,.9960784314,.9960784314,.4117647059,.8627450980392157,.9960784314,.9960784314,.4274509804,.8666666666666667,.9960784314,.9960784314,.4431372549,.8705882352941177,.9960784314,.9960784314,.4588235294,.8745098039215686,.9960784314,.9960784314,.4745098039,.8784313725490196,.9960784314,.9960784314,.4901960784,.8823529411764706,.9960784314,.9960784314,.5058823529,.8862745098039215,.9960784314,.9960784314,.5215686275,.8901960784313725,.9960784314,.9960784314,.537254902,.8941176470588236,.9960784314,.9960784314,.5529411765,.8980392156862745,.9960784314,.9960784314,.568627451,.9019607843137255,.9960784314,.9960784314,.5843137255,.9058823529411765,.9960784314,.9960784314,.6,.9098039215686274,.9960784314,.9960784314,.6156862745,.9137254901960784,.9960784314,.9960784314,.631372549,.9176470588235294,.9960784314,.9960784314,.6470588235,.9215686274509803,.9960784314,.9960784314,.6666666667,.9254901960784314,.9960784314,.9960784314,.6823529412,.9294117647058824,.9960784314,.9960784314,.6980392157,.9333333333333333,.9960784314,.9960784314,.7137254902,.9372549019607843,.9960784314,.9960784314,.7294117647,.9411764705882354,.9960784314,.9960784314,.7450980392,.9450980392156864,.9960784314,.9960784314,.7568627451,.9490196078431372,.9960784314,.9960784314,.7725490196,.9529411764705882,.9960784314,.9960784314,.7882352941,.9568627450980394,.9960784314,.9960784314,.8039215686,.9607843137254903,.9960784314,.9960784314,.8196078431,.9647058823529413,.9960784314,.9960784314,.8352941176,.9686274509803922,.9960784314,.9960784314,.8509803922,.9725490196078431,.9960784314,.9960784314,.8666666667,.9764705882352941,.9960784314,.9960784314,.8823529412,.9803921568627451,.9960784314,.9960784314,.8980392157,.984313725490196,.9960784314,.9960784314,.9137254902,.9882352941176471,.9960784314,.9960784314,.9294117647,.9921568627450981,.9960784314,.9960784314,.9450980392,.996078431372549,.9960784314,.9960784314,.9607843137,1,.9960784314,.9960784314,.9607843137],description:"Hot Iron"},{ColorSpace:"RGB",Name:"red_hot",RGBPoints:[0,0,0,0,.00392156862745098,0,0,0,.00784313725490196,0,0,0,.011764705882352941,0,0,0,.01568627450980392,.0039215686,.0039215686,.0039215686,.0196078431372549,.0039215686,.0039215686,.0039215686,.023529411764705882,.0039215686,.0039215686,.0039215686,.027450980392156862,.0039215686,.0039215686,.0039215686,.03137254901960784,.0039215686,.0039215686,.0039215686,.03529411764705882,.0156862745,0,0,.0392156862745098,.0274509804,0,0,.043137254901960784,.0392156863,0,0,.047058823529411764,.0509803922,0,0,.050980392156862744,.062745098,0,0,.054901960784313725,.0784313725,0,0,.05882352941176471,.0901960784,0,0,.06274509803921569,.1058823529,0,0,.06666666666666667,.1176470588,0,0,.07058823529411765,.1294117647,0,0,.07450980392156863,.1411764706,0,0,.0784313725490196,.1529411765,0,0,.08235294117647059,.1647058824,0,0,.08627450980392157,.1764705882,0,0,.09019607843137255,.1882352941,0,0,.09411764705882353,.2039215686,0,0,.09803921568627451,.2156862745,0,0,.10196078431372549,.2274509804,0,0,.10588235294117647,.2392156863,0,0,.10980392156862745,.2549019608,0,0,.11372549019607843,.2666666667,0,0,.11764705882352942,.2784313725,0,0,.12156862745098039,.2901960784,0,0,.12549019607843137,.3058823529,0,0,.12941176470588237,.3176470588,0,0,.13333333333333333,.3294117647,0,0,.13725490196078433,.3411764706,0,0,.1411764705882353,.3529411765,0,0,.1450980392156863,.3647058824,0,0,.14901960784313725,.3764705882,0,0,.15294117647058825,.3882352941,0,0,.1568627450980392,.4039215686,0,0,.1607843137254902,.4156862745,0,0,.16470588235294117,.431372549,0,0,.16862745098039217,.4431372549,0,0,.17254901960784313,.4588235294,0,0,.17647058823529413,.4705882353,0,0,.1803921568627451,.4823529412,0,0,.1843137254901961,.4941176471,0,0,.18823529411764706,.5098039216,0,0,.19215686274509805,.5215686275,0,0,.19607843137254902,.5333333333,0,0,.2,.5450980392,0,0,.20392156862745098,.5568627451,0,0,.20784313725490197,.568627451,0,0,.21176470588235294,.5803921569,0,0,.21568627450980393,.5921568627,0,0,.2196078431372549,.6078431373,0,0,.2235294117647059,.6196078431,0,0,.22745098039215686,.631372549,0,0,.23137254901960785,.6431372549,0,0,.23529411764705885,.6588235294,0,0,.23921568627450984,.6705882353,0,0,.24313725490196078,.6823529412,0,0,.24705882352941178,.6941176471,0,0,.25098039215686274,.7098039216,0,0,.2549019607843137,.7215686275,0,0,.25882352941176473,.7333333333,0,0,.2627450980392157,.7450980392,0,0,.26666666666666666,.7568627451,0,0,.27058823529411763,.768627451,0,0,.27450980392156865,.7843137255,0,0,.2784313725490196,.7960784314,0,0,.2823529411764706,.8117647059,0,0,.28627450980392155,.8235294118,0,0,.2901960784313726,.8352941176,0,0,.29411764705882354,.8470588235,0,0,.2980392156862745,.862745098,0,0,.30196078431372547,.8745098039,0,0,.3058823529411765,.8862745098,0,0,.30980392156862746,.8980392157,0,0,.3137254901960784,.9137254902,0,0,.3176470588235294,.9254901961,0,0,.3215686274509804,.937254902,0,0,.3254901960784314,.9490196078,0,0,.32941176470588235,.9607843137,0,0,.3333333333333333,.968627451,0,0,.33725490196078434,.9803921569,.0039215686,0,.3411764705882353,.9882352941,.0078431373,0,.34509803921568627,1,.0117647059,0,.34901960784313724,1,.0235294118,0,.35294117647058826,1,.0352941176,0,.3568627450980392,1,.0470588235,0,.3607843137254902,1,.062745098,0,.36470588235294116,1,.0745098039,0,.3686274509803922,1,.0862745098,0,.37254901960784315,1,.0980392157,0,.3764705882352941,1,.1137254902,0,.3803921568627451,1,.1254901961,0,.3843137254901961,1,.137254902,0,.38823529411764707,1,.1490196078,0,.39215686274509803,1,.1647058824,0,.396078431372549,1,.1764705882,0,.4,1,.1882352941,0,.403921568627451,1,.2,0,.40784313725490196,1,.2156862745,0,.4117647058823529,1,.2274509804,0,.41568627450980394,1,.2392156863,0,.4196078431372549,1,.2509803922,0,.4235294117647059,1,.2666666667,0,.42745098039215684,1,.2784313725,0,.43137254901960786,1,.2901960784,0,.43529411764705883,1,.3019607843,0,.4392156862745098,1,.3176470588,0,.44313725490196076,1,.3294117647,0,.4470588235294118,1,.3411764706,0,.45098039215686275,1,.3529411765,0,.4549019607843137,1,.368627451,0,.4588235294117647,1,.3803921569,0,.4627450980392157,1,.3921568627,0,.4666666666666667,1,.4039215686,0,.4705882352941177,1,.4156862745,0,.4745098039215686,1,.4274509804,0,.4784313725490197,1,.4392156863,0,.48235294117647065,1,.4509803922,0,.48627450980392156,1,.4666666667,0,.49019607843137253,1,.4784313725,0,.49411764705882355,1,.4941176471,0,.4980392156862745,1,.5058823529,0,.5019607843137255,1,.5215686275,0,.5058823529411764,1,.5333333333,0,.5098039215686274,1,.5450980392,0,.5137254901960784,1,.5568627451,0,.5176470588235295,1,.568627451,0,.5215686274509804,1,.5803921569,0,.5254901960784314,1,.5921568627,0,.5294117647058824,1,.6039215686,0,.5333333333333333,1,.6196078431,0,.5372549019607843,1,.631372549,0,.5411764705882353,1,.6431372549,0,.5450980392156862,1,.6549019608,0,.5490196078431373,1,.6705882353,0,.5529411764705883,1,.6823529412,0,.5568627450980392,1,.6941176471,0,.5607843137254902,1,.7058823529,0,.5647058823529412,1,.7215686275,0,.5686274509803921,1,.7333333333,0,.5725490196078431,1,.7450980392,0,.5764705882352941,1,.7568627451,0,.5803921568627451,1,.7725490196,0,.5843137254901961,1,.7843137255,0,.5882352941176471,1,.7960784314,0,.592156862745098,1,.8078431373,0,.596078431372549,1,.8196078431,0,.6,1,.831372549,0,.6039215686274509,1,.8470588235,0,.6078431372549019,1,.8588235294,0,.611764705882353,1,.8745098039,0,.615686274509804,1,.8862745098,0,.6196078431372549,1,.8980392157,0,.6235294117647059,1,.9098039216,0,.6274509803921569,1,.9254901961,0,.6313725490196078,1,.937254902,0,.6352941176470588,1,.9490196078,0,.6392156862745098,1,.9607843137,0,.6431372549019608,1,.9764705882,0,.6470588235294118,1,.9803921569,.0039215686,.6509803921568628,1,.9882352941,.0117647059,.6549019607843137,1,.9921568627,.0156862745,.6588235294117647,1,1,.0235294118,.6627450980392157,1,1,.0352941176,.6666666666666666,1,1,.0470588235,.6705882352941176,1,1,.0588235294,.6745098039215687,1,1,.0745098039,.6784313725490196,1,1,.0862745098,.6823529411764706,1,1,.0980392157,.6862745098039216,1,1,.1098039216,.6901960784313725,1,1,.1254901961,.6941176470588235,1,1,.137254902,.6980392156862745,1,1,.1490196078,.7019607843137254,1,1,.1607843137,.7058823529411765,1,1,.1764705882,.7098039215686275,1,1,.1882352941,.7137254901960784,1,1,.2,.7176470588235294,1,1,.2117647059,.7215686274509804,1,1,.2274509804,.7254901960784313,1,1,.2392156863,.7294117647058823,1,1,.2509803922,.7333333333333333,1,1,.262745098,.7372549019607844,1,1,.2784313725,.7411764705882353,1,1,.2901960784,.7450980392156863,1,1,.3019607843,.7490196078431373,1,1,.3137254902,.7529411764705882,1,1,.3294117647,.7568627450980392,1,1,.3411764706,.7607843137254902,1,1,.3529411765,.7647058823529411,1,1,.3647058824,.7686274509803922,1,1,.3803921569,.7725490196078432,1,1,.3921568627,.7764705882352941,1,1,.4039215686,.7803921568627451,1,1,.4156862745,.7843137254901961,1,1,.431372549,.788235294117647,1,1,.4431372549,.792156862745098,1,1,.4549019608,.796078431372549,1,1,.4666666667,.8,1,1,.4784313725,.803921568627451,1,1,.4901960784,.807843137254902,1,1,.5019607843,.8117647058823529,1,1,.5137254902,.8156862745098039,1,1,.5294117647,.8196078431372549,1,1,.5411764706,.8235294117647058,1,1,.5568627451,.8274509803921568,1,1,.568627451,.8313725490196079,1,1,.5843137255,.8352941176470589,1,1,.5960784314,.8392156862745098,1,1,.6078431373,.8431372549019608,1,1,.6196078431,.8470588235294118,1,1,.631372549,.8509803921568627,1,1,.6431372549,.8549019607843137,1,1,.6549019608,.8588235294117647,1,1,.6666666667,.8627450980392157,1,1,.6823529412,.8666666666666667,1,1,.6941176471,.8705882352941177,1,1,.7058823529,.8745098039215686,1,1,.7176470588,.8784313725490196,1,1,.7333333333,.8823529411764706,1,1,.7450980392,.8862745098039215,1,1,.7568627451,.8901960784313725,1,1,.768627451,.8941176470588236,1,1,.7843137255,.8980392156862745,1,1,.7960784314,.9019607843137255,1,1,.8078431373,.9058823529411765,1,1,.8196078431,.9098039215686274,1,1,.8352941176,.9137254901960784,1,1,.8470588235,.9176470588235294,1,1,.8588235294,.9215686274509803,1,1,.8705882353,.9254901960784314,1,1,.8823529412,.9294117647058824,1,1,.8941176471,.9333333333333333,1,1,.9098039216,.9372549019607843,1,1,.9215686275,.9411764705882354,1,1,.937254902,.9450980392156864,1,1,.9490196078,.9490196078431372,1,1,.9607843137,.9529411764705882,1,1,.9725490196,.9568627450980394,1,1,.9882352941,.9607843137254903,1,1,.9882352941,.9647058823529413,1,1,.9921568627,.9686274509803922,1,1,.9960784314,.9725490196078431,1,1,1,.9764705882352941,1,1,1,.9803921568627451,1,1,1,.984313725490196,1,1,1,.9882352941176471,1,1,1,.9921568627450981,1,1,1,.996078431372549,1,1,1,1,1,1,1],description:"Red Hot"},{ColorSpace:"RGB",Name:"s_pet",RGBPoints:[0,.0156862745,.0039215686,.0156862745,.00392156862745098,.0156862745,.0039215686,.0156862745,.00784313725490196,.0274509804,.0039215686,.031372549,.011764705882352941,.0352941176,.0039215686,.0509803922,.01568627450980392,.0392156863,.0039215686,.0666666667,.0196078431372549,.0509803922,.0039215686,.0823529412,.023529411764705882,.062745098,.0039215686,.0980392157,.027450980392156862,.0705882353,.0039215686,.1176470588,.03137254901960784,.0745098039,.0039215686,.1333333333,.03529411764705882,.0862745098,.0039215686,.1490196078,.0392156862745098,.0980392157,.0039215686,.1647058824,.043137254901960784,.1058823529,.0039215686,.1843137255,.047058823529411764,.1098039216,.0039215686,.2,.050980392156862744,.1215686275,.0039215686,.2156862745,.054901960784313725,.1333333333,.0039215686,.231372549,.05882352941176471,.137254902,.0039215686,.2509803922,.06274509803921569,.1490196078,.0039215686,.262745098,.06666666666666667,.1607843137,.0039215686,.2784313725,.07058823529411765,.168627451,.0039215686,.2941176471,.07450980392156863,.1725490196,.0039215686,.3137254902,.0784313725490196,.1843137255,.0039215686,.3294117647,.08235294117647059,.1960784314,.0039215686,.3450980392,.08627450980392157,.2039215686,.0039215686,.3607843137,.09019607843137255,.2078431373,.0039215686,.3803921569,.09411764705882353,.2196078431,.0039215686,.3960784314,.09803921568627451,.231372549,.0039215686,.4117647059,.10196078431372549,.2392156863,.0039215686,.4274509804,.10588235294117647,.2431372549,.0039215686,.4470588235,.10980392156862745,.2509803922,.0039215686,.462745098,.11372549019607843,.262745098,.0039215686,.4784313725,.11764705882352942,.2666666667,.0039215686,.4980392157,.12156862745098039,.2666666667,.0039215686,.4980392157,.12549019607843137,.262745098,.0039215686,.5137254902,.12941176470588237,.2509803922,.0039215686,.5294117647,.13333333333333333,.2431372549,.0039215686,.5450980392,.13725490196078433,.2392156863,.0039215686,.5607843137,.1411764705882353,.231372549,.0039215686,.5764705882,.1450980392156863,.2196078431,.0039215686,.5921568627,.14901960784313725,.2078431373,.0039215686,.6078431373,.15294117647058825,.2039215686,.0039215686,.6235294118,.1568627450980392,.1960784314,.0039215686,.6392156863,.1607843137254902,.1843137255,.0039215686,.6549019608,.16470588235294117,.1725490196,.0039215686,.6705882353,.16862745098039217,.168627451,.0039215686,.6862745098,.17254901960784313,.1607843137,.0039215686,.7019607843,.17647058823529413,.1490196078,.0039215686,.7176470588,.1803921568627451,.137254902,.0039215686,.7333333333,.1843137254901961,.1333333333,.0039215686,.7490196078,.18823529411764706,.1215686275,.0039215686,.7607843137,.19215686274509805,.1098039216,.0039215686,.7764705882,.19607843137254902,.1058823529,.0039215686,.7921568627,.2,.0980392157,.0039215686,.8078431373,.20392156862745098,.0862745098,.0039215686,.8235294118,.20784313725490197,.0745098039,.0039215686,.8392156863,.21176470588235294,.0705882353,.0039215686,.8549019608,.21568627450980393,.062745098,.0039215686,.8705882353,.2196078431372549,.0509803922,.0039215686,.8862745098,.2235294117647059,.0392156863,.0039215686,.9019607843,.22745098039215686,.0352941176,.0039215686,.9176470588,.23137254901960785,.0274509804,.0039215686,.9333333333,.23529411764705885,.0156862745,.0039215686,.9490196078,.23921568627450984,.0078431373,.0039215686,.9647058824,.24313725490196078,.0039215686,.0039215686,.9960784314,.24705882352941178,.0039215686,.0039215686,.9960784314,.25098039215686274,.0039215686,.0196078431,.9647058824,.2549019607843137,.0039215686,.0392156863,.9490196078,.25882352941176473,.0039215686,.0549019608,.9333333333,.2627450980392157,.0039215686,.0745098039,.9176470588,.26666666666666666,.0039215686,.0901960784,.9019607843,.27058823529411763,.0039215686,.1098039216,.8862745098,.27450980392156865,.0039215686,.1254901961,.8705882353,.2784313725490196,.0039215686,.1450980392,.8549019608,.2823529411764706,.0039215686,.1607843137,.8392156863,.28627450980392155,.0039215686,.1803921569,.8235294118,.2901960784313726,.0039215686,.1960784314,.8078431373,.29411764705882354,.0039215686,.2156862745,.7921568627,.2980392156862745,.0039215686,.231372549,.7764705882,.30196078431372547,.0039215686,.2509803922,.7607843137,.3058823529411765,.0039215686,.262745098,.7490196078,.30980392156862746,.0039215686,.2823529412,.7333333333,.3137254901960784,.0039215686,.2980392157,.7176470588,.3176470588235294,.0039215686,.3176470588,.7019607843,.3215686274509804,.0039215686,.3333333333,.6862745098,.3254901960784314,.0039215686,.3529411765,.6705882353,.32941176470588235,.0039215686,.368627451,.6549019608,.3333333333333333,.0039215686,.3882352941,.6392156863,.33725490196078434,.0039215686,.4039215686,.6235294118,.3411764705882353,.0039215686,.4235294118,.6078431373,.34509803921568627,.0039215686,.4392156863,.5921568627,.34901960784313724,.0039215686,.4588235294,.5764705882,.35294117647058826,.0039215686,.4745098039,.5607843137,.3568627450980392,.0039215686,.4941176471,.5450980392,.3607843137254902,.0039215686,.5098039216,.5294117647,.36470588235294116,.0039215686,.5294117647,.5137254902,.3686274509803922,.0039215686,.5450980392,.4980392157,.37254901960784315,.0039215686,.5647058824,.4784313725,.3764705882352941,.0039215686,.5803921569,.462745098,.3803921568627451,.0039215686,.6,.4470588235,.3843137254901961,.0039215686,.6156862745,.4274509804,.38823529411764707,.0039215686,.6352941176,.4117647059,.39215686274509803,.0039215686,.6509803922,.3960784314,.396078431372549,.0039215686,.6705882353,.3803921569,.4,.0039215686,.6862745098,.3607843137,.403921568627451,.0039215686,.7058823529,.3450980392,.40784313725490196,.0039215686,.7215686275,.3294117647,.4117647058823529,.0039215686,.7411764706,.3137254902,.41568627450980394,.0039215686,.7529411765,.2941176471,.4196078431372549,.0039215686,.7960784314,.2784313725,.4235294117647059,.0039215686,.7960784314,.262745098,.42745098039215684,.0392156863,.8039215686,.2509803922,.43137254901960786,.0745098039,.8117647059,.231372549,.43529411764705883,.1098039216,.8196078431,.2156862745,.4392156862745098,.1450980392,.8274509804,.2,.44313725490196076,.1803921569,.8352941176,.1843137255,.4470588235294118,.2156862745,.8431372549,.1647058824,.45098039215686275,.2509803922,.8509803922,.1490196078,.4549019607843137,.2823529412,.8588235294,.1333333333,.4588235294117647,.3176470588,.8666666667,.1176470588,.4627450980392157,.3529411765,.8745098039,.0980392157,.4666666666666667,.3882352941,.8823529412,.0823529412,.4705882352941177,.4235294118,.8901960784,.0666666667,.4745098039215686,.4588235294,.8980392157,.0509803922,.4784313725490197,.4941176471,.9058823529,.0431372549,.48235294117647065,.5294117647,.9137254902,.031372549,.48627450980392156,.5647058824,.9215686275,.0196078431,.49019607843137253,.6,.9294117647,.0078431373,.49411764705882355,.6352941176,.937254902,.0039215686,.4980392156862745,.6705882353,.9450980392,.0039215686,.5019607843137255,.7058823529,.9490196078,.0039215686,.5058823529411764,.7411764706,.9568627451,.0039215686,.5098039215686274,.7725490196,.9607843137,.0039215686,.5137254901960784,.8078431373,.968627451,.0039215686,.5176470588235295,.8431372549,.9725490196,.0039215686,.5215686274509804,.8784313725,.9803921569,.0039215686,.5254901960784314,.9137254902,.9843137255,.0039215686,.5294117647058824,.9490196078,.9921568627,.0039215686,.5333333333333333,.9960784314,.9960784314,.0039215686,.5372549019607843,.9960784314,.9960784314,.0039215686,.5411764705882353,.9960784314,.9921568627,.0039215686,.5450980392156862,.9960784314,.9843137255,.0039215686,.5490196078431373,.9960784314,.9764705882,.0039215686,.5529411764705883,.9960784314,.968627451,.0039215686,.5568627450980392,.9960784314,.9607843137,.0039215686,.5607843137254902,.9960784314,.9529411765,.0039215686,.5647058823529412,.9960784314,.9450980392,.0039215686,.5686274509803921,.9960784314,.937254902,.0039215686,.5725490196078431,.9960784314,.9294117647,.0039215686,.5764705882352941,.9960784314,.9215686275,.0039215686,.5803921568627451,.9960784314,.9137254902,.0039215686,.5843137254901961,.9960784314,.9058823529,.0039215686,.5882352941176471,.9960784314,.8980392157,.0039215686,.592156862745098,.9960784314,.8901960784,.0039215686,.596078431372549,.9960784314,.8823529412,.0039215686,.6,.9960784314,.8745098039,.0039215686,.6039215686274509,.9960784314,.8666666667,.0039215686,.6078431372549019,.9960784314,.8588235294,.0039215686,.611764705882353,.9960784314,.8509803922,.0039215686,.615686274509804,.9960784314,.8431372549,.0039215686,.6196078431372549,.9960784314,.8352941176,.0039215686,.6235294117647059,.9960784314,.8274509804,.0039215686,.6274509803921569,.9960784314,.8196078431,.0039215686,.6313725490196078,.9960784314,.8117647059,.0039215686,.6352941176470588,.9960784314,.8039215686,.0039215686,.6392156862745098,.9960784314,.7960784314,.0039215686,.6431372549019608,.9960784314,.7882352941,.0039215686,.6470588235294118,.9960784314,.7803921569,.0039215686,.6509803921568628,.9960784314,.7725490196,.0039215686,.6549019607843137,.9960784314,.7647058824,.0039215686,.6588235294117647,.9960784314,.7568627451,.0039215686,.6627450980392157,.9960784314,.7490196078,.0039215686,.6666666666666666,.9960784314,.7450980392,.0039215686,.6705882352941176,.9960784314,.737254902,.0039215686,.6745098039215687,.9960784314,.7294117647,.0039215686,.6784313725490196,.9960784314,.7215686275,.0039215686,.6823529411764706,.9960784314,.7137254902,.0039215686,.6862745098039216,.9960784314,.7058823529,.0039215686,.6901960784313725,.9960784314,.6980392157,.0039215686,.6941176470588235,.9960784314,.6901960784,.0039215686,.6980392156862745,.9960784314,.6823529412,.0039215686,.7019607843137254,.9960784314,.6745098039,.0039215686,.7058823529411765,.9960784314,.6666666667,.0039215686,.7098039215686275,.9960784314,.6588235294,.0039215686,.7137254901960784,.9960784314,.6509803922,.0039215686,.7176470588235294,.9960784314,.6431372549,.0039215686,.7215686274509804,.9960784314,.6352941176,.0039215686,.7254901960784313,.9960784314,.6274509804,.0039215686,.7294117647058823,.9960784314,.6196078431,.0039215686,.7333333333333333,.9960784314,.6117647059,.0039215686,.7372549019607844,.9960784314,.6039215686,.0039215686,.7411764705882353,.9960784314,.5960784314,.0039215686,.7450980392156863,.9960784314,.5882352941,.0039215686,.7490196078431373,.9960784314,.5803921569,.0039215686,.7529411764705882,.9960784314,.5725490196,.0039215686,.7568627450980392,.9960784314,.5647058824,.0039215686,.7607843137254902,.9960784314,.5568627451,.0039215686,.7647058823529411,.9960784314,.5490196078,.0039215686,.7686274509803922,.9960784314,.5411764706,.0039215686,.7725490196078432,.9960784314,.5333333333,.0039215686,.7764705882352941,.9960784314,.5254901961,.0039215686,.7803921568627451,.9960784314,.5176470588,.0039215686,.7843137254901961,.9960784314,.5098039216,.0039215686,.788235294117647,.9960784314,.5019607843,.0039215686,.792156862745098,.9960784314,.4941176471,.0039215686,.796078431372549,.9960784314,.4862745098,.0039215686,.8,.9960784314,.4784313725,.0039215686,.803921568627451,.9960784314,.4705882353,.0039215686,.807843137254902,.9960784314,.462745098,.0039215686,.8117647058823529,.9960784314,.4549019608,.0039215686,.8156862745098039,.9960784314,.4470588235,.0039215686,.8196078431372549,.9960784314,.4392156863,.0039215686,.8235294117647058,.9960784314,.431372549,.0039215686,.8274509803921568,.9960784314,.4235294118,.0039215686,.8313725490196079,.9960784314,.4156862745,.0039215686,.8352941176470589,.9960784314,.4078431373,.0039215686,.8392156862745098,.9960784314,.4,.0039215686,.8431372549019608,.9960784314,.3921568627,.0039215686,.8470588235294118,.9960784314,.3843137255,.0039215686,.8509803921568627,.9960784314,.3764705882,.0039215686,.8549019607843137,.9960784314,.368627451,.0039215686,.8588235294117647,.9960784314,.3607843137,.0039215686,.8627450980392157,.9960784314,.3529411765,.0039215686,.8666666666666667,.9960784314,.3450980392,.0039215686,.8705882352941177,.9960784314,.337254902,.0039215686,.8745098039215686,.9960784314,.3294117647,.0039215686,.8784313725490196,.9960784314,.3215686275,.0039215686,.8823529411764706,.9960784314,.3137254902,.0039215686,.8862745098039215,.9960784314,.3058823529,.0039215686,.8901960784313725,.9960784314,.2980392157,.0039215686,.8941176470588236,.9960784314,.2901960784,.0039215686,.8980392156862745,.9960784314,.2823529412,.0039215686,.9019607843137255,.9960784314,.2705882353,.0039215686,.9058823529411765,.9960784314,.2588235294,.0039215686,.9098039215686274,.9960784314,.2509803922,.0039215686,.9137254901960784,.9960784314,.2431372549,.0039215686,.9176470588235294,.9960784314,.231372549,.0039215686,.9215686274509803,.9960784314,.2196078431,.0039215686,.9254901960784314,.9960784314,.2117647059,.0039215686,.9294117647058824,.9960784314,.2,.0039215686,.9333333333333333,.9960784314,.1882352941,.0039215686,.9372549019607843,.9960784314,.1764705882,.0039215686,.9411764705882354,.9960784314,.168627451,.0039215686,.9450980392156864,.9960784314,.1568627451,.0039215686,.9490196078431372,.9960784314,.1450980392,.0039215686,.9529411764705882,.9960784314,.1333333333,.0039215686,.9568627450980394,.9960784314,.1254901961,.0039215686,.9607843137254903,.9960784314,.1137254902,.0039215686,.9647058823529413,.9960784314,.1019607843,.0039215686,.9686274509803922,.9960784314,.0901960784,.0039215686,.9725490196078431,.9960784314,.0823529412,.0039215686,.9764705882352941,.9960784314,.0705882353,.0039215686,.9803921568627451,.9960784314,.0588235294,.0039215686,.984313725490196,.9960784314,.0470588235,.0039215686,.9882352941176471,.9960784314,.0392156863,.0039215686,.9921568627450981,.9960784314,.0274509804,.0039215686,.996078431372549,.9960784314,.0156862745,.0039215686,1,.9960784314,.0156862745,.0039215686],description:"S PET"},{ColorSpace:"RGB",Name:"perfusion",RGBPoints:[0,0,0,0,.00392156862745098,.0078431373,.0235294118,.0235294118,.00784313725490196,.0078431373,.031372549,.0470588235,.011764705882352941,.0078431373,.0392156863,.062745098,.01568627450980392,.0078431373,.0470588235,.0862745098,.0196078431372549,.0078431373,.0549019608,.1019607843,.023529411764705882,.0078431373,.0549019608,.1254901961,.027450980392156862,.0078431373,.062745098,.1411764706,.03137254901960784,.0078431373,.0705882353,.1647058824,.03529411764705882,.0078431373,.0784313725,.1803921569,.0392156862745098,.0078431373,.0862745098,.2039215686,.043137254901960784,.0078431373,.0862745098,.2196078431,.047058823529411764,.0078431373,.0941176471,.2431372549,.050980392156862744,.0078431373,.1019607843,.2666666667,.054901960784313725,.0078431373,.1098039216,.2823529412,.05882352941176471,.0078431373,.1176470588,.3058823529,.06274509803921569,.0078431373,.1176470588,.3215686275,.06666666666666667,.0078431373,.1254901961,.3450980392,.07058823529411765,.0078431373,.1333333333,.3607843137,.07450980392156863,.0078431373,.1411764706,.3843137255,.0784313725490196,.0078431373,.1490196078,.4,.08235294117647059,.0078431373,.1490196078,.4235294118,.08627450980392157,.0078431373,.1568627451,.4392156863,.09019607843137255,.0078431373,.1647058824,.462745098,.09411764705882353,.0078431373,.1725490196,.4784313725,.09803921568627451,.0078431373,.1803921569,.5019607843,.10196078431372549,.0078431373,.1803921569,.5254901961,.10588235294117647,.0078431373,.1882352941,.5411764706,.10980392156862745,.0078431373,.1960784314,.5647058824,.11372549019607843,.0078431373,.2039215686,.5803921569,.11764705882352942,.0078431373,.2117647059,.6039215686,.12156862745098039,.0078431373,.2117647059,.6196078431,.12549019607843137,.0078431373,.2196078431,.6431372549,.12941176470588237,.0078431373,.2274509804,.6588235294,.13333333333333333,.0078431373,.2352941176,.6823529412,.13725490196078433,.0078431373,.2431372549,.6980392157,.1411764705882353,.0078431373,.2431372549,.7215686275,.1450980392156863,.0078431373,.2509803922,.737254902,.14901960784313725,.0078431373,.2588235294,.7607843137,.15294117647058825,.0078431373,.2666666667,.7843137255,.1568627450980392,.0078431373,.2745098039,.8,.1607843137254902,.0078431373,.2745098039,.8235294118,.16470588235294117,.0078431373,.2823529412,.8392156863,.16862745098039217,.0078431373,.2901960784,.862745098,.17254901960784313,.0078431373,.2980392157,.8784313725,.17647058823529413,.0078431373,.3058823529,.9019607843,.1803921568627451,.0078431373,.3058823529,.9176470588,.1843137254901961,.0078431373,.2980392157,.9411764706,.18823529411764706,.0078431373,.3058823529,.9568627451,.19215686274509805,.0078431373,.2980392157,.9803921569,.19607843137254902,.0078431373,.2980392157,.9882352941,.2,.0078431373,.2901960784,.9803921569,.20392156862745098,.0078431373,.2901960784,.9647058824,.20784313725490197,.0078431373,.2823529412,.9568627451,.21176470588235294,.0078431373,.2823529412,.9411764706,.21568627450980393,.0078431373,.2745098039,.9333333333,.2196078431372549,.0078431373,.2666666667,.9176470588,.2235294117647059,.0078431373,.2666666667,.9098039216,.22745098039215686,.0078431373,.2588235294,.9019607843,.23137254901960785,.0078431373,.2588235294,.8862745098,.23529411764705885,.0078431373,.2509803922,.8784313725,.23921568627450984,.0078431373,.2509803922,.862745098,.24313725490196078,.0078431373,.2431372549,.8549019608,.24705882352941178,.0078431373,.2352941176,.8392156863,.25098039215686274,.0078431373,.2352941176,.831372549,.2549019607843137,.0078431373,.2274509804,.8235294118,.25882352941176473,.0078431373,.2274509804,.8078431373,.2627450980392157,.0078431373,.2196078431,.8,.26666666666666666,.0078431373,.2196078431,.7843137255,.27058823529411763,.0078431373,.2117647059,.7764705882,.27450980392156865,.0078431373,.2039215686,.7607843137,.2784313725490196,.0078431373,.2039215686,.7529411765,.2823529411764706,.0078431373,.1960784314,.7450980392,.28627450980392155,.0078431373,.1960784314,.7294117647,.2901960784313726,.0078431373,.1882352941,.7215686275,.29411764705882354,.0078431373,.1882352941,.7058823529,.2980392156862745,.0078431373,.1803921569,.6980392157,.30196078431372547,.0078431373,.1803921569,.6823529412,.3058823529411765,.0078431373,.1725490196,.6745098039,.30980392156862746,.0078431373,.1647058824,.6666666667,.3137254901960784,.0078431373,.1647058824,.6509803922,.3176470588235294,.0078431373,.1568627451,.6431372549,.3215686274509804,.0078431373,.1568627451,.6274509804,.3254901960784314,.0078431373,.1490196078,.6196078431,.32941176470588235,.0078431373,.1490196078,.6039215686,.3333333333333333,.0078431373,.1411764706,.5960784314,.33725490196078434,.0078431373,.1333333333,.5882352941,.3411764705882353,.0078431373,.1333333333,.5725490196,.34509803921568627,.0078431373,.1254901961,.5647058824,.34901960784313724,.0078431373,.1254901961,.5490196078,.35294117647058826,.0078431373,.1176470588,.5411764706,.3568627450980392,.0078431373,.1176470588,.5254901961,.3607843137254902,.0078431373,.1098039216,.5176470588,.36470588235294116,.0078431373,.1019607843,.5098039216,.3686274509803922,.0078431373,.1019607843,.4941176471,.37254901960784315,.0078431373,.0941176471,.4862745098,.3764705882352941,.0078431373,.0941176471,.4705882353,.3803921568627451,.0078431373,.0862745098,.462745098,.3843137254901961,.0078431373,.0862745098,.4470588235,.38823529411764707,.0078431373,.0784313725,.4392156863,.39215686274509803,.0078431373,.0705882353,.431372549,.396078431372549,.0078431373,.0705882353,.4156862745,.4,.0078431373,.062745098,.4078431373,.403921568627451,.0078431373,.062745098,.3921568627,.40784313725490196,.0078431373,.0549019608,.3843137255,.4117647058823529,.0078431373,.0549019608,.368627451,.41568627450980394,.0078431373,.0470588235,.3607843137,.4196078431372549,.0078431373,.0470588235,.3529411765,.4235294117647059,.0078431373,.0392156863,.337254902,.42745098039215684,.0078431373,.031372549,.3294117647,.43137254901960786,.0078431373,.031372549,.3137254902,.43529411764705883,.0078431373,.0235294118,.3058823529,.4392156862745098,.0078431373,.0235294118,.2901960784,.44313725490196076,.0078431373,.0156862745,.2823529412,.4470588235294118,.0078431373,.0156862745,.2745098039,.45098039215686275,.0078431373,.0078431373,.2588235294,.4549019607843137,.0235294118,.0078431373,.2509803922,.4588235294117647,.0078431373,.0078431373,.2352941176,.4627450980392157,.0078431373,.0078431373,.2274509804,.4666666666666667,.0078431373,.0078431373,.2117647059,.4705882352941177,.0078431373,.0078431373,.2039215686,.4745098039215686,.0078431373,.0078431373,.1960784314,.4784313725490197,.0078431373,.0078431373,.1803921569,.48235294117647065,.0078431373,.0078431373,.1725490196,.48627450980392156,.0078431373,.0078431373,.1568627451,.49019607843137253,.0078431373,.0078431373,.1490196078,.49411764705882355,.0078431373,.0078431373,.1333333333,.4980392156862745,.0078431373,.0078431373,.1254901961,.5019607843137255,.0078431373,.0078431373,.1176470588,.5058823529411764,.0078431373,.0078431373,.1019607843,.5098039215686274,.0078431373,.0078431373,.0941176471,.5137254901960784,.0078431373,.0078431373,.0784313725,.5176470588235295,.0078431373,.0078431373,.0705882353,.5215686274509804,.0078431373,.0078431373,.0549019608,.5254901960784314,.0078431373,.0078431373,.0470588235,.5294117647058824,.0235294118,.0078431373,.0392156863,.5333333333333333,.031372549,.0078431373,.0235294118,.5372549019607843,.0392156863,.0078431373,.0156862745,.5411764705882353,.0549019608,.0078431373,0,.5450980392156862,.062745098,.0078431373,0,.5490196078431373,.0705882353,.0078431373,0,.5529411764705883,.0862745098,.0078431373,0,.5568627450980392,.0941176471,.0078431373,0,.5607843137254902,.1019607843,.0078431373,0,.5647058823529412,.1098039216,.0078431373,0,.5686274509803921,.1254901961,.0078431373,0,.5725490196078431,.1333333333,.0078431373,0,.5764705882352941,.1411764706,.0078431373,0,.5803921568627451,.1568627451,.0078431373,0,.5843137254901961,.1647058824,.0078431373,0,.5882352941176471,.1725490196,.0078431373,0,.592156862745098,.1882352941,.0078431373,0,.596078431372549,.1960784314,.0078431373,0,.6,.2039215686,.0078431373,0,.6039215686274509,.2117647059,.0078431373,0,.6078431372549019,.2274509804,.0078431373,0,.611764705882353,.2352941176,.0078431373,0,.615686274509804,.2431372549,.0078431373,0,.6196078431372549,.2588235294,.0078431373,0,.6235294117647059,.2666666667,.0078431373,0,.6274509803921569,.2745098039,0,0,.6313725490196078,.2901960784,.0156862745,0,.6352941176470588,.2980392157,.0235294118,0,.6392156862745098,.3058823529,.0392156863,0,.6431372549019608,.3137254902,.0470588235,0,.6470588235294118,.3294117647,.0549019608,0,.6509803921568628,.337254902,.0705882353,0,.6549019607843137,.3450980392,.0784313725,0,.6588235294117647,.3607843137,.0862745098,0,.6627450980392157,.368627451,.1019607843,0,.6666666666666666,.3764705882,.1098039216,0,.6705882352941176,.3843137255,.1176470588,0,.6745098039215687,.4,.1333333333,0,.6784313725490196,.4078431373,.1411764706,0,.6823529411764706,.4156862745,.1490196078,0,.6862745098039216,.431372549,.1647058824,0,.6901960784313725,.4392156863,.1725490196,0,.6941176470588235,.4470588235,.1803921569,0,.6980392156862745,.462745098,.1960784314,0,.7019607843137254,.4705882353,.2039215686,0,.7058823529411765,.4784313725,.2117647059,0,.7098039215686275,.4862745098,.2274509804,0,.7137254901960784,.5019607843,.2352941176,0,.7176470588235294,.5098039216,.2431372549,0,.7215686274509804,.5176470588,.2588235294,0,.7254901960784313,.5333333333,.2666666667,0,.7294117647058823,.5411764706,.2745098039,0,.7333333333333333,.5490196078,.2901960784,0,.7372549019607844,.5647058824,.2980392157,0,.7411764705882353,.5725490196,.3058823529,0,.7450980392156863,.5803921569,.3215686275,0,.7490196078431373,.5882352941,.3294117647,0,.7529411764705882,.6039215686,.337254902,0,.7568627450980392,.6117647059,.3529411765,0,.7607843137254902,.6196078431,.3607843137,0,.7647058823529411,.6352941176,.368627451,0,.7686274509803922,.6431372549,.3843137255,0,.7725490196078432,.6509803922,.3921568627,0,.7764705882352941,.6588235294,.4,0,.7803921568627451,.6745098039,.4156862745,0,.7843137254901961,.6823529412,.4235294118,0,.788235294117647,.6901960784,.431372549,0,.792156862745098,.7058823529,.4470588235,0,.796078431372549,.7137254902,.4549019608,0,.8,.7215686275,.462745098,0,.803921568627451,.737254902,.4784313725,0,.807843137254902,.7450980392,.4862745098,0,.8117647058823529,.7529411765,.4941176471,0,.8156862745098039,.7607843137,.5098039216,0,.8196078431372549,.7764705882,.5176470588,0,.8235294117647058,.7843137255,.5254901961,0,.8274509803921568,.7921568627,.5411764706,0,.8313725490196079,.8078431373,.5490196078,0,.8352941176470589,.8156862745,.5568627451,0,.8392156862745098,.8235294118,.5725490196,0,.8431372549019608,.8392156863,.5803921569,0,.8470588235294118,.8470588235,.5882352941,0,.8509803921568627,.8549019608,.6039215686,0,.8549019607843137,.862745098,.6117647059,0,.8588235294117647,.8784313725,.6196078431,0,.8627450980392157,.8862745098,.6352941176,0,.8666666666666667,.8941176471,.6431372549,0,.8705882352941177,.9098039216,.6509803922,0,.8745098039215686,.9176470588,.6666666667,0,.8784313725490196,.9254901961,.6745098039,0,.8823529411764706,.9411764706,.6823529412,0,.8862745098039215,.9490196078,.6980392157,0,.8901960784313725,.9568627451,.7058823529,0,.8941176470588236,.9647058824,.7137254902,0,.8980392156862745,.9803921569,.7294117647,0,.9019607843137255,.9882352941,.737254902,0,.9058823529411765,.9960784314,.7450980392,0,.9098039215686274,.9960784314,.7607843137,0,.9137254901960784,.9960784314,.768627451,0,.9176470588235294,.9960784314,.7764705882,0,.9215686274509803,.9960784314,.7921568627,0,.9254901960784314,.9960784314,.8,0,.9294117647058824,.9960784314,.8078431373,0,.9333333333333333,.9960784314,.8235294118,0,.9372549019607843,.9960784314,.831372549,0,.9411764705882354,.9960784314,.8392156863,0,.9450980392156864,.9960784314,.8549019608,0,.9490196078431372,.9960784314,.862745098,.0549019608,.9529411764705882,.9960784314,.8705882353,.1098039216,.9568627450980394,.9960784314,.8862745098,.1647058824,.9607843137254903,.9960784314,.8941176471,.2196078431,.9647058823529413,.9960784314,.9019607843,.2666666667,.9686274509803922,.9960784314,.9176470588,.3215686275,.9725490196078431,.9960784314,.9254901961,.3764705882,.9764705882352941,.9960784314,.9333333333,.431372549,.9803921568627451,.9960784314,.9490196078,.4862745098,.984313725490196,.9960784314,.9568627451,.5333333333,.9882352941176471,.9960784314,.9647058824,.5882352941,.9921568627450981,.9960784314,.9803921569,.6431372549,.996078431372549,.9960784314,.9882352941,.6980392157,1,.9960784314,.9960784314,.7450980392],description:"Perfusion"},{ColorSpace:"RGB",Name:"rainbow_2",RGBPoints:[0,0,0,0,.00392156862745098,.0156862745,0,.0117647059,.00784313725490196,.0352941176,0,.0274509804,.011764705882352941,.0509803922,0,.0392156863,.01568627450980392,.0705882353,0,.0549019608,.0196078431372549,.0862745098,0,.0745098039,.023529411764705882,.1058823529,0,.0901960784,.027450980392156862,.1215686275,0,.1098039216,.03137254901960784,.1411764706,0,.1254901961,.03529411764705882,.1568627451,0,.1490196078,.0392156862745098,.1764705882,0,.168627451,.043137254901960784,.1960784314,0,.1882352941,.047058823529411764,.2117647059,0,.2078431373,.050980392156862744,.2274509804,0,.231372549,.054901960784313725,.2392156863,0,.2470588235,.05882352941176471,.2509803922,0,.2666666667,.06274509803921569,.2666666667,0,.2823529412,.06666666666666667,.2705882353,0,.3019607843,.07058823529411765,.2823529412,0,.3176470588,.07450980392156863,.2901960784,0,.337254902,.0784313725490196,.3019607843,0,.3568627451,.08235294117647059,.3098039216,0,.3725490196,.08627450980392157,.3137254902,0,.3921568627,.09019607843137255,.3215686275,0,.4078431373,.09411764705882353,.3254901961,0,.4274509804,.09803921568627451,.3333333333,0,.4431372549,.10196078431372549,.3294117647,0,.462745098,.10588235294117647,.337254902,0,.4784313725,.10980392156862745,.3411764706,0,.4980392157,.11372549019607843,.3450980392,0,.5176470588,.11764705882352942,.337254902,0,.5333333333,.12156862745098039,.3411764706,0,.5529411765,.12549019607843137,.3411764706,0,.568627451,.12941176470588237,.3411764706,0,.5882352941,.13333333333333333,.3333333333,0,.6039215686,.13725490196078433,.3294117647,0,.6235294118,.1411764705882353,.3294117647,0,.6392156863,.1450980392156863,.3294117647,0,.6588235294,.14901960784313725,.3254901961,0,.6784313725,.15294117647058825,.3098039216,0,.6941176471,.1568627450980392,.3058823529,0,.7137254902,.1607843137254902,.3019607843,0,.7294117647,.16470588235294117,.2980392157,0,.7490196078,.16862745098039217,.2784313725,0,.7647058824,.17254901960784313,.2745098039,0,.7843137255,.17647058823529413,.2666666667,0,.8,.1803921568627451,.2588235294,0,.8196078431,.1843137254901961,.2352941176,0,.8392156863,.18823529411764706,.2274509804,0,.8549019608,.19215686274509805,.2156862745,0,.8745098039,.19607843137254902,.2078431373,0,.8901960784,.2,.1803921569,0,.9098039216,.20392156862745098,.168627451,0,.9254901961,.20784313725490197,.1568627451,0,.9450980392,.21176470588235294,.1411764706,0,.9607843137,.21568627450980393,.1294117647,0,.9803921569,.2196078431372549,.0980392157,0,1,.2235294117647059,.0823529412,0,1,.22745098039215686,.062745098,0,1,.23137254901960785,.0470588235,0,1,.23529411764705885,.0156862745,0,1,.23921568627450984,0,0,1,.24313725490196078,0,.0156862745,1,.24705882352941178,0,.031372549,1,.25098039215686274,0,.062745098,1,.2549019607843137,0,.0823529412,1,.25882352941176473,0,.0980392157,1,.2627450980392157,0,.1137254902,1,.26666666666666666,0,.1490196078,1,.27058823529411763,0,.1647058824,1,.27450980392156865,0,.1803921569,1,.2784313725490196,0,.2,1,.2823529411764706,0,.2156862745,1,.28627450980392155,0,.2470588235,1,.2901960784313726,0,.262745098,1,.29411764705882354,0,.2823529412,1,.2980392156862745,0,.2980392157,1,.30196078431372547,0,.3294117647,1,.3058823529411765,0,.3490196078,1,.30980392156862746,0,.3647058824,1,.3137254901960784,0,.3803921569,1,.3176470588235294,0,.4156862745,1,.3215686274509804,0,.431372549,1,.3254901960784314,0,.4470588235,1,.32941176470588235,0,.4666666667,1,.3333333333333333,0,.4980392157,1,.33725490196078434,0,.5137254902,1,.3411764705882353,0,.5294117647,1,.34509803921568627,0,.5490196078,1,.34901960784313724,0,.5647058824,1,.35294117647058826,0,.5960784314,1,.3568627450980392,0,.6156862745,1,.3607843137254902,0,.631372549,1,.36470588235294116,0,.6470588235,1,.3686274509803922,0,.6823529412,1,.37254901960784315,0,.6980392157,1,.3764705882352941,0,.7137254902,1,.3803921568627451,0,.7333333333,1,.3843137254901961,0,.7647058824,1,.38823529411764707,0,.7803921569,1,.39215686274509803,0,.7960784314,1,.396078431372549,0,.8156862745,1,.4,0,.8470588235,1,.403921568627451,0,.862745098,1,.40784313725490196,0,.8823529412,1,.4117647058823529,0,.8980392157,1,.41568627450980394,0,.9137254902,1,.4196078431372549,0,.9490196078,1,.4235294117647059,0,.9647058824,1,.42745098039215684,0,.9803921569,1,.43137254901960786,0,1,1,.43529411764705883,0,1,.9647058824,.4392156862745098,0,1,.9490196078,.44313725490196076,0,1,.9333333333,.4470588235294118,0,1,.9137254902,.45098039215686275,0,1,.8823529412,.4549019607843137,0,1,.862745098,.4588235294117647,0,1,.8470588235,.4627450980392157,0,1,.831372549,.4666666666666667,0,1,.7960784314,.4705882352941177,0,1,.7803921569,.4745098039215686,0,1,.7647058824,.4784313725490197,0,1,.7490196078,.48235294117647065,0,1,.7333333333,.48627450980392156,0,1,.6980392157,.49019607843137253,0,1,.6823529412,.49411764705882355,0,1,.6666666667,.4980392156862745,0,1,.6470588235,.5019607843137255,0,1,.6156862745,.5058823529411764,0,1,.5960784314,.5098039215686274,0,1,.5803921569,.5137254901960784,0,1,.5647058824,.5176470588235295,0,1,.5294117647,.5215686274509804,0,1,.5137254902,.5254901960784314,0,1,.4980392157,.5294117647058824,0,1,.4823529412,.5333333333333333,0,1,.4470588235,.5372549019607843,0,1,.431372549,.5411764705882353,0,1,.4156862745,.5450980392156862,0,1,.4,.5490196078431373,0,1,.3803921569,.5529411764705883,0,1,.3490196078,.5568627450980392,0,1,.3294117647,.5607843137254902,0,1,.3137254902,.5647058823529412,0,1,.2980392157,.5686274509803921,0,1,.262745098,.5725490196078431,0,1,.2470588235,.5764705882352941,0,1,.231372549,.5803921568627451,0,1,.2156862745,.5843137254901961,0,1,.1803921569,.5882352941176471,0,1,.1647058824,.592156862745098,0,1,.1490196078,.596078431372549,0,1,.1333333333,.6,0,1,.0980392157,.6039215686274509,0,1,.0823529412,.6078431372549019,0,1,.062745098,.611764705882353,0,1,.0470588235,.615686274509804,0,1,.031372549,.6196078431372549,0,1,0,.6235294117647059,.0156862745,1,0,.6274509803921569,.031372549,1,0,.6313725490196078,.0470588235,1,0,.6352941176470588,.0823529412,1,0,.6392156862745098,.0980392157,1,0,.6431372549019608,.1137254902,1,0,.6470588235294118,.1294117647,1,0,.6509803921568628,.1647058824,1,0,.6549019607843137,.1803921569,1,0,.6588235294117647,.2,1,0,.6627450980392157,.2156862745,1,0,.6666666666666666,.2470588235,1,0,.6705882352941176,.262745098,1,0,.6745098039215687,.2823529412,1,0,.6784313725490196,.2980392157,1,0,.6823529411764706,.3137254902,1,0,.6862745098039216,.3490196078,1,0,.6901960784313725,.3647058824,1,0,.6941176470588235,.3803921569,1,0,.6980392156862745,.3960784314,1,0,.7019607843137254,.431372549,1,0,.7058823529411765,.4470588235,1,0,.7098039215686275,.4666666667,1,0,.7137254901960784,.4823529412,1,0,.7176470588235294,.5137254902,1,0,.7215686274509804,.5294117647,1,0,.7254901960784313,.5490196078,1,0,.7294117647058823,.5647058824,1,0,.7333333333333333,.6,1,0,.7372549019607844,.6156862745,1,0,.7411764705882353,.631372549,1,0,.7450980392156863,.6470588235,1,0,.7490196078431373,.662745098,1,0,.7529411764705882,.6980392157,1,0,.7568627450980392,.7137254902,1,0,.7607843137254902,.7333333333,1,0,.7647058823529411,.7490196078,1,0,.7686274509803922,.7803921569,1,0,.7725490196078432,.7960784314,1,0,.7764705882352941,.8156862745,1,0,.7803921568627451,.831372549,1,0,.7843137254901961,.8666666667,1,0,.788235294117647,.8823529412,1,0,.792156862745098,.8980392157,1,0,.796078431372549,.9137254902,1,0,.8,.9490196078,1,0,.803921568627451,.9647058824,1,0,.807843137254902,.9803921569,1,0,.8117647058823529,1,1,0,.8156862745098039,1,.9803921569,0,.8196078431372549,1,.9490196078,0,.8235294117647058,1,.9333333333,0,.8274509803921568,1,.9137254902,0,.8313725490196079,1,.8980392157,0,.8352941176470589,1,.8666666667,0,.8392156862745098,1,.8470588235,0,.8431372549019608,1,.831372549,0,.8470588235294118,1,.8156862745,0,.8509803921568627,1,.7803921569,0,.8549019607843137,1,.7647058824,0,.8588235294117647,1,.7490196078,0,.8627450980392157,1,.7333333333,0,.8666666666666667,1,.6980392157,0,.8705882352941177,1,.6823529412,0,.8745098039215686,1,.6666666667,0,.8784313725490196,1,.6470588235,0,.8823529411764706,1,.631372549,0,.8862745098039215,1,.6,0,.8901960784313725,1,.5803921569,0,.8941176470588236,1,.5647058824,0,.8980392156862745,1,.5490196078,0,.9019607843137255,1,.5137254902,0,.9058823529411765,1,.4980392157,0,.9098039215686274,1,.4823529412,0,.9137254901960784,1,.4666666667,0,.9176470588235294,1,.431372549,0,.9215686274509803,1,.4156862745,0,.9254901960784314,1,.4,0,.9294117647058824,1,.3803921569,0,.9333333333333333,1,.3490196078,0,.9372549019607843,1,.3333333333,0,.9411764705882354,1,.3137254902,0,.9450980392156864,1,.2980392157,0,.9490196078431372,1,.2823529412,0,.9529411764705882,1,.2470588235,0,.9568627450980394,1,.231372549,0,.9607843137254903,1,.2156862745,0,.9647058823529413,1,.2,0,.9686274509803922,1,.1647058824,0,.9725490196078431,1,.1490196078,0,.9764705882352941,1,.1333333333,0,.9803921568627451,1,.1137254902,0,.984313725490196,1,.0823529412,0,.9882352941176471,1,.0666666667,0,.9921568627450981,1,.0470588235,0,.996078431372549,1,.031372549,0,1,1,0,0],description:"Rainbow"},{ColorSpace:"RGB",Name:"suv",RGBPoints:[0,1,1,1,.00392156862745098,1,1,1,.00784313725490196,1,1,1,.011764705882352941,1,1,1,.01568627450980392,1,1,1,.0196078431372549,1,1,1,.023529411764705882,1,1,1,.027450980392156862,1,1,1,.03137254901960784,1,1,1,.03529411764705882,1,1,1,.0392156862745098,1,1,1,.043137254901960784,1,1,1,.047058823529411764,1,1,1,.050980392156862744,1,1,1,.054901960784313725,1,1,1,.05882352941176471,1,1,1,.06274509803921569,1,1,1,.06666666666666667,1,1,1,.07058823529411765,1,1,1,.07450980392156863,1,1,1,.0784313725490196,1,1,1,.08235294117647059,1,1,1,.08627450980392157,1,1,1,.09019607843137255,1,1,1,.09411764705882353,1,1,1,.09803921568627451,1,1,1,.10196078431372549,.737254902,.737254902,.737254902,.10588235294117647,.737254902,.737254902,.737254902,.10980392156862745,.737254902,.737254902,.737254902,.11372549019607843,.737254902,.737254902,.737254902,.11764705882352942,.737254902,.737254902,.737254902,.12156862745098039,.737254902,.737254902,.737254902,.12549019607843137,.737254902,.737254902,.737254902,.12941176470588237,.737254902,.737254902,.737254902,.13333333333333333,.737254902,.737254902,.737254902,.13725490196078433,.737254902,.737254902,.737254902,.1411764705882353,.737254902,.737254902,.737254902,.1450980392156863,.737254902,.737254902,.737254902,.14901960784313725,.737254902,.737254902,.737254902,.15294117647058825,.737254902,.737254902,.737254902,.1568627450980392,.737254902,.737254902,.737254902,.1607843137254902,.737254902,.737254902,.737254902,.16470588235294117,.737254902,.737254902,.737254902,.16862745098039217,.737254902,.737254902,.737254902,.17254901960784313,.737254902,.737254902,.737254902,.17647058823529413,.737254902,.737254902,.737254902,.1803921568627451,.737254902,.737254902,.737254902,.1843137254901961,.737254902,.737254902,.737254902,.18823529411764706,.737254902,.737254902,.737254902,.19215686274509805,.737254902,.737254902,.737254902,.19607843137254902,.737254902,.737254902,.737254902,.2,.737254902,.737254902,.737254902,.20392156862745098,.431372549,0,.568627451,.20784313725490197,.431372549,0,.568627451,.21176470588235294,.431372549,0,.568627451,.21568627450980393,.431372549,0,.568627451,.2196078431372549,.431372549,0,.568627451,.2235294117647059,.431372549,0,.568627451,.22745098039215686,.431372549,0,.568627451,.23137254901960785,.431372549,0,.568627451,.23529411764705885,.431372549,0,.568627451,.23921568627450984,.431372549,0,.568627451,.24313725490196078,.431372549,0,.568627451,.24705882352941178,.431372549,0,.568627451,.25098039215686274,.431372549,0,.568627451,.2549019607843137,.431372549,0,.568627451,.25882352941176473,.431372549,0,.568627451,.2627450980392157,.431372549,0,.568627451,.26666666666666666,.431372549,0,.568627451,.27058823529411763,.431372549,0,.568627451,.27450980392156865,.431372549,0,.568627451,.2784313725490196,.431372549,0,.568627451,.2823529411764706,.431372549,0,.568627451,.28627450980392155,.431372549,0,.568627451,.2901960784313726,.431372549,0,.568627451,.29411764705882354,.431372549,0,.568627451,.2980392156862745,.431372549,0,.568627451,.30196078431372547,.431372549,0,.568627451,.3058823529411765,.2509803922,.3333333333,.6509803922,.30980392156862746,.2509803922,.3333333333,.6509803922,.3137254901960784,.2509803922,.3333333333,.6509803922,.3176470588235294,.2509803922,.3333333333,.6509803922,.3215686274509804,.2509803922,.3333333333,.6509803922,.3254901960784314,.2509803922,.3333333333,.6509803922,.32941176470588235,.2509803922,.3333333333,.6509803922,.3333333333333333,.2509803922,.3333333333,.6509803922,.33725490196078434,.2509803922,.3333333333,.6509803922,.3411764705882353,.2509803922,.3333333333,.6509803922,.34509803921568627,.2509803922,.3333333333,.6509803922,.34901960784313724,.2509803922,.3333333333,.6509803922,.35294117647058826,.2509803922,.3333333333,.6509803922,.3568627450980392,.2509803922,.3333333333,.6509803922,.3607843137254902,.2509803922,.3333333333,.6509803922,.36470588235294116,.2509803922,.3333333333,.6509803922,.3686274509803922,.2509803922,.3333333333,.6509803922,.37254901960784315,.2509803922,.3333333333,.6509803922,.3764705882352941,.2509803922,.3333333333,.6509803922,.3803921568627451,.2509803922,.3333333333,.6509803922,.3843137254901961,.2509803922,.3333333333,.6509803922,.38823529411764707,.2509803922,.3333333333,.6509803922,.39215686274509803,.2509803922,.3333333333,.6509803922,.396078431372549,.2509803922,.3333333333,.6509803922,.4,.2509803922,.3333333333,.6509803922,.403921568627451,.2509803922,.3333333333,.6509803922,.40784313725490196,0,.8,1,.4117647058823529,0,.8,1,.41568627450980394,0,.8,1,.4196078431372549,0,.8,1,.4235294117647059,0,.8,1,.42745098039215684,0,.8,1,.43137254901960786,0,.8,1,.43529411764705883,0,.8,1,.4392156862745098,0,.8,1,.44313725490196076,0,.8,1,.4470588235294118,0,.8,1,.45098039215686275,0,.8,1,.4549019607843137,0,.8,1,.4588235294117647,0,.8,1,.4627450980392157,0,.8,1,.4666666666666667,0,.8,1,.4705882352941177,0,.8,1,.4745098039215686,0,.8,1,.4784313725490197,0,.8,1,.48235294117647065,0,.8,1,.48627450980392156,0,.8,1,.49019607843137253,0,.8,1,.49411764705882355,0,.8,1,.4980392156862745,0,.8,1,.5019607843137255,0,.8,1,.5058823529411764,0,.6666666667,.5333333333,.5098039215686274,0,.6666666667,.5333333333,.5137254901960784,0,.6666666667,.5333333333,.5176470588235295,0,.6666666667,.5333333333,.5215686274509804,0,.6666666667,.5333333333,.5254901960784314,0,.6666666667,.5333333333,.5294117647058824,0,.6666666667,.5333333333,.5333333333333333,0,.6666666667,.5333333333,.5372549019607843,0,.6666666667,.5333333333,.5411764705882353,0,.6666666667,.5333333333,.5450980392156862,0,.6666666667,.5333333333,.5490196078431373,0,.6666666667,.5333333333,.5529411764705883,0,.6666666667,.5333333333,.5568627450980392,0,.6666666667,.5333333333,.5607843137254902,0,.6666666667,.5333333333,.5647058823529412,0,.6666666667,.5333333333,.5686274509803921,0,.6666666667,.5333333333,.5725490196078431,0,.6666666667,.5333333333,.5764705882352941,0,.6666666667,.5333333333,.5803921568627451,0,.6666666667,.5333333333,.5843137254901961,0,.6666666667,.5333333333,.5882352941176471,0,.6666666667,.5333333333,.592156862745098,0,.6666666667,.5333333333,.596078431372549,0,.6666666667,.5333333333,.6,0,.6666666667,.5333333333,.6039215686274509,0,.6666666667,.5333333333,.6078431372549019,.4,1,.4,.611764705882353,.4,1,.4,.615686274509804,.4,1,.4,.6196078431372549,.4,1,.4,.6235294117647059,.4,1,.4,.6274509803921569,.4,1,.4,.6313725490196078,.4,1,.4,.6352941176470588,.4,1,.4,.6392156862745098,.4,1,.4,.6431372549019608,.4,1,.4,.6470588235294118,.4,1,.4,.6509803921568628,.4,1,.4,.6549019607843137,.4,1,.4,.6588235294117647,.4,1,.4,.6627450980392157,.4,1,.4,.6666666666666666,.4,1,.4,.6705882352941176,.4,1,.4,.6745098039215687,.4,1,.4,.6784313725490196,.4,1,.4,.6823529411764706,.4,1,.4,.6862745098039216,.4,1,.4,.6901960784313725,.4,1,.4,.6941176470588235,.4,1,.4,.6980392156862745,.4,1,.4,.7019607843137254,.4,1,.4,.7058823529411765,1,.9490196078,0,.7098039215686275,1,.9490196078,0,.7137254901960784,1,.9490196078,0,.7176470588235294,1,.9490196078,0,.7215686274509804,1,.9490196078,0,.7254901960784313,1,.9490196078,0,.7294117647058823,1,.9490196078,0,.7333333333333333,1,.9490196078,0,.7372549019607844,1,.9490196078,0,.7411764705882353,1,.9490196078,0,.7450980392156863,1,.9490196078,0,.7490196078431373,1,.9490196078,0,.7529411764705882,1,.9490196078,0,.7568627450980392,1,.9490196078,0,.7607843137254902,1,.9490196078,0,.7647058823529411,1,.9490196078,0,.7686274509803922,1,.9490196078,0,.7725490196078432,1,.9490196078,0,.7764705882352941,1,.9490196078,0,.7803921568627451,1,.9490196078,0,.7843137254901961,1,.9490196078,0,.788235294117647,1,.9490196078,0,.792156862745098,1,.9490196078,0,.796078431372549,1,.9490196078,0,.8,1,.9490196078,0,.803921568627451,1,.9490196078,0,.807843137254902,.9490196078,.6509803922,.2509803922,.8117647058823529,.9490196078,.6509803922,.2509803922,.8156862745098039,.9490196078,.6509803922,.2509803922,.8196078431372549,.9490196078,.6509803922,.2509803922,.8235294117647058,.9490196078,.6509803922,.2509803922,.8274509803921568,.9490196078,.6509803922,.2509803922,.8313725490196079,.9490196078,.6509803922,.2509803922,.8352941176470589,.9490196078,.6509803922,.2509803922,.8392156862745098,.9490196078,.6509803922,.2509803922,.8431372549019608,.9490196078,.6509803922,.2509803922,.8470588235294118,.9490196078,.6509803922,.2509803922,.8509803921568627,.9490196078,.6509803922,.2509803922,.8549019607843137,.9490196078,.6509803922,.2509803922,.8588235294117647,.9490196078,.6509803922,.2509803922,.8627450980392157,.9490196078,.6509803922,.2509803922,.8666666666666667,.9490196078,.6509803922,.2509803922,.8705882352941177,.9490196078,.6509803922,.2509803922,.8745098039215686,.9490196078,.6509803922,.2509803922,.8784313725490196,.9490196078,.6509803922,.2509803922,.8823529411764706,.9490196078,.6509803922,.2509803922,.8862745098039215,.9490196078,.6509803922,.2509803922,.8901960784313725,.9490196078,.6509803922,.2509803922,.8941176470588236,.9490196078,.6509803922,.2509803922,.8980392156862745,.9490196078,.6509803922,.2509803922,.9019607843137255,.9490196078,.6509803922,.2509803922,.9058823529411765,.9490196078,.6509803922,.2509803922,.9098039215686274,1,0,0,.9137254901960784,1,0,0,.9176470588235294,1,0,0,.9215686274509803,1,0,0,.9254901960784314,1,0,0,.9294117647058824,1,0,0,.9333333333333333,1,0,0,.9372549019607843,1,0,0,.9411764705882354,1,0,0,.9450980392156864,1,0,0,.9490196078431372,1,0,0,.9529411764705882,1,0,0,.9568627450980394,1,0,0,.9607843137254903,1,0,0,.9647058823529413,1,0,0,.9686274509803922,1,0,0,.9725490196078431,1,0,0,.9764705882352941,1,0,0,.9803921568627451,1,0,0,.984313725490196,1,0,0,.9882352941176471,1,0,0,.9921568627450981,1,0,0,.996078431372549,1,0,0,1,1,0,0],description:"SUV"},{ColorSpace:"RGB",Name:"ge_256",RGBPoints:[0,.0039215686,.0078431373,.0078431373,.00392156862745098,.0039215686,.0078431373,.0078431373,.00784313725490196,.0039215686,.0078431373,.0117647059,.011764705882352941,.0039215686,.0117647059,.0156862745,.01568627450980392,.0039215686,.0117647059,.0196078431,.0196078431372549,.0039215686,.0156862745,.0235294118,.023529411764705882,.0039215686,.0156862745,.0274509804,.027450980392156862,.0039215686,.0196078431,.031372549,.03137254901960784,.0039215686,.0196078431,.0352941176,.03529411764705882,.0039215686,.0235294118,.0392156863,.0392156862745098,.0039215686,.0235294118,.0431372549,.043137254901960784,.0039215686,.0274509804,.0470588235,.047058823529411764,.0039215686,.0274509804,.0509803922,.050980392156862744,.0039215686,.031372549,.0549019608,.054901960784313725,.0039215686,.031372549,.0588235294,.05882352941176471,.0039215686,.0352941176,.062745098,.06274509803921569,.0039215686,.0352941176,.0666666667,.06666666666666667,.0039215686,.0392156863,.0705882353,.07058823529411765,.0039215686,.0392156863,.0745098039,.07450980392156863,.0039215686,.0431372549,.0784313725,.0784313725490196,.0039215686,.0431372549,.0823529412,.08235294117647059,.0039215686,.0470588235,.0862745098,.08627450980392157,.0039215686,.0470588235,.0901960784,.09019607843137255,.0039215686,.0509803922,.0941176471,.09411764705882353,.0039215686,.0509803922,.0980392157,.09803921568627451,.0039215686,.0549019608,.1019607843,.10196078431372549,.0039215686,.0549019608,.1058823529,.10588235294117647,.0039215686,.0588235294,.1098039216,.10980392156862745,.0039215686,.0588235294,.1137254902,.11372549019607843,.0039215686,.062745098,.1176470588,.11764705882352942,.0039215686,.062745098,.1215686275,.12156862745098039,.0039215686,.0666666667,.1254901961,.12549019607843137,.0039215686,.0666666667,.1294117647,.12941176470588237,.0039215686,.0705882353,.1333333333,.13333333333333333,.0039215686,.0705882353,.137254902,.13725490196078433,.0039215686,.0745098039,.1411764706,.1411764705882353,.0039215686,.0745098039,.1450980392,.1450980392156863,.0039215686,.0784313725,.1490196078,.14901960784313725,.0039215686,.0784313725,.1529411765,.15294117647058825,.0039215686,.0823529412,.1568627451,.1568627450980392,.0039215686,.0823529412,.1607843137,.1607843137254902,.0039215686,.0862745098,.1647058824,.16470588235294117,.0039215686,.0862745098,.168627451,.16862745098039217,.0039215686,.0901960784,.1725490196,.17254901960784313,.0039215686,.0901960784,.1764705882,.17647058823529413,.0039215686,.0941176471,.1803921569,.1803921568627451,.0039215686,.0941176471,.1843137255,.1843137254901961,.0039215686,.0980392157,.1882352941,.18823529411764706,.0039215686,.0980392157,.1921568627,.19215686274509805,.0039215686,.1019607843,.1960784314,.19607843137254902,.0039215686,.1019607843,.2,.2,.0039215686,.1058823529,.2039215686,.20392156862745098,.0039215686,.1058823529,.2078431373,.20784313725490197,.0039215686,.1098039216,.2117647059,.21176470588235294,.0039215686,.1098039216,.2156862745,.21568627450980393,.0039215686,.1137254902,.2196078431,.2196078431372549,.0039215686,.1137254902,.2235294118,.2235294117647059,.0039215686,.1176470588,.2274509804,.22745098039215686,.0039215686,.1176470588,.231372549,.23137254901960785,.0039215686,.1215686275,.2352941176,.23529411764705885,.0039215686,.1215686275,.2392156863,.23921568627450984,.0039215686,.1254901961,.2431372549,.24313725490196078,.0039215686,.1254901961,.2470588235,.24705882352941178,.0039215686,.1294117647,.2509803922,.25098039215686274,.0039215686,.1294117647,.2509803922,.2549019607843137,.0078431373,.1254901961,.2549019608,.25882352941176473,.0156862745,.1254901961,.2588235294,.2627450980392157,.0235294118,.1215686275,.262745098,.26666666666666666,.031372549,.1215686275,.2666666667,.27058823529411763,.0392156863,.1176470588,.2705882353,.27450980392156865,.0470588235,.1176470588,.2745098039,.2784313725490196,.0549019608,.1137254902,.2784313725,.2823529411764706,.062745098,.1137254902,.2823529412,.28627450980392155,.0705882353,.1098039216,.2862745098,.2901960784313726,.0784313725,.1098039216,.2901960784,.29411764705882354,.0862745098,.1058823529,.2941176471,.2980392156862745,.0941176471,.1058823529,.2980392157,.30196078431372547,.1019607843,.1019607843,.3019607843,.3058823529411765,.1098039216,.1019607843,.3058823529,.30980392156862746,.1176470588,.0980392157,.3098039216,.3137254901960784,.1254901961,.0980392157,.3137254902,.3176470588235294,.1333333333,.0941176471,.3176470588,.3215686274509804,.1411764706,.0941176471,.3215686275,.3254901960784314,.1490196078,.0901960784,.3254901961,.32941176470588235,.1568627451,.0901960784,.3294117647,.3333333333333333,.1647058824,.0862745098,.3333333333,.33725490196078434,.1725490196,.0862745098,.337254902,.3411764705882353,.1803921569,.0823529412,.3411764706,.34509803921568627,.1882352941,.0823529412,.3450980392,.34901960784313724,.1960784314,.0784313725,.3490196078,.35294117647058826,.2039215686,.0784313725,.3529411765,.3568627450980392,.2117647059,.0745098039,.3568627451,.3607843137254902,.2196078431,.0745098039,.3607843137,.36470588235294116,.2274509804,.0705882353,.3647058824,.3686274509803922,.2352941176,.0705882353,.368627451,.37254901960784315,.2431372549,.0666666667,.3725490196,.3764705882352941,.2509803922,.0666666667,.3764705882,.3803921568627451,.2549019608,.062745098,.3803921569,.3843137254901961,.262745098,.062745098,.3843137255,.38823529411764707,.2705882353,.0588235294,.3882352941,.39215686274509803,.2784313725,.0588235294,.3921568627,.396078431372549,.2862745098,.0549019608,.3960784314,.4,.2941176471,.0549019608,.4,.403921568627451,.3019607843,.0509803922,.4039215686,.40784313725490196,.3098039216,.0509803922,.4078431373,.4117647058823529,.3176470588,.0470588235,.4117647059,.41568627450980394,.3254901961,.0470588235,.4156862745,.4196078431372549,.3333333333,.0431372549,.4196078431,.4235294117647059,.3411764706,.0431372549,.4235294118,.42745098039215684,.3490196078,.0392156863,.4274509804,.43137254901960786,.3568627451,.0392156863,.431372549,.43529411764705883,.3647058824,.0352941176,.4352941176,.4392156862745098,.3725490196,.0352941176,.4392156863,.44313725490196076,.3803921569,.031372549,.4431372549,.4470588235294118,.3882352941,.031372549,.4470588235,.45098039215686275,.3960784314,.0274509804,.4509803922,.4549019607843137,.4039215686,.0274509804,.4549019608,.4588235294117647,.4117647059,.0235294118,.4588235294,.4627450980392157,.4196078431,.0235294118,.462745098,.4666666666666667,.4274509804,.0196078431,.4666666667,.4705882352941177,.4352941176,.0196078431,.4705882353,.4745098039215686,.4431372549,.0156862745,.4745098039,.4784313725490197,.4509803922,.0156862745,.4784313725,.48235294117647065,.4588235294,.0117647059,.4823529412,.48627450980392156,.4666666667,.0117647059,.4862745098,.49019607843137253,.4745098039,.0078431373,.4901960784,.49411764705882355,.4823529412,.0078431373,.4941176471,.4980392156862745,.4901960784,.0039215686,.4980392157,.5019607843137255,.4980392157,.0117647059,.4980392157,.5058823529411764,.5058823529,.0156862745,.4901960784,.5098039215686274,.5137254902,.0235294118,.4823529412,.5137254901960784,.5215686275,.0274509804,.4745098039,.5176470588235295,.5294117647,.0352941176,.4666666667,.5215686274509804,.537254902,.0392156863,.4588235294,.5254901960784314,.5450980392,.0470588235,.4509803922,.5294117647058824,.5529411765,.0509803922,.4431372549,.5333333333333333,.5607843137,.0588235294,.4352941176,.5372549019607843,.568627451,.062745098,.4274509804,.5411764705882353,.5764705882,.0705882353,.4196078431,.5450980392156862,.5843137255,.0745098039,.4117647059,.5490196078431373,.5921568627,.0823529412,.4039215686,.5529411764705883,.6,.0862745098,.3960784314,.5568627450980392,.6078431373,.0941176471,.3882352941,.5607843137254902,.6156862745,.0980392157,.3803921569,.5647058823529412,.6235294118,.1058823529,.3725490196,.5686274509803921,.631372549,.1098039216,.3647058824,.5725490196078431,.6392156863,.1176470588,.3568627451,.5764705882352941,.6470588235,.1215686275,.3490196078,.5803921568627451,.6549019608,.1294117647,.3411764706,.5843137254901961,.662745098,.1333333333,.3333333333,.5882352941176471,.6705882353,.1411764706,.3254901961,.592156862745098,.6784313725,.1450980392,.3176470588,.596078431372549,.6862745098,.1529411765,.3098039216,.6,.6941176471,.1568627451,.3019607843,.6039215686274509,.7019607843,.1647058824,.2941176471,.6078431372549019,.7098039216,.168627451,.2862745098,.611764705882353,.7176470588,.1764705882,.2784313725,.615686274509804,.7254901961,.1803921569,.2705882353,.6196078431372549,.7333333333,.1882352941,.262745098,.6235294117647059,.7411764706,.1921568627,.2549019608,.6274509803921569,.7490196078,.2,.2509803922,.6313725490196078,.7529411765,.2039215686,.2431372549,.6352941176470588,.7607843137,.2117647059,.2352941176,.6392156862745098,.768627451,.2156862745,.2274509804,.6431372549019608,.7764705882,.2235294118,.2196078431,.6470588235294118,.7843137255,.2274509804,.2117647059,.6509803921568628,.7921568627,.2352941176,.2039215686,.6549019607843137,.8,.2392156863,.1960784314,.6588235294117647,.8078431373,.2470588235,.1882352941,.6627450980392157,.8156862745,.2509803922,.1803921569,.6666666666666666,.8235294118,.2549019608,.1725490196,.6705882352941176,.831372549,.2588235294,.1647058824,.6745098039215687,.8392156863,.2666666667,.1568627451,.6784313725490196,.8470588235,.2705882353,.1490196078,.6823529411764706,.8549019608,.2784313725,.1411764706,.6862745098039216,.862745098,.2823529412,.1333333333,.6901960784313725,.8705882353,.2901960784,.1254901961,.6941176470588235,.8784313725,.2941176471,.1176470588,.6980392156862745,.8862745098,.3019607843,.1098039216,.7019607843137254,.8941176471,.3058823529,.1019607843,.7058823529411765,.9019607843,.3137254902,.0941176471,.7098039215686275,.9098039216,.3176470588,.0862745098,.7137254901960784,.9176470588,.3254901961,.0784313725,.7176470588235294,.9254901961,.3294117647,.0705882353,.7215686274509804,.9333333333,.337254902,.062745098,.7254901960784313,.9411764706,.3411764706,.0549019608,.7294117647058823,.9490196078,.3490196078,.0470588235,.7333333333333333,.9568627451,.3529411765,.0392156863,.7372549019607844,.9647058824,.3607843137,.031372549,.7411764705882353,.9725490196,.3647058824,.0235294118,.7450980392156863,.9803921569,.3725490196,.0156862745,.7490196078431373,.9882352941,.3725490196,.0039215686,.7529411764705882,.9960784314,.3843137255,.0156862745,.7568627450980392,.9960784314,.3921568627,.031372549,.7607843137254902,.9960784314,.4039215686,.0470588235,.7647058823529411,.9960784314,.4117647059,.062745098,.7686274509803922,.9960784314,.4235294118,.0784313725,.7725490196078432,.9960784314,.431372549,.0941176471,.7764705882352941,.9960784314,.4431372549,.1098039216,.7803921568627451,.9960784314,.4509803922,.1254901961,.7843137254901961,.9960784314,.462745098,.1411764706,.788235294117647,.9960784314,.4705882353,.1568627451,.792156862745098,.9960784314,.4823529412,.1725490196,.796078431372549,.9960784314,.4901960784,.1882352941,.8,.9960784314,.5019607843,.2039215686,.803921568627451,.9960784314,.5098039216,.2196078431,.807843137254902,.9960784314,.5215686275,.2352941176,.8117647058823529,.9960784314,.5294117647,.2509803922,.8156862745098039,.9960784314,.5411764706,.262745098,.8196078431372549,.9960784314,.5490196078,.2784313725,.8235294117647058,.9960784314,.5607843137,.2941176471,.8274509803921568,.9960784314,.568627451,.3098039216,.8313725490196079,.9960784314,.5803921569,.3254901961,.8352941176470589,.9960784314,.5882352941,.3411764706,.8392156862745098,.9960784314,.6,.3568627451,.8431372549019608,.9960784314,.6078431373,.3725490196,.8470588235294118,.9960784314,.6196078431,.3882352941,.8509803921568627,.9960784314,.6274509804,.4039215686,.8549019607843137,.9960784314,.6392156863,.4196078431,.8588235294117647,.9960784314,.6470588235,.4352941176,.8627450980392157,.9960784314,.6588235294,.4509803922,.8666666666666667,.9960784314,.6666666667,.4666666667,.8705882352941177,.9960784314,.6784313725,.4823529412,.8745098039215686,.9960784314,.6862745098,.4980392157,.8784313725490196,.9960784314,.6980392157,.5137254902,.8823529411764706,.9960784314,.7058823529,.5294117647,.8862745098039215,.9960784314,.7176470588,.5450980392,.8901960784313725,.9960784314,.7254901961,.5607843137,.8941176470588236,.9960784314,.737254902,.5764705882,.8980392156862745,.9960784314,.7450980392,.5921568627,.9019607843137255,.9960784314,.7529411765,.6078431373,.9058823529411765,.9960784314,.7607843137,.6235294118,.9098039215686274,.9960784314,.7725490196,.6392156863,.9137254901960784,.9960784314,.7803921569,.6549019608,.9176470588235294,.9960784314,.7921568627,.6705882353,.9215686274509803,.9960784314,.8,.6862745098,.9254901960784314,.9960784314,.8117647059,.7019607843,.9294117647058824,.9960784314,.8196078431,.7176470588,.9333333333333333,.9960784314,.831372549,.7333333333,.9372549019607843,.9960784314,.8392156863,.7490196078,.9411764705882354,.9960784314,.8509803922,.7607843137,.9450980392156864,.9960784314,.8588235294,.7764705882,.9490196078431372,.9960784314,.8705882353,.7921568627,.9529411764705882,.9960784314,.8784313725,.8078431373,.9568627450980394,.9960784314,.8901960784,.8235294118,.9607843137254903,.9960784314,.8980392157,.8392156863,.9647058823529413,.9960784314,.9098039216,.8549019608,.9686274509803922,.9960784314,.9176470588,.8705882353,.9725490196078431,.9960784314,.9294117647,.8862745098,.9764705882352941,.9960784314,.937254902,.9019607843,.9803921568627451,.9960784314,.9490196078,.9176470588,.984313725490196,.9960784314,.9568627451,.9333333333,.9882352941176471,.9960784314,.968627451,.9490196078,.9921568627450981,.9960784314,.9764705882,.9647058824,.996078431372549,.9960784314,.9882352941,.9803921569,1,.9960784314,.9882352941,.9803921569],description:"GE 256"},{ColorSpace:"RGB",Name:"ge",RGBPoints:[0,.0078431373,.0078431373,.0078431373,.00392156862745098,.0078431373,.0078431373,.0078431373,.00784313725490196,.0078431373,.0078431373,.0078431373,.011764705882352941,.0078431373,.0078431373,.0078431373,.01568627450980392,.0078431373,.0078431373,.0078431373,.0196078431372549,.0078431373,.0078431373,.0078431373,.023529411764705882,.0078431373,.0078431373,.0078431373,.027450980392156862,.0078431373,.0078431373,.0078431373,.03137254901960784,.0078431373,.0078431373,.0078431373,.03529411764705882,.0078431373,.0078431373,.0078431373,.0392156862745098,.0078431373,.0078431373,.0078431373,.043137254901960784,.0078431373,.0078431373,.0078431373,.047058823529411764,.0078431373,.0078431373,.0078431373,.050980392156862744,.0078431373,.0078431373,.0078431373,.054901960784313725,.0078431373,.0078431373,.0078431373,.05882352941176471,.0117647059,.0078431373,.0078431373,.06274509803921569,.0078431373,.0156862745,.0156862745,.06666666666666667,.0078431373,.0235294118,.0235294118,.07058823529411765,.0078431373,.031372549,.031372549,.07450980392156863,.0078431373,.0392156863,.0392156863,.0784313725490196,.0078431373,.0470588235,.0470588235,.08235294117647059,.0078431373,.0549019608,.0549019608,.08627450980392157,.0078431373,.062745098,.062745098,.09019607843137255,.0078431373,.0705882353,.0705882353,.09411764705882353,.0078431373,.0784313725,.0784313725,.09803921568627451,.0078431373,.0901960784,.0862745098,.10196078431372549,.0078431373,.0980392157,.0941176471,.10588235294117647,.0078431373,.1058823529,.1019607843,.10980392156862745,.0078431373,.1137254902,.1098039216,.11372549019607843,.0078431373,.1215686275,.1176470588,.11764705882352942,.0078431373,.1294117647,.1254901961,.12156862745098039,.0078431373,.137254902,.1333333333,.12549019607843137,.0078431373,.1450980392,.1411764706,.12941176470588237,.0078431373,.1529411765,.1490196078,.13333333333333333,.0078431373,.1647058824,.1568627451,.13725490196078433,.0078431373,.1725490196,.1647058824,.1411764705882353,.0078431373,.1803921569,.1725490196,.1450980392156863,.0078431373,.1882352941,.1803921569,.14901960784313725,.0078431373,.1960784314,.1882352941,.15294117647058825,.0078431373,.2039215686,.1960784314,.1568627450980392,.0078431373,.2117647059,.2039215686,.1607843137254902,.0078431373,.2196078431,.2117647059,.16470588235294117,.0078431373,.2274509804,.2196078431,.16862745098039217,.0078431373,.2352941176,.2274509804,.17254901960784313,.0078431373,.2470588235,.2352941176,.17647058823529413,.0078431373,.2509803922,.2431372549,.1803921568627451,.0078431373,.2549019608,.2509803922,.1843137254901961,.0078431373,.262745098,.2509803922,.18823529411764706,.0078431373,.2705882353,.2588235294,.19215686274509805,.0078431373,.2784313725,.2666666667,.19607843137254902,.0078431373,.2862745098,.2745098039,.2,.0078431373,.2941176471,.2823529412,.20392156862745098,.0078431373,.3019607843,.2901960784,.20784313725490197,.0078431373,.3137254902,.2980392157,.21176470588235294,.0078431373,.3215686275,.3058823529,.21568627450980393,.0078431373,.3294117647,.3137254902,.2196078431372549,.0078431373,.337254902,.3215686275,.2235294117647059,.0078431373,.3450980392,.3294117647,.22745098039215686,.0078431373,.3529411765,.337254902,.23137254901960785,.0078431373,.3607843137,.3450980392,.23529411764705885,.0078431373,.368627451,.3529411765,.23921568627450984,.0078431373,.3764705882,.3607843137,.24313725490196078,.0078431373,.3843137255,.368627451,.24705882352941178,.0078431373,.3960784314,.3764705882,.25098039215686274,.0078431373,.4039215686,.3843137255,.2549019607843137,.0078431373,.4117647059,.3921568627,.25882352941176473,.0078431373,.4196078431,.4,.2627450980392157,.0078431373,.4274509804,.4078431373,.26666666666666666,.0078431373,.4352941176,.4156862745,.27058823529411763,.0078431373,.4431372549,.4235294118,.27450980392156865,.0078431373,.4509803922,.431372549,.2784313725490196,.0078431373,.4588235294,.4392156863,.2823529411764706,.0078431373,.4705882353,.4470588235,.28627450980392155,.0078431373,.4784313725,.4549019608,.2901960784313726,.0078431373,.4862745098,.462745098,.29411764705882354,.0078431373,.4941176471,.4705882353,.2980392156862745,.0078431373,.5019607843,.4784313725,.30196078431372547,.0117647059,.5098039216,.4862745098,.3058823529411765,.0196078431,.5019607843,.4941176471,.30980392156862746,.0274509804,.4941176471,.5058823529,.3137254901960784,.0352941176,.4862745098,.5137254902,.3176470588235294,.0431372549,.4784313725,.5215686275,.3215686274509804,.0509803922,.4705882353,.5294117647,.3254901960784314,.0588235294,.462745098,.537254902,.32941176470588235,.0666666667,.4549019608,.5450980392,.3333333333333333,.0745098039,.4470588235,.5529411765,.33725490196078434,.0823529412,.4392156863,.5607843137,.3411764705882353,.0901960784,.431372549,.568627451,.34509803921568627,.0980392157,.4235294118,.5764705882,.34901960784313724,.1058823529,.4156862745,.5843137255,.35294117647058826,.1137254902,.4078431373,.5921568627,.3568627450980392,.1215686275,.4,.6,.3607843137254902,.1294117647,.3921568627,.6078431373,.36470588235294116,.137254902,.3843137255,.6156862745,.3686274509803922,.1450980392,.3764705882,.6235294118,.37254901960784315,.1529411765,.368627451,.631372549,.3764705882352941,.1607843137,.3607843137,.6392156863,.3803921568627451,.168627451,.3529411765,.6470588235,.3843137254901961,.1764705882,.3450980392,.6549019608,.38823529411764707,.1843137255,.337254902,.662745098,.39215686274509803,.1921568627,.3294117647,.6705882353,.396078431372549,.2,.3215686275,.6784313725,.4,.2078431373,.3137254902,.6862745098,.403921568627451,.2156862745,.3058823529,.6941176471,.40784313725490196,.2235294118,.2980392157,.7019607843,.4117647058823529,.231372549,.2901960784,.7098039216,.41568627450980394,.2392156863,.2823529412,.7176470588,.4196078431372549,.2470588235,.2745098039,.7254901961,.4235294117647059,.2509803922,.2666666667,.7333333333,.42745098039215684,.2509803922,.2588235294,.7411764706,.43137254901960786,.2588235294,.2509803922,.7490196078,.43529411764705883,.2666666667,.2509803922,.7490196078,.4392156862745098,.2745098039,.2431372549,.7568627451,.44313725490196076,.2823529412,.2352941176,.7647058824,.4470588235294118,.2901960784,.2274509804,.7725490196,.45098039215686275,.2980392157,.2196078431,.7803921569,.4549019607843137,.3058823529,.2117647059,.7882352941,.4588235294117647,.3137254902,.2039215686,.7960784314,.4627450980392157,.3215686275,.1960784314,.8039215686,.4666666666666667,.3294117647,.1882352941,.8117647059,.4705882352941177,.337254902,.1803921569,.8196078431,.4745098039215686,.3450980392,.1725490196,.8274509804,.4784313725490197,.3529411765,.1647058824,.8352941176,.48235294117647065,.3607843137,.1568627451,.8431372549,.48627450980392156,.368627451,.1490196078,.8509803922,.49019607843137253,.3764705882,.1411764706,.8588235294,.49411764705882355,.3843137255,.1333333333,.8666666667,.4980392156862745,.3921568627,.1254901961,.8745098039,.5019607843137255,.4,.1176470588,.8823529412,.5058823529411764,.4078431373,.1098039216,.8901960784,.5098039215686274,.4156862745,.1019607843,.8980392157,.5137254901960784,.4235294118,.0941176471,.9058823529,.5176470588235295,.431372549,.0862745098,.9137254902,.5215686274509804,.4392156863,.0784313725,.9215686275,.5254901960784314,.4470588235,.0705882353,.9294117647,.5294117647058824,.4549019608,.062745098,.937254902,.5333333333333333,.462745098,.0549019608,.9450980392,.5372549019607843,.4705882353,.0470588235,.9529411765,.5411764705882353,.4784313725,.0392156863,.9607843137,.5450980392156862,.4862745098,.031372549,.968627451,.5490196078431373,.4941176471,.0235294118,.9764705882,.5529411764705883,.4980392157,.0156862745,.9843137255,.5568627450980392,.5058823529,.0078431373,.9921568627,.5607843137254902,.5137254902,.0156862745,.9803921569,.5647058823529412,.5215686275,.0235294118,.9647058824,.5686274509803921,.5294117647,.0352941176,.9490196078,.5725490196078431,.537254902,.0431372549,.9333333333,.5764705882352941,.5450980392,.0509803922,.9176470588,.5803921568627451,.5529411765,.062745098,.9019607843,.5843137254901961,.5607843137,.0705882353,.8862745098,.5882352941176471,.568627451,.0784313725,.8705882353,.592156862745098,.5764705882,.0901960784,.8549019608,.596078431372549,.5843137255,.0980392157,.8392156863,.6,.5921568627,.1098039216,.8235294118,.6039215686274509,.6,.1176470588,.8078431373,.6078431372549019,.6078431373,.1254901961,.7921568627,.611764705882353,.6156862745,.137254902,.7764705882,.615686274509804,.6235294118,.1450980392,.7607843137,.6196078431372549,.631372549,.1529411765,.7490196078,.6235294117647059,.6392156863,.1647058824,.737254902,.6274509803921569,.6470588235,.1725490196,.7215686275,.6313725490196078,.6549019608,.1843137255,.7058823529,.6352941176470588,.662745098,.1921568627,.6901960784,.6392156862745098,.6705882353,.2,.6745098039,.6431372549019608,.6784313725,.2117647059,.6588235294,.6470588235294118,.6862745098,.2196078431,.6431372549,.6509803921568628,.6941176471,.2274509804,.6274509804,.6549019607843137,.7019607843,.2392156863,.6117647059,.6588235294117647,.7098039216,.2470588235,.5960784314,.6627450980392157,.7176470588,.2509803922,.5803921569,.6666666666666666,.7254901961,.2588235294,.5647058824,.6705882352941176,.7333333333,.2666666667,.5490196078,.6745098039215687,.7411764706,.2784313725,.5333333333,.6784313725490196,.7490196078,.2862745098,.5176470588,.6823529411764706,.7490196078,.2941176471,.5019607843,.6862745098039216,.7529411765,.3058823529,.4862745098,.6901960784313725,.7607843137,.3137254902,.4705882353,.6941176470588235,.768627451,.3215686275,.4549019608,.6980392156862745,.7764705882,.3333333333,.4392156863,.7019607843137254,.7843137255,.3411764706,.4235294118,.7058823529411765,.7921568627,.3529411765,.4078431373,.7098039215686275,.8,.3607843137,.3921568627,.7137254901960784,.8078431373,.368627451,.3764705882,.7176470588235294,.8156862745,.3803921569,.3607843137,.7215686274509804,.8235294118,.3882352941,.3450980392,.7254901960784313,.831372549,.3960784314,.3294117647,.7294117647058823,.8392156863,.4078431373,.3137254902,.7333333333333333,.8470588235,.4156862745,.2980392157,.7372549019607844,.8549019608,.4274509804,.2823529412,.7411764705882353,.862745098,.4352941176,.2666666667,.7450980392156863,.8705882353,.4431372549,.2509803922,.7490196078431373,.8784313725,.4549019608,.2431372549,.7529411764705882,.8862745098,.462745098,.2274509804,.7568627450980392,.8941176471,.4705882353,.2117647059,.7607843137254902,.9019607843,.4823529412,.1960784314,.7647058823529411,.9098039216,.4901960784,.1803921569,.7686274509803922,.9176470588,.4980392157,.1647058824,.7725490196078432,.9254901961,.5098039216,.1490196078,.7764705882352941,.9333333333,.5176470588,.1333333333,.7803921568627451,.9411764706,.5294117647,.1176470588,.7843137254901961,.9490196078,.537254902,.1019607843,.788235294117647,.9568627451,.5450980392,.0862745098,.792156862745098,.9647058824,.5568627451,.0705882353,.796078431372549,.9725490196,.5647058824,.0549019608,.8,.9803921569,.5725490196,.0392156863,.803921568627451,.9882352941,.5843137255,.0235294118,.807843137254902,.9921568627,.5921568627,.0078431373,.8117647058823529,.9921568627,.6039215686,.0274509804,.8156862745098039,.9921568627,.6117647059,.0509803922,.8196078431372549,.9921568627,.6196078431,.0745098039,.8235294117647058,.9921568627,.631372549,.0980392157,.8274509803921568,.9921568627,.6392156863,.1215686275,.8313725490196079,.9921568627,.6470588235,.1411764706,.8352941176470589,.9921568627,.6588235294,.1647058824,.8392156862745098,.9921568627,.6666666667,.1882352941,.8431372549019608,.9921568627,.6784313725,.2117647059,.8470588235294118,.9921568627,.6862745098,.2352941176,.8509803921568627,.9921568627,.6941176471,.2509803922,.8549019607843137,.9921568627,.7058823529,.2705882353,.8588235294117647,.9921568627,.7137254902,.2941176471,.8627450980392157,.9921568627,.7215686275,.3176470588,.8666666666666667,.9921568627,.7333333333,.3411764706,.8705882352941177,.9921568627,.7411764706,.3647058824,.8745098039215686,.9921568627,.7490196078,.3843137255,.8784313725490196,.9921568627,.7529411765,.4078431373,.8823529411764706,.9921568627,.7607843137,.431372549,.8862745098039215,.9921568627,.7725490196,.4549019608,.8901960784313725,.9921568627,.7803921569,.4784313725,.8941176470588236,.9921568627,.7882352941,.4980392157,.8980392156862745,.9921568627,.8,.5215686275,.9019607843137255,.9921568627,.8078431373,.5450980392,.9058823529411765,.9921568627,.8156862745,.568627451,.9098039215686274,.9921568627,.8274509804,.5921568627,.9137254901960784,.9921568627,.8352941176,.6156862745,.9176470588235294,.9921568627,.8470588235,.6352941176,.9215686274509803,.9921568627,.8549019608,.6588235294,.9254901960784314,.9921568627,.862745098,.6823529412,.9294117647058824,.9921568627,.8745098039,.7058823529,.9333333333333333,.9921568627,.8823529412,.7294117647,.9372549019607843,.9921568627,.8901960784,.7490196078,.9411764705882354,.9921568627,.9019607843,.7647058824,.9450980392156864,.9921568627,.9098039216,.7882352941,.9490196078431372,.9921568627,.9215686275,.8117647059,.9529411764705882,.9921568627,.9294117647,.8352941176,.9568627450980394,.9921568627,.937254902,.8588235294,.9607843137254903,.9921568627,.9490196078,.8784313725,.9647058823529413,.9921568627,.9568627451,.9019607843,.9686274509803922,.9921568627,.9647058824,.9254901961,.9725490196078431,.9921568627,.9764705882,.9490196078,.9764705882352941,.9921568627,.9843137255,.9725490196,.9803921568627451,.9921568627,.9921568627,.9921568627,.984313725490196,.9921568627,.9921568627,.9921568627,.9882352941176471,.9921568627,.9921568627,.9921568627,.9921568627450981,.9921568627,.9921568627,.9921568627,.996078431372549,.9921568627,.9921568627,.9921568627,1,.9921568627,.9921568627,.9921568627],description:"GE"},{ColorSpace:"RGB",Name:"siemens",RGBPoints:[0,.0078431373,.0039215686,.1254901961,.00392156862745098,.0078431373,.0039215686,.1254901961,.00784313725490196,.0078431373,.0039215686,.1882352941,.011764705882352941,.0117647059,.0039215686,.2509803922,.01568627450980392,.0117647059,.0039215686,.3098039216,.0196078431372549,.0156862745,.0039215686,.3725490196,.023529411764705882,.0156862745,.0039215686,.3725490196,.027450980392156862,.0156862745,.0039215686,.3725490196,.03137254901960784,.0156862745,.0039215686,.3725490196,.03529411764705882,.0156862745,.0039215686,.3725490196,.0392156862745098,.0156862745,.0039215686,.3725490196,.043137254901960784,.0156862745,.0039215686,.3725490196,.047058823529411764,.0156862745,.0039215686,.3725490196,.050980392156862744,.0156862745,.0039215686,.3725490196,.054901960784313725,.0156862745,.0039215686,.3725490196,.05882352941176471,.0156862745,.0039215686,.3725490196,.06274509803921569,.0156862745,.0039215686,.3882352941,.06666666666666667,.0156862745,.0039215686,.4078431373,.07058823529411765,.0156862745,.0039215686,.4235294118,.07450980392156863,.0156862745,.0039215686,.4431372549,.0784313725490196,.0156862745,.0039215686,.462745098,.08235294117647059,.0156862745,.0039215686,.4784313725,.08627450980392157,.0156862745,.0039215686,.4980392157,.09019607843137255,.0196078431,.0039215686,.5137254902,.09411764705882353,.0196078431,.0039215686,.5333333333,.09803921568627451,.0196078431,.0039215686,.5529411765,.10196078431372549,.0196078431,.0039215686,.568627451,.10588235294117647,.0196078431,.0039215686,.5882352941,.10980392156862745,.0196078431,.0039215686,.6039215686,.11372549019607843,.0196078431,.0039215686,.6235294118,.11764705882352942,.0196078431,.0039215686,.6431372549,.12156862745098039,.0235294118,.0039215686,.6588235294,.12549019607843137,.0235294118,.0039215686,.6784313725,.12941176470588237,.0235294118,.0039215686,.6980392157,.13333333333333333,.0235294118,.0039215686,.7137254902,.13725490196078433,.0235294118,.0039215686,.7333333333,.1411764705882353,.0235294118,.0039215686,.7490196078,.1450980392156863,.0235294118,.0039215686,.7647058824,.14901960784313725,.0235294118,.0039215686,.7843137255,.15294117647058825,.0274509804,.0039215686,.8,.1568627450980392,.0274509804,.0039215686,.8196078431,.1607843137254902,.0274509804,.0039215686,.8352941176,.16470588235294117,.0274509804,.0039215686,.8549019608,.16862745098039217,.0274509804,.0039215686,.8745098039,.17254901960784313,.0274509804,.0039215686,.8901960784,.17647058823529413,.0274509804,.0039215686,.9098039216,.1803921568627451,.031372549,.0039215686,.9294117647,.1843137254901961,.031372549,.0039215686,.9254901961,.18823529411764706,.0509803922,.0039215686,.9098039216,.19215686274509805,.0705882353,.0039215686,.8901960784,.19607843137254902,.0901960784,.0039215686,.8705882353,.2,.1137254902,.0039215686,.8509803922,.20392156862745098,.1333333333,.0039215686,.831372549,.20784313725490197,.1529411765,.0039215686,.8117647059,.21176470588235294,.1725490196,.0039215686,.7921568627,.21568627450980393,.1960784314,.0039215686,.7725490196,.2196078431372549,.2156862745,.0039215686,.7529411765,.2235294117647059,.2352941176,.0039215686,.737254902,.22745098039215686,.2509803922,.0039215686,.7176470588,.23137254901960785,.2745098039,.0039215686,.6980392157,.23529411764705885,.2941176471,.0039215686,.6784313725,.23921568627450984,.3137254902,.0039215686,.6588235294,.24313725490196078,.3333333333,.0039215686,.6392156863,.24705882352941178,.3568627451,.0039215686,.6196078431,.25098039215686274,.3764705882,.0039215686,.6,.2549019607843137,.3960784314,.0039215686,.5803921569,.25882352941176473,.4156862745,.0039215686,.5607843137,.2627450980392157,.4392156863,.0039215686,.5411764706,.26666666666666666,.4588235294,.0039215686,.5215686275,.27058823529411763,.4784313725,.0039215686,.5019607843,.27450980392156865,.4980392157,.0039215686,.4823529412,.2784313725490196,.5215686275,.0039215686,.4666666667,.2823529411764706,.5411764706,.0039215686,.4470588235,.28627450980392155,.5607843137,.0039215686,.4274509804,.2901960784313726,.5803921569,.0039215686,.4078431373,.29411764705882354,.6039215686,.0039215686,.3882352941,.2980392156862745,.6235294118,.0039215686,.368627451,.30196078431372547,.6431372549,.0039215686,.3490196078,.3058823529411765,.662745098,.0039215686,.3294117647,.30980392156862746,.6862745098,.0039215686,.3098039216,.3137254901960784,.7058823529,.0039215686,.2901960784,.3176470588235294,.7254901961,.0039215686,.2705882353,.3215686274509804,.7450980392,.0039215686,.2509803922,.3254901960784314,.7647058824,.0039215686,.2352941176,.32941176470588235,.7843137255,.0039215686,.2156862745,.3333333333333333,.8039215686,.0039215686,.1960784314,.33725490196078434,.8235294118,.0039215686,.1764705882,.3411764705882353,.8470588235,.0039215686,.1568627451,.34509803921568627,.8666666667,.0039215686,.137254902,.34901960784313724,.8862745098,.0039215686,.1176470588,.35294117647058826,.9058823529,.0039215686,.0980392157,.3568627450980392,.9294117647,.0039215686,.0784313725,.3607843137254902,.9490196078,.0039215686,.0588235294,.36470588235294116,.968627451,.0039215686,.0392156863,.3686274509803922,.9921568627,.0039215686,.0235294118,.37254901960784315,.9529411765,.0039215686,.0588235294,.3764705882352941,.9529411765,.0078431373,.0549019608,.3803921568627451,.9529411765,.0156862745,.0549019608,.3843137254901961,.9529411765,.0235294118,.0549019608,.38823529411764707,.9529411765,.031372549,.0549019608,.39215686274509803,.9529411765,.0352941176,.0549019608,.396078431372549,.9529411765,.0431372549,.0549019608,.4,.9529411765,.0509803922,.0549019608,.403921568627451,.9529411765,.0588235294,.0549019608,.40784313725490196,.9529411765,.062745098,.0549019608,.4117647058823529,.9529411765,.0705882353,.0549019608,.41568627450980394,.9529411765,.0784313725,.0509803922,.4196078431372549,.9529411765,.0862745098,.0509803922,.4235294117647059,.9568627451,.0941176471,.0509803922,.42745098039215684,.9568627451,.0980392157,.0509803922,.43137254901960786,.9568627451,.1058823529,.0509803922,.43529411764705883,.9568627451,.1137254902,.0509803922,.4392156862745098,.9568627451,.1215686275,.0509803922,.44313725490196076,.9568627451,.1254901961,.0509803922,.4470588235294118,.9568627451,.1333333333,.0509803922,.45098039215686275,.9568627451,.1411764706,.0509803922,.4549019607843137,.9568627451,.1490196078,.0470588235,.4588235294117647,.9568627451,.1568627451,.0470588235,.4627450980392157,.9568627451,.1607843137,.0470588235,.4666666666666667,.9568627451,.168627451,.0470588235,.4705882352941177,.9607843137,.1764705882,.0470588235,.4745098039215686,.9607843137,.1843137255,.0470588235,.4784313725490197,.9607843137,.1882352941,.0470588235,.48235294117647065,.9607843137,.1960784314,.0470588235,.48627450980392156,.9607843137,.2039215686,.0470588235,.49019607843137253,.9607843137,.2117647059,.0470588235,.49411764705882355,.9607843137,.2196078431,.0431372549,.4980392156862745,.9607843137,.2235294118,.0431372549,.5019607843137255,.9607843137,.231372549,.0431372549,.5058823529411764,.9607843137,.2392156863,.0431372549,.5098039215686274,.9607843137,.2470588235,.0431372549,.5137254901960784,.9607843137,.2509803922,.0431372549,.5176470588235295,.9647058824,.2549019608,.0431372549,.5215686274509804,.9647058824,.262745098,.0431372549,.5254901960784314,.9647058824,.2705882353,.0431372549,.5294117647058824,.9647058824,.2745098039,.0431372549,.5333333333333333,.9647058824,.2823529412,.0392156863,.5372549019607843,.9647058824,.2901960784,.0392156863,.5411764705882353,.9647058824,.2980392157,.0392156863,.5450980392156862,.9647058824,.3058823529,.0392156863,.5490196078431373,.9647058824,.3098039216,.0392156863,.5529411764705883,.9647058824,.3176470588,.0392156863,.5568627450980392,.9647058824,.3254901961,.0392156863,.5607843137254902,.9647058824,.3333333333,.0392156863,.5647058823529412,.9647058824,.337254902,.0392156863,.5686274509803921,.968627451,.3450980392,.0392156863,.5725490196078431,.968627451,.3529411765,.0352941176,.5764705882352941,.968627451,.3607843137,.0352941176,.5803921568627451,.968627451,.368627451,.0352941176,.5843137254901961,.968627451,.3725490196,.0352941176,.5882352941176471,.968627451,.3803921569,.0352941176,.592156862745098,.968627451,.3882352941,.0352941176,.596078431372549,.968627451,.3960784314,.0352941176,.6,.968627451,.4,.0352941176,.6039215686274509,.968627451,.4078431373,.0352941176,.6078431372549019,.968627451,.4156862745,.0352941176,.611764705882353,.968627451,.4235294118,.031372549,.615686274509804,.9725490196,.431372549,.031372549,.6196078431372549,.9725490196,.4352941176,.031372549,.6235294117647059,.9725490196,.4431372549,.031372549,.6274509803921569,.9725490196,.4509803922,.031372549,.6313725490196078,.9725490196,.4588235294,.031372549,.6352941176470588,.9725490196,.462745098,.031372549,.6392156862745098,.9725490196,.4705882353,.031372549,.6431372549019608,.9725490196,.4784313725,.031372549,.6470588235294118,.9725490196,.4862745098,.031372549,.6509803921568628,.9725490196,.4941176471,.0274509804,.6549019607843137,.9725490196,.4980392157,.0274509804,.6588235294117647,.9725490196,.5058823529,.0274509804,.6627450980392157,.9764705882,.5137254902,.0274509804,.6666666666666666,.9764705882,.5215686275,.0274509804,.6705882352941176,.9764705882,.5254901961,.0274509804,.6745098039215687,.9764705882,.5333333333,.0274509804,.6784313725490196,.9764705882,.5411764706,.0274509804,.6823529411764706,.9764705882,.5490196078,.0274509804,.6862745098039216,.9764705882,.5529411765,.0274509804,.6901960784313725,.9764705882,.5607843137,.0235294118,.6941176470588235,.9764705882,.568627451,.0235294118,.6980392156862745,.9764705882,.5764705882,.0235294118,.7019607843137254,.9764705882,.5843137255,.0235294118,.7058823529411765,.9764705882,.5882352941,.0235294118,.7098039215686275,.9764705882,.5960784314,.0235294118,.7137254901960784,.9803921569,.6039215686,.0235294118,.7176470588235294,.9803921569,.6117647059,.0235294118,.7215686274509804,.9803921569,.6156862745,.0235294118,.7254901960784313,.9803921569,.6235294118,.0235294118,.7294117647058823,.9803921569,.631372549,.0196078431,.7333333333333333,.9803921569,.6392156863,.0196078431,.7372549019607844,.9803921569,.6470588235,.0196078431,.7411764705882353,.9803921569,.6509803922,.0196078431,.7450980392156863,.9803921569,.6588235294,.0196078431,.7490196078431373,.9803921569,.6666666667,.0196078431,.7529411764705882,.9803921569,.6745098039,.0196078431,.7568627450980392,.9803921569,.6784313725,.0196078431,.7607843137254902,.9843137255,.6862745098,.0196078431,.7647058823529411,.9843137255,.6941176471,.0196078431,.7686274509803922,.9843137255,.7019607843,.0156862745,.7725490196078432,.9843137255,.7098039216,.0156862745,.7764705882352941,.9843137255,.7137254902,.0156862745,.7803921568627451,.9843137255,.7215686275,.0156862745,.7843137254901961,.9843137255,.7294117647,.0156862745,.788235294117647,.9843137255,.737254902,.0156862745,.792156862745098,.9843137255,.7411764706,.0156862745,.796078431372549,.9843137255,.7490196078,.0156862745,.8,.9843137255,.7529411765,.0156862745,.803921568627451,.9843137255,.7607843137,.0156862745,.807843137254902,.9882352941,.768627451,.0156862745,.8117647058823529,.9882352941,.768627451,.0156862745,.8156862745098039,.9843137255,.7843137255,.0117647059,.8196078431372549,.9843137255,.8,.0117647059,.8235294117647058,.9843137255,.8156862745,.0117647059,.8274509803921568,.9803921569,.831372549,.0117647059,.8313725490196079,.9803921569,.8431372549,.0117647059,.8352941176470589,.9803921569,.8588235294,.0078431373,.8392156862745098,.9803921569,.8745098039,.0078431373,.8431372549019608,.9764705882,.8901960784,.0078431373,.8470588235294118,.9764705882,.9058823529,.0078431373,.8509803921568627,.9764705882,.9176470588,.0078431373,.8549019607843137,.9764705882,.9333333333,.0039215686,.8588235294117647,.9725490196,.9490196078,.0039215686,.8627450980392157,.9725490196,.9647058824,.0039215686,.8666666666666667,.9725490196,.9803921569,.0039215686,.8705882352941177,.9725490196,.9960784314,.0039215686,.8745098039215686,.9725490196,.9960784314,.0039215686,.8784313725490196,.9725490196,.9960784314,.0352941176,.8823529411764706,.9725490196,.9960784314,.0666666667,.8862745098039215,.9725490196,.9960784314,.0980392157,.8901960784313725,.9725490196,.9960784314,.1294117647,.8941176470588236,.9725490196,.9960784314,.1647058824,.8980392156862745,.9764705882,.9960784314,.1960784314,.9019607843137255,.9764705882,.9960784314,.2274509804,.9058823529411765,.9764705882,.9960784314,.2549019608,.9098039215686274,.9764705882,.9960784314,.2901960784,.9137254901960784,.9764705882,.9960784314,.3215686275,.9176470588235294,.9803921569,.9960784314,.3529411765,.9215686274509803,.9803921569,.9960784314,.3843137255,.9254901960784314,.9803921569,.9960784314,.4156862745,.9294117647058824,.9803921569,.9960784314,.4509803922,.9333333333333333,.9803921569,.9960784314,.4823529412,.9372549019607843,.9843137255,.9960784314,.5137254902,.9411764705882354,.9843137255,.9960784314,.5450980392,.9450980392156864,.9843137255,.9960784314,.5803921569,.9490196078431372,.9843137255,.9960784314,.6117647059,.9529411764705882,.9843137255,.9960784314,.6431372549,.9568627450980394,.9882352941,.9960784314,.6745098039,.9607843137254903,.9882352941,.9960784314,.7058823529,.9647058823529413,.9882352941,.9960784314,.7411764706,.9686274509803922,.9882352941,.9960784314,.768627451,.9725490196078431,.9882352941,.9960784314,.8,.9764705882352941,.9921568627,.9960784314,.831372549,.9803921568627451,.9921568627,.9960784314,.8666666667,.984313725490196,.9921568627,.9960784314,.8980392157,.9882352941176471,.9921568627,.9960784314,.9294117647,.9921568627450981,.9921568627,.9960784314,.9607843137,.996078431372549,.9960784314,.9960784314,.9607843137,1,.9960784314,.9960784314,.9607843137],description:"Siemens"}];var ot=n(99737),at=n(10182),rt=n(44646),it=n(2847),st=n(33592);const{registerColormap:lt}=s.utilities.colormap;async function ct({servicesManager:e,commandsManager:t,extensionManager:n,appConfig:o}){window.PUBLIC_LIB_URL||="./${component}/",await(0,s.init)({peerImport:o.peerImport}),s.setUseCPURendering(Boolean(o.useCPURendering)),s.setConfiguration({...s.getConfiguration(),rendering:{...s.getConfiguration().rendering,strictZSpacingForVolumeViewport:o.strictZSpacingForVolumeViewport}});const{maxCacheSize:a}=o;a&&s.cache.setMaxCacheSize(a),function(){l.CrosshairsTool.isAnnotation=!1,v.Bj.isAnnotation=!1,v.pY.isAnnotation=!1,l.ReferenceLinesTool.isAnnotation=!1,l.AdvancedMagnifyTool.isAnnotation=!1,l.PlanarFreehandContourSegmentationTool.isAnnotation=!1,(0,l.init)({addons:{polySeg:y},computeWorker:{autoTerminateOnIdle:{enabled:!1}}}),(0,l.addTool)(l.PanTool),(0,l.addTool)(l.SegmentBidirectionalTool),(0,l.addTool)(l.WindowLevelTool),(0,l.addTool)(l.StackScrollTool),(0,l.addTool)(l.VolumeRotateTool),(0,l.addTool)(l.ZoomTool),(0,l.addTool)(l.ProbeTool),(0,l.addTool)(l.MIPJumpToClickTool),(0,l.addTool)(l.LengthTool),(0,l.addTool)(l.RectangleROITool),(0,l.addTool)(l.RectangleROIThresholdTool),(0,l.addTool)(l.EllipticalROITool),(0,l.addTool)(l.CircleROITool),(0,l.addTool)(l.BidirectionalTool),(0,l.addTool)(l.ArrowAnnotateTool),(0,l.addTool)(l.DragProbeTool),(0,l.addTool)(l.AngleTool),(0,l.addTool)(l.CobbAngleTool),(0,l.addTool)(l.MagnifyTool),(0,l.addTool)(l.CrosshairsTool),(0,l.addTool)(l.RectangleScissorsTool),(0,l.addTool)(l.SphereScissorsTool),(0,l.addTool)(l.CircleScissorsTool),(0,l.addTool)(l.BrushTool),(0,l.addTool)(l.PaintFillTool),(0,l.addTool)(l.ReferenceLinesTool),(0,l.addTool)(T),(0,l.addTool)(l.TrackballRotateTool),(0,l.addTool)(U),(0,l.addTool)(l.AdvancedMagnifyTool),(0,l.addTool)(l.UltrasoundDirectionalTool),(0,l.addTool)(l.UltrasoundPleuraBLineTool),(0,l.addTool)(l.PlanarFreehandROITool),(0,l.addTool)(l.SplineROITool),(0,l.addTool)(l.LivewireContourTool),(0,l.addTool)(l.OrientationMarkerTool),(0,l.addTool)(l.WindowLevelRegionTool),(0,l.addTool)(l.PlanarFreehandContourSegmentationTool),(0,l.addTool)(l.SegmentSelectTool),(0,l.addTool)(l.SegmentLabelTool),(0,l.addTool)(v.Bj),(0,l.addTool)(v.pY),(0,l.addTool)(l.RegionSegmentPlusTool),(0,l.addTool)(l.LivewireContourSegmentationTool),(0,l.addTool)(l.SculptorTool),(0,l.addTool)(l.SplineContourSegmentationTool),(0,l.addTool)(l.LabelMapEditWithContourTool);const e=l.annotation.config.style.getDefaultToolStyles();l.annotation.config.style.setDefaultToolStyles({global:{...e.global,textBoxFontSize:"15px",lineWidth:"1.5"}})}(),s.Settings.getRuntimeSettings().set("useCursors",Boolean(o.useCursors));const{userAuthenticationService:r,customizationService:i,uiModalService:c,uiNotificationService:d,cornerstoneViewportService:m,hangingProtocolService:f,viewportGridService:h,segmentationService:w,measurementService:E,colorbarService:b,displaySetService:D,toolbarService:C}=e.services;C.registerEventForToolbarUpdate(b,[b.EVENTS.STATE_CHANGED]),C.registerEventForToolbarUpdate(w,[w.EVENTS.SEGMENTATION_MODIFIED,w.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,w.EVENTS.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED]),window.services=e.services,window.extensionManager=n,window.commandsManager=t,o.showCPUFallbackMessage&&s.getShouldUseCPURendering()&&function(e,t){const n=t=>{if(100===t)return e.show({content:mt,title:"OHIF Fell Back to CPU Rendering"}),!0},{unsubscribe:o}=t.subscribe(t.EVENTS.PROTOCOL_CHANGED,()=>{n(100)&&o()})}(c,f);const{getPresentationId:O}=at.I.getState(),{getPresentationId:N}=it.v.getState(),{getPresentationId:M}=rt.q.getState();h.addPresentationIdProvider("positionPresentationId",M),h.addPresentationIdProvider("lutPresentationId",O),h.addPresentationIdProvider("segmentationPresentationId",N),l.segmentation.config.style.setStyle({type:ot.SegmentationRepresentations.Contour},{renderFill:!1});const V=p.Ay.classes.MetadataProvider;s.volumeLoader.registerVolumeLoader("cornerstoneStreamingImageVolume",u.FC),s.volumeLoader.registerVolumeLoader("cornerstoneStreamingDynamicImageVolume",u.Mr);const R={interleaveCenter:ze,interleaveTopToBottom:qe,nth:je};Object.entries(R).forEach(([e,t])=>{f.registerImageLoadStrategy(e,dt(t))}),s.metaData.addProvider(s.utilities.calibratedPixelSpacingMetadataProvider.get.bind(s.utilities.calibratedPixelSpacingMetadataProvider)),s.metaData.addProvider(V.get.bind(V),9999),s.imageLoadPoolManager.maxNumRequests={[g.A.Interaction]:o?.maxNumRequests?.interaction||10,[g.A.Thumbnail]:o?.maxNumRequests?.thumbnail||5,[g.A.Prefetch]:o?.maxNumRequests?.prefetch||5,[g.A.Compute]:o?.maxNumRequests?.compute||10},function(e,t,n){I("cornerstoneStreamingImageVolume",u.FC),I("cornerstoneStreamingDynamicImageVolume",u.Mr),S.Ay.init({maxWebWorkers:Math.min(Math.max(navigator.hardwareConcurrency-1,1),t.maxNumberOfWebWorkers),beforeSend:function(t){const o=n.getActiveDataSource()?.[0].getConfig()??{},a=e.getAuthorizationHeader(),r={Accept:p.Wp.generateAcceptHeader(o.acceptHeader,o.requestTransferSyntaxUID,o.omitQuotationForMultipartRequest)};return a&&Object.assign(r,a),r},errorInterceptor:e=>{p.r_.getHTTPErrorHandler(e)}})}(r,o,n),this.measurementServiceSource=Ne({servicesManager:e,commandsManager:t,extensionManager:n}),Re(e),Ue(e),E.subscribe(E.EVENTS.JUMP_TO_MEASUREMENT,e=>{const{measurement:n}=e,{uid:o}=n;t.runCommand("jumpToMeasurementViewport",{measurement:n,annotationUID:o,evt:e})}),f.subscribe(f.EVENTS.CUSTOM_IMAGE_LOAD_PERFORMED,e=>{const{lutPresentationStore:t}=at.I.getState(),{segmentationPresentationStore:n}=it.v.getState(),{positionPresentationStore:o}=rt.q.getState();for(const a of e.entries()){const[e,r]=a,i=m.getCornerstoneViewport(e),s=m.getViewportInfo(e),{presentationIds:l}=s.getViewportOptions(),c={positionPresentation:o[l?.positionPresentationId],lutPresentation:t[l?.lutPresentationId],segmentationPresentation:n[l?.segmentationPresentationId]};m.setVolumesForViewport(i,r,c)}}),Ke({cornerstoneViewportService:m,customizationService:i,commandsManager:t}),Ze({customizationService:i,commandsManager:t});const A=({detail:e})=>{p.r_.getHTTPErrorHandler()(e.error)};s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_FAILED,A),s.eventTarget.addEventListener(s.EVENTS.IMAGE_LOAD_ERROR,A);s.eventTarget.addEventListener(s.EVENTS.ELEMENT_ENABLED,function(e){const{element:n}=e.detail,{viewport:o}=(0,s.getEnabledElement)(n);!function({element:e}){if(!Xe.length){const{W:e}=p.fX;Xe.push(e.DISPLAY_SETS_TO_ALL_IMAGES,e.DISPLAY_SETS_TO_FIRST_IMAGE,e.STUDY_TO_FIRST_IMAGE)}Xe.find(e=>p.Rm.timingKeys[e])&&(et.viewportsWaiting+=1,e.addEventListener(s.EVENTS.IMAGE_RENDERED,tt))}({element:n}),n.addEventListener(s.EVENTS.CAMERA_RESET,e=>{const{element:n}=e.detail,o=(0,s.getEnabledElement)(n);if(!o)return;const{viewportId:a}=o;t.runCommand("resetCrosshairs",{viewportId:a})}),o.type,s.Enums.ViewportType.ORTHOGRAPHIC}.bind(null)),nt.forEach(lt),s.eventTarget.addEventListenerDebounced(s.EVENTS.ERROR_EVENT,({detail:e})=>{const t=`cornerstone-error-${e.type}-${e.message.substring(0,50)}`;d.show({title:e.type,message:e.message,type:"error",id:t,allowDuplicates:!1,deduplicationInterval:3e4})},100),function(e){const t=new Map;s.eventTarget.addEventListener(s.EVENTS.WEB_WORKER_PROGRESS,({detail:n})=>{let o,a=!1;try{const{progress:r,type:i,id:s}=n;if(i===l.Enums.WorkerTypes.COMPUTE_STATISTICS)return;if(o=(e=>`worker-task-${e.toLowerCase().replace(/\s+/g,"-")}`)(i),0===r)if(t.has(o))console.debug(`Already tracking a "${i}" task, skipping duplicate notification`);else{const n=new Promise((e,n)=>{try{t.set(o,{resolve:e,reject:n,originalId:s,type:i})}catch(e){throw console.error(`Error setting active worker task for type "${i}":`,e),n(e),e}});try{e.show({id:o,title:`${i}`,message:"Computing...",autoClose:!1,allowDuplicates:!1,deduplicationInterval:6e4,promise:n,promiseMessages:{loading:"Computing...",success:"Completed successfully",error:"Web Worker failed"}})}catch(e){throw console.error(`Error showing web worker notification for type "${i}":`,e),a=!0,e}}else if(100===r){const e=t.get(o);if(e){const{resolve:t}=e;t({progress:r,type:i}),a=!0,console.debug(`Worker task "${i}" completed successfully`)}}}catch(e){console.error(`Error in web worker progress handler for type "${n?.type}":`,e),a=!0}finally{if(a&&o)try{t.delete(o)}catch(e){console.error(`Error cleaning up active worker task for type "${n?.type}":`,e)}}})}(e.services.uiNotificationService)}window.cornerstone=s,window.cornerstoneTools=l;const dt=e=>t=>{const n=st.imageRetrieveMetadataProvider.clone();st.imageRetrieveMetadataProvider.clear();try{return e(t)}finally{setTimeout(()=>{st.imageRetrieveMetadataProvider.restore(n)},10)}};function mt(){return i.createElement("div",null,i.createElement("p",null,"Your computer does not have enough GPU power to support the default GPU rendering mode. OHIF has switched to CPU rendering mode. Please note that CPU rendering does not support all features such as Volume Rendering, Multiplanar Reconstruction, and Segmentation Overlays."))}const pt={"viewportOverlay.topLeft":[{id:"StudyDate",inheritsFrom:"ohif.overlayItem",label:"",title:"Study date",condition:({referenceInstance:e})=>e?.StudyDate,contentF:({referenceInstance:e,formatters:{formatDate:t}})=>t(e.StudyDate)},{id:"SeriesDescription",inheritsFrom:"ohif.overlayItem",label:"",title:"Series description",condition:({referenceInstance:e})=>e&&e.SeriesDescription,contentF:({referenceInstance:e})=>e.SeriesDescription}],"viewportOverlay.topRight":[],"viewportOverlay.bottomLeft":[{id:"WindowLevel",inheritsFrom:"ohif.overlayItem.windowLevel"},{id:"ZoomLevel",inheritsFrom:"ohif.overlayItem.zoomLevel",condition:e=>"Zoom"===e.toolGroupService.getActiveToolForViewport(e.viewportId)}],"viewportOverlay.bottomRight":[{id:"InstanceNumber",inheritsFrom:"ohif.overlayItem.instanceNumber"}]};var ut=n(96283),gt=n(99993);const St=({segmentationId:e,segmentationRepresentationType:t,allowExport:n,actions:o})=>{const{t:a}=(0,gt.Bd)("SegmentationTable");return i.createElement(i.Fragment,null,t===ot.SegmentationRepresentations.Labelmap&&i.createElement(ut.lvB,null,i.createElement(ut.nVd,{className:"pl-1"},i.createElement(ut.FI1.Export,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},a("Download & Export"))),i.createElement(ut.dce,null,i.createElement(ut.M56,null,i.createElement(ut.lpj,{className:"flex items-center pl-0"},i.createElement(ut.FI1.Download,{className:"h-5 w-5"}),i.createElement("span",{className:"pl-1"},a("Download"))),i.createElement(ut._26,{onClick:t=>{t.preventDefault(),o.downloadCSVSegmentationReport(e)},disabled:!n},a("CSV Report")),i.createElement(ut._26,{onClick:t=>{t.preventDefault(),o.onSegmentationDownload(e)},disabled:!n},a("DICOM SEG")),i.createElement(ut._26,{onClick:t=>{t.preventDefault(),o.onSegmentationDownloadRTSS(e)},disabled:!n},a("DICOM RTSS")),i.createElement(ut.mBJ,null),i.createElement(ut.lpj,{className:"flex items-center pl-0"},i.createElement(ut.FI1.Export,{className:"h-5 w-5"}),i.createElement("span",{className:"pl-1 pt-1"},a("Export"))),i.createElement(ut._26,{onClick:t=>{t.preventDefault(),o.storeSegmentation(e)},disabled:!n},a("DICOM SEG"))))),t===ot.SegmentationRepresentations.Contour&&i.createElement(i.Fragment,null,i.createElement(ut._26,{onClick:t=>{t.preventDefault(),o.onSegmentationDownloadRTSS(e)},disabled:!n},i.createElement(ut.FI1.Export,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},a("Download DICOM RTSS")))))},It=()=>{const{commandsManager:e}=(0,p.Jg)(),{t}=(0,gt.Bd)("SegmentationTable"),{onSegmentationAdd:n,onSegmentationRemoveFromViewport:o,onSegmentationEdit:a,onSegmentationDelete:r,exportOptions:s,activeSegmentation:l,activeSegmentationId:c,segmentationRepresentationType:d,disableEditing:m}=(0,ut.dQ$)("CustomDropdownMenu");let u,g,S=!1;try{u=(0,ut.dPM)().segmentation,g=u.segmentationId}catch(e){u=l,g=c}if(s&&g){const e=s.find(e=>e.segmentationId===g);S=e?.isExportable||!1}if(!u||!g)return null;const I={storeSegmentation:async t=>{e.run({commandName:"storeSegmentation",commandOptions:{segmentationId:t},context:"CORNERSTONE"})},onSegmentationDownloadRTSS:t=>{e.run("downloadRTSS",{segmentationId:t})},onSegmentationDownload:t=>{e.run("downloadSegmentation",{segmentationId:t})},downloadCSVSegmentationReport:t=>{e.run("downloadCSVSegmentationReport",{segmentationId:t})}};return i.createElement(ut.SQm,{align:"start"},!m&&i.createElement(ut._26,{onClick:()=>n({segmentationId:g,segmentationRepresentationType:d})},i.createElement(ut.FI1.Add,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},t("Create New Segmentation"))),i.createElement(ut.mBJ,null),i.createElement(ut.lpj,null,t("Manage Current Segmentation")),i.createElement(ut._26,{onClick:()=>o(g)},i.createElement(ut.FI1.Series,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},t("Remove from Viewport"))),i.createElement(ut._26,{onClick:()=>a(g)},i.createElement(ut.FI1.Rename,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},t("Rename"))),i.createElement(St,{segmentationId:g,segmentationRepresentationType:d,allowExport:S,actions:I}),i.createElement(ut.mBJ,null),i.createElement(ut._26,{onClick:()=>r(g)},i.createElement(ut.FI1.Delete,{className:"text-red-600"}),i.createElement("span",{className:"pl-2 text-red-600"},t("Delete"))))},vt=({segmentationId:e,segmentIndex:t})=>{const{servicesManager:n,commandsManager:o}=(0,p.Jg)(),{segmentationService:a}=n.services,{t:r}=(0,gt.Bd)("SegmentationTable"),s=a.getSegmentation(e).segments[t].cachedStats.namedStats;if(!s)return null;const c=s.bidirectional;if(!c)return i.createElement("div",{className:"-mt-2 space-y-2"},i.createElement("div",{className:"flex"},i.createElement(ut.m_M,null,i.createElement(ut.k$k,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"sm",className:"text-primary flex items-center gap-2",onClick:()=>{o.run("runSegmentBidirectional",{segmentationId:e,segmentIndex:t})}},i.createElement(ut.FI1.ToolBidirectionalSegment,{className:"h-5 w-5"}),i.createElement("span",null,r("Compute Largest Bidirectional")))),i.createElement(ut.ZIw,{side:"bottom"},r("Add bidirectional measurement")))),i.createElement(ut.wvv,{className:"bg-input"}));const{value:d,unit:m}=c,u=d.maxMajor,g=d.maxMinor,S=Math.max(u,g),I=Math.min(u,g),v=l.annotation.visibility.isAnnotationVisible(c.annotationUID);return i.createElement("div",{className:"-mt-2 space-y-2"},i.createElement("div",{className:"flex items-center justify-between"},i.createElement("div",{className:"text-foreground"},i.createElement("div",null,"L: ",(0,O.Wf)(S)," ",m),i.createElement("div",null,"W: ",(0,O.Wf)(I)," ",m)),i.createElement("div",{className:"flex gap-2"},i.createElement(ut.m_M,null,i.createElement(ut.k$k,{asChild:!0},i.createElement(ut.$nd,{size:"icon",variant:"ghost",className:"h-6 w-6 transition-opacity",onClick:n=>{n.stopPropagation(),l.annotation.visibility.setAnnotationVisibility(c.annotationUID,!v),a.addOrUpdateSegmentation({segmentationId:e,segmentIndex:t})}},v?i.createElement(ut.FI1.Hide,{className:"h-6 w-6"}):i.createElement(ut.FI1.Show,{className:"h-6 w-6"}))),i.createElement(ut.ZIw,{side:"bottom"},r("Toggle visibility"))),i.createElement(ut.m_M,null,i.createElement(ut.k$k,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"icon",onClick:()=>{c.annotationUID&&o.run("jumpToMeasurement",{uid:c.annotationUID})}},i.createElement(ut.FI1.JumpToSlice,null))),i.createElement(ut.ZIw,{side:"bottom"},r("Jump to measurement"))))),i.createElement(ut.wvv,{className:"bg-input"}))};function yt(){const{commandsManager:e}=(0,p.Jg)(),[t,n]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),[r,s]=(0,i.useState)(!1),[l,c]=(0,i.useState)(!1);return i.createElement("div",{className:"bg-muted flex flex-col gap-2 border-b border-b-[2px] border-black px-2 py-3"},i.createElement("div",{className:"flex items-center gap-2"},i.createElement(ut.dOG,{checked:t,onCheckedChange:t=>{n(t),e.run("toggleSegmentPreviewEdit",{toggle:t})}}),i.createElement("span",{className:"text-foreground text-base"},"Preview edits before creating")),i.createElement("div",{className:"flex items-center gap-2"},i.createElement(ut.dOG,{checked:l,onCheckedChange:t=>{c(t),e.run("toggleUseCenterSegmentIndex",{toggle:t})}}),i.createElement("span",{className:"text-foreground text-base"},"Use center as segment index")),i.createElement("div",{className:"flex items-center gap-2"},i.createElement(ut.dOG,{checked:r,onCheckedChange:t=>{s(t),e.run("toggleSegmentSelect",{toggle:t})}}),i.createElement("span",{className:"text-foreground text-base"},"Hover on segment border to activate")),i.createElement("div",{className:"flex items-center gap-2"},i.createElement(ut.dOG,{checked:o,onCheckedChange:t=>{a(t),e.run("toggleSegmentLabel",{enabled:t})}}),i.createElement("span",{className:"text-foreground text-base"},"Show segment name on hover")))}function ft({commandsManager:e,servicesManager:t}){return{"panelSegmentation.customDropdownMenuContent":It,"panelSegmentation.customSegmentStatisticsHeader":vt,"panelSegmentation.disableEditing":!1,"panelSegmentation.showAddSegment":!0,"panelSegmentation.onSegmentationAdd":async({segmentationRepresentationType:n=ot.SegmentationRepresentations.Labelmap})=>{const{viewportGridService:o}=t.services,a=o.getState().activeViewportId;if(n===ot.SegmentationRepresentations.Labelmap)e.run("createLabelmapForViewport",{viewportId:a});else if(n===ot.SegmentationRepresentations.Contour){const t=await e.run("createContourForViewport",{viewportId:a});l.segmentation.config.style.setStyle({segmentationId:t,type:ot.SegmentationRepresentations.Contour},{fillAlpha:.5,renderFill:!0})}},"panelSegmentation.tableMode":"collapsed","panelSegmentation.readableText":{min:"Min Value",minLPS:"Min Coord",max:"Max Value",maxLPS:"Max Coord",mean:"Mean Value",stdDev:"Standard Deviation",count:"Voxel Count",median:"Median",skewness:"Skewness",kurtosis:"Kurtosis",peakValue:"Peak Value",peakLPS:"Peak Coord",volume:"Volume",lesionGlycolysis:"Lesion Glycolysis",center:"Center"},"labelMapSegmentationToolbox.config":()=>i.createElement(yt,null),"contourSegmentationToolbox.config":()=>i.createElement(yt,null)}}const ht={"layoutSelector.advancedPresetGenerator":({servicesManager:e})=>(({servicesManager:e})=>{const{hangingProtocolService:t,viewportGridService:n,displaySetService:o}=e.services,a=Array.from(t.protocols.values()),r=n.getActiveViewportId();if(!r)return[];const i=n.getDisplaySetsUIDsForViewport(r);if(!i)return[];const s=i.map(e=>{const t=o.getDisplaySetByUID(e),n=t?.measurements?.[0]?.displaySetInstanceUID;return"SR"===t.Modality&&n?o.getDisplaySetByUID(n):t});return a.map(e=>{if(!e.isPreset)return null;const n=((e,t,n)=>!e.displaySetSelectors||0===Object.values(e.displaySetSelectors).length||n.areRequiredSelectorsValid(Object.values(e.displaySetSelectors),t[0]))(e,s,t);return{icon:e.icon,title:e.name,commandOptions:{protocolId:e.id},disabled:!n}}).filter(e=>null!==e)})({servicesManager:e}),"layoutSelector.commonPresets":[{icon:"layout-common-1x1",commandOptions:{numRows:1,numCols:1}},{icon:"layout-common-1x2",commandOptions:{numRows:1,numCols:2}},{icon:"layout-common-2x2",commandOptions:{numRows:2,numCols:2}},{icon:"layout-common-2x3",commandOptions:{numRows:2,numCols:3}}]},wt={"cornerstone.overlayViewportTools":{active:[{toolName:A.WindowLevel,bindings:[{mouseButton:l.Enums.MouseBindings.Primary}]},{toolName:A.Pan,bindings:[{mouseButton:l.Enums.MouseBindings.Auxiliary}]},{toolName:A.Zoom,bindings:[{mouseButton:l.Enums.MouseBindings.Secondary},{numTouchPoints:2}]},{toolName:A.StackScroll,bindings:[{mouseButton:l.Enums.MouseBindings.Wheel},{numTouchPoints:3}]}],enabled:[{toolName:A.PlanarFreehandContourSegmentation,configuration:{displayOnePointAsCrosshairs:!0}}]}},Et={cornerstoneViewportClickCommands:{doubleClick:["toggleOneUp"],button1:["closeContextMenu"],button3:[{commandName:"showCornerstoneContextMenu",commandOptions:{requireNearbyToolData:!0,menuId:"measurementsContextMenu"}}]}},bt={"cornerstone.measurements":{Angle:{displayText:[],report:[]},CobbAngle:{displayText:[],report:[]},ArrowAnnotate:{displayText:[],report:[]},RectangleROi:{displayText:[],report:[]},CircleROI:{displayText:[],report:[]},EllipticalROI:{displayText:[],report:[]},Bidirectional:{displayText:[],report:[]},Length:{displayText:[],report:[]},LivewireContour:{displayText:[],report:[]},SplineROI:{displayText:[{displayName:"Areas",value:"area",type:"value"},{value:"areaUnits",for:["area"],type:"unit"}],report:[{displayName:"Area",value:"area",type:"value"},{displayName:"Unit",value:"areaUnits",type:"value"}]},PlanarFreehandROI:{displayTextOpen:[{displayName:"Length",value:"length",type:"value"}],displayText:[{displayName:"Mean",value:"mean",type:"value"},{displayName:"Max",value:"max",type:"value"},{displayName:"Area",value:"area",type:"value"},{value:"pixelValueUnits",for:["mean","max"],type:"unit"},{value:"areaUnits",for:["area"],type:"unit"}],report:[{displayName:"Mean",value:"mean",type:"value"},{displayName:"Max",value:"max",type:"value"},{displayName:"Area",value:"area",type:"value"},{displayName:"Unit",value:"unit",type:"value"}]}}},{VIEWPORT_PRESETS:Dt}=s.CONSTANTS,Tt={"cornerstone.3dVolumeRendering":{volumeRenderingPresets:Dt,volumeRenderingQualityRange:{min:1,max:4,step:1}}},Ct="bottom",Ot={bottom:{position:"top",style:{labelOffset:5,labelMargin:13}},right:{position:"left",style:{labelMargin:5}},left:{position:"right",style:{labelMargin:5}},top:{position:"bottom",style:{labelMargin:5}}};var Nt;const Mt={"cornerstone.colorbar":{colorbarTickPosition:(Nt=Ct,"bottom"===Nt?"top":"top"===Nt?"bottom":"left"===Nt?"right":"right"===Nt?"left":Ot[Nt]?.position||"top"),colormaps:nt,colorbarContainerPosition:Ct,colorbarInitialColormap:"Grayscale",positionStyles:{left:{width:"15px"},right:{width:"15px"},bottom:{height:"15px"}},positionTickStyles:Ot,containerStyles:{cursor:"initial"},tickStyles:{font:"12px Arial",color:"#fff",maxNumTicks:6,tickSize:5,tickWidth:1}}},Vt={"cornerstone.modalityOverlayDefaultColorMaps":{defaultSettings:{PT:{colormap:"hsv",opacity:.5},RTDOSE:{colormap:"Isodose",opacity:.5}}}},Rt={"cornerstone.windowLevelPresets":{CT:[{id:"ct-soft-tissue",description:"Soft tissue",window:"400",level:"40"},{id:"ct-lung",description:"Lung",window:"1500",level:"-600"},{id:"ct-liver",description:"Liver",window:"150",level:"90"},{id:"ct-bone",description:"Bone",window:"2500",level:"480"},{id:"ct-brain",description:"Brain",window:"80",level:"40"}],PT:[{id:"pt-default",description:"Default",window:"5",level:"2.5"},{id:"pt-suv-3",description:"SUV",window:"0",level:"3"},{id:"pt-suv-5",description:"SUV",window:"0",level:"5"},{id:"pt-suv-7",description:"SUV",window:"0",level:"7"},{id:"pt-suv-8",description:"SUV",window:"0",level:"8"},{id:"pt-suv-10",description:"SUV",window:"0",level:"10"},{id:"pt-suv-15",description:"SUV",window:"0",level:"15"}]}};var Ut=n(85252),At=n(97598),xt=n.n(At),Pt=n(55530),Ft=n.n(Pt);const Lt={PROGRESS:"event:DicomFileUploader:progress"};let _t=function(e){return e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Success=2]="Success",e[e.Failed=3]="Failed",e[e.Cancelled=4]="Cancelled",e}({});class kt{constructor(e,t){this.message=void 0,this.status=void 0,this.message=t,this.status=e}}class Gt extends p.Rc{constructor(e,t){super(Lt),this._file=void 0,this._fileId=void 0,this._dataSource=void 0,this._loadPromise=void 0,this._abortController=new AbortController,this._status=_t.NotStarted,this._percentComplete=0,this._file=e,this._fileId=S.Ay.wadouri.fileManager.add(e),this._dataSource=t}getFileId(){return this._fileId}getFileName(){return this._file.name}getFileSize(){return this._file.size}cancel(){this._abortController.abort()}getStatus(){return this._status}getPercentComplete(){return this._percentComplete}async load(){return this._loadPromise||(this._loadPromise=new Promise((e,t)=>{const n={progress:e=>{e.lengthComputable&&(this._status=_t.InProgress,this._percentComplete=Math.round(100*e.loaded/e.total),this._broadcastEvent(Lt.PROGRESS,{fileId:this._fileId,percentComplete:this._percentComplete}))},timeout:()=>{this._reject(t,new kt(_t.Failed,"The request timed out."))},abort:()=>{this._reject(t,new kt(_t.Cancelled,"Cancelled"))},error:()=>{this._reject(t,new kt(_t.Failed,"The request failed."))}};S.Ay.wadouri.loadFileRequest(this._fileId).then(o=>{if(this._abortController.signal.aborted)return void this._reject(t,new kt(_t.Cancelled,"Cancelled"));if(!this._checkDicomFile(o))return void this._reject(t,new kt(_t.Failed,"Not a valid DICOM file."));const a=new XMLHttpRequest;return this._addRequestCallbacks(a,n),this._dataSource.store.dicom(o,a).then(()=>{this._status=_t.Success,e()}).catch(e=>{this._reject(t,e)})}).catch(e=>{this._reject(t,e)})})),this._loadPromise}_isRejected(){return this._status===_t.Failed||this._status===_t.Cancelled}_reject(e,t){if(!this._isRejected()){if(t instanceof kt)return this._status=t.status,void e(t);this._status=_t.Failed,t.message?e(new kt(_t.Failed,t.message)):e(new kt(_t.Failed,t))}}_addRequestCallbacks(e,t){const n=()=>e.abort();this._abortController.signal.addEventListener("abort",n);for(const[n,o]of Object.entries(t))e.upload.addEventListener(n,o);const o=()=>{this._abortController.signal.removeEventListener("abort",n);for(const[n,o]of Object.entries(t))e.upload.removeEventListener(n,o);e.removeEventListener("loadend",o)};e.addEventListener("loadend",o)}_checkDicomFile(e){if(e.length<=132)return!1;const t=new Uint8Array(e.slice(128,132));return Array.from("DICM").every((e,n)=>e.charCodeAt(0)===t[n])}}var zt=n(39078);const Bt=(0,i.memo)(({dicomFileUploader:e})=>{const[t,n]=(0,i.useState)(e.getPercentComplete()),[o,a]=(0,i.useState)(""),[r,s]=(0,i.useState)(e.getStatus()),l=(0,i.useCallback)(()=>r===_t.Failed||r===_t.Cancelled||r===_t.Success,[r]);(0,i.useEffect)(()=>{const t=e.subscribe(Lt.PROGRESS,e=>{n(e.percentComplete)});return e.load().catch(e=>{s(e.status),a(e.message??"")}).finally(()=>s(e.getStatus())),()=>t.unsubscribe()},[]);const c=(0,i.useCallback)(()=>{e.cancel()},[]);return i.createElement("div",{className:"min-h-14 border-secondary-light flex w-full items-center overflow-hidden border-b p-2.5 text-lg"},i.createElement("div",{className:"self-top flex w-0 shrink grow flex-col gap-1"},i.createElement("div",{className:"flex gap-4"},i.createElement("div",{className:"flex w-6 shrink-0 items-center justify-center"},(()=>{switch(e.getStatus()){case _t.Success:return i.createElement(ut.FI1.ByName,{name:"status-tracked",className:"text-primary-light"});case _t.InProgress:return i.createElement(ut.FI1.ByName,{name:"icon-transferring"});case _t.Failed:return i.createElement(ut.FI1.ByName,{name:"icon-alert-small"});case _t.Cancelled:return i.createElement(ut.FI1.ByName,{name:"icon-alert-outline"});default:return i.createElement(i.Fragment,null)}})()),i.createElement("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-[rgb(var(--text))]"},e.getFileName())),o&&i.createElement("div",{className:"pl-10"},o)),i.createElement("div",{className:"flex w-24 items-center"},!l()&&i.createElement(i.Fragment,null,e.getStatus()===_t.InProgress&&i.createElement("div",{className:"w-10 text-right"},t,"%"),i.createElement("div",{className:"ml-auto flex cursor-pointer"},i.createElement(ut.FI1.Close,{className:"text-primary self-center",onClick:c})))))});Bt.propTypes={dicomFileUploader:xt().instanceOf(Gt).isRequired};const $t=Bt,jt=1e3,Wt=6e4,Ht=36e5,qt=15e3,Yt="text-ellipsis whitespace-nowrap overflow-hidden";function Jt({dicomFileUploaderArr:e,onComplete:t}){const{servicesManager:n}=(0,p.Jg)(),o=n.services.customizationService.getCustomization("ui.progressLoadingBar"),[a]=(0,i.useState)(e.reduce((e,t)=>e+t.getFileSize(),0)),r=(0,i.useRef)(0),s=(0,i.useRef)(0),[l,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(0),[u,g]=(0,i.useState)(0),[S,I]=(0,i.useState)(0),[v,y]=(0,i.useState)(!1),f=(0,i.useRef)();(0,i.useEffect)(()=>{let e,t=0,n=Date.now();const o=()=>{const i=r.current-t,l=Date.now(),c=l-n;s.current=i/c,t=r.current,n=l,a-r.current>0&&(e=s.current>=75?setTimeout(o,qt):setTimeout(o,3e4))};return e=setTimeout(o,qt),()=>{clearTimeout(e)}},[]),(0,i.useEffect)(()=>{let t=null;const n=e.map(e=>{let n=0;const o=o=>{const i=n;if(n=Math.round(o/100*e.getFileSize()),r.current=Math.min(a,r.current-i+n),m(r.current/a*100),0!==s.current){const e=a-r.current,n=Math.round(e/s.current);if(null===t)return t=n,void c(t);if(n<Wt){const e=Math.ceil(t/jt),o=Math.ceil(n/jt)-e;return void((o<0||o>2)&&(t=n,c(t)))}if(n<Ht){const e=Math.ceil(t/Wt),o=Math.ceil(n/Wt)-e;return void((o<0||o>2)&&(t=n,c(t)))}t=n,c(t)}};return e.load().catch(e=>{e.status===_t.Failed&&I(e=>e+1)}).finally(()=>{o(100),g(e=>e+1)}),e.subscribe(Lt.PROGRESS,e=>{o(e.percentComplete)})});return()=>{n.forEach(e=>e.unsubscribe())}},[]);const h=(0,i.useCallback)(async()=>{for(const t of e){new Promise((e,n)=>{setTimeout(()=>{t.cancel(),e()},0)})}},[]),w=(0,i.useCallback)(()=>{if(null==l)return"";if(l<Wt){const e=Math.ceil(l/jt);return`${e} ${1===e?"second":"seconds"}`}if(l<Ht){const e=Math.ceil(l/Wt);return`${e} ${1===e?"minute":"minutes"}`}const e=Math.ceil(l/Ht);return`${e} ${1===e?"hour":"hours"}`},[l]),E=(0,i.useCallback)(()=>Math.min(100,Math.round(d)),[d]),b=(0,i.useCallback)(()=>E()<1&&(f?.current?.offsetWidth??0)*(d/100)<1,[E,d]),D=(0,i.useCallback)(()=>({width:`${u.toString().length+e.length.toString().length+3}ch`}),[u]),T=()=>i.createElement("div",{className:"ml-auto flex w-6 justify-center"},S>0&&i.createElement("div",{onClick:()=>y(e=>!e)},i.createElement(ut.FI1.ByName,{className:"cursor-pointer",name:"icon-status-alert"})));return i.createElement("div",{className:"flex grow flex-col"},i.createElement("div",{className:"flex h-14 items-center bg-[rgb(var(--primary-dark))] px-1 pb-4 text-lg text-[rgb(var(--text))]"},u===e.length?i.createElement(i.Fragment,null,i.createElement("span",{className:Yt},`${e.length} ${e.length>1?"files":"file"} completed.`),i.createElement(zt.$n,{disabled:!1,className:"ml-auto",onClick:t},"Close")):i.createElement(i.Fragment,null,i.createElement("div",{className:"flex flex-wrap"},i.createElement("span",{style:D(),className:Ft()(Yt,"text-right")},`${u} of ${e.length}`,"Â "),i.createElement("span",{className:Yt}," files completed."),i.createElement("br",null),i.createElement("span",null,l?`Less than ${w()} remaining. `:"")),i.createElement("span",{className:"text-primary hover:text-primary-lightactive:text-aqua-pale ml-auto cursor-pointer whitespace-nowrap",onClick:h},"Cancel All Uploads"))),i.createElement("div",{className:"flex grow flex-col overflow-hidden bg-[rgb(var(--background))] text-lg"},i.createElement("div",{className:"ohif-scrollbar border-secondary-light overflow-y-scroll border-b px-2"},i.createElement("div",{className:"min-h-14 flex w-full items-center p-2.5"},u===e.length?i.createElement(i.Fragment,null,i.createElement("div",{className:"text-primary-light text-xl"},S>0?`Completed with ${S} ${S>1?"errors":"error"}!`:"Completed!"),T()):i.createElement(i.Fragment,null,i.createElement("div",{ref:f,className:"flex-grow"},i.createElement(o,{progress:b()?void 0:Math.min(100,d)})),i.createElement("div",{className:"ml-1 flex w-24 items-center"},i.createElement("div",{className:"text-foreground w-10 text-right"},`${E()}%`),T())))),i.createElement("div",{className:"ohif-scrollbar h-1 grow overflow-y-scroll px-2"},e.filter(e=>!v||e.getStatus()===_t.Failed).map(e=>i.createElement($t,{key:e.getFileId(),dicomFileUploader:e})))))}Jt.propTypes={dicomFileUploaderArr:xt().arrayOf(xt().instanceOf(Gt)).isRequired,onComplete:xt().func.isRequired};const Kt=Jt;function Qt(){return Qt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Qt.apply(null,arguments)}function Zt({dataSource:e,onComplete:t,onStarted:n}){const o="min-h-[480px] flex flex-col bg-[rgb(var(--background))] select-none",[a,r]=(0,i.useState)([]),s=(0,i.useCallback)(async t=>{n(),r(t.map(t=>new Gt(t,e)))},[]);return i.createElement(i.Fragment,null,a.length?i.createElement("div",{className:Ft()("h-[calc(100vh-300px)]",o)},i.createElement(Kt,{dicomFileUploaderArr:Array.from(a),onComplete:t})):i.createElement("div",{className:Ft()("h-[480px]",o)},i.createElement(Ut.A,{onDrop:e=>{s(e)},noClick:!0},({getRootProps:e})=>i.createElement("div",Qt({},e(),{className:"dicom-upload-drop-area-border-dash m-5 flex h-full flex-col items-center justify-center"}),i.createElement("div",{className:"flex gap-3"},i.createElement(Ut.A,{onDrop:s,noDrag:!0},({getRootProps:e,getInputProps:t})=>i.createElement("div",e(),i.createElement(zt.$n,{disabled:!1,onClick:()=>{}},"Add files",i.createElement("input",t())))),i.createElement(Ut.A,{onDrop:s,noDrag:!0},({getRootProps:e,getInputProps:t})=>i.createElement("div",e(),i.createElement(zt.$n,{type:zt.Ny.NW.secondary,disabled:!1,onClick:()=>{}},"Add folder",i.createElement("input",Qt({},t(),{webkitdirectory:"true",mozdirectory:"true"})))))),i.createElement("div",{className:"pt-5"},"or drag images or folders here"),i.createElement("div",{className:"text-aqua-pale pt-3 text-lg"},"(DICOM files supported)")))))}Zt.propTypes={dataSource:xt().object.isRequired,onComplete:xt().func.isRequired,onStarted:xt().func.isRequired};const Xt=Zt,en={cinePlayer:ut.F05,autoCineModalities:["OT","US"],"panelMeasurement.disableEditing":!1,onBeforeSRAddMeasurement:({measurement:e,StudyInstanceUID:t,SeriesInstanceUID:n})=>e,onBeforeDicomStore:({dicomDict:e,measurementData:t,naturalizedReport:n})=>e,dicomUploadComponent:Xt,codingValues:{}},tn="image";const nn={"ohif.captureViewportModal":function({onClose:e,defaultSize:t,fileTypeOptions:n,viewportId:o,showAnnotations:a,onAnnotationsChange:r,dimensions:s,warningState:l,onDimensionsChange:c,onEnableViewport:d,onDisableViewport:m,onDownload:p}){const[u,g]=(0,i.useState)(null),[S,I]=(0,i.useState)(!0),[v,y]=(0,i.useState)(tn),[f,h]=(0,i.useState)("jpg"),{t:w}=(0,gt.Bd)("CaptureViewportModal");return(0,i.useEffect)(()=>{if(u)return d(u),()=>{m()}},[m,d,u]),i.createElement(ut.jiK,null,i.createElement(ut.jiK.Body,null,i.createElement(ut.jiK.ImageVisual,null,i.createElement("div",{style:{height:s.height,width:s.width,position:"relative"},"data-viewport-uid":o,ref:g},l.enabled&&S&&i.createElement("div",{className:"text-foreground absolute left-1/2 bottom-[5px] z-[1000] -translate-x-1/2 whitespace-nowrap rounded bg-[rgb(var(--background))] p-3 text-xs font-bold",style:{fontSize:"12px"}},l.value))),i.createElement(ut.jiK.ImageOptions,null,i.createElement("div",{className:"flex items-end space-x-2"},i.createElement(ut.jiK.Filename,{value:v,onChange:e=>y(e.target.value)},w("File name")),i.createElement(ut.jiK.Filetype,{selected:f,onSelect:h,options:n})),i.createElement(ut.jiK.ImageSize,{width:s.width.toString(),height:s.height.toString(),onWidthChange:e=>{c({...s,width:parseInt(e.target.value)||t})},onHeightChange:e=>{c({...s,height:parseInt(e.target.value)||t})},maxWidth:1e4.toString(),maxHeight:1e4.toString()},w("Image size")," ",i.createElement("span",{className:"text-muted-foreground"},"px")),i.createElement(ut.jiK.SwitchOption,{defaultChecked:a,checked:a,onCheckedChange:r},w("Include annotations")),l.enabled&&i.createElement(ut.jiK.SwitchOption,{defaultChecked:S,checked:S,onCheckedChange:I},w("Include warning message")),i.createElement(ut.esu,{className:"mt-2"},i.createElement(ut.esu.Right,null,i.createElement(ut.esu.Secondary,{onClick:e},w("Common:Cancel")),i.createElement(ut.esu.Primary,{onClick:()=>{p(v||tn,f),e()}},w("Common:Save")))))))}},on={"viewportDownload.warningMessage":{enabled:!0,value:"Not For Diagnostic Use"}};const an=function({commandsManager:e,servicesManager:t,extensionManager:n}){return[{name:"default",value:{...pt,...ft({commandsManager:e,servicesManager:t,extensionManager:n}),...ht,...wt,...Et,...bt,...Tt,...Mt,...Vt,...Rt,...en,...nn,...on}}]};var rn=n(21536),sn=n(7927),ln=n(3823);function cn(e,t){let{viewports:n}=e.getState();return n=[...n.values()],n=n.filter(e=>e.displaySetInstanceUIDs&&e.displaySetInstanceUIDs.length),n=n.filter(e=>{const{displaySetInstanceUIDs:n}=e;for(const e of n){const n=t.getDisplaySetByUID(e);return!(!n||!n.isReconstructable)}}),n}const dn=e=>`VOI_SYNC_${e}`;function mn(e,t,n){const{syncGroupService:o,cornerstoneViewportService:a}=n.services;e.forEach(e=>{const{viewportId:n}=e.viewportOptions,r=a.getCornerstoneViewport(n);r&&o.removeViewportFromSyncGroup(r.id,r.getRenderingEngine().id,t)})}var pn=n(68578),un=n(78713);n(21978);const gn=e=>({selectedSegmentationsForViewport:{},type:"selectedSegmentationsForViewportId",setSelectedSegmentationsForViewport:(t,n)=>e(e=>({selectedSegmentationsForViewport:{...e.selectedSegmentationsForViewport,[t]:n}}),!1,"setSelectedSegmentationsForViewport"),clearSelectedSegmentationsForViewportStore:()=>e({selectedSegmentationsForViewport:{}},!1,"clearSelectedSegmentationsForViewportStore")}),Sn=(0,un.vt)()(gn);var In=n(91037);const vn=512,yn="cornerstone-viewport-download-form",fn=[{value:"jpg",label:"JPG"},{value:"png",label:"PNG"}],hn=({hide:e,activeViewportId:t})=>{const{servicesManager:n}=(0,p.Jg)(),{customizationService:o,cornerstoneViewportService:a}=n.services,[r,c]=(0,i.useState)(!0),[d,m]=(0,i.useState)({width:vn,height:vn}),u=o.getCustomization("viewportDownload.warningMessage"),g=(0,h.kJ)(t),S=g?.element,{viewportId:I,renderingEngineId:v}=(0,s.getEnabledElement)(S),y=a.getRenderingEngine(),f=l.ToolGroupManager.getToolGroupForViewport(I,v);(0,i.useEffect)(()=>{const e=Object.keys(f.toolOptions).reduce((e,t)=>{const n=f.toolOptions[t],{mode:o,bindings:a}=n;return{...e,[t]:{mode:o,bindings:a}}},{});return()=>{Object.keys(e).forEach(t=>{const{mode:n,bindings:o}=e[t];f.setToolMode(t,n,{bindings:o})})}},[]);(0,i.useEffect)(()=>{d.width&&d.height&&setTimeout(()=>{(async(e,t)=>{if(!S)return;const n=(0,s.getEnabledElement)(S);if(!n)return;const o=l.segmentation.state.getViewportSegmentationRepresentations(I),{viewport:a}=n,r=y.getViewport(yn);try{if(r instanceof s.StackViewport){const e=a.getCurrentImageId(),t=a.getProperties();await r.setStack([e]),r.setProperties(t)}else if(r instanceof s.BaseVolumeViewport){const e=a.getAllVolumeIds();r.setVolumes([{volumeId:e[0]}])}return o.length>0&&o.forEach(e=>{const{segmentationId:t,colorLUTIndex:n,type:o}=e;o===l.Enums.SegmentationRepresentations.Labelmap&&l.segmentation.addLabelmapRepresentationToViewportMap({[r.id]:[{segmentationId:t,type:l.Enums.SegmentationRepresentations.Labelmap,config:{colorLUTOrIndex:n}}]}),o===l.Enums.SegmentationRepresentations.Contour&&l.segmentation.addContourRepresentationToViewportMap({[r.id]:[{segmentationId:t,type:l.Enums.SegmentationRepresentations.Contour,config:{colorLUTOrIndex:n}}]})}),{width:Math.min(e||vn,1e4),height:Math.min(t||vn,1e4)}}catch(e){console.error("Error loading image:",e)}})(d.width,d.height),(e=>{const t=(0,s.getEnabledElement)(S);if(!t)return;const n=y.getViewport(yn);if(!n)return;const{viewportId:o,renderingEngineId:a}=t,{id:r}=n,i=l.ToolGroupManager.getToolGroupForViewport(o,a);i.addViewport(r,a);const c=i.getToolInstances();Object.values(c).forEach(t=>{!1!==t.constructor.isAnnotation&&(e?i.setToolEnabled(t.toolName):i.setToolDisabled(t.toolName))})})(r),y.resize(),y.render()},100)},[d,r]);const w=o.getCustomization("ohif.captureViewportModal");return i.createElement(w,{onClose:e,defaultSize:vn,fileTypeOptions:fn,viewportId:yn,showAnnotations:r,onAnnotationsChange:c,dimensions:d,onDimensionsChange:m,onEnableViewport:e=>{if(!e)return;const{viewport:t}=(0,s.getEnabledElement)(S),n={viewportId:yn,element:e,type:t.type,defaultOptions:{background:t.defaultOptions.background,orientation:t.defaultOptions.orientation}};y.enableElement(n)},onDisableViewport:async()=>{y.disableElement(yn)},onDownload:async(e,t)=>{const n=document.querySelector(`div[data-viewport-uid="${yn}"]`);if(!n)return void console.debug("No viewport found for download");const o=await(0,In.A)(n),a=document.createElement("a");a.download=`${e}.${t}`,a.href=o.toDataURL(`image/${t}`,1),a.click()},warningState:u})};var wn=n(3359),En=n.n(wn);const bn=({viewportId:e,viewportGridService:t})=>{const{viewports:n,activeViewportId:o}=t.getState(),a=e||o;return n.get(a)},Dn=e=>{const{points:t}=e;if(!t||!Array.isArray(t)||0===t.length){return{center:[0,0,0],extent:{min:[0,0,0],max:[0,0,0]}}}const n=[...t[0]],o=[...t[0]];for(let e=1;e<t.length;e++){const a=t[e];for(let e=0;e<3;e++)n[e]=Math.min(n[e],a[e]),o[e]=Math.max(o[e],a[e])}return{center:[(n[0]+o[0])/2,(n[1]+o[1])/2,(n[2]+o[2])/2],extent:{min:n,max:o}}};function Tn(e,t,n,o){if(e<0||e>1||n<0||n>1)throw new Error("x1 and x2 must be in the range [0, 1]");return function(a){if(a<=0)return 0;if(a>=1)return 1;if(e===t&&n===o)return a;const r=function(e,t,n){const o=1e-6,a=3*t,r=3*(n-t)-a,i=1-a-r;function s(e){return((i*e+r)*e+a)*e}function l(e){return(3*i*e+2*r)*e+a}const c=function(e){let t=e;for(let n=0;n<8;n++){const n=s(t)-e;if(Math.abs(n)<o)return t;const a=l(t);if(Math.abs(a)<o)break;t-=n/a}return null}(e);return null!==c?c:function(e){let t=0,n=1,a=e;for(;t<n;){const r=s(a);if(Math.abs(r-e)<o)return a;e>r?t=a:n=a,a=.5*(n-t)+t}return a}(e)}(a,e,n);return function(e,t,n){const o=3*t,a=3*(n-t)-o;return(((1-o-a)*e+a)*e+o)*e}(r,t,o)}}const Cn=Tn(0,0,1,1),On=Tn(.42,0,1,1),Nn=Tn(0,0,.58,1),Mn=Tn(.42,0,.58,1),Vn=Tn(.25,.1,.25,1);function Rn(e){return function(t,n=0,o){if(0===n)return e(t);const a=e(t),r=(o?n*o:1)-n;return n+(1-Math.abs(2*a-1))*r}}const Un=Rn(Cn),An=Rn(Vn),xn=Rn(On),Pn=Rn(Nn),Fn=Rn(Mn);let Ln=function(e){return e.EASE="ease",e.EASE_IN="ease-in",e.EASE_OUT="ease-out",e.EASE_IN_OUT="ease-in-out",e.LINEAR="linear",e}({});const _n=new Map([[Ln.EASE,An],[Ln.EASE_IN,xn],[Ln.EASE_OUT,Pn],[Ln.EASE_IN_OUT,Fn],[Ln.LINEAR,Un]]);var kn=n(68523);async function Gn(e,{viewportId:t,options:n={},segmentationType:o}){const{viewportGridService:a,displaySetService:r,segmentationService:i}=e.services,{viewports:l}=a.getState(),c=t,d=l.get(c),m=n.displaySetInstanceUID||d.displaySetInstanceUIDs[0],p=i.getSegmentations(),u=n.label||`${kn.A.t("Tools:Segmentation")} ${p.length+1}`,g=n.segmentationId||`${s.utilities.uuidv4()}`,S=r.getDisplaySetByUID(m),I={label:u,segmentationId:g,segments:(v=n.createInitialSegment,v?{1:{label:`${kn.A.t("Tools:Segment")} 1`,active:!0}}:{})};var v;const y=await(o===ot.SegmentationRepresentations.Labelmap?i.createLabelmapForDisplaySet(S,I):i.createContourForDisplaySet(S,I));return await i.addSegmentationRepresentation(t,{segmentationId:g,type:o}),y}var zn=n(55126);const{add:Bn,intersect:$n,subtract:jn,copy:Wn}=l.utilities.contourSegmentation,{DefaultHistoryMemo:Hn}=s.utilities.HistoryMemo,qn={imageSlice:function({servicesManager:e,viewports:t,syncId:n}){const{syncGroupService:o,viewportGridService:a,displaySetService:r,cornerstoneViewportService:i}=e.services;n||="IMAGE_SLICE_SYNC";const s=t||cn(a,r);if(s.some(e=>!!o.getSynchronizersForViewport(e.viewportOptions.viewportId).find(e=>e.id===n)))return function(e,t){const{syncGroupService:n,viewportGridService:o,displaySetService:a,cornerstoneViewportService:r}=t.services,i=cn(o,a);i.forEach(t=>{const{viewportId:o}=t.viewportOptions,a=r.getCornerstoneViewport(o);a&&n.removeViewportFromSyncGroup(a.id,a.getRenderingEngine().id,e)})}(n,e);s.forEach(e=>{const{viewportId:t}=e.viewportOptions,a=i.getCornerstoneViewport(t);a&&o.addViewportToSyncGroup(t,a.getRenderingEngine().id,{type:"imageSlice",id:n,source:!0,target:!0})})},voi:function({servicesManager:e,viewports:t,syncId:n}){const{syncGroupService:o,viewportGridService:a,displaySetService:r,cornerstoneViewportService:i}=e.services,s=t||function(e,t){const{viewports:n}=e.getState(),o=[...n.values()];return o.reduce((e,n)=>{const{displaySetInstanceUIDs:o}=n,a=o[0],r=t.getDisplaySetByUID(a).Modality;return e[r]||(e[r]=[]),e[r].push(n),e},{})}(a,r);for(const[t,a]of Object.entries(s)){const r=n||dn(t);if(a.some(e=>!!o.getSynchronizersForViewport(e.viewportOptions.viewportId).find(e=>e.id===r)))return mn(a,r,e);a.forEach(e=>{const{viewportId:t}=e.viewportOptions,n=i.getCornerstoneViewport(t);n&&o.addViewportToSyncGroup(t,n.getRenderingEngine().id,{type:"voi",id:r,source:!0,target:!0})})}}},{segmentation:Yn}=l.utilities,Jn=({toolGroupService:e})=>{const t=[];return e.getToolGroupIds().forEach(e=>{const n=l.ToolGroupManager.getToolGroup(e).getToolInstances();Object.keys(n).forEach(e=>{const o=n[e];o instanceof l.LabelmapBaseTool&&t.push(o)})}),t},Kn=new v.OU({autoSegmentMode:!0,models:{sam_b:[{name:"sam-b-encoder",url:"https://huggingface.co/schmuell/sam-b-fp16/resolve/main/sam_vit_b_01ec64.encoder-fp16.onnx",size:180,key:"encoder"},{name:"sam-b-decoder",url:"https://huggingface.co/schmuell/sam-b-fp16/resolve/main/sam_vit_b_01ec64.decoder.onnx",size:17,key:"decoder"}]},modelName:"sam_b"});let Qn=!1;const Zn=function({servicesManager:e,commandsManager:t,extensionManager:n}){const{viewportGridService:o,toolGroupService:a,cineService:r,uiDialogService:i,cornerstoneViewportService:c,uiNotificationService:d,measurementService:m,customizationService:u,colorbarService:g,hangingProtocolService:S,syncGroupService:I,segmentationService:v,displaySetService:y}=e.services;function h(){return E(o)}function b(e){return w(e)}function D(){const e=h();return a.getToolGroupForViewport(e.id)}function T(){const e=o.getActiveViewportId(),t=v.getActiveSegmentation(e),n=t?.segmentationId;return{segmentationId:n,segmentIndex:v.getActiveSegment(e).segmentIndex}}const C={jumpToMeasurementViewport:({annotationUID:e,measurement:n})=>{l.annotation.selection.setAnnotationSelected(e,!0);const{metadata:a}=n,r=o.getActiveViewportId(),i=c.findNavigationCompatibleViewportId(r,a);if(i){const e=c.getCornerstoneViewport(i);if(e.setViewReference(a),e.render(),!((e,t)=>{const n=e.getCamera(),{focalPoint:o,parallelScale:a}=n,{extent:r}=Dn(t),{min:i,max:s}=r;for(let e=0;e<3;e++){const t=Math.abs(i[e]-o[e]),n=Math.abs(s[e]-o[e]);if(t>a||n>a)return!1}return!0})(e,n)){const t=e.getCamera(),{focalPoint:o,position:a}=t,{center:r,extent:i}=Dn(n),s=ln.eR.sub(ln.eR.create(),a,o);ln.eR.add(s,s,r),e.setCamera({focalPoint:r,position:s});const l=ln.eR.dist(i.min,i.max);if(l>t.parallelScale){const n=l/t.parallelScale;e.setZoom(e.getZoom()/n)}e.render()}return}const{displaySetInstanceUID:s}=n;if(!s)return void console.warn("ViewportGrid::No display set found in",n);const d=c.findUpdateableViewportConfiguration(r,n);if(!d)return void console.warn("Unable to find a viewport to show this in");const m=S.getViewportsRequireUpdate(d.viewportId,s);m?.[0]?(m[0].viewportOptions=d.viewportOptions,t.run("updateStoredPositionPresentation",{viewportId:d.viewportId,displaySetInstanceUIDs:[s],referencedImageId:n.referencedImageId,options:{...n.metadata}}),t.run("setDisplaySetsForViewports",{viewportsToUpdate:m})):console.warn("ViewportGrid::Unable to navigate to viewport containing",s)},hydrateSecondaryDisplaySet:async({displaySet:e,viewportId:n})=>{if(!e)return;const a=c.getCornerstoneViewport(n);if(!a)return;if(e.isOverlayDisplaySet){const n="SEG"!==e.Modality?ot.SegmentationRepresentations.Contour:a.type===s.Enums.ViewportType.VOLUME_3D?ot.SegmentationRepresentations.Surface:ot.SegmentationRepresentations.Labelmap;t.runCommand("updateStoredSegmentationPresentation",{displaySet:e,type:n})}const r=e.referencedDisplaySetInstanceUID,i=e=>{t.runCommand("updateStoredPositionPresentation",{viewportId:n,displaySetInstanceUIDs:[e.displaySetInstanceUID]})};if("SEG"===e.Modality||"RTSTRUCT"===e.Modality){const o=y.getDisplaySetByUID(r);i(o);const a=t.runCommand("loadSegmentationDisplaySetsForViewport",{viewportId:n,displaySetInstanceUIDs:[o.displaySetInstanceUID]});if(u.getCustomization("panelSegmentation.disableEditing")){v.getSegmentationRepresentations(n,{segmentationId:e.displaySetInstanceUID}).forEach(e=>{Object.keys(e.segments).forEach(t=>{v.setSegmentLocked(e.segmentationId,parseInt(t),!0)})})}return a}if("SR"===e.Modality){const n=t.runCommand("hydrateStructuredReport",{displaySetInstanceUID:e.displaySetInstanceUID}),{SeriesInstanceUIDs:a}=n,r=y.getDisplaySetsForSeries(a[0]);return r.forEach(i),r.length&&C.setDisplaySetsForViewports({viewportsToUpdate:[{viewportId:o.getActiveViewportId(),displaySetInstanceUIDs:[r[0].displaySetInstanceUID]}]}),n}},runSegmentBidirectional:async({segmentationId:e,segmentIndex:n}={})=>{const a=e&&n?{segmentationId:e,segmentIndex:n}:T(),{segmentationId:r,segmentIndex:i}=a,s=await l.utilities.segmentation.getSegmentLargestBidirectional({segmentationId:r,segmentIndices:[i]}),c=o.getActiveViewportId();s.forEach(e=>{const{segmentIndex:t,majorAxis:n,minorAxis:o}=e,a=l.SegmentBidirectionalTool.hydrate(c,[n,o],{segmentIndex:t,segmentationId:r});e.annotationUID=a.annotationUID;const s=function({segmentationId:e,segmentIndex:t,bidirectionalData:n,segmentationService:o,annotation:a}){if(!e||void 0===t||!n)return console.debug("Missing required data for bidirectional stats update"),null;const r=o.getSegmentation(e);if(!r||!r.segments[t])return console.debug("Segment not found:",t,"in segmentation:",e),null;const i={...r},s=i.segments[t];s.cachedStats||(s.cachedStats={namedStats:{}}),s.cachedStats.namedStats||(s.cachedStats.namedStats={});const{majorAxis:l,minorAxis:c,maxMajor:d,maxMinor:m}=n;if(!l||!c)return console.debug("Missing major or minor axis data"),null;let p=!1;const u=s.cachedStats.namedStats;return d>0&&m>0&&(u.bidirectional={name:"bidirectional",label:"Bidirectional",annotationUID:a.annotationUID,value:{maxMajor:d,maxMinor:m,majorAxis:l,minorAxis:c},unit:"mm"},p=!0),p?i:null}({segmentationId:r,segmentIndex:i,bidirectionalData:e,segmentationService:v,annotation:a});s&&v.addOrUpdateSegmentation({segmentationId:r,segments:s.segments})});const d=s.find(e=>e.segmentIndex===i);t.run("jumpToMeasurement",{uid:d.annotationUID})},interpolateLabelmap:()=>{const{segmentationId:e,segmentIndex:t}=T();sn.G({segmentationId:e,segmentIndex:t})},showCornerstoneContextMenu:e=>{const n=h()?.viewport?.element,o={...e,element:n},{useSelectedAnnotation:a,nearbyToolData:r,event:i}=o;if(a&&!r){const e=j();if(!(!o.allowedSelectedTools||o.allowedSelectedTools.includes(e?.metadata?.toolName)))return;o.nearbyToolData=e}o.defaultPointsPosition=[],o.selectorProps={toolName:o.nearbyToolData?.metadata?.toolName,value:o.nearbyToolData,uid:o.nearbyToolData?.annotationUID,nearbyToolData:o.nearbyToolData,event:i,...o.selectorProps},t.run(e,o)},updateStoredSegmentationPresentation:({displaySet:e,type:t})=>{const{addSegmentationPresentationItem:n}=it.v.getState();n(e.referencedDisplaySetInstanceUID,{segmentationId:e.displaySetInstanceUID,hydrated:!0,type:t})},updateStoredPositionPresentation:({viewportId:e,displaySetInstanceUIDs:t,referencedImageId:n,options:o})=>{const a=c.getPresentations(e),{positionPresentationStore:r,setPositionPresentation:i,getPositionPresentationId:s}=rt.q.getState();let l;t&&Array.isArray(t)&&t.length>0&&(l=Object.entries(r).find(([n,o])=>t.every(e=>n.includes(e))&&o?.viewportId===e)?.[0]);const d=n||o?.FrameOfReferenceUID?{...a.positionPresentation,viewReference:{referencedImageId:n,...o}}:a.positionPresentation;if(l)return void i(l,d);i(s({displaySetInstanceUIDs:t,viewportId:e}),d)},getNearbyToolData:({nearbyToolData:e,element:t,canvasCoordinates:n})=>e??l.utilities.getAnnotationNearPoint(t,n),getNearbyAnnotation({element:e,canvasCoordinates:t}){const n=C.getNearbyToolData({nearbyToolData:null,element:e,canvasCoordinates:t});return n?.metadata?.toolName&&(t=>{const n=(0,s.getEnabledElement)(e);if(!n)return;const{renderingEngineId:o,viewportId:a}=n,r=l.ToolGroupManager.getToolGroupForViewport(a,o).getToolInstance(t);return r?.constructor?.isAnnotation??!0})(n.metadata.toolName)?n:null},_handleMeasurementLabelDialog:async e=>{const t=u.getCustomization("measurementLabels"),n=u.getCustomization("ui.labellingComponent"),o=m.getMeasurement(e);if(!o)return void console.debug("No measurement found for label editing");if(!t){const t=await(0,f.callInputDialog)({uiDialogService:i,title:kn.A.t("Tools:Edit Measurement Label"),placeholder:o.label||kn.A.t("Tools:Enter new label"),defaultValue:o.label});return void(null!=t&&m.update(e,{...o,label:t},!0))}const a=await(0,f.callInputDialogAutoComplete)({measurement:o,uiDialogService:i,labelConfig:t,renderContent:n});null!=a&&m.update(e,{...o,label:a},!0)},setMeasurementLabel:async({uid:e})=>{await C._handleMeasurementLabelDialog(e)},renameMeasurement:async({uid:e})=>{await C._handleMeasurementLabelDialog(e)},updateMeasurement:e=>{const{code:t,uid:n,textLabel:o,label:a}=e;let{style:r}=e;const i=m.getMeasurement(n);if(!i)return void console.warn("No measurement found to update",n);const s={...i};if(void 0!==o&&(s.label=o),void 0!==t){const e=t.type||"finding";if(t.ref&&!t.CodeValue){const e=t.ref.indexOf(":");t.CodeValue=t.ref.substring(e+1),t.CodeMeaning=t.text||a,t.CodingSchemeDesignator=t.ref.substring(0,e)}s[e]=t,"finding"!==e&&(s.findingSites?(s.findingSites=s.findingSites.filter(t=>t.type!==e),s.findingSites.push(t)):s.findingSites=[t])}if(r||=s.finding?.style,r||=s.findingSites?.find(e=>e?.style)?.style,r)switch(r.lineDashSelected||=r.lineDash,l.annotation.config.style.setAnnotationStyles(i.uid,r),i.toolName){case A.PlanarFreehandROI:l.annotation.state.getAnnotation(i.uid).data.isOpenUShapeContour=!!r.isOpenUShapeContour;break}m.update(s.uid,s,!0)},jumpToMeasurement:({uid:e,displayMeasurements:t=[]})=>{m.jumpToMeasurement(o.getActiveViewportId(),e);for(const n of t)n.isActive=n.uid===e},removeMeasurement:({uid:e})=>{Array.isArray(e)?m.removeMany(e):m.remove(e)},toggleLockMeasurement:({uid:e})=>{m.toggleLockMeasurement(e)},toggleVisibilityMeasurement:({uid:e,items:t,visibility:n})=>{void 0===n&&t?.length&&(n=!t[0].isVisible),Array.isArray(e)?m.toggleVisibilityMeasurementMany(e,n):m.toggleVisibilityMeasurement(e,n)},downloadCSVMeasurementsReport:({measurementFilter:e})=>{p.Wp.downloadCSVReport(m.getMeasurements(e))},downloadCSVSegmentationReport:({segmentationId:e})=>{const t=v.getSegmentation(e),{representationData:n}=t,{Labelmap:o}=n,{referencedImageIds:a}=o,r=a[0],i=y.getActiveDisplaySets().find(e=>e.imageIds?.some(e=>e===r)),{SeriesNumber:s,SeriesInstanceUID:l,StudyInstanceUID:c,SeriesDate:d,SeriesTime:m,SeriesDescription:p}=i;!function(e,t){const n=[];n.push(["Segmentation ID",e.segmentationId||""]),n.push(["Segmentation Label",e.label||""]),n.push([]);const o=t.reference;if([["Series Number",o.SeriesNumber],["Series Instance UID",o.SeriesInstanceUID],["Study Instance UID",o.StudyInstanceUID],["Series Date",o.SeriesDate],["Series Time",o.SeriesTime],["Series Description",o.SeriesDescription]].forEach(([e,t])=>{t&&n.push([`reference ${e}`,t])}),n.push([]),n.push(["Segments Statistics"]),e.segments){const t=["Label"];for(const n in e.segments){const o=e.segments[n];t.push(`${o.label||""}`)}n.push(t),n.push(["Segment Index",...Object.values(e.segments).map(e=>e.segmentIndex||"")]),n.push(["Locked",...Object.values(e.segments).map(e=>e.locked?"Yes":"No")]),n.push(["Active",...Object.values(e.segments).map(e=>e.active?"Yes":"No")]);const o=new Set;for(const t of Object.values(e.segments))if(t.cachedStats&&t.cachedStats.namedStats)for(const e in t.cachedStats.namedStats){const n=t.cachedStats.namedStats[e],a=n.label||n.name,r=n.unit?` (${n.unit})`:"";o.add(`${a}${r}`)}for(const t of o){const o=[t];for(const n of Object.values(e.segments)){let e="";if(n.cachedStats&&n.cachedStats.namedStats)for(const o in n.cachedStats.namedStats){const a=n.cachedStats.namedStats[o];if(`${a.label||a.name}${a.unit?` (${a.unit})`:""}`===t){e=void 0!==a.value?a.value:"";break}}o.push(e)}n.push(o)}}let a="";for(const e of n)a+=e.map(e=>{const t=null!=e?e.toString():"";return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t}).join(",")+"\n";const r=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(r),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",`${e.label||"Segmentation"}_Report_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}(t,{reference:{SeriesNumber:s,SeriesInstanceUID:l,StudyInstanceUID:c,SeriesDate:d,SeriesTime:m,SeriesDescription:p}})},getActiveViewportEnabledElement:h,setViewportActive:({viewportId:e})=>{c.getViewportInfo(e)?o.setActiveViewportId(e):console.warn("No viewport found for viewportId:",e)},arrowTextCallback:async({callback:e,data:t})=>{const n=u.getCustomization("measurementLabels"),o=u.getCustomization("ui.labellingComponent");if(!n){const n=await(0,f.callInputDialog)({uiDialogService:i,title:kn.A.t("Tools:Edit Arrow Text"),placeholder:t?.data?.label||kn.A.t("Tools:Enter new text"),defaultValue:t?.data?.label||""});return void e?.(n)}const a=await(0,f.callInputDialogAutoComplete)({uiDialogService:i,labelConfig:n,renderContent:o});e?.(a)},toggleCine:()=>{const{viewports:e}=o.getState(),{isCineEnabled:t}=r.getState();r.setIsCineEnabled(!t),e.forEach((e,t)=>r.setCine({id:t,isPlaying:!1}))},setViewportWindowLevel({viewportId:e,windowWidth:t,windowCenter:n,displaySetInstanceUID:o}){const a=Number(t),r=Number(n),i=c.getRenderingEngine().getViewport(e),{lower:l,upper:d}=s.utilities.windowLevel.toLowHighRange(a,r);if(i instanceof s.BaseVolumeViewport){const t=C.getVolumeIdForDisplaySet({viewportId:e,displaySetInstanceUID:o});i.setProperties({voiRange:{upper:d,lower:l}},t)}else i.setProperties({voiRange:{upper:d,lower:l}});i.render()},toggleViewportColorbar:({viewportId:e,displaySetInstanceUIDs:t,options:n={}})=>{g.hasColorbar(e)?g.removeColorbar(e):g.addColorbar(e,t,n)},setWindowLevel(e){const{toolGroupId:t}=e,{viewportId:n}=h(),o=a.getToolGroupForViewport(n);t&&t!==o||C.setViewportWindowLevel({...e,viewportId:n})},setWindowLevelPreset:({presetName:e,presetIndex:t})=>{const n=u.getCustomization("cornerstone.windowLevelPresets"),a=o.getActiveViewportId(),r=c.getCornerstoneViewport(a).getImageData().metadata.Modality;if(!r)return;const i=n[r];if(!i)return;const s=i[e]??Object.values(i)[t];C.setViewportWindowLevel({viewportId:a,windowWidth:s.window,windowCenter:s.level})},getVolumeIdForDisplaySet:({viewportId:e,displaySetInstanceUID:t})=>{const n=c.getCornerstoneViewport(e);if(n instanceof s.BaseVolumeViewport){const e=n.getAllVolumeIds().find(e=>e.includes(t));return e}return null},setToolEnabled:({toolName:e,toggle:t,toolGroupId:n})=>{const{viewports:r}=o.getState();if(!r.size)return;const i=a.getToolGroup(n??null);if(!i||!i.hasTool(e))return;const s=i.getToolOptions(e).mode===l.Enums.ToolModes.Enabled;t&&s?i.setToolDisabled(e):i.setToolEnabled(e);c.getRenderingEngine().render()},toggleEnabledDisabledToolbar({value:e,itemId:t,toolGroupId:n}){const o=t||e;n=n??D();const r=a.getToolGroup(n);if(!r||!r.hasTool(o))return;r.getToolOptions(o).mode===l.Enums.ToolModes.Enabled?r.setToolDisabled(o):r.setToolEnabled(o)},toggleActiveDisabledToolbar({value:e,itemId:t,toolGroupId:n}){const o=t||e;n=n??D();const r=a.getToolGroup(n);if(!r||!r.hasTool(o))return;const i=[l.Enums.ToolModes.Active,l.Enums.ToolModes.Enabled,l.Enums.ToolModes.Passive].includes(r.getToolOptions(o).mode);if(i?r.setToolDisabled(o):C.setToolActive({toolName:o,toolGroupId:n}),i){const e=r.getPrevActivePrimaryToolName();e!==o&&C.setToolActive({toolName:e,toolGroupId:n})}},setToolActiveToolbar:({value:e,itemId:t,toolName:n,toolGroupIds:o=[],bindings:r})=>{n=n||t||e,(o=o.length?o:a.getToolGroupIds()).forEach(e=>{C.setToolActive({toolName:n,toolGroupId:e,bindings:r})})},setToolActive:({toolName:e,toolGroupId:t=null,bindings:n=[{mouseButton:l.Enums.MouseBindings.Primary}]})=>{const{viewports:r}=o.getState();if(!r.size)return;const i=a.getToolGroup(t);if(!i)return;if(!i?.hasTool(e))return;const s=i.getActivePrimaryMouseButtonTool();if(s){const e=i.getToolConfiguration(s);e?.disableOnPassive?i.setToolDisabled(s):i.setToolPassive(s)}i.setToolActive(e,{bindings:n})},showDownloadViewportModal:()=>{const{activeViewportId:t}=o.getState();if(!c.getCornerstoneViewport(t))return void d.show({title:kn.A.t("Tools:Download Image"),message:kn.A.t("Tools:Image cannot be downloaded"),type:"error"});const{uiModalService:n}=e.services;n&&n.show({content:hn,title:kn.A.t("Tools:Download High Quality Image"),contentProps:{activeViewportId:t,cornerstoneViewportService:c},containerClassName:"max-w-4xl p-4"})},rotateViewportBy:({rotation:e,viewportId:t})=>{C._rotateViewport({rotation:e,viewportId:t,rotationMode:"apply"})},setViewportRotation:({rotation:e,viewportId:t})=>{C._rotateViewport({rotation:e,viewportId:t,rotationMode:"set"})},flipViewportHorizontal:({viewportId:e,newValue:t="toggle"})=>{const n=e?b(e):h();if(!n)return;const{viewport:o}=n;let a;if("toggle"===t){const{flipHorizontal:e}=o.getCamera();a=!e}else a=t;o.setCamera({flipHorizontal:a}),o.render()},flipViewportVertical:({viewportId:e,newValue:t="toggle"})=>{const n=e?b(e):h();if(!n)return;const{viewport:o}=n;let a;if("toggle"===t){const{flipVertical:e}=o.getCamera();a=!e}else a=t;o.setCamera({flipVertical:a}),o.render()},invertViewport:({element:e})=>{let t;if(t=void 0===e?h():e,!t)return;const{viewport:n}=t,{invert:o}=n.getProperties();n.setProperties({invert:!o}),n.render()},resetViewport:()=>{const e=h();if(!e)return;const{viewport:t}=e;t.resetProperties?.(),t.resetCamera(),t.render()},scaleViewport:({direction:e})=>{const t=h(),n=e>0?.9:1.1;if(!t)return;const{viewport:o}=t;if(o instanceof s.StackViewport)if(e){const{parallelScale:e}=o.getCamera();o.setCamera({parallelScale:e*n}),o.render()}else o.resetCamera(),o.render()},jumpToImage:({imageIndex:e,viewport:t})=>{let n;if(t)n=c.getCornerstoneViewport(t.id);else{const e=h();if(!e)return;n=e.viewport}let o=0;if(n instanceof s.StackViewport)o=n.getImageIds().length;else{if(!(n instanceof s.VolumeViewport))throw new Error("Unsupported viewport type");o=s.utilities.getImageSliceDataForVolumeViewport(n).numberOfSlices}const a=e<0?o+e:e;if(a>=o||a<0)throw new Error(`Can't jump to ${e}`);const r={imageIndex:a};s.utilities.jumpToSlice(n.element,r)},scroll:e=>{const t=h();if(e.delta??=e.direction||1,e.direction??=e.delta,!t)return;const{viewport:n}=t;s.utilities.scroll(n,e)},setViewportColormap:({viewportId:e,displaySetInstanceUID:t,colormap:n,opacity:a=1,immediate:r=!1})=>{const i=c.getCornerstoneViewport(e);let l;const{viewportMatchDetails:d}=S.getActiveProtocol(),m=d.get(e)?.displaySetsInfo;if(m){const e=m.find(e=>e.displaySetInstanceUID===t);l=e?.displaySetOptions?.options?.colormap?.opacity}if(n={...n,opacity:l||a},i instanceof s.StackViewport&&i.setProperties({colormap:n}),i instanceof s.VolumeViewport){if(!t){const{viewports:n}=o.getState();t=n.get(e)?.displaySetInstanceUIDs[0]}const a=i.getAllVolumeIds().find(e=>e.includes(t))??i.getVolumeId();i.setProperties({colormap:n},a)}r&&i.render()},changeActiveViewport:({direction:e=1})=>{const{activeViewportId:t,viewports:n}=o.getState(),a=Array.from(n.keys()),r=(a.indexOf(t)+e+a.length)%a.length;o.setActiveViewportId(a[r])},toggleSynchronizer:({type:t,viewports:n,syncId:o})=>{const a=I.getSynchronizer(o);if(a)return void(a.isDisabled()?a.setEnabled(!0):a.setEnabled(!1));const r=qn[t];r&&r({servicesManager:e,viewports:n,syncId:o})},setViewportForToolConfiguration:({viewportId:e,toolName:t})=>{if(!e){const{activeViewportId:t}=o.getState();e=t??"default"}const n=a.getToolGroupForViewport(e);if(!n?.hasTool(t))return;const r=n?.getToolConfiguration(t);n?.setToolConfiguration(t,{...r,sourceViewportId:e},!0);c.getRenderingEngine().render()},storePresentation:({viewportId:e})=>{c.storePresentation({viewportId:e})},updateVolumeData:({volume:e})=>{const{imageData:t,vtkOpenGLTexture:n}=e,o=t.getDimensions()[2];[...Array(o).keys()].forEach(e=>{n.setUpdatedFrame(e)}),t.modified()},attachProtocolViewportDataListener:({protocol:e,stageIndex:n})=>{const o=c.EVENTS.VIEWPORT_DATA_CHANGED,a=e.callbacks.onViewportDataInitialized,r=e.stages?.[n]?.viewports.length??1;let i=0;const{unsubscribe:s}=c.subscribe(o,e=>{i++,i===r&&(t.run(...a),s(o))})},setViewportPreset:({viewportId:e,preset:t})=>{const n=c.getCornerstoneViewport(e);n&&(n.setProperties({preset:t}),n.render())},setVolumeRenderingQulaity:({viewportId:e,volumeQuality:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],a=o.getMapper(),r=a.getInputData(),i=r.getDimensions(),s=r.getSpacing(),l=ln.eR.length(ln.eR.fromValues(i[0]*s[0],i[1]*s[1],i[2]*s[2]));let d=s.reduce((e,t)=>e+t)/3;d/=t>1?.5*t**2:1;const m=l/d+1;a.setMaximumSamplesPerRay(m),a.setSampleDistance(d),n.render()},shiftVolumeOpacityPoints:({viewportId:e,shift:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],a=o.getProperty().getScalarOpacity(0),r=[],i=a.getSize();for(let e=0;e<i;e++){const t=[0,0,0,0];a.getNodeValue(e,t),r.push(t)}r.forEach(e=>{e[0]+=t}),a.removeAllPoints(),r.forEach(e=>{a.addPoint(...e)}),n.render()},setVolumeLighting:({viewportId:e,options:t})=>{const n=c.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],a=o.getProperty();void 0!==t.shade&&a.setShade(t.shade),void 0!==t.ambient&&a.setAmbient(t.ambient),void 0!==t.diffuse&&a.setDiffuse(t.diffuse),void 0!==t.specular&&a.setSpecular(t.specular),n.render()},resetCrosshairs:({viewportId:e})=>{const t=[],n=e=>{const n=a.getToolGroup(e);t.push(n.getToolInstance("Crosshairs"))};if(e){n(a.getToolGroupForViewport(e).id)}else{a.getToolGroupIds().forEach(n)}t.forEach(e=>{e?.computeToolCenter()})},createLabelmapForViewport:async({viewportId:t,options:n={}})=>Gn(e,{viewportId:t,options:n,segmentationType:ot.SegmentationRepresentations.Labelmap}),createContourForViewport:async({viewportId:t,options:n={}})=>Gn(e,{viewportId:t,options:n,segmentationType:ot.SegmentationRepresentations.Contour}),setActiveSegmentation:({segmentationId:t})=>{const{viewportGridService:n,segmentationService:o}=e.services;o.setActiveSegmentation(n.getActiveViewportId(),t)},addSegmentCommand:({segmentationId:t,config:n})=>{const{segmentationService:o}=e.services;o.addSegment(t,n)},setActiveSegmentAndCenterCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o,viewportGridService:a}=e.services;o.setActiveSegmentation(a.getActiveViewportId(),t),o.setActiveSegment(t,n);const{highlightAlpha:r,highlightSegment:i,animationLength:s,animationFunctionType:l}=u.getCustomization("panelSegmentation.jumpToSegmentHighlightAnimationConfig")??{},c=Object.values(Ln).includes(l)?l:void 0;o.jumpToSegmentCenter(t,n,void 0,r,i,s,void 0,c)},toggleSegmentVisibilityCommand:({segmentationId:t,segmentIndex:n,type:o})=>{const{segmentationService:a,viewportGridService:r}=e.services;a.toggleSegmentVisibility(r.getActiveViewportId(),t,n,o)},toggleSegmentLockCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o}=e.services;o.toggleSegmentLocked(t,n)},toggleSegmentationVisibilityCommand:({segmentationId:t,type:n})=>{const{segmentationService:o,viewportGridService:a}=e.services;o.toggleSegmentationRepresentationVisibility(a.getActiveViewportId(),{segmentationId:t,type:n})},downloadSegmentationCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.downloadSegmentation(t)},storeSegmentationCommand:async({segmentationId:n})=>{const{segmentationService:o,viewportGridService:a}=e.services,r=await(0,f.createReportAsync)({servicesManager:e,getReport:()=>t.runCommand("storeSegmentation",{segmentationId:n}),reportType:"Segmentation"});r&&(o.remove(n),a.setDisplaySetsForViewport({viewportId:a.getActiveViewportId(),displaySetInstanceUIDs:r}))},downloadRTSSCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.downloadRTSS(t)},setSegmentationStyleCommand:({type:t,key:n,value:o})=>{const{segmentationService:a}=e.services;a.setStyle({type:t},{[n]:o})},deleteSegmentCommand:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o}=e.services;o.removeSegment(t,n)},deleteSegmentationCommand:({segmentationId:t})=>{const{segmentationService:n}=e.services;n.remove(t)},removeSegmentationFromViewportCommand:({segmentationId:t})=>{const{segmentationService:n,viewportGridService:o}=e.services;n.removeSegmentationRepresentations(o.getActiveViewportId(),{segmentationId:t})},toggleRenderInactiveSegmentationsCommand:()=>{const{segmentationService:t,viewportGridService:n}=e.services,o=n.getActiveViewportId(),a=t.getRenderInactiveSegmentations(o);t.setRenderInactiveSegmentations(o,!a)},setFillAlphaCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{fillAlpha:n})},setOutlineWidthCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{outlineWidth:n})},setRenderFillCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{renderFill:n})},setRenderOutlineCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{renderOutline:n})},setFillAlphaInactiveCommand:({type:t,value:n})=>{const{segmentationService:o}=e.services;o.setStyle({type:t},{fillAlphaInactive:n})},editSegmentLabel:async({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o,uiDialogService:a}=e.services,r=o.getSegmentation(t);if(!r)return;const i=r.segments[n];(0,f.callInputDialog)({uiDialogService:a,title:kn.A.t("Tools:Edit Segment Label"),placeholder:kn.A.t("Tools:Enter new label"),defaultValue:i.label}).then(e=>{o.setSegmentLabel(t,n,e)})},editSegmentationLabel:({segmentationId:t})=>{const{segmentationService:n,uiDialogService:o}=e.services,a=n.getSegmentation(t);if(!a)return;const{label:r}=a;(0,f.callInputDialog)({uiDialogService:o,title:kn.A.t("Tools:Edit Segmentation Label"),placeholder:kn.A.t("Tools:Enter new label"),defaultValue:r}).then(e=>{n.addOrUpdateSegmentation({segmentationId:t,label:e})})},editSegmentColor:({segmentationId:t,segmentIndex:n})=>{const{segmentationService:o,uiDialogService:a,viewportGridService:r}=e.services,i=r.getActiveViewportId(),s=o.getSegmentColor(i,t,n),l={r:s[0],g:s[1],b:s[2],a:s[3]/255};a.show({content:f.colorPickerDialog,title:kn.A.t("Tools:Segment Color"),contentProps:{value:l,onSave:e=>{const a=[e.r,e.g,e.b,255*e.a];o.setSegmentColor(i,t,n,a)}}})},getRenderInactiveSegmentations:()=>{const{segmentationService:t,viewportGridService:n}=e.services;return t.getRenderInactiveSegmentations(n.getActiveViewportId())},deleteActiveAnnotation:()=>{l.annotation.selection.getAnnotationsSelected().forEach(e=>{m.remove(e)})},setDisplaySetsForViewports:({viewportsToUpdate:t})=>{const{cineService:n,viewportGridService:o}=e.services;t.forEach(e=>{const t=n.getState(),o=t.cines?.[e.viewportId];n.setCine({id:e.viewportId,frameRate:o?.frameRate??t.default?.frameRate??24,isPlaying:!1})}),o.setDisplaySetsForViewports(t)},undo:()=>{Hn.undo()},redo:()=>{Hn.redo()},toggleSegmentPreviewEdit:({toggle:e})=>{let t=Jn({toolGroupService:a});t=t.filter(e=>!e.toolName.includes("Eraser")),t.forEach(t=>{t.configuration={...t.configuration,preview:{...t.configuration.preview,enabled:e}}})},toggleSegmentSelect:({toggle:e})=>{a.getToolGroupIds().forEach(t=>{const n=l.ToolGroupManager.getToolGroup(t);e?n.setToolActive(l.SegmentSelectTool.toolName):n.setToolDisabled(l.SegmentSelectTool.toolName)})},toggleSegmentLabel:({enabled:e})=>{const t=l.SegmentLabelTool.toolName,n=a.getToolGroupIds(),o=n.some(e=>{const n=l.ToolGroupManager.getToolGroup(e),o=n.getToolInstance(t)?.mode;return"Active"===o}),r=void 0!==e?e:!o;n.forEach(e=>{const n=l.ToolGroupManager.getToolGroup(e);r?n.setToolActive(t):n.setToolDisabled(t)})},initializeSegmentLabelTool:({tools:e})=>{const t=n.appConfig,o=t.segmentation?.segmentLabel;if(o?.enabledByDefault){const t=e?.active??[];return t.push({toolName:A.SegmentLabel,configuration:{hoverTimeout:o?.hoverTimeout??1,color:o?.labelColor,background:o?.background}}),e.active=t,e}const a=e?.disabled??[];return a.push({toolName:A.SegmentLabel,configuration:{hoverTimeout:o?.hoverTimeout??1,color:o?.labelColor}}),e.disabled=a,e},toggleUseCenterSegmentIndex:({toggle:e})=>{let t=Jn({toolGroupService:a});t=t.filter(e=>!e.toolName.includes("Eraser")),t.forEach(t=>{t.configuration={...t.configuration,useCenterSegmentIndex:e}})},_handlePreviewAction:e=>{const{viewport:t}=h(),n=(({toolGroupService:e})=>Jn({toolGroupService:e}).filter(e=>e.acceptPreview||e.rejectPreview))({toolGroupService:a});n.forEach(t=>{try{t[`${e}Preview`]()}catch(e){console.debug("Error accepting preview for tool",t.toolName)}}),Kn.enabled&&Kn[`${e}Preview`](t.element)},acceptPreview:()=>{C._handlePreviewAction("accept")},rejectPreview:()=>{C._handlePreviewAction("reject")},clearMarkersForMarkerLabelmap:()=>{const{viewport:e}=h(),t=l.ToolGroupManager.getToolGroupForViewport(e.id).getToolInstance("MarkerLabelmap");t&&t.clearMarkers(e)},interpolateScrollForMarkerLabelmap:()=>{const{viewport:e}=h(),t=l.ToolGroupManager.getToolGroupForViewport(e.id).getToolInstance("MarkerLabelmap");t&&t.interpolateScroll(e,1)},toggleLabelmapAssist:async()=>{const{viewport:e}=h(),t=!Kn.enabled;Kn.enabled=t,Qn||(await Kn.initModel(),Qn=!0);const n=a.getToolGroupIds();t?C.setToolActiveToolbar({toolName:"CircularBrushForAutoSegmentAI",toolGroupIds:n}):n.forEach(e=>{l.ToolGroupManager.getToolGroup(e).setToolPassive("CircularBrushForAutoSegmentAI")}),Kn.enabled&&Kn.initViewport(e)},setBrushSize:({value:e,toolNames:t})=>{const n=Number(e);a.getToolGroupIds()?.forEach(e=>{0===t?.length?Yn.setBrushSizeForToolGroup(e,n):t?.forEach(t=>{Yn.setBrushSizeForToolGroup(e,n,t)})})},setThresholdRange:({value:e,toolNames:t=["ThresholdCircularBrush","ThresholdSphereBrush","ThresholdCircularBrushDynamic","ThresholdSphereBrushDynamic"]})=>{const n=a.getToolGroupIds();if(n?.length)for(const o of n){const n=a.getToolGroup(o);t?.forEach(t=>{n.setToolConfiguration(t,{threshold:{range:e}})})}},increaseBrushSize:()=>{const e=a.getToolGroupIds();if(e?.length)for(const t of e){const e=Yn.getBrushSizeForToolGroup(t);Yn.setBrushSizeForToolGroup(t,e+3)}},decreaseBrushSize:()=>{const e=a.getToolGroupIds();if(e?.length)for(const t of e){const e=Yn.getBrushSizeForToolGroup(t);Yn.setBrushSizeForToolGroup(t,e-3)}},addNewSegment:()=>{const{segmentationService:t}=e.services,{activeViewportId:n}=o.getState(),a=t.getActiveSegmentation(n);a&&t.addSegment(a.segmentationId)},loadSegmentationDisplaySetsForViewport:({viewportId:t,displaySetInstanceUIDs:n})=>{const o=function({viewportId:e,servicesManager:t,displaySetInstanceUIDs:n}){const{hangingProtocolService:o,viewportGridService:a}=t.services,{isHangingProtocolLayout:r}=a.getState(),i=bn({viewportId:e,viewportGridService:a}).viewportOptions.viewportId;return o.getViewportsRequireUpdate(i,n[0],r)}({viewportId:t,servicesManager:e,displaySetInstanceUIDs:n});C.setDisplaySetsForViewports({viewportsToUpdate:o.map(e=>({viewportId:e.viewportId,displaySetInstanceUIDs:e.displaySetInstanceUIDs}))})},setViewportOrientation:({viewportId:e,orientation:t})=>{const n=c.getCornerstoneViewport(e);if(!n||n.type!==s.Enums.ViewportType.ORTHOGRAPHIC)return void console.warn("Orientation can only be set on volume viewports");if(!o.getDisplaySetsUIDsForViewport(e).map(e=>y.getDisplaySetByUID(e)).some(e=>e.isReconstructable))return void console.warn("Cannot change orientation: No reconstructable display sets in viewport");n.setOrientation(t),n.render();c.getViewportInfo(e).setOrientation(t)},toggleViewportHorizontalFlip:({viewportId:e}={})=>{C.flipViewportHorizontal({viewportId:e,newValue:"toggle"})},setViewportHorizontalFlip:({flipped:e,viewportId:t})=>{C.flipViewportHorizontal({viewportId:t,newValue:e})},toggleViewportVerticalFlip:({viewportId:e}={})=>{C.flipViewportVertical({viewportId:e,newValue:"toggle"})},setViewportVerticalFlip:({flipped:e,viewportId:t})=>{C.flipViewportVertical({viewportId:t,newValue:e})},_rotateViewport:({rotation:e,viewportId:t,rotationMode:n="apply"})=>{const o=t?b(t):h();if(!o)return;const{viewport:a}=o;if(a instanceof s.BaseVolumeViewport){const t=a.getCamera(),n=e*Math.PI/180,o=ln.pB.identity(new Float32Array(16));ln.pB.rotate(o,o,n,t.viewPlaneNormal);const r=ln.eR.transformMat4(ln.eR.create(),t.viewUp,o);return a.setCamera({viewUp:r}),void a.render()}if(void 0!==a.getRotation){const{rotation:t}=a.getViewPresentation(),o="apply"===n?(t+e+360)%360:(()=>{const{flipHorizontal:t=!1,flipVertical:n=!1}=a.getViewPresentation();return((((t?1:0)+(n?1:0))%2==1?-e:e)+360)%360})();a.setViewPresentation({rotation:o}),a.render()}},startRecordingForAnnotationGroup:()=>{l.AnnotationTool.startGroupRecording()},endRecordingForAnnotationGroup:()=>{l.AnnotationTool.endGroupRecording()},triggerCreateAnnotationMemo:({annotation:e,FrameOfReferenceUID:t,options:n})=>{const{newAnnotation:o,deleting:a}=n,r=(0,s.getRenderingEngines)().flatMap(e=>e.getViewports()).find(e=>e.getFrameOfReferenceUID()===t);r&&l.AnnotationTool.createAnnotationMemo(r.element,e,{newAnnotation:o,deleting:a})},activateSelectedSegmentationOfType:({segmentationRepresentationType:t})=>{const{segmentationService:n,viewportGridService:o}=e.services,a=o.getActiveViewportId(),{selectedSegmentationsForViewport:r}=Sn.getState(),i=r[a]?.get(t);i&&n.setActiveSegmentation(a,i)},setDynamicCursorSizeForSculptorTool:({value:e})=>{const t=o.getActiveViewportId(),n=a.getToolGroupForViewport(t).getToolInstance(A.SculptorTool),r=n.configuration;n.configuration={...r,updateCursorSize:e?"dynamic":""}},setInterpolationToolConfiguration:({value:e,toolNames:t})=>{const n=o.getActiveViewportId(),r=a.getToolGroupForViewport(n),i=a.getActiveToolForViewport(n),s={interpolation:{enabled:e,showInterpolationPolyline:!0}};r.setToolConfiguration(i,s),t&&Object.values(r.getToolInstances()).forEach(e=>{t?.includes(e.toolName)&&r.setToolConfiguration(e.toolName,s)})},setSimplifiedSplineForSplineContourSegmentationTool:({value:e})=>{const t=o.getActiveViewportId(),n=a.getToolGroupForViewport(t);Object.values(n.getToolInstances()).forEach(t=>{if(t instanceof l.SplineContourSegmentationTool){const n=t.configuration;t.configuration={...n,simplifiedSpline:e}}})},removeSmallContours:({areaThreshold:e})=>{const t=o.getActiveViewportId(),n=v.getActiveSegmentation(t),a=v.getActiveSegment(t);if(!n||!a)return;const{removeContourIslands:r}=zn.utilities;r(n.segmentationId,a.segmentIndex,{threshold:e});c.getRenderingEngine().render()},applyLogicalContourOperation:({segmentAInfo:e,segmentBInfo:t,resultSegmentInfo:n,logicalOperation:o})=>{switch(o){case rn.Dp.Union:Bn(e,t,n);break;case rn.Dp.Intersect:$n(e,t,n);break;case rn.Dp.Subtract:jn(e,t,n);break;default:throw new Error("Unsupported logical operation")}},copyContourSegment:({sourceSegmentInfo:e,targetSegmentInfo:t})=>{t||(t={segmentationId:e.segmentationId,segmentIndex:v.getNextAvailableSegmentIndex(e.segmentationId)},v.addSegment(t.segmentationId,{segmentIndex:t.segmentIndex})),Wn(e,t)},smoothContours:()=>{const e=o.getActiveViewportId(),t=v.getActiveSegmentation(e),n=v.getActiveSegment(e);if(!t||!n)return;const{smoothContours:a}=zn.utilities;a(t.segmentationId,n.segmentIndex);c.getRenderingEngine().render()},removeContourHoles:()=>{const e=o.getActiveViewportId(),t=v.getActiveSegmentation(e),n=v.getActiveSegment(e);if(!t||!n)return;const{removeContourHoles:a}=zn.utilities;a(t.segmentationId,n.segmentIndex);c.getRenderingEngine().render()},decimateContours:()=>{const e=o.getActiveViewportId(),t=v.getActiveSegmentation(e),n=v.getActiveSegment(e);if(!t||!n)return;const{decimateContours:a}=zn.utilities;a(t.segmentationId,n.segmentIndex);c.getRenderingEngine().render()},convertContourHoles:()=>{const e=o.getActiveViewportId(),t=v.getActiveSegmentation(e),n=v.getActiveSegment(e);if(!t||!n)return;const a={segmentationId:t.segmentationId,segmentIndex:v.getNextAvailableSegmentIndex(t.segmentationId)};v.addSegment(a.segmentationId,{segmentIndex:a.segmentIndex});const{convertContourHoles:r}=zn.utilities;r(t.segmentationId,n.segmentIndex,a.segmentationId,a.segmentIndex);c.getRenderingEngine().render()}},O={showCornerstoneContextMenu:{commandFn:C.showCornerstoneContextMenu,options:{menuCustomizationId:"measurementsContextMenu",commands:[{commandName:"showContextMenu"}]}},getNearbyToolData:{commandFn:C.getNearbyToolData},getNearbyAnnotation:{commandFn:C.getNearbyAnnotation,storeContexts:[],options:{}},toggleViewportColorbar:{commandFn:C.toggleViewportColorbar},setMeasurementLabel:{commandFn:C.setMeasurementLabel},renameMeasurement:{commandFn:C.renameMeasurement},updateMeasurement:{commandFn:C.updateMeasurement},jumpToMeasurement:C.jumpToMeasurement,removeMeasurement:{commandFn:C.removeMeasurement},toggleLockMeasurement:{commandFn:C.toggleLockMeasurement},toggleVisibilityMeasurement:{commandFn:C.toggleVisibilityMeasurement},downloadCSVMeasurementsReport:{commandFn:C.downloadCSVMeasurementsReport},setViewportWindowLevel:{commandFn:C.setViewportWindowLevel},setWindowLevel:{commandFn:C.setWindowLevel},setWindowLevelPreset:{commandFn:C.setWindowLevelPreset},setToolActive:{commandFn:C.setToolActive},setToolActiveToolbar:{commandFn:C.setToolActiveToolbar},setToolEnabled:{commandFn:C.setToolEnabled},rotateViewportCW:{commandFn:C.rotateViewportBy,options:{rotation:90}},rotateViewportCCW:{commandFn:C.rotateViewportBy,options:{rotation:-90}},rotateViewportCWSet:{commandFn:C.setViewportRotation,options:{rotation:90}},incrementActiveViewport:{commandFn:C.changeActiveViewport},decrementActiveViewport:{commandFn:C.changeActiveViewport,options:{direction:-1}},flipViewportHorizontal:{commandFn:C.toggleViewportHorizontalFlip},flipViewportVertical:{commandFn:C.toggleViewportVerticalFlip},setViewportHorizontalFlip:{commandFn:C.setViewportHorizontalFlip,options:{flipped:!0}},setViewportVerticalFlip:{commandFn:C.setViewportVerticalFlip,options:{flipped:!0}},invertViewport:{commandFn:C.invertViewport},resetViewport:{commandFn:C.resetViewport},scaleUpViewport:{commandFn:C.scaleViewport,options:{direction:1}},scaleDownViewport:{commandFn:C.scaleViewport,options:{direction:-1}},fitViewportToWindow:{commandFn:C.scaleViewport,options:{direction:0}},nextImage:{commandFn:C.scroll,options:{direction:1}},previousImage:{commandFn:C.scroll,options:{direction:-1}},firstImage:{commandFn:C.jumpToImage,options:{imageIndex:0}},lastImage:{commandFn:C.jumpToImage,options:{imageIndex:-1}},jumpToImage:{commandFn:C.jumpToImage},showDownloadViewportModal:{commandFn:C.showDownloadViewportModal},toggleCine:{commandFn:C.toggleCine},arrowTextCallback:{commandFn:C.arrowTextCallback},setViewportActive:{commandFn:C.setViewportActive},setViewportColormap:{commandFn:C.setViewportColormap},setViewportForToolConfiguration:{commandFn:C.setViewportForToolConfiguration},storePresentation:{commandFn:C.storePresentation},attachProtocolViewportDataListener:{commandFn:C.attachProtocolViewportDataListener},setViewportPreset:{commandFn:C.setViewportPreset},setVolumeRenderingQulaity:{commandFn:C.setVolumeRenderingQulaity},shiftVolumeOpacityPoints:{commandFn:C.shiftVolumeOpacityPoints},setVolumeLighting:{commandFn:C.setVolumeLighting},resetCrosshairs:{commandFn:C.resetCrosshairs},toggleSynchronizer:{commandFn:C.toggleSynchronizer},updateVolumeData:{commandFn:C.updateVolumeData},toggleEnabledDisabledToolbar:{commandFn:C.toggleEnabledDisabledToolbar},toggleActiveDisabledToolbar:{commandFn:C.toggleActiveDisabledToolbar},updateStoredPositionPresentation:{commandFn:C.updateStoredPositionPresentation},updateStoredSegmentationPresentation:{commandFn:C.updateStoredSegmentationPresentation},createLabelmapForViewport:{commandFn:C.createLabelmapForViewport},createContourForViewport:{commandFn:C.createContourForViewport},setActiveSegmentation:{commandFn:C.setActiveSegmentation},addSegment:{commandFn:C.addSegmentCommand},setActiveSegmentAndCenter:{commandFn:C.setActiveSegmentAndCenterCommand},toggleSegmentVisibility:{commandFn:C.toggleSegmentVisibilityCommand},toggleSegmentLock:{commandFn:C.toggleSegmentLockCommand},toggleSegmentationVisibility:{commandFn:C.toggleSegmentationVisibilityCommand},downloadSegmentation:{commandFn:C.downloadSegmentationCommand},storeSegmentation:{commandFn:C.storeSegmentationCommand},downloadRTSS:{commandFn:C.downloadRTSSCommand},setSegmentationStyle:{commandFn:C.setSegmentationStyleCommand},deleteSegment:{commandFn:C.deleteSegmentCommand},deleteSegmentation:{commandFn:C.deleteSegmentationCommand},removeSegmentationFromViewport:{commandFn:C.removeSegmentationFromViewportCommand},toggleRenderInactiveSegmentations:{commandFn:C.toggleRenderInactiveSegmentationsCommand},setFillAlpha:{commandFn:C.setFillAlphaCommand},setOutlineWidth:{commandFn:C.setOutlineWidthCommand},setRenderFill:{commandFn:C.setRenderFillCommand},setRenderOutline:{commandFn:C.setRenderOutlineCommand},setFillAlphaInactive:{commandFn:C.setFillAlphaInactiveCommand},editSegmentLabel:{commandFn:C.editSegmentLabel},editSegmentationLabel:{commandFn:C.editSegmentationLabel},editSegmentColor:{commandFn:C.editSegmentColor},getRenderInactiveSegmentations:{commandFn:C.getRenderInactiveSegmentations},deleteActiveAnnotation:{commandFn:C.deleteActiveAnnotation},setDisplaySetsForViewports:C.setDisplaySetsForViewports,undo:C.undo,redo:C.redo,interpolateLabelmap:C.interpolateLabelmap,runSegmentBidirectional:C.runSegmentBidirectional,downloadCSVSegmentationReport:C.downloadCSVSegmentationReport,toggleSegmentPreviewEdit:C.toggleSegmentPreviewEdit,toggleSegmentSelect:C.toggleSegmentSelect,acceptPreview:C.acceptPreview,rejectPreview:C.rejectPreview,toggleUseCenterSegmentIndex:C.toggleUseCenterSegmentIndex,toggleLabelmapAssist:C.toggleLabelmapAssist,interpolateScrollForMarkerLabelmap:C.interpolateScrollForMarkerLabelmap,clearMarkersForMarkerLabelmap:C.clearMarkersForMarkerLabelmap,setBrushSize:C.setBrushSize,setThresholdRange:C.setThresholdRange,increaseBrushSize:C.increaseBrushSize,decreaseBrushSize:C.decreaseBrushSize,addNewSegment:C.addNewSegment,loadSegmentationDisplaySetsForViewport:C.loadSegmentationDisplaySetsForViewport,setViewportOrientation:C.setViewportOrientation,hydrateSecondaryDisplaySet:C.hydrateSecondaryDisplaySet,getVolumeIdForDisplaySet:C.getVolumeIdForDisplaySet,triggerCreateAnnotationMemo:C.triggerCreateAnnotationMemo,startRecordingForAnnotationGroup:C.startRecordingForAnnotationGroup,endRecordingForAnnotationGroup:C.endRecordingForAnnotationGroup,toggleSegmentLabel:C.toggleSegmentLabel,jumpToMeasurementViewport:C.jumpToMeasurementViewport,initializeSegmentLabelTool:C.initializeSegmentLabelTool,activateSelectedSegmentationOfType:C.activateSelectedSegmentationOfType,setDynamicCursorSizeForSculptorTool:C.setDynamicCursorSizeForSculptorTool,setSimplifiedSplineForSplineContourSegmentationTool:C.setSimplifiedSplineForSplineContourSegmentationTool,removeSmallContours:C.removeSmallContours,applyLogicalContourOperation:C.applyLogicalContourOperation,copyContourSegment:C.copyContourSegment,smoothContours:C.smoothContours,removeContourHoles:C.removeContourHoles,decimateContours:C.decimateContours,convertContourHoles:C.convertContourHoles,setInterpolationToolConfiguration:C.setInterpolationToolConfiguration};return{actions:C,definitions:O,defaultContext:"CORNERSTONE"}};var Xn=n(40680);const eo={type:"voi",id:"mpr",source:!0,target:!0,options:{syncColormap:!0}},to={type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}},no={id:"mpr",name:Xn.A.t("Hps:MPR"),locked:!0,icon:"layout-advanced-mpr",isPreset:!0,createdDate:"2021-02-23",modifiedDate:"2023-08-15",availableTo:{},editableBy:{},numberOfPriorsReferenced:0,protocolMatchingRules:[],imageLoadStrategy:"nth",callbacks:{},displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{name:"MPR 1x3",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3,layoutOptions:[{x:0,y:0,width:1/3,height:1},{x:1/3,y:0,width:1/3,height:1},{x:2/3,y:0,width:1/3,height:1}]}},viewports:[{viewportOptions:{viewportId:"mpr-axial",toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"mpr-sagittal",toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"mpr-coronal",toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},oo={id:"fourUp",locked:!0,name:Xn.A.t("Hps:3D four up"),icon:"layout-advanced-3d-four-up",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"fourUpStage",name:"fourUp",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0},syncGroups:[to]},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},ao={id:"main3D",locked:!0,name:Xn.A.t("Hps:3D main"),icon:"layout-advanced-3d-main",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"main3DStage",name:"main3D",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:1,height:.5},{x:0,y:.5,width:1/3,height:.5},{x:1/3,y:.5,width:1/3,height:.5},{x:2/3,y:.5,width:1/3,height:.5}]}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},ro={id:"mprAnd3DVolumeViewport",locked:!0,name:Xn.A.t("Hps:mpr"),createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0}]}},stages:[{id:"mpr3Stage",name:"mpr",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0},syncGroups:[to]},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},io={id:"only3D",locked:!0,name:Xn.A.t("Hps:3D only"),icon:"layout-advanced-3d-only",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"only3DStage",name:"only3D",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0,syncGroups:[to]}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]}]}]},so={id:"primary3D",locked:!0,name:Xn.A.t("Hps:3D primary"),icon:"layout-advanced-3d-primary",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"primary3DStage",name:"primary3D",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:3,layoutOptions:[{x:0,y:0,width:2/3,height:1},{x:2/3,y:0,width:1/3,height:1/3},{x:2/3,y:1/3,width:1/3,height:1/3},{x:2/3,y:2/3,width:1/3,height:1/3}]}},viewports:[{viewportOptions:{toolGroupId:"volume3d",viewportType:"volume3d",orientation:"coronal",customViewportProps:{hideOverlays:!0}},displaySets:[{id:"activeDisplaySet",options:{displayPreset:{CT:"CT-Bone",MR:"MR-Default",default:"CT-Bone"}}}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},lo={id:"primaryAxial",locked:!0,name:Xn.A.t("Hps:Axial Primary"),icon:"layout-advanced-axial-primary",isPreset:!0,createdDate:"2023-03-15T10:29:44.894Z",modifiedDate:"2023-03-15T10:29:44.894Z",availableTo:{},editableBy:{},protocolMatchingRules:[],imageLoadStrategy:"interleaveCenter",displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]}},stages:[{id:"primaryAxialStage",name:"primaryAxial",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:2/3,height:1},{x:2/3,y:0,width:1/3,height:.5},{x:2/3,y:.5,width:1/3,height:.5}]}},viewports:[{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"axial",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"sagittal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"mpr",viewportType:"volume",orientation:"coronal",initialImageOptions:{preset:"middle"},syncGroups:[eo,to]},displaySets:[{id:"activeDisplaySet"}]}]}]},co={id:"@ohif/frameView",description:Xn.A.t("Hps:Frame view for the active series"),name:Xn.A.t("Hps:Frame View"),icon:"tool-stack-scroll",isPreset:!0,toolGroupIds:["default"],protocolMatchingRules:[],displaySetSelectors:{activeDisplaySet:{seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:16}},required:!0},{attribute:"isDisplaySetFromUrl",weight:20,constraint:{equals:!0}}]}},defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"activeDisplaySet"}]},stages:[{name:"frameView",id:"4x4",viewportStructure:{layoutType:"grid",properties:{rows:4,columns:4}},viewports:[{viewportOptions:{viewportId:"custom_R0_C0",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R0_C1",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R0_C2",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:2}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R0_C3",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:3}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R1_C0",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:4}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R1_C1",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:5}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R1_C2",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:6}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R1_C3",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:7}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R2_C0",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:8}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R2_C1",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:9}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R2_C2",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:10}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R2_C3",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:11}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R3_C0",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:12}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R3_C1",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:13}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R3_C2",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:14}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{viewportId:"custom_R3_C3",toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:15}}]},displaySets:[{id:"activeDisplaySet"}]}]},{name:"frameView",id:"3x3",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:3}},viewports:[{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:2}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:3}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:4}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:5}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:6}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:7}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:8}}]},displaySets:[{id:"activeDisplaySet"}]}]},{name:"frameView",id:"3x2",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3}},viewports:[{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:2}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:3}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:4}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:5}}]},displaySets:[{id:"activeDisplaySet"}]}]},{name:"frameView",id:"2x2",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:2}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:3}}]},displaySets:[{id:"activeDisplaySet"}]}]},{name:"frameView",id:"1x3",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:2}}]},displaySets:[{id:"activeDisplaySet"}]}]},{name:"frameView",id:"1x2",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:0}}]},displaySets:[{id:"activeDisplaySet"}]},{viewportOptions:{toolGroupId:"default",syncGroups:[{type:"zoompan",id:"zoompansync",source:!0,target:!0},{type:"voi",id:"wlsync",source:!0,target:!0,options:{syncColormap:!0}},{type:"frameview",id:"frameViewSync",source:!0,target:!0,options:{viewportIndex:1}}]},displaySets:[{id:"activeDisplaySet"}]}]}]};const mo=function(){return[{name:no.id,protocol:no},{name:ro.id,protocol:ro},{name:oo.id,protocol:oo},{name:ao.id,protocol:ao},{name:lo.id,protocol:lo},{name:io.id,protocol:io},{name:so.id,protocol:so},{name:co.id,protocol:co}]};var po=n(10225);const uo=({displaySet:e,showModality:t=!0,dataCY:n=`${e.label}-${e.Modality}`})=>i.createElement("div",{className:"flex w-[90%] items-center justify-between","data-cy":n},i.createElement("span",{className:"text-foreground truncate text-base"},e.label),t&&e.Modality&&i.createElement("span",{className:"text-muted-foreground flex-shrink-0 whitespace-nowrap text-xs"},e.Modality));var go=n(38007);const So=function({viewportId:e}){const{commandsManager:t,servicesManager:n}=(0,p.Jg)(),[o,a]=(0,i.useState)([]),[r,s]=(0,i.useState)([]),{toggleColorbar:l}=(0,go.eH)(e),{hangingProtocolService:c,toolbarService:d}=n.services,{backgroundDisplaySet:m,potentialOverlayDisplaySets:u,potentialForegroundDisplaySets:g,potentialBackgroundDisplaySets:S,overlayDisplaySets:I,foregroundDisplaySets:v}=(0,po.N)(e),[y,f]=(0,i.useState)(I),[h,w]=(0,i.useState)(!1),E=(n,o)=>{t.runCommand("removeDisplaySetLayer",{viewportId:e,displaySetInstanceUID:n}),setTimeout(()=>{t.runCommand("addDisplaySetAsLayer",{viewportId:e,displaySetInstanceUID:o})},0)},b=n=>{-1!==y.findIndex(e=>e.displaySetInstanceUID===n)&&f(e=>e.filter(e=>e.displaySetInstanceUID!==n)),t.runCommand("removeDisplaySetLayer",{viewportId:e,displaySetInstanceUID:n})},D=n=>{t.runCommand("addDisplaySetAsLayer",{viewportId:e,displaySetInstanceUID:n})},T=!!d.getButton("AdvancedRenderingControls"),C=!!d.getButton("opacityMenu");return i.createElement("div",{className:"bg-popover flex h-full w-[275px] flex-col rounded rounded-md p-1.5","data-cy":`viewport-data-overlay-menu-${e}`},i.createElement("div",{className:"flex"},i.createElement(ut.$nd,{variant:"ghost",className:"text-primary flex items-center p-1",onClick:()=>{a([...o,`pending-${Date.now()}`])},disabled:0===g.length},i.createElement(ut.FI1.Plus,{className:"h-4 w-4"}),"Foreground"),i.createElement(ut.$nd,{variant:"ghost",className:"text-primary ml-2 flex items-center",disabled:0===u.length,onClick:()=>{s([...r,`seg-${Date.now()}`])},dataCY:`AddSegmentationDataOverlay-${e}`},i.createElement(ut.FI1.Plus,{className:"h-4 w-4"}),"Segmentation")),i.createElement("div",{className:""},i.createElement("div",{className:"my-2 ml-1"},y.map(e=>i.createElement("div",{key:e.displaySetInstanceUID,className:"mb-1 flex items-center"},i.createElement(ut.FI1.LayerSegmentation,{className:"text-muted-foreground mr-1 h-6 w-6 flex-shrink-0"}),i.createElement(ut.l6P,{value:e.displaySetInstanceUID,onValueChange:t=>((e,t)=>{if(t===e.displaySetInstanceUID)return;const n=u.find(e=>e.displaySetInstanceUID===t);n&&(f(t=>{const o=t.findIndex(t=>t.displaySetInstanceUID===e.displaySetInstanceUID);return[...t.slice(0,o),n,...t.slice(o+1)]}),E(e.displaySetInstanceUID,n.displaySetInstanceUID))})(e,t)},i.createElement(ut.bqE,{className:"flex-1"},i.createElement(ut.yvm,{"data-cy":`overlay-ds-select-value-${e.label?.toUpperCase()}`},e.label?.toUpperCase())),i.createElement(ut.gCo,null,i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e})),u.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e}))))),i.createElement(ut.rId,null,i.createElement(ut.tyb,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"icon",className:"ml-2 flex-shrink-0",dataCY:`overlay-ds-more-button-${e.label?.toUpperCase()}`},i.createElement(ut.FI1.More,{className:"h-4 w-4"}))),i.createElement(ut.SQm,{align:"start"},i.createElement(ut._26,{"data-cy":`overlay-ds-remove-button-${e.label?.toUpperCase()}`,onClick:()=>b(e.displaySetInstanceUID)},"Remove"))))),r.map(e=>i.createElement("div",{key:e,className:"mb-2 flex items-center"},i.createElement(ut.FI1.LayerSegmentation,{className:"text-muted-foreground mr-1 h-6 w-6 flex-shrink-0"}),i.createElement(ut.l6P,{value:"",onValueChange:t=>((e,t)=>{const n=u.find(e=>e.displaySetInstanceUID===t);n&&(f(e=>[...e,n]),D(n.displaySetInstanceUID),s(r.filter(t=>t!==e)))})(e,t)},i.createElement(ut.bqE,{className:"flex-1"},i.createElement(ut.yvm,{placeholder:"SELECT A SEGMENTATION"})),i.createElement(ut.gCo,null,u.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e,dataCY:`${e.label}`}))))),i.createElement(ut.rId,null,i.createElement(ut.tyb,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"icon",className:"ml-2 flex-shrink-0"},i.createElement(ut.FI1.More,{className:"h-4 w-4"}))),i.createElement(ut.SQm,{align:"start"},i.createElement(ut._26,{onClick:()=>{s(r.filter(t=>t!==e))}},"Cancel")))))),i.createElement("div",{className:"my-2 px-1"},v.map((e,t)=>i.createElement("div",{key:e.displaySetInstanceUID,className:"mb-1 flex items-center"},i.createElement(ut.FI1.LayerForeground,{className:"text-muted-foreground mr-1 h-6 w-6 flex-shrink-0"}),i.createElement(ut.l6P,{value:e.displaySetInstanceUID,onValueChange:t=>((e,t)=>{if(t===e.displaySetInstanceUID)return;const n=g.find(e=>e.displaySetInstanceUID===t);n&&E(e.displaySetInstanceUID,n.displaySetInstanceUID)})(e,t)},i.createElement(ut.bqE,{className:"flex-1"},i.createElement(ut.yvm,null,e.label?.toUpperCase())),i.createElement(ut.gCo,null,i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e})),g.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e}))))),i.createElement(ut.rId,null,i.createElement(ut.tyb,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"icon",className:"ml-2 flex-shrink-0"},i.createElement(ut.FI1.More,{className:"h-4 w-4"}))),i.createElement(ut.SQm,{align:"start"},i.createElement(ut._26,{onClick:()=>b(e.displaySetInstanceUID)},"Remove"))))),o.map(e=>i.createElement("div",{key:e,className:"mb-2 flex items-center"},i.createElement(ut.FI1.LayerForeground,{className:"text-muted-foreground mr-1 h-6 w-6 flex-shrink-0"}),i.createElement(ut.l6P,{value:"",onValueChange:t=>((e,t)=>{const n=g.find(e=>e.displaySetInstanceUID===t);n&&(D(n.displaySetInstanceUID),a(o.filter(t=>t!==e)))})(e,t)},i.createElement(ut.bqE,{className:"flex-1"},i.createElement(ut.yvm,{placeholder:"SELECT A FOREGROUND"})),i.createElement(ut.gCo,null,g.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e}))))),i.createElement(ut.rId,null,i.createElement(ut.tyb,{asChild:!0},i.createElement(ut.$nd,{variant:"ghost",size:"icon",className:"ml-2 flex-shrink-0"},i.createElement(ut.FI1.More,{className:"h-4 w-4"}))),i.createElement(ut.SQm,{align:"start"},i.createElement(ut._26,{onClick:()=>{a(o.filter(t=>t!==e))}},"Cancel")))))),i.createElement("div",{className:"mt-1 mb-1 flex items-center px-1"},i.createElement(ut.FI1.LayerBackground,{className:"text-muted-foreground mr-1 h-6 w-6 flex-shrink-0"}),i.createElement(ut.l6P,{value:m?.displaySetInstanceUID,onValueChange:n=>{const o=S.find(e=>e.displaySetInstanceUID===n);o&&(n=>{const o=c.getViewportsRequireUpdate(e,n.displaySetInstanceUID);t.run("setDisplaySetsForViewports",{viewportsToUpdate:o})})(o)}},i.createElement(ut.bqE,{className:"flex-1"},i.createElement(ut.yvm,null,(m?.SeriesDescription||m?.label||"background").toUpperCase())),i.createElement(ut.gCo,null,S.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID,className:"pr-2"},i.createElement(uo,{displaySet:e}))))))),v.length>0&&(T||C)&&i.createElement("div",{className:"mt-1 ml-7"},i.createElement("div",{className:"flex items-center"},i.createElement(ut.dOG,{id:"threshold-opacity-switch",className:"mr-2",checked:h,onCheckedChange:()=>{const e=!h;T&&l(),w(e)}}),i.createElement("label",{htmlFor:"threshold-opacity-switch",className:"text-muted-foreground cursor-pointer text-sm",onClick:()=>w(!h)},"Control threshold & opacity"))))};function Io(){return Io=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Io.apply(null,arguments)}function vo(e){const{viewportId:t,location:n,isOpen:o=!1,onOpen:a,onClose:r,disabled:s,...l}=e,{viewportDisplaySets:c}=(0,po.N)(t),{IconContainer:d,className:m,containerProps:u}=(0,ut.n1D)(),{servicesManager:g}=(0,p.Jg)(),{toolbarService:S}=g.services,{align:I,side:v}=S.getAlignAndSide(n),y=i.createElement(ut.FI1.ViewportViews,{className:m}),f=l.id?{id:`${l.id}-${t}`}:{};return i.createElement(ut.AMh,{open:o,onOpenChange:e=>{e?a?.():r?.()}},i.createElement(ut.Wvm,{asChild:!0,className:"flex items-center justify-center"},i.createElement("div",null,d?i.createElement(d,Io({disabled:s,icon:"ViewportViews"},l,u,f),y):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:s},y))),i.createElement(ut.hlN,{className:"border-none bg-transparent p-0 shadow-none",side:v,align:I,alignOffset:0,sideOffset:5},i.createElement(So,{className:"w-full",viewportId:t,displaySets:c})))}function yo(){return yo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},yo.apply(null,arguments)}const fo=e=>{switch(e.toLowerCase()){case"axial":return ut.FI1.OrientationSwitchA;case"sagittal":return ut.FI1.OrientationSwitchS;case"coronal":return ut.FI1.OrientationSwitchC;case"reformat":return ut.FI1.OrientationSwitchR;default:return ut.FI1.OrientationSwitch}},ho=function({location:e,viewportId:t,displaySets:n,isOpen:o=!1,onOpen:a,onClose:r,disabled:l,...c}){const{servicesManager:d,commandsManager:m}=(0,p.Jg)(),{cornerstoneViewportService:u,toolbarService:g}=d.services,S=u.getViewportInfo(t).getOrientation(),[I]=(0,ut.ihW)(),v=t||I.activeViewportId,{IconContainer:y,className:f,containerProps:h}=(0,ut.n1D)(),[w,E]=i.useState("string"==typeof S?S:"axial"),b=e=>{E(e);const t=u.getViewportInfo(v),o=t?.getViewportType();if(!n.length)return;if(!n.some(e=>e.isReconstructable))return void console.warn("Cannot change orientation: No reconstructable display sets in viewport");let a;switch(e.toLowerCase()){case"axial":a=s.Enums.OrientationAxis.AXIAL;break;case"sagittal":a=s.Enums.OrientationAxis.SAGITTAL;break;case"coronal":a=s.Enums.OrientationAxis.CORONAL;break;case"reformat":a=s.Enums.OrientationAxis.REFORMAT;break;default:a=s.Enums.OrientationAxis.ACQUISITION}const i=n.map(e=>e.displaySetInstanceUID);if(o!==s.Enums.ViewportType.ORTHOGRAPHIC){const e={viewportId:v,displaySetInstanceUIDs:i,viewportOptions:{viewportType:s.Enums.ViewportType.ORTHOGRAPHIC,orientation:a},displaySetOptions:i.map(()=>({}))};m.run("setDisplaySetsForViewports",{viewportsToUpdate:[e]})}else m.runCommand("setViewportOrientation",{viewportId:v,orientation:a});r?.()};if(!n.length)return null;const{align:D,side:T}=g.getAlignAndSide(Number(e)),C=i.createElement(fo(w),{className:f});return i.createElement(ut.AMh,{open:o,onOpenChange:e=>{e?a?.():r?.()}},i.createElement(ut.Wvm,{asChild:!0,className:(0,ut.cn)("flex items-center justify-center")},i.createElement("div",null,y?i.createElement(y,yo({disabled:l,icon:"OrientationSwitch"},c,h),C):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:l,onClick:()=>{}},C))),i.createElement(ut.hlN,{className:"h-[170px] w-[130px] flex-shrink-0 flex-col items-start rounded p-1",align:D,side:T,style:{left:0}},i.createElement(ut.$nd,{variant:"ghost",className:"flex h-7 w-full flex-shrink-0 items-center justify-start self-stretch px-1 py-0",onClick:()=>b("axial")},i.createElement("div",{className:"mr-1 flex w-6 items-center justify-start"},"axial"===w?i.createElement(ut.FI1.Checked,{className:"text-primary h-6 w-6"}):null),i.createElement("div",{className:"flex-1 text-left"},"Axial")),i.createElement(ut.$nd,{variant:"ghost",className:"flex h-7 w-full flex-shrink-0 items-center justify-start self-stretch px-1 py-0",onClick:()=>b("sagittal")},i.createElement("div",{className:"mr-1 flex w-6 items-center justify-start"},"sagittal"===w?i.createElement(ut.FI1.Checked,{className:"text-primary h-6 w-6"}):null),i.createElement("div",{className:"flex-1 text-left"},"Sagittal")),i.createElement(ut.$nd,{variant:"ghost",className:"flex h-7 w-full flex-shrink-0 items-center justify-start self-stretch px-1 py-0",onClick:()=>b("coronal")},i.createElement("div",{className:"mr-1 flex w-6 items-center justify-start"},"coronal"===w?i.createElement(ut.FI1.Checked,{className:"text-primary h-6 w-6"}):null),i.createElement("div",{className:"flex-1 text-left"},"Coronal")),i.createElement(ut.$nd,{variant:"ghost",className:"flex h-7 w-full flex-shrink-0 items-center justify-start self-stretch px-1 py-0",onClick:()=>b("acquisition")},i.createElement("div",{className:"mr-1 flex w-6 items-center justify-start"},"acquisition"===w?i.createElement(ut.FI1.Checked,{className:"text-primary h-6 w-6"}):null),i.createElement("div",{className:"flex-1 text-left"},"Acquisition")),i.createElement("div",{className:"mx-1 my-2 border-t border-white/20"}),i.createElement(ut.$nd,{variant:"ghost",className:"flex h-7 w-full flex-shrink-0 items-center justify-start self-stretch px-1 py-0",onClick:()=>b("reformat")},i.createElement("div",{className:"mr-1 flex w-6 items-center justify-start"},"reformat"===w?i.createElement(ut.FI1.Checked,{className:"text-primary h-6 w-6"}):null),i.createElement("div",{className:"flex-1 text-left"},"Reformat"))))};function wo(){return wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},wo.apply(null,arguments)}function Eo(e){const{viewportId:t}=e,{viewportDisplaySets:n}=(0,po.N)(t);return n.length?i.createElement(ho,wo({},e,{displaySets:n})):null}var bo=n(47488);function Do({viewportId:e}={}){const{viewportDisplaySets:t}=(0,bo.e)(e),{t:n}=(0,gt.Bd)("WindowLevelActionMenu"),[o,a]=(0,i.useState)(t?.[0]?.displaySetInstanceUID),{colorbarProperties:r,setColormap:s}=(0,bo.e)(e,{displaySetInstanceUID:o}),{colormaps:l}=r,[c,d]=(0,i.useState)(!1),[m,p]=(0,i.useState)(null),[u,g]=(0,i.useState)(null),S=(0,i.useRef)(c);S.current=c;const I=(0,i.useRef)(m);I.current=m;const v=(0,i.useRef)(u);v.current=u,(0,i.useEffect)(()=>{g(null),p(null)},[o]);const y=(e,n=!0)=>{const o=t.length>1&&!["Grayscale","X Ray"].includes(e.name)?.5:1;s({colormap:e,opacity:o,immediate:n})};return i.createElement(i.Fragment,null,t&&t.length>1&&i.createElement("div",{className:"flex h-8 w-full flex-shrink-0 items-center justify-center px-2 text-base"},i.createElement(ut.tUM,{value:o,onValueChange:e=>{a(e),p(null)}},i.createElement(ut.j7C,null,t.map(e=>i.createElement(ut.Xib,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID},e.Modality))))),i.createElement("div",{className:"hover:bg-accent flex h-8 w-full flex-shrink-0 cursor-pointer items-center px-2 text-base hover:rounded",onClick:()=>d(!c)},i.createElement("span",{className:"flex-shrink-0"},n("Preview in viewport")),i.createElement(ut.dOG,{className:"ml-auto flex-shrink-0",checked:c,onCheckedChange:e=>{d(e),!e&&v.current&&y(v.current)}})),i.createElement(ut.se.DividerItem,null),i.createElement("div",{className:"h-[300px] flex-grow"},i.createElement(ut.FKN,{className:"h-full w-full"},i.createElement("div",{className:"p-1"},l.map((e,t)=>i.createElement(ut.se.Item,{key:t,label:e.description,useIconSpace:!1,onClick:()=>{g(e),y(e),p(null)},onMouseEnter:()=>{S.current&&(I.current||p(e),y(e))},onMouseLeave:()=>{S.current&&I.current&&y(I.current)}}))))))}function To({viewportId:e}={}){const{hasColorbar:t,toggleColorbar:n}=(0,bo.e)(e),{t:o}=(0,gt.Bd)("WindowLevelActionMenu"),a=(0,i.useCallback)(()=>{n()},[n]);return i.createElement("div",{className:"hover:bg-accent flex h-8 w-full flex-shrink-0 cursor-pointer items-center px-2 text-base hover:rounded"},i.createElement("div",{className:"flex w-7 flex-shrink-0 items-center justify-center"}),i.createElement("span",{className:"flex-grow",onClick:a},o("Display Color bar")),i.createElement(ut.dOG,{className:"ml-2 flex-shrink-0",checked:!!t,onCheckedChange:a}))}function Co({viewportId:e}={}){const{viewportDisplaySets:t}=(0,bo.e)(e),[n,o]=(0,i.useState)(t?.[0]?.displaySetInstanceUID),{windowLevelPresets:a,setWindowLevel:r}=(0,bo.e)(e,{displaySetInstanceUID:n}),[s,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(null),[m,p]=(0,i.useState)(null),u=(0,i.useRef)(s);u.current=s;const g=(0,i.useRef)(c);g.current=c;const S=(0,i.useRef)(m);S.current=m,(0,i.useEffect)(()=>{p(null),d(null)},[n]);const I=(e,t=!1)=>{r({windowWidth:Number(e.window),windowCenter:Number(e.level),immediate:t})};return i.createElement(i.Fragment,null,t&&t.length>1&&i.createElement("div",{className:"flex h-8 w-full flex-shrink-0 items-center justify-center px-2 text-base"},i.createElement(ut.tUM,{value:n,onValueChange:e=>{o(e)}},i.createElement(ut.j7C,null,t.map(e=>i.createElement(ut.Xib,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID},e.Modality))))),i.createElement("div",{className:"hover:bg-accent flex h-8 w-full flex-shrink-0 cursor-pointer items-center px-2 text-base hover:rounded",onClick:()=>l(!s)},i.createElement("span",{className:"flex-shrink-0"},"Preview in viewport"),i.createElement(ut.dOG,{className:"ml-auto flex-shrink-0",checked:s,onCheckedChange:e=>{l(e),!e&&S.current&&I(S.current,!0)}})),i.createElement(ut.se.DividerItem,null),i.createElement("div",{className:"h-[175px] flex-grow"},i.createElement(ut.FKN,{className:"h-full w-full"},i.createElement("div",{className:"p-1"},a.map((e,t)=>i.createElement(ut.se.Item,{key:t,label:e.description,secondaryLabel:`${e.window} / ${e.level}`,useIconSpace:!1,onClick:()=>{p(e),I(e,!0),d(null)},onMouseEnter:()=>{u.current&&(g.current||d(S.current||e),I(e,!0))},onMouseLeave:()=>{u.current&&g.current&&I(g.current,!0)}}))))))}function Oo({presets:e,viewportId:t,hide:n}){const{commandsManager:o}=(0,p.Jg)(),[a,r]=(0,i.useState)(""),[s,l]=(0,i.useState)(null),c=(0,i.useCallback)(e=>{r(e.target.value)},[]),d=(0,i.useCallback)(e=>{o.runCommand("setViewportPreset",{...e})},[o]),m=a?e.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())):e;return i.createElement(ut.MUF,{className:"h-[500px]"},i.createElement(ut.MUF.PresetBody,null,i.createElement(ut.MUF.PresetFilter,null,i.createElement(ut.MUF.PresetSearch,{value:a,onChange:c,placeholder:"Search all"})),i.createElement(ut.MUF.PresetGrid,null,m.map((e,n)=>{return i.createElement("div",{key:n,className:"flex cursor-pointer flex-col items-start",onClick:()=>{l(e),d({preset:e.name,viewportId:t})}},i.createElement(ut.FI1.ByName,{name:e.name,className:s?.name===e.name?"border-highlight h-[75px] w-[95px] max-w-none rounded border-2":"hover:border-highlight h-[75px] w-[95px] max-w-none rounded border-2 border-black"}),i.createElement("label",{className:"text-muted-foreground mt-1 text-left text-xs"},(o=e.name,a=11,o.length>a?`${o.slice(0,a)}...`:o)));var o,a}))),i.createElement(ut.esu,{className:"mt-4 flex-shrink-0"},i.createElement(ut.esu.Right,null,i.createElement(ut.esu.Secondary,{onClick:n},"Cancel"))))}function No({viewportId:e}={}){const{volumeRenderingPresets:t}=(0,bo.e)(e),{servicesManager:n}=(0,p.Jg)(),{uiDialogService:o}=n.services;return i.createElement(ut.se.Item,{label:"Rendering Presets",icon:i.createElement(ut.FI1.VolumeRendering,null),rightIcon:i.createElement(ut.FI1.ByName,{name:"action-new-dialog"}),onClick:()=>{o.show({id:"volume-rendering-presets",content:Oo,title:"Rendering Presets",isDraggable:!0,contentProps:{presets:t,viewportId:e}})}})}function Mo({volumeRenderingQualityRange:e,viewportId:t}){const{servicesManager:n,commandsManager:o}=(0,p.Jg)(),{cornerstoneViewportService:a}=n.services,{min:r,max:s,step:l}=e,[c,d]=(0,i.useState)(null),m=(0,i.useCallback)(e=>{o.runCommand("setVolumeRenderingQulaity",{viewportId:t,volumeQuality:e}),d(e)},[o,t]);return(0,i.useEffect)(()=>{const e=a.getCornerstoneViewport(t),{actor:n}=e.getActors()[0],o=n.getMapper(),r=o.getInputData().getSpacing(),i=o.getSampleDistance(),s=r.reduce((e,t)=>e+t)/3;d(i===s?1:Math.sqrt(s/(.5*i)))},[a,t]),i.createElement("div",{className:"my-1 mt-2 flex flex-col space-y-2"},null!==c&&i.createElement("div",{className:"w-full pl-2 pr-1"},i.createElement(ut.ewR.Container,{mode:"singleRange",min:r,max:s,step:l,value:c,onChange:m},i.createElement("div",{className:"flex flex-row items-center"},i.createElement(ut.ewR.Label,{className:"w-16"},"Quality"),i.createElement(ut.ewR.SingleRange,{sliderClassName:"mx-2 flex-grow"})))))}function Vo({viewportId:e}){const{servicesManager:t,commandsManager:n}=(0,p.Jg)(),{cornerstoneViewportService:o}=t.services,[a,r]=(0,i.useState)(null),[s,l]=(0,i.useState)(null),[c,d]=(0,i.useState)(o.getCornerstoneViewport(e)?.shiftedBy||0),[m,u]=(0,i.useState)(null),[g,S]=(0,i.useState)(!1),I=(0,i.useRef)(c),v=o.getCornerstoneViewport(e),{actor:y}=v.getActors()[0],f=y.getProperty().getScalarOpacity(0);(0,i.useEffect)(()=>{if(g)return;const e=f.getRange(),t=e[1]-e[0],n=t;r(-t),l(n),u(Math.pow(10,Math.floor(Math.log10(t/500))))},[o,e,y,f,g]);const h=(0,i.useCallback)(t=>{const o=t-I.current;I.current=t,v.shiftedBy=t,n.runCommand("shiftVolumeOpacityPoints",{viewportId:e,shift:o}),d(t)},[n,e,v]);return i.createElement("div",{className:"my-1 mt-2 flex flex-col space-y-2"},null!==m&&null!==a&&null!==s&&i.createElement("div",{className:"w-full pl-2 pr-1"},i.createElement(ut.ewR.Container,{mode:"singleRange",min:a,max:s,step:m,value:c,onChange:h,onMouseDown:()=>S(!0),onMouseUp:()=>S(!1)},i.createElement("div",{className:"flex flex-row items-center"},i.createElement(ut.ewR.Label,{className:"w-16"},"Shift"),i.createElement(ut.ewR.SingleRange,{sliderClassName:"mx-2 flex-grow"})))))}function Ro({viewportId:e,hasShade:t}){const{servicesManager:n,commandsManager:o}=(0,p.Jg)(),{cornerstoneViewportService:a}=n.services,[r,s]=(0,i.useState)({ambient:null,diffuse:null,specular:null}),l=(0,i.useCallback)((t,n)=>{o.runCommand("setVolumeLighting",{viewportId:e,options:{[t]:n}}),s(e=>({...e,[t]:n}))},[o,e]);(0,i.useEffect)(()=>{const t=a.getCornerstoneViewport(e),{actor:n}=t.getActors()[0],o=n.getProperty(),r={ambient:o.getAmbient(),diffuse:o.getDiffuse(),specular:o.getSpecular()};s(r)},[e,a]);const c=t?"":"ohif-disabled !opacity-40";return i.createElement("div",{className:"my-1 mt-2 flex flex-col space-y-2"},[{key:"ambient",label:"Ambient"},{key:"diffuse",label:"Diffuse"},{key:"specular",label:"Specular"}].map(({key:e,label:t})=>null!==r[e]&&i.createElement("div",{key:e,className:`w-full pl-2 pr-1 ${c}`},i.createElement(ut.ewR.Container,{mode:"singleRange",min:0,max:1,step:.1,value:r[e],onChange:t=>l(e,t)},i.createElement("div",{className:"flex flex-row items-center"},i.createElement(ut.ewR.Label,{className:"w-16"},t),i.createElement(ut.ewR.SingleRange,{sliderClassName:"mx-2 flex-grow"}))))))}function Uo({viewportId:e,onClickShade:t=e=>{}}){const{servicesManager:n,commandsManager:o}=(0,p.Jg)(),{cornerstoneViewportService:a}=n.services,[r,s]=(0,i.useState)(!0),[l,c]=(0,i.useState)(0),d=(0,i.useCallback)(t=>{o.runCommand("setVolumeLighting",{viewportId:e,options:{shade:t}})},[o,e]);return(0,i.useEffect)(()=>{const n=a.getCornerstoneViewport(e),{actor:o}=n.getActors()[0],r=o.getProperty().getShade();s(r),t(r),c(l+1)},[e,a]),i.createElement(i.Fragment,null,i.createElement("span",{className:"flex-grow"},"Shade"),i.createElement(ut.dOG,{className:"ml-2 flex-shrink-0",key:l,checked:r,onCheckedChange:()=>{s(!r),t(!r),d(!r)}}))}function Ao({viewportId:e}={}){const{volumeRenderingQualityRange:t}=(0,bo.e)(e),[n,o]=(0,i.useState)(!1);return i.createElement(ut.se.ItemPanel,null,i.createElement(Mo,{viewportId:e,volumeRenderingQualityRange:t}),i.createElement(Vo,{viewportId:e}),i.createElement("div",{className:"mt-2 flex h-8 !h-[20px] w-full flex-shrink-0 items-center justify-start px-2 text-base"},i.createElement("div",{className:"text-muted-foreground text-sm"},"Lighting")),i.createElement("div",{className:"bg-background mt-1 mb-1 h-px w-full"}),i.createElement("div",{className:"hover:bg-accent flex h-8 w-full flex-shrink-0 items-center px-2 text-base hover:rounded"},i.createElement(Uo,{viewportId:e,onClickShade:o})),i.createElement(Ro,{viewportId:e,hasShade:n}))}function xo({viewportId:e,element:t,align:n,side:o}){return i.createElement(Po,{viewportId:e,align:n,side:o})}function Po({viewportId:e,align:t,side:n}){const{t:o}=(0,gt.Bd)("WindowLevelActionMenu"),a=(0,i.useMemo)(()=>`${e}`,[e]),{is3DVolume:r,colorbarProperties:s,windowLevelPresets:l,volumeRenderingPresets:c,volumeRenderingQualityRange:d}=(0,bo.e)(e);return i.createElement(ut.se.Menu,{key:a,isVisible:!0,align:t,side:n,backLabel:Xn.A.t("WindowLevelActionMenu:Back to Display Options")},i.createElement(ut.se.ItemPanel,null,!r&&i.createElement(To,{viewportId:e}),s?.colormaps&&!r&&i.createElement(ut.se.SubMenu,{key:"colorLUTPresets",itemLabel:o("Color LUT"),itemIcon:"icon-color-lut",className:"flex h-[calc(100%-32px)] flex-col"},i.createElement(Do,{viewportId:e})),l?.length>0&&!r&&i.createElement(ut.se.SubMenu,{key:"windowLevelPresets",itemLabel:o("Modality Window Presets"),itemIcon:"viewport-window-level"},i.createElement(Co,{viewportId:e})),c&&r&&i.createElement(No,{viewportId:e}),d&&r&&i.createElement(ut.se.SubMenu,{itemLabel:o("Rendering Options")},i.createElement(Ao,{viewportId:e}))))}function Fo(){return Fo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Fo.apply(null,arguments)}function Lo(e){const{viewportId:t,element:n,location:o,isOpen:a=!1,onOpen:r,onClose:s,disabled:l,isEmbedded:c=!1,onInteraction:d,hasEmbeddedVariantToUse:m,...u}=e,[g]=(0,ut.ihW)(),S=t||g.activeViewportId,{viewportDisplaySets:I}=(0,po.N)(S),{servicesManager:v}=(0,p.Jg)(),{toolbarService:y}=v.services,{IconContainer:f,className:h,containerProps:w}=(0,ut.n1D)(),{hasColorbar:E,toggleColorbar:b}=(0,go.eH)(t),{align:D,side:T}=y.getAlignAndSide(o);if(0===I.map(e=>e.supportsWindowLevel).length)return null;const C=E&&!c&&m?i.createElement(ut.FI1.Close,{className:h}):i.createElement(ut.FI1.ViewportWindowLevel,{className:h});return i.createElement(ut.AMh,{open:a,onOpenChange:e=>{const t=E&&!c;if(a&&t&&e)return b(),void s?.();!a&&e&&t?b():e?r?.():s?.()}},i.createElement(ut.Wvm,{asChild:!0,className:"flex items-center justify-center"},i.createElement("div",null,f?i.createElement(f,Fo({disabled:l},u,w),C):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:l},C))),i.createElement(ut.hlN,{className:"border-none bg-transparent p-0 shadow-none",side:T,align:D,alignOffset:0,sideOffset:5},i.createElement(xo,{viewportId:S,element:n,align:D,side:T})))}const _o="minmax",ko="manual";const Go=function({viewportId:e,className:t}){const{servicesManager:n}=(0,p.Jg)(),{displaySetService:o}=n.services,[a,r]=(0,i.useState)(_o),{viewportDisplaySets:l}=(0,po.N)(e),[c,d]=(0,i.useState)(l.length>0?l[0].displaySetInstanceUID:void 0),{voiRange:m,setVOIRange:u,windowLevel:g,setWindowLevel:S}=(0,bo.e)(e,{displaySetInstanceUID:c});if((0,i.useEffect)(()=>{l.length>0&&!c&&d(l[0].displaySetInstanceUID)},[l,c]),!m)return null;const{upper:I,lower:v}=m,{windowWidth:y,windowCenter:f}=g,h=o.getDisplaySetByUID(c)?.imageIds;let w=1/0,E=-1/0;if(h)for(const e of h){const t=s.cache.getImage(e);t&&(w=Math.min(w,t.minPixelValue),E=Math.max(E,t.maxPixelValue))}w!==1/0&&E!==-1/0||(w=0,E=255);const b=l.find(e=>e.displaySetInstanceUID===c);return i.createElement("div",{className:t},i.createElement("div",{className:"bg-popover w-72 rounded-lg p-4 shadow-md"},i.createElement(ut.tUM,{defaultValue:a,onValueChange:r},i.createElement("div",{className:"mb-4 flex items-center space-x-2"},l.length>1&&i.createElement(ut.l6P,{value:c,onValueChange:d},i.createElement(ut.bqE,null,i.createElement(ut.yvm,null,b?.label||"Select Display Set")),i.createElement(ut.gCo,null,l.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID},`${e.SeriesDescription||""}`.trim())))),i.createElement(ut.j7C,{className:"w-full flex-1"},i.createElement(ut.Xib,{value:_o,className:"flex-1"},"Min/Max"),i.createElement(ut.Xib,{value:ko,className:"flex-1"},"Manual"))),i.createElement(ut.avX,{value:_o},i.createElement(ut.ewR.Container,{mode:"doubleRange",min:w,max:E,values:[v,I],step:1,className:"space-y-1",onChange:e=>{const[t,n]=e;t===v&&n===I||u({lower:t,upper:n})}},i.createElement(ut.ewR.DoubleRange,{showNumberInputs:!0}))),i.createElement(ut.avX,{value:ko},i.createElement("div",{className:"space-y-1"},i.createElement(ut.ewR.Container,{mode:"singleRange",min:0,max:E,step:1,value:y,className:"space-y-1",onChange:e=>{e!==y&&S({windowWidth:e,windowCenter:f})}},i.createElement("div",{className:"flex items-center space-x-2"},i.createElement(ut.ewR.Label,null,"W:"),i.createElement(ut.ewR.SingleRange,{showNumberInput:!0}))),i.createElement(ut.ewR.Container,{mode:"singleRange",min:w,max:E,step:1,value:f,className:"space-y-1",onChange:e=>{e!==f&&S({windowWidth:y,windowCenter:e})}},i.createElement("div",{className:"flex items-center space-x-2"},i.createElement(ut.ewR.Label,null,"L:"),i.createElement(ut.ewR.SingleRange,{showNumberInput:!0}))))))))};function zo(){return zo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},zo.apply(null,arguments)}function Bo(e){const{viewportId:t,location:n,isOpen:o=!1,onOpen:a,onClose:r,disabled:s,...l}=e,{IconContainer:c,className:d,containerProps:m}=(0,ut.n1D)(),{servicesManager:u}=(0,p.Jg)(),{toolbarService:g}=u.services,{align:S,side:I}=g.getAlignAndSide(n),v=i.createElement(ut.FI1.WindowLevelAdvanced,{className:d});return i.createElement(ut.AMh,{open:o,onOpenChange:e=>{e?a?.():r?.()}},i.createElement(ut.Wvm,{asChild:!0,className:"flex items-center justify-center"},i.createElement("div",null,c?i.createElement(c,zo({disabled:s,icon:"WindowLevelAdvanced"},l,m),v):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:s},v))),i.createElement(ut.hlN,{className:"border-none bg-transparent p-0 shadow-none",side:I,align:S,alignOffset:0,sideOffset:5},i.createElement(Go,{className:"w-full",viewportId:t})))}const $o=function({viewportId:e,className:t}){const{viewportDisplaySets:n,foregroundDisplaySets:o}=(0,po.N)(e),[a,r]=(0,i.useState)(o.length>0?o[0].displaySetInstanceUID:void 0),{threshold:s,setThreshold:l,pixelValueRange:c}=(0,go.eH)(e,{displaySetInstanceUID:a}),{min:d,max:m}=c,p=s??d;(0,i.useEffect)(()=>{o.length>0&&!a&&r(o[0].displaySetInstanceUID)},[o,a]);const u=n.find(e=>e.displaySetInstanceUID===a);return i.createElement("div",{className:t},i.createElement("div",{className:"bg-popover w-72 rounded-lg p-4 shadow-md"},i.createElement("div",{className:"mb-4 flex items-center justify-between"},i.createElement("div",{className:"flex items-center space-x-2"},i.createElement("span",{className:"text-muted-foreground text-base"},"Threshold"),n.length>1&&i.createElement("div",{className:"w-32"},i.createElement(ut.l6P,{value:a,onValueChange:r},i.createElement(ut.bqE,null,i.createElement(ut.yvm,null,u?.label||"Select Display Set")),i.createElement(ut.gCo,null,n.map(e=>i.createElement(ut.ebT,{key:e.displaySetInstanceUID,value:e.displaySetInstanceUID},i.createElement(uo,{displaySet:e}))))))),i.createElement(ut.$nd,{size:"sm",variant:"ghost",onClick:()=>l(d),className:"text-sm"},"Reset")),i.createElement(ut.ewR.Container,{mode:"singleRange",value:p,onChange:e=>{"number"==typeof e&&l(e)},min:d,max:m,step:.01},i.createElement(ut.ewR.SingleRange,null),i.createElement("div",{className:"mt-1 flex justify-between"},i.createElement("span",{className:"text-muted-foreground text-sm"},d.toFixed(0)),i.createElement("span",{className:"text-muted-foreground text-sm"},m.toFixed(0))))))};function jo(){return jo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},jo.apply(null,arguments)}function Wo(e){const{viewportId:t,location:n,isOpen:o=!1,onOpen:a,onClose:r,disabled:s,...l}=e,{IconContainer:c,className:d,containerProps:m}=(0,ut.n1D)(),{servicesManager:u}=(0,p.Jg)(),{toolbarService:g}=u.services,{align:S,side:I}=g.getAlignAndSide(n),v=i.createElement(ut.FI1.Threshold,{className:d});return i.createElement(ut.AMh,{open:o,onOpenChange:e=>{e?a?.():r?.()}},i.createElement(ut.Wvm,{asChild:!0,className:"flex items-center justify-center"},i.createElement("div",null,c?i.createElement(c,jo({disabled:s,icon:"Threshold"},l,m),v):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:s},v))),i.createElement(ut.hlN,{className:"border-none bg-transparent p-0 shadow-none",side:I,align:S,alignOffset:0,sideOffset:5},i.createElement($o,{className:"w-full",viewportId:t})))}const Ho=function({viewportId:e,className:t}){const{backgroundDisplaySet:n,foregroundDisplaySets:o}=(0,go.Ne)(e,{includeForeground:!0,includeBackground:!0}),{opacityLinear:a,setOpacityLinear:r}=(0,go.eH)(e,{displaySetInstanceUID:o[0].displaySetInstanceUID}),s=void 0!==a?a:0,l=n?.Modality||"",c=o[0]?.Modality||"";return i.createElement("div",{className:t},i.createElement("div",{className:"bg-popover w-72 rounded-lg p-3"},i.createElement("div",{className:"mb-2 flex items-center justify-center"},i.createElement("span",{className:"text-muted-foreground text-base"},"Opacity")),i.createElement("div",{className:""},i.createElement(ut.ewR.Container,{mode:"singleRange",value:s,onChange:e=>{"number"==typeof e&&r(e)},min:0,max:1,step:1e-4},i.createElement("div",{className:"flex items-center"},i.createElement("span",{className:"text-foreground mr-2 text-sm"},l),i.createElement(ut.ewR.SingleRange,{showNumberInput:!1}),i.createElement("span",{className:"text-foreground ml-2 text-sm"},c))))))};function qo(){return qo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},qo.apply(null,arguments)}function Yo(e){const{viewportId:t,location:n,isOpen:o=!1,onOpen:a,onClose:r,disabled:s,...l}=e,{IconContainer:c,className:d,containerProps:m}=(0,ut.n1D)(),{servicesManager:u}=(0,p.Jg)(),{toolbarService:g}=u.services,{align:S,side:I}=g.getAlignAndSide(n),v=i.createElement(ut.FI1.Opacity,{className:d});return i.createElement(ut.AMh,{open:o,onOpenChange:e=>{e?a?.():r?.()}},i.createElement(ut.Wvm,{asChild:!0,className:"flex items-center justify-center"},i.createElement("div",null,c?i.createElement(c,qo({disabled:s,icon:"Opacity"},l,m),v):i.createElement(ut.$nd,{variant:"ghost",size:"icon",disabled:s},v))),i.createElement(ut.hlN,{className:"border-none bg-transparent p-0 shadow-none",side:I,align:S,alignOffset:0,sideOffset:5},i.createElement(Ho,{className:"w-full",viewportId:t})))}var Jo=n(84535);const Ko=function({viewportId:e}){const{commandsManager:t}=(0,p.Jg)(),{t:n}=(0,gt.Bd)("Common"),o=n("LOAD"),{isTracked:a,isLocked:r}=(0,Jo.R)({viewportId:e}),{backgroundDisplaySet:s}=(0,po.N)(e),[l,c]=(0,i.useState)(null),d=(0,i.useMemo)(()=>[s].filter(Boolean),[s]);(0,i.useEffect)(()=>{const e=d.find(e=>e.isOverlayDisplaySet||"SR"===e?.Modality);c(e||null)},[d]);const m=(0,i.useMemo)(()=>{if(a&&!l)return{type:"SR",isHydrated:!0,isTracked:a,displaySet:null,tooltip:"Currently tracking measurements in this viewport"};if(!l)return{type:null};const e=l.Modality,t=l.isHydrated||!1;let n=null;const i=l.isRehydratable||!1;return"SEG"===e?n=t?"This Segmentation is loaded in the segmentation panel":"Click LOAD to load segmentation.":"RTSTRUCT"===e?n=t?"This RTSTRUCT is loaded in the segmentation panel":"Click LOAD to load RTSTRUCT.":"SR"===e&&(n=i?i&&r?"This structured report is currently read-only because you are tracking measurements in another viewport.":`Click ${o} to restore measurements.`:"This structured report is not compatible with this application."),{type:e,isHydrated:t,displaySet:l,isRehydratable:i,tooltip:n}},[l,o,r,a]);if(!m.type&&!a)return null;const u=()=>"SR"===m.type?m.isRehydratable&&!r?i.createElement(ut.FI1.ByName,{className:"text-muted-foreground h-4 w-4",name:"status-untracked"}):m.isRehydratable&&r?i.createElement(ut.FI1.ByName,{name:"status-locked",className:"h-4 w-4"}):i.createElement(ut.FI1.ByName,{name:"status-alert",className:"h-4 w-4"}):i.createElement(ut.FI1.StatusUntracked,{className:"h-4 w-4"}),g=()=>m.isHydrated?null:i.createElement("div",{"data-cy":`ModalityLoadBadge-${e}`,className:"flex h-6 cursor-default text-sm leading-6 text-[rgb(var(--text))]"},i.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},i.createElement(u,null),i.createElement("span",{className:"ml-1"},m.type)),"SR"!==m.type&&i.createElement(ut.N8H,{onInteraction:()=>{t.runCommand("hydrateSecondaryDisplaySet",{displaySet:m.displaySet,viewportId:e})}},o));return i.createElement(i.Fragment,null,m.tooltip&&i.createElement(ut.m_M,null,i.createElement(ut.k$k,{asChild:!0},i.createElement("span",null,i.createElement(g,null))),i.createElement(ut.ZIw,{side:"bottom"},i.createElement("div",null,m.tooltip))),!m.tooltip&&i.createElement(g,null))};function Qo(e,t,n){if(n<=0)return 0;let o=(e+t)%n;return o<0&&(o=n-1),o}const Zo=function({viewportId:e}){const{servicesManager:t}=(0,p.Jg)(),{segmentationService:n,cornerstoneViewportService:o,measurementService:a}=t.services,{isTracked:r,trackedMeasurementUIDs:s}=(0,Jo.R)({viewportId:e}),{viewportDisplaySets:l}=(0,po.N)(e),[c,d]=(0,i.useState)(0),m=l.some(e=>"SR"===e?.Modality),u=o.getCornerstoneViewport(e),{segmentationsWithRepresentations:g}=(0,go.Lt)({viewportId:e}),S=g.length>0?"segment":m||r?"measurement":null,I=(0,i.useCallback)(t=>{const n=l.find(e=>"SR"===e?.Modality);if(n){const e=n.measurements;if(e.length<=0)return;const o=Qo(c,t,e.length);d(o);const a=e[o];return void u.setViewReference({referencedImageId:a.imageId})}if(r&&s.length>0){const n=Qo(c,t,s.length);d(n),a.jumpToMeasurement(e,s[n])}},[e,u,c,a,r,s,l]),v=(0,i.useCallback)(t=>{if(!g.length)return;const o=g[0].segmentation.segmentationId;Gi.handleSegmentChange({direction:t,segmentationId:o,viewportId:e,selectedSegmentObjectIndex:0,segmentationService:n})},[g,e,n]),y=(0,i.useCallback)(e=>{"segment"===S?v(e):"measurement"===S&&I(e)},[S,v,I]);return S?i.createElement(ut.$IX,{onArrowsClick:y,className:"h-6"}):null};const Xo=function({viewportId:e}){const{isTracked:t}=(0,Jo.R)({viewportId:e});return t?i.createElement(i.Fragment,null,i.createElement(ut.m_M,null,i.createElement(ut.k$k,{asChild:!0},i.createElement("span",null,i.createElement(ut.FI1.StatusTracking,{className:"h-4 w-4"}))),i.createElement(ut.ZIw,{side:"bottom"},i.createElement("div",null,"Tracking")))):null},{ViewportColorbar:ea}=l.utilities.voi.colorbar,ta=e=>"top"===e||"bottom"===e,na=(0,i.memo)(function({viewportId:e,displaySetInstanceUID:t,colormaps:n,activeColormapName:o,volumeId:a,position:r,tickPosition:s,tickStyles:l,numColorbars:c}){const d=(0,i.useRef)(null),{servicesManager:m}=(0,p.Jg)(),{customizationService:u}=m.services,g=(0,p.bs)(e),{height:S,width:I}=(0,p.lR)(e),v=(0,i.useMemo)(()=>u.getCustomization("cornerstone.colorbar"),[u]),y=(0,i.useMemo)(()=>{let e=s;return e="left"===r||"right"===r?"left"===r?"right":"left":"top"===r?"bottom":"top",e},[r,s]),f=(0,i.useMemo)(()=>v?.positionTickStyles?.[r],[v,r]),h=(0,i.useMemo)(()=>v?.positionStyles?.[r]||{},[v,r]),w=(0,i.useMemo)(()=>({...v?.tickStyles||{},...f?.style||{},...l||{}}),[v,f,l]),E=(0,i.useMemo)(()=>`Colorbar-${e}-${t}`,[e,t]);return(0,i.useEffect)(()=>{if(!d.current||!n||!o)return;const e=g?.current;if(!e||!n?.length)return;const t=new ea({id:E,element:e,container:d.current,colormaps:n,activeColormapName:o,volumeId:a,ticks:{position:y,style:w}});return()=>{t&&t.destroy()}},[e,t,n,o,a,E,y,w,g]),S&&I?i.createElement("div",{id:`colorbar-container-${e}-${t}`,ref:d,style:{position:"relative",zIndex:1e3,boxSizing:"border-box",display:"flex",alignItems:"center",pointerEvents:"auto",minWidth:ta(r)?I/2.5:"17px",minHeight:ta(r)?"20px":1===c?S/3:S/4,height:"1px",...h}}):null}),oa=na,aa=(0,i.memo)(function({viewportId:e,location:t}){const[n,o]=(0,i.useState)([]),{servicesManager:a}=(0,p.Jg)(),{colorbarService:r,customizationService:s,displaySetService:l}=a.services,{viewportDisplaySets:c,backgroundDisplaySet:d,foregroundDisplaySets:m}=(0,po.N)(e),{colorbarPosition:u,opacity:g}=(0,bo.A)(e,{location:t}),S=(0,i.useMemo)(()=>s.getCustomization("cornerstone.colorbar"),[s]),I=(0,i.useMemo)(()=>{const e=S?.colorbarTickPosition;return S?.colorbarTickPosition||e},[S]);if((0,i.useEffect)(()=>{o(r.getViewportColorbar(e)||[])},[e,r]),(0,i.useEffect)(()=>{const{unsubscribe:t}=r.subscribe(r.EVENTS.STATE_CHANGED,t=>{t.viewportId===e&&o(r.getViewportColorbar(e)||[])});return()=>{t()}},[e,r]),!n.length)return null;const v=1===c.length||!ta(u)?n:n.filter(({displaySetInstanceUID:e})=>{const{displaySetInstanceUID:t}=l.getDisplaySetByUID(e)??{};return t===(0===g||null==g?d?.displaySetInstanceUID:m[0].displaySetInstanceUID)});return i.createElement("div",{style:{pointerEvents:"auto"}},i.createElement("div",{className:"flex h-full flex-col items-center justify-center",style:{pointerEvents:"auto"}},v.map(t=>{const{colorbar:o,displaySetInstanceUID:a}=t;return i.createElement(oa,{key:`colorbar-${e}-${a}`,viewportId:e,displaySetInstanceUID:a,colormaps:o.colormaps,activeColormapName:o.activeColormapName,volumeId:o.volumeId,position:u,tickPosition:I,tickStyles:S?.tickStyles,numColorbars:n.length})})))}),ra=aa;var ia=n(85490),sa=n(93813);function la(){return la=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},la.apply(null,arguments)}const ca={[sa.ij.TopMiddle]:{minX:0,minY:0,maxX:1,maxY:.1},[sa.ij.BottomMiddle]:{minX:0,minY:.9,maxX:1,maxY:1},[sa.ij.LeftMiddle]:{minX:0,minY:0,maxX:.1,maxY:1},[sa.ij.RightMiddle]:{minX:.9,minY:0,maxX:1,maxY:1}},da=e=>e===sa.ij.LeftMiddle||e===sa.ij.RightMiddle?"flex-col":"flex-row";const ma=function({viewportId:e,location:t,buttonSection:n}){const{onInteraction:o,toolbarButtons:a,isItemOpen:r,isItemLocked:s,openItem:l,closeItem:c,toggleLock:d}=(0,ia.tR)({buttonSection:n}),m=(0,ia.Yk)(e),[p,u]=(0,i.useState)(!1),[g,S]=(0,i.useState)(!0),I=(0,i.useRef)(!0),{hasColorbar:v}=(0,go.eH)(e),[y,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(I.current){I.current=!1;const e=setTimeout(()=>{S(!1)},3e3);return()=>clearTimeout(e)}},[]),(0,i.useEffect)(()=>{if(!g&&m.isInViewport){const e=ca[t];m.isWithinNormalizedBox(e)?u(!0):u(!1)}},[t,m,g]);const h=(0,i.useCallback)((e,t)=>{l(e,t),f(!0)},[l,f]),w=(0,i.useCallback)((e,t)=>{c(e,t),f(!1)},[c,f]);return a?.length&&v?i.createElement("div",{className:Ft()("flex gap-2",da(t))},a.map(n=>{if(!n)return null;const{id:a,Component:l,componentProps:c}=n,m={...c,isOpen:r(a,e),isLocked:s(a,e),onOpen:()=>h(a,e),onClose:()=>w(a,e),onToggleLock:()=>d(a,e),viewportId:e},u=i.createElement(l,la({key:a,id:a,location:t,onInteraction:t=>{o({...t,itemId:a,viewportId:e})}},m)),S=y||g||"Colorbar"===a||p;return i.createElement("div",{key:a,className:S?"opacity-100":"pointer-events-none opacity-0",style:{transition:"opacity 0.2s ease-in-out"}},u)})):null},pa=e=>({disabled:!0,disabledText:e??"Not available on the current viewport"});function ua({viewportId:e,toolbarService:t,button:n,disabledText:o,offModes:a,toolGroupService:r}){const i=r.getToolGroupForViewport(e);if(!i)return;const s=t.getToolNameForButton(n);if(!i?.hasTool(s))return pa(o);const l=a.includes(i.getToolOptions(s).mode);return{className:ut.WpD.getToggledClassName(!l)}}var ga;const Sa={VIEWPORT_ADDED:"event::cornerstone::toolgroupservice:viewportadded",TOOLGROUP_CREATED:"event::cornerstone::toolgroupservice:toolgroupcreated",TOOL_ACTIVATED:"event::cornerstone::toolgroupservice:toolactivated",PRIMARY_TOOL_ACTIVATED:"event::cornerstone::toolgroupservice:primarytoolactivated"};class Ia{constructor(e){this.servicesManager=void 0,this.cornerstoneViewportService=void 0,this.viewportGridService=void 0,this.uiNotificationService=void 0,this.toolGroupIds=new Set,this.listeners=void 0,this.EVENTS=void 0,this._onToolActivated=e=>{const{toolGroupId:t,toolName:n,toolBindingsOptions:o}=e.detail,a=o.bindings?.some(e=>e.mouseButton===l.Enums.MouseBindings.Primary),r={toolGroupId:t,toolName:n,toolBindingsOptions:o};this._broadcastEvent(Sa.TOOL_ACTIVATED,r),a&&this._broadcastEvent(Sa.PRIMARY_TOOL_ACTIVATED,r)};const{cornerstoneViewportService:t,viewportGridService:n,uiNotificationService:o}=e.services;this.cornerstoneViewportService=t,this.viewportGridService=n,this.uiNotificationService=o,this.listeners={},this.EVENTS=Sa,Object.assign(this,p.Ml),this._init()}onModeExit(){this.destroy()}_init(){s.eventTarget.addEventListener(l.Enums.Events.TOOL_ACTIVATED,this._onToolActivated)}getToolGroup(e){let t=e;if(!t){const e=E(this.viewportGridService);if(!e)return;const{renderingEngineId:n,viewportId:o}=e,a=l.ToolGroupManager.getToolGroupForViewport(o,n);if(!a)return void console.warn("No tool group found for viewportId:",o,"and renderingEngineId:",n);t=a.id}return l.ToolGroupManager.getToolGroup(t)}getToolGroupIds(){return Array.from(this.toolGroupIds)}getToolGroupForViewport(e){const t=this.cornerstoneViewportService.getRenderingEngine();return l.ToolGroupManager.getToolGroupForViewport(e,t.id)}getActiveToolForViewport(e){const t=this.getToolGroupForViewport(e);if(t)return t.getActivePrimaryMouseButtonTool()}destroy(){l.ToolGroupManager.destroy(),this.toolGroupIds=new Set,s.eventTarget.removeEventListener(l.Enums.Events.TOOL_ACTIVATED,this._onToolActivated)}destroyToolGroup(e){l.ToolGroupManager.destroyToolGroup(e),this.toolGroupIds.delete(e)}removeViewportFromToolGroup(e,t,n){const o=l.ToolGroupManager.getToolGroupForViewport(e,t);if(!o)return;o.removeViewports(t,e);0===o.getViewportIds().length&&n&&l.ToolGroupManager.destroyToolGroup(o.id)}addViewportToToolGroup(e,t,n){if(n){let o=l.ToolGroupManager.getToolGroup(n);o||(o=this.createToolGroup(n)),o.addViewport(e,t)}else{l.ToolGroupManager.getAllToolGroups().forEach(n=>{n.addViewport(e,t)})}this._broadcastEvent(Sa.VIEWPORT_ADDED,{viewportId:e,toolGroupId:n})}createToolGroup(e){if(this.getToolGroup(e))throw new Error(`ToolGroup ${e} already exists`);const t=l.ToolGroupManager.createToolGroup(e);return this.toolGroupIds.add(e),this._broadcastEvent(Sa.TOOLGROUP_CREATED,{toolGroupId:e}),t}addToolsToToolGroup(e,t,n={}){const o=l.ToolGroupManager.getToolGroup(e);this._addTools(o,t,n),this._setToolsMode(o,t)}createToolGroupAndAddTools(e,t){const n=this.createToolGroup(e);return this.addToolsToToolGroup(e,t),n}getToolConfiguration(e,t){const n=l.ToolGroupManager.getToolGroup(e);if(!n)return null;const o=n.getToolInstance(t);return o?o.configuration:null}setToolConfiguration(e,t,n){l.ToolGroupManager.getToolGroup(e).getToolInstance(t).configuration=n}getActivePrimaryMouseButtonTool(e){return this.getToolGroup(e)?.getActivePrimaryMouseButtonTool()}_setToolsMode(e,t){const{active:n,passive:o,enabled:a,disabled:r}=t;n&&n.forEach(({toolName:t,bindings:n})=>{e.setToolActive(t,{bindings:n})}),o&&o.forEach(({toolName:t})=>{e.setToolPassive(t)}),a&&a.forEach(({toolName:t})=>{e.setToolEnabled(t)}),r&&r.forEach(({toolName:t})=>{e.setToolDisabled(t)})}_addTools(e,t){const n=t=>{t.forEach(({toolName:t,parentTool:n,configuration:o})=>{n?e.addToolInstance(t,n,{...o}):e.addTool(t,{...o})})};t.active&&n(t.active),t.passive&&n(t.passive),t.enabled&&n(t.enabled),t.disabled&&n(t.disabled)}}ga=Ia,Ia.REGISTRATION={name:"toolGroupService",altName:"ToolGroupService",create:({servicesManager:e})=>new ga(e)};const va=Ia,{createSynchronizer:ya}=l.SynchronizerManager,{SEGMENTATION_REPRESENTATION_MODIFIED:fa}=l.Enums.Events,{BlendModes:ha}=s.Enums;function wa(e,{servicesManager:t,...n}){return ya(e,fa,(e,o,a,r)=>Ea(e,o,a,r,{servicesManager:t,options:n}),{eventSource:"eventTarget"})}const Ea=async(e,t,n,o,{servicesManager:a,options:r})=>{const i=o,{segmentationId:c}=i.detail,{segmentationService:d}=a.services,m=n.viewportId,{viewport:p}=(0,s.getEnabledElementByViewportId)(m);if(!p.getFrameOfReferenceUID())return;if(d.getSegmentationRepresentations(m,{segmentationId:c}).length>0)return;const u=p.type===s.Enums.ViewportType.VOLUME_3D?l.Enums.SegmentationRepresentations.Surface:l.Enums.SegmentationRepresentations.Labelmap;await d.addSegmentationRepresentation(m,{segmentationId:c,type:u,config:{blendMode:1===p.getBlendMode()?ha.LABELMAP_EDGE_PROJECTION_BLEND:void 0}})};var ba;const Da={TOOL_GROUP_CREATED:"event::cornerstone::syncgroupservice:toolgroupcreated"},Ta="cameraposition",Ca="voi",Oa="zoompan",Na="stackimage",Ma="imageslice",Va="hydrateseg";class Ra{constructor(e){this.servicesManager=void 0,this.listeners={},this.EVENTS=void 0,this.synchronizerCreators={[Ta]:l.synchronizers.createCameraPositionSynchronizer,[Ca]:l.synchronizers.createVOISynchronizer,[Oa]:l.synchronizers.createZoomPanSynchronizer,[Na]:l.synchronizers.createImageSliceSynchronizer,[Ma]:l.synchronizers.createImageSliceSynchronizer,[Va]:wa},this.synchronizersByType={},this.servicesManager=e,this.listeners={},this.EVENTS=Da,Object.assign(this,p.Ml)}_createSynchronizer(e,t,n){this.synchronizersByType[e]=this.synchronizersByType[e]||[];const o=this.synchronizerCreators[e.toLowerCase()];if(o){const a=o(t,{...n,servicesManager:this.servicesManager});if(a)return this.synchronizersByType[e].push(a),a}else console.debug(`Unknown synchronizer type: ${e}, id: ${t}`)}getSyncCreatorForType(e){return this.synchronizerCreators[e.toLowerCase()]}addSynchronizerType(e,t){this.synchronizerCreators[e.toLowerCase()]=t}getSynchronizer(e){return l.SynchronizerManager.getSynchronizer(e)}registerCustomSynchronizer(e,t){this.synchronizerCreators[e]=t}getSynchronizersOfType(e){return this.synchronizersByType[e]}_getOrCreateSynchronizer(e,t,n){let o=l.SynchronizerManager.getSynchronizer(t);return o||(o=this._createSynchronizer(e,t,n)),o}addViewportToSyncGroup(e,t,n){if(!n)return;(Array.isArray(n)?n:[n]).forEach(n=>{const o=(e=>"string"==typeof e?{type:e}:e)(n),{type:a,target:r=!0,source:i=!0,options:s={},id:l=a}=o,c=this._getOrCreateSynchronizer(a,l,s);if(!c)return;c.setOptions(e,s);const d={viewportId:e,renderingEngineId:t};r&&i?c.add(d):i?c.addSource(d):r&&c.addTarget(d)})}destroy(){l.SynchronizerManager.destroy()}getSynchronizersForViewport(e){const t=(0,s.getRenderingEngines)().find(t=>t.getViewports().find(t=>t.id===e))||(0,s.getRenderingEngines)()[0];return l.SynchronizerManager.getAllSynchronizers().filter(n=>n.hasSourceViewport(t.id,e)||n.hasTargetViewport(t.id,e))}removeViewportFromSyncGroup(e,t,n){const o=l.SynchronizerManager.getAllSynchronizers();(n?o.filter(e=>e.id===n):o).forEach(n=>{if(!n)return;this.isImageSliceSyncronizer(n)&&this.unRegisterSpatialRegistration(n),n.remove({viewportId:e,renderingEngineId:t});const o=n.getSourceViewports(),a=n.getTargetViewports();o.length||a.length||l.SynchronizerManager.destroySynchronizer(n.id)})}unRegisterSpatialRegistration(e){const t=e.getSourceViewports().map(e=>e.viewportId),n=e.getTargetViewports().map(e=>e.viewportId);t.map(e=>n.map(t=>[t,e])).reduce((e,t)=>e.concat(t),[]).forEach(e=>{s.utilities.spatialRegistrationMetadataProvider.add(e,void 0)})}isImageSliceSyncronizer(e){return this.getSynchronizerType(e).toLowerCase()===Ma}getSynchronizerType(e){return Object.keys(this.synchronizersByType).find(t=>this.getSynchronizersOfType(t).includes(e))}}ba=Ra,Ra.REGISTRATION={name:"syncGroupService",altName:"SyncGroupService",create:({servicesManager:e})=>new ba(e)};const Ua=Ra;var Aa=n(71851);const xa="cornerstoneStreamingImageVolume",Pa="cornerstoneStreamingDynamicImageVolume";var Fa;const{Labelmap:La,Contour:_a,Surface:ka}=l.Enums.SegmentationRepresentations,{getLabelmapImageIds:Ga,helpers:{convertStackToVolumeLabelmap:za},state:{addColorLUT:Ba,updateLabelmapSegmentationImageReferences:$a},triggerSegmentationEvents:{triggerSegmentationRepresentationModified:ja}}=l.segmentation,Wa={SEGMENTATION_MODIFIED:"event::segmentation_modified",SEGMENTATION_ADDED:"event::segmentation_added",SEGMENTATION_DATA_MODIFIED:"event::segmentation_data_modified",SEGMENTATION_REMOVED:"event::segmentation_removed",SEGMENTATION_REPRESENTATION_MODIFIED:"event::segmentation_representation_modified",SEGMENTATION_REPRESENTATION_REMOVED:"event::segmentation_representation_removed",SEGMENT_LOADING_COMPLETE:"event::segment_loading_complete",SEGMENTATION_LOADING_COMPLETE:"event::segmentation_loading_complete",ANNOTATION_CUT_MERGE_PROCESS_COMPLETED:"event::annotation_cut_merge_process_completed"};class Ha extends p.Rc{constructor({servicesManager:e}){super(Wa),this._segmentationIdToColorLUTIndexMap=void 0,this._segmentationGroupStatsMap=void 0,this.servicesManager=void 0,this.highlightIntervalId=null,this.EVENTS=Wa,this.destroy=()=>{s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_MODIFIED,this._onSegmentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REMOVED,this._onSegmentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_DATA_MODIFIED,this._onSegmentationDataModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_MODIFIED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_ADDED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_REMOVED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.removeEventListener(l.Enums.Events.SEGMENTATION_ADDED,this._onSegmentationAddedFromSource),this.reset()},this.getStyle=e=>l.segmentation.config.style.getStyle(e),this.setStyle=(e,t)=>{l.segmentation.config.style.setStyle(e,t)},this.resetToGlobalStyle=()=>{l.segmentation.config.style.resetToGlobalStyle()},this.toggleSegmentationRepresentationVisibility=(e,{segmentationId:t,type:n})=>{this._toggleSegmentationRepresentationVisibility(e,t,n)},this.getViewportIdsWithSegmentation=e=>l.segmentation.state.getViewportIdsWithSegmentation(e),this._toggleSegmentationRepresentationVisibility=(e,t,n)=>{const o=0===l.segmentation.config.visibility.getHiddenSegmentIndices(e,{segmentationId:t,type:n}).size;this._setSegmentationRepresentationVisibility(e,t,n,!o)},this._onSegmentationDataModifiedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_DATA_MODIFIED,{segmentationId:t})},this._onSegmentationRepresentationModifiedFromSource=e=>{const{segmentationId:t,viewportId:n}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,{segmentationId:t,viewportId:n})},this._onSegmentationModifiedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_MODIFIED,{segmentationId:t})},this._onSegmentationAddedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.SEGMENTATION_ADDED,{segmentationId:t})},this._onAnnotationCutMergeProcessCompletedFromSource=e=>{const{segmentationId:t}=e.detail;this._broadcastEvent(this.EVENTS.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{segmentationId:t})},this._segmentationIdToColorLUTIndexMap=new Map,this.servicesManager=e,this._segmentationGroupStatsMap=new Map}onModeEnter(){this._initSegmentationService()}onModeExit(){this.destroy()}getSegmentation(e){return l.segmentation.state.getSegmentation(e)}getSegmentations(){return l.segmentation.state.getSegmentations()}getPresentation(e){const t=[],n=new Map,o=this.getSegmentationRepresentations(e);for(const e of o){if(!e)continue;const{segmentationId:t,type:o}=e;n.set(t,{segmentationId:t,type:o,hydrated:!0,config:e.config||{}})}return t.push(...n.values()),t}getRepresentationsForSegmentation(e){return l.segmentation.state.getSegmentationRepresentationsBySegmentationId(e)}getSegmentationRepresentations(e,t={}){return l.segmentation.state.getSegmentationRepresentations(e,t).map(t=>this._toOHIFSegmentationRepresentation(e,t))}async addSegmentationRepresentation(e,{segmentationId:t,type:n,config:o,suppressEvents:a=!1}){const r=this.getSegmentation(t),i=this.getAndValidateViewport(e);if(!i)return;const s=this._segmentationIdToColorLUTIndexMap.get(t);let l=!1;const c=i.type===Aa.ViewportType.VOLUME_3D?ka:La;let d=n||c;if(d===La){const{isVolumeViewport:n,isVolumeSegmentation:o}=this.determineViewportAndSegmentationType(i,r)||{isVolumeViewport:!1,isVolumeSegmentation:!1};({representationTypeToUse:d,isConverted:l}=await this.handleViewportConversion(n,o,i,r,e,t,d))}await this._addSegmentationRepresentation(e,t,d,s,l,o),a||this._broadcastEvent(this.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,{segmentationId:t})}async createLabelmapForDisplaySet(e,t){return this._createSegmentationForDisplaySet(e,La,t)}async createContourForDisplaySet(e,t){return this._createSegmentationForDisplaySet(e,_a,t)}async _createSegmentationForDisplaySet(e,t,n){const o=n?.segmentationId??`${s.utilities.uuidv4()}`,a=e.isDynamicVolume;let r=e.imageIds;if(a){const t=e.dynamicVolumeInfo.timePoints;r=t[Math.floor(t.length/2)]}const i=await s.imageLoader.createAndCacheDerivedLabelmapImages(r),l=this.getSegmentations(),c=n?.label||`Segmentation ${l.length+1}`,d={segmentationId:o,representation:{type:t,data:{imageIds:i.map(e=>e.imageId),referencedImageIds:r}},config:{label:c,segments:n?.segments&&Object.keys(n.segments).length>0?n.segments:{1:{label:`${kn.A.t("Segment")} 1`,active:!0}},cachedStats:{info:`S${e.SeriesNumber}: ${e.SeriesDescription}`}}};return this.addOrUpdateSegmentation(d),o}async createSegmentationForSEGDisplaySet(e,t={type:La}){const{type:n}=t;let{segmentationId:o}=t;const{labelMapImages:a}=e;if(n!==La)throw new Error("Only labelmap type is supported for SEG display sets right now");if(!a||!a.length)throw new Error("SEG reading failed");o=o??e.displaySetInstanceUID;const r=e.referencedDisplaySetInstanceUID,i=this.servicesManager.services.displaySetService.getDisplaySetByUID(r).instances;if(!i.length)throw new Error("No instances were provided for the referenced display set of the SEG");const l=i.map(e=>e.imageId),c=a?.flat(),d=c.map(e=>e.imageId);e.images=c.map(e=>({...e,...s.metaData.get("instance",e.referencedImageId)})),e.imageIds=d;let m=null;for(let e=0;e<c.length;e++){const t=c[e].voxelManager,n=t.getScalarData();t.setScalarData(n),!m&&n.some(e=>0!==e)&&(m=c[e].referencedImageId)}e.firstSegmentedSliceImageId=m;const p=e.segMetadata.data,u={},g=[];p.forEach((t,n)=>{if(0===n)return void g.push([0,0,0,0]);const{SegmentedPropertyCategoryCodeSequence:o,SegmentNumber:a,SegmentLabel:r,SegmentAlgorithmType:i,SegmentAlgorithmName:s,SegmentedPropertyTypeCodeSequence:l,rgba:c}=t;g.push(c);const d=Number(a),m=e.centroids?.get(n),p=m?.image||{x:0,y:0,z:0},S=m?.world||{x:0,y:0,z:0};u[d]={segmentIndex:d,label:r||`Segment ${a}`,locked:!1,active:!1,cachedStats:{center:{image:[p.x,p.y,p.z],world:[S.x,S.y,S.z]},modifiedTime:e.SeriesDate,category:o?o.CodeMeaning:"",type:l?l.CodeMeaning:"",algorithmType:i,algorithmName:s}}});const S=Ba(g);this._segmentationIdToColorLUTIndexMap.set(o,S),this._broadcastEvent(Wa.SEGMENTATION_LOADING_COMPLETE,{segmentationId:o,segDisplaySet:e});const I={segmentationId:o,representation:{type:La,data:{imageIds:d,referencedImageIds:l}},config:{label:e.SeriesDescription,segments:u}};return e.isLoaded=!0,this.addOrUpdateSegmentation(I),o}async createSegmentationForRTDisplaySet(e,t={type:_a}){const{type:n}=t;let{segmentationId:o}=t;if(n!==_a)throw new Error("Only contour type is supported for RT display sets right now");o=o??e.displaySetInstanceUID;const{structureSet:a}=e;if(!a)throw new Error("To create the contours from RT displaySet, the displaySet should be loaded first. You can perform rtDisplaySet.load() before calling this method.");const r=e.displaySetInstanceUID,i=this.servicesManager.services.displaySetService.getDisplaySetByUID(e.referencedDisplaySetInstanceUID),l=Array.from(a.ReferencedSOPInstanceUIDsSet),c=i.imageIds,d=c?.find(e=>l.some(t=>e.includes(t)))||null;if(e.firstSegmentedSliceImageId=d,!a.ROIContours?.length)throw new Error("The structureSet does not contain any ROIContours. Please ensure the structureSet is loaded first.");const m=function(e,t){return e.ROIContours.map(({contourPoints:e,ROINumber:n,ROIName:o,colorArray:a,ROIGroup:r})=>{const i=o||n;return{data:e.map(({points:e,...t})=>({...t,points:e.map(({x:e,y:t,z:n})=>[e,t,n])})),id:i,segmentIndex:n,color:a,group:r,geometryId:`${t}:${i}:segmentIndex-${n}`}})}(a,r);m.sort((e,t)=>e.segmentIndex-t.segmentIndex);const p=m.map(({geometryId:e})=>e),u={segmentationId:o,representation:{type:_a,data:{geometryIds:p}},config:{label:e.SeriesDescription}},g={};let S={};const I=[[0,0,0,0]];for(let t=0;t<m.length;t++){const n=m[t],{data:o,id:r,color:i,segmentIndex:l,geometryId:c,group:d}=n;I.push(i);try{const t=(await s.geometryLoader.createAndCacheGeometry(c,{geometryData:{data:o,id:r,color:i,frameOfReferenceUID:a.frameOfReferenceUID,segmentIndex:l},type:s.Enums.GeometryType.CONTOUR})).data;S={center:{world:t.centroid},modifiedTime:e.SeriesDate},g[l]={label:r,segmentIndex:l,cachedStats:S,locked:!1,active:!1,group:d};const n=Object.keys(S).length,p=Math.round(n/m.length*100);this._broadcastEvent(Wa.SEGMENT_LOADING_COMPLETE,{percentComplete:p,numSegments:m.length})}catch(e){console.warn(`Error initializing contour for segment ${l}:`,e);continue}}const v=Ba(I);return this._segmentationIdToColorLUTIndexMap.set(o,v),u.config.segments=g,this._broadcastEvent(Wa.SEGMENTATION_LOADING_COMPLETE,{segmentationId:o,rtDisplaySet:e}),e.isLoaded=!0,this.addOrUpdateSegmentation(u),o}addOrUpdateSegmentation(e){const t=e.segmentationId;l.segmentation.state.getSegmentation(t)?this.updateSegmentationInSource(t,e):this.addSegmentationToSource(e)}setActiveSegmentation(e,t){l.segmentation.activeSegmentation.setActiveSegmentation(e,t)}getActiveSegmentation(e){return l.segmentation.activeSegmentation.getActiveSegmentation(e)}getActiveSegment(e){const t=this.getActiveSegmentation(e);if(!t)return;const{segments:n}=t;let o;for(const e of Object.values(n))if(e.active){o=e;break}return o}hasCustomStyles(e){return l.segmentation.config.style.hasCustomStyle(e)}getNextAvailableSegmentIndex(e){const t=this.getCornerstoneSegmentation(e),n=Object.keys(t.segments);return 0===n.length?1:Math.max(...n.map(Number))+1}addSegment(e,t={}){if(0===t?.segmentIndex)throw new Error(kn.A.t("Segment")+' index 0 is reserved for "no label"');const n=this.getCornerstoneSegmentation(e);let o=t.segmentIndex;o||(o=this.getNextAvailableSegmentIndex(e)),t.label||(t.label=`${kn.A.t("Segment")} ${o}`);const a=n.segments;l.segmentation.updateSegmentations([{segmentationId:e,payload:{segments:{...a,[o]:{...a[o],segmentIndex:o,cachedStats:{},locked:!1,...t}}}}]),this.setActiveSegment(e,o),void 0!==t.isLocked&&this._setSegmentLockedStatus(e,o,t.isLocked);this.getViewportIdsWithSegmentation(e).forEach(n=>{void 0!==t.color&&this.setSegmentColor(n,e,o,t.color),void 0!==t.visibility&&this.setSegmentVisibility(n,e,o,t.visibility)})}removeSegment(e,t){l.segmentation.removeSegment(e,t)}setSegmentVisibility(e,t,n,o,a){this._setSegmentVisibility(e,t,n,o,a)}setSegmentLocked(e,t,n){this._setSegmentLockedStatus(e,t,n)}toggleSegmentLocked(e,t){const n=l.segmentation.segmentLocking.isSegmentIndexLocked(e,t);this._setSegmentLockedStatus(e,t,!n)}toggleSegmentVisibility(e,t,n,o){const a=l.segmentation.config.visibility.getSegmentIndexVisibility(e,{segmentationId:t,type:o},n);this._setSegmentVisibility(e,t,n,!a,o)}setSegmentColor(e,t,n,o){const a=this.getSegmentationRepresentations(e,{segmentationId:t}),{colorLUTIndex:r}=a[0];this._segmentationIdToColorLUTIndexMap.set(t,r),l.segmentation.config.color.setSegmentIndexColor(e,t,n,o)}getSegmentColor(e,t,n){return l.segmentation.config.color.getSegmentIndexColor(e,t,n)}getLabelmapVolume(e){const t=l.segmentation.state.getSegmentation(e).representationData[La];if(!t||!t.volumeId)return null;const{volumeId:n}=t;return s.cache.getVolume(n)}setSegmentLabel(e,t,n){this._setSegmentLabel(e,t,n)}setActiveSegment(e,t){this._setActiveSegment(e,t)}setRenderInactiveSegmentations(e,t){l.segmentation.config.style.setRenderInactiveSegmentations(e,t)}getRenderInactiveSegmentations(e){return l.segmentation.config.style.getRenderInactiveSegmentations(e)}setSegmentationGroupStats(e,t){const n=this.getGroupId(e);this._segmentationGroupStatsMap.set(n,t)}getSegmentationGroupStats(e){const t=this.getGroupId(e);return this._segmentationGroupStatsMap.get(t)}getGroupId(e){return e.sort().join(",")}clearSegmentationRepresentations(e){this.removeSegmentationRepresentations(e)}remove(e){l.segmentation.state.removeSegmentation(e)}removeAllSegmentations(){l.segmentation.state.removeAllSegmentations()}removeSegmentationRepresentations(e,t={}){l.segmentation.removeSegmentationRepresentations(e,t)}jumpToSegmentCenter(e,t,n,o=.9,a=!0,r=750,i=!1,l=Ln.EASE_IN_OUT){const c=this._getSegmentCenter(e,t);if(!c)return void console.warn("No center found for segmentation",e,t);const{world:d}=c;(n?[n]:this.getViewportIdsWithSegmentation(e)).forEach(n=>{const{viewport:c}=(0,s.getEnabledElementByViewportId)(n);c.jumpToWorld(d),a&&this.highlightSegment(e,t,n,o,r,i,l)})}highlightSegment(e,t,n,o=.9,a=750,r=!0,i=Ln.EASE_IN_OUT){this.highlightIntervalId&&clearInterval(this.highlightIntervalId);const s=this.getCornerstoneSegmentation(e);(n?[n]:this.getViewportIdsWithSegmentation(e)).forEach(n=>{const l=this.getSegmentationRepresentations(n,{segmentationId:e})[0],{type:c}=l,d=s.segments;(c===La?this._highlightLabelmap.bind(this):this._highlightContour.bind(this))(t,c===La?o:1-o,r,d,n,a,l,i)})}getAndValidateViewport(e){const t=this.servicesManager.services.cornerstoneViewportService.getCornerstoneViewport(e);return t||(console.warn(`Viewport with id ${e} not found.`),null)}_setSegmentationRepresentationVisibility(e,t,n,o){this.getSegmentationRepresentations(e,{segmentationId:t,type:n})[0]?l.segmentation.config.visibility.setSegmentationRepresentationVisibility(e,{segmentationId:t,type:n},o):console.debug("No segmentation representation found for the given viewportId and segmentationId")}determineViewportAndSegmentationType(e,t){return{isVolumeViewport:e.type===Aa.ViewportType.ORTHOGRAPHIC||e.type===Aa.ViewportType.VOLUME_3D,isVolumeSegmentation:"volumeId"in t.representationData[La]}}async handleViewportConversion(e,t,n,o,a,r,i){let s=i,l=!1;const c=e?this.handleVolumeViewportCase:this.handleStackViewportCase;return({representationTypeToUse:s,isConverted:l}=await c.apply(this,[n,o,t,a,r])),{representationTypeToUse:s,isConverted:l}}async handleVolumeViewportCase(e,t,n){return e.type===Aa.ViewportType.VOLUME_3D?{representationTypeToUse:ka,isConverted:!1}:(await this.handleVolumeViewport(e,t,n),{representationTypeToUse:La,isConverted:!1})}async handleStackViewportCase(e,t,n,o,a){if(n){const t=await this.convertStackToVolumeViewport(e);return{representationTypeToUse:La,isConverted:t}}if($a(o,a))return{representationTypeToUse:La,isConverted:!1};const r=await this.attemptStackToVolumeConversion(e,t,o,a);return{representationTypeToUse:La,isConverted:r}}async _addSegmentationRepresentation(e,t,n,o,a,r){const i={type:n,segmentationId:t,config:{colorLUTOrIndex:o,...r}},s=()=>l.segmentation.addSegmentationRepresentations(e,[i]);if(a){const{viewportGridService:e}=this.servicesManager.services;await new Promise(t=>{const{unsubscribe:n}=e.subscribe(e.EVENTS.GRID_STATE_CHANGED,()=>{s(),n(),t()})})}else s()}async handleVolumeViewport(e,t,n){if(n)return;const o=e.getFrameOfReferenceUID(),a=Ga(t.segmentationId),r=s.cache.getImage(a[0]);r?.FrameOfReferenceUID===o&&await za(t)}async convertStackToVolumeViewport(e){const{viewportGridService:t,cornerstoneViewportService:n}=this.servicesManager.services,o=t.getState().viewports.get(e.id),a=e.getViewPresentation(),r=e.getViewReference(),i=n.getCornerstoneViewport(e.id),{element:l}=i,c=()=>{const t=n.getCornerstoneViewport(e.id);t.setViewPresentation(a),t.setViewReference(r),t.render(),l.removeEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,c)};return l.addEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,c),t.setDisplaySetsForViewport({viewportId:e.id,displaySetInstanceUIDs:o.displaySetInstanceUIDs,viewportOptions:{...o.viewportOptions,viewportType:Aa.ViewportType.ORTHOGRAPHIC}}),!0}async attemptStackToVolumeConversion(e,t,n,o){const a=Ga(t.segmentationId),r=e.getFrameOfReferenceUID(),i=s.cache.getImage(a[0]);if(i?.FrameOfReferenceUID&&r&&i.FrameOfReferenceUID===r){const t=await this.convertStackToVolumeViewport(e);return ja(n,o,La),t}}addSegmentationToSource(e){l.segmentation.addSegmentations([e])}updateSegmentationInSource(e,t){l.segmentation.updateSegmentations([{segmentationId:e,payload:t}])}_toOHIFSegmentationRepresentation(e,t){const{segmentationId:n,type:o,active:a,visible:r}=t,{colorLUTIndex:i}=t,s={},c=l.segmentation.state.getSegmentation(n);if(!c)throw new Error(`Segmentation with ID ${n} not found.`);const d=Object.keys(c.segments);for(const t of d){const a=parseInt(t,10),r=l.segmentation.config.color.getSegmentIndexColor(e,n,a),i=l.segmentation.config.visibility.getSegmentIndexVisibility(e,{segmentationId:n,type:o},a);s[a]={color:r,segmentIndex:a,opacity:r[3],visible:i}}const m=l.segmentation.config.style.getStyle({viewportId:e,segmentationId:n,type:o});return{id:`${n}-${o}-${e}`,segmentationId:n,label:c.label,active:a,type:o,visible:r,segments:s,styles:m,viewportId:e,colorLUTIndex:i,config:{}}}_initSegmentationService(){s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_MODIFIED,this._onSegmentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REMOVED,this._onSegmentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_DATA_MODIFIED,this._onSegmentationDataModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_MODIFIED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_ADDED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_REPRESENTATION_REMOVED,this._onSegmentationRepresentationModifiedFromSource),s.eventTarget.addEventListener(l.Enums.Events.SEGMENTATION_ADDED,this._onSegmentationAddedFromSource),s.eventTarget.addEventListener(l.Enums.Events.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,this._onAnnotationCutMergeProcessCompletedFromSource)}getCornerstoneSegmentation(e){return l.segmentation.state.getSegmentation(e)}_highlightLabelmap(e,t,n,o,a,r,i,s){const{segmentationId:c}=i;if(n)throw new Error("hideOthers is not working right now");const{fillAlpha:d}=this.getStyle({viewportId:a,segmentationId:c,type:La,segmentIndex:e});let m=null;const p=t=>{null===m&&(m=t);const n=t-m,o=Math.min(n/r,1),a=_n.get(s);l.segmentation.config.style.setStyle({segmentationId:c,segmentIndex:e,type:La},{fillAlpha:a(o,d)}),o<1?requestAnimationFrame(p):l.segmentation.config.style.setStyle({segmentationId:c,segmentIndex:e,type:La},{})};requestAnimationFrame(p)}_highlightContour(e,t,n,o,a,r,i,s){const{segmentationId:c}=i,d=performance.now(),m=l.segmentation.config.style.getStyle({type:_a}).outlineWidth,p=t=>{const n=(t-d)/r;if(n>=1)return void l.segmentation.config.style.resetToGlobalStyle();const o=_n.get(s);l.segmentation.config.style.setStyle({segmentationId:c,segmentIndex:e,type:_a},{outlineWidth:o(n,m,5)}),requestAnimationFrame(p)};requestAnimationFrame(p)}_setActiveSegment(e,t){l.segmentation.segmentIndex.setActiveSegmentIndex(e,t)}_getVolumeIdForDisplaySet(e){return`${e.volumeLoaderSchema??xa}:${e.displaySetInstanceUID}`}_getSegmentCenter(e,t){const n=this.getSegmentation(e);if(!n)return;const{segments:o}=n,{cachedStats:a}=o[t];if(a?.center){const{center:e}=a;return e}return a?.namedStats?.center?{world:a.namedStats.center.value}:void 0}_setSegmentLockedStatus(e,t,n){l.segmentation.segmentLocking.setSegmentIndexLocked(e,t,n)}_setSegmentVisibility(e,t,n,o,a){l.segmentation.config.visibility.setSegmentIndexVisibility(e,{segmentationId:t,type:a},n,o)}_setSegmentLabel(e,t,n){const o=this.getCornerstoneSegmentation(e),{segments:a}=o;a[t].label=n,l.segmentation.updateSegmentations([{segmentationId:e,payload:{segments:a}}])}}Fa=Ha,Ha.REGISTRATION={name:"segmentationService",altName:"SegmentationService",create:({servicesManager:e})=>new Fa({servicesManager:e})};const qa=Ha;function Ya(e,t){const n=t?.[0]?.viewportType?.toLowerCase()||e.toLowerCase();if("stack"===n)return s.Enums.ViewportType.STACK;if("video"===n)return s.Enums.ViewportType.VIDEO;if("wholeslide"===n)return s.Enums.ViewportType.WHOLE_SLIDE;if("volume"===n||"orthographic"===n)return s.Enums.ViewportType.ORTHOGRAPHIC;if("volume3d"===n)return s.Enums.ViewportType.VOLUME_3D;throw new Error(`Invalid viewport type: ${e}. Valid types are: stack, volume, video, wholeslide`)}var Ja;class Ka{constructor(e){this.stackImageIds=new Map,this.volumeImageIds=new Map,this.servicesManager=void 0,this.servicesManager=e}getCacheSize(){return s.cache.getCacheSize()}getCacheFreeSpace(){return s.cache.getBytesAvailable()}async createViewportData(e,t,n,o){const a=Ya(t.viewportType,e);let r;return r=a===s.Enums.ViewportType.ORTHOGRAPHIC||a===s.Enums.ViewportType.VOLUME_3D?await this._getVolumeViewportData(n,e,a):a===s.Enums.ViewportType.STACK?await this._getStackViewportData(n,e,o,a):await this._getOtherViewportData(n,e,o,a),r.viewportType=a,r}async invalidateViewportData(e,t,n,o){if(e.viewportType===s.Enums.ViewportType.STACK){const e=o.getDisplaySetByUID(t),a=this._getCornerstoneStackImageIds(e,n);return a.forEach(e=>{s.cache.getImageLoadObject(e)&&s.cache.removeImageLoadObject(e)}),{viewportType:s.Enums.ViewportType.STACK,data:{StudyInstanceUID:e.StudyInstanceUID,displaySetInstanceUID:t,imageIds:a}}}const a=`${xa}:${t}`,r=s.cache.getVolume(a);r&&(r.imageIds&&r.imageIds.forEach(e=>{s.cache.getImageLoadObject(e)&&s.cache.removeImageLoadObject(e,{force:!0})}),s.cache._volumeCache.delete(a),this.volumeImageIds.delete(a));const i=e.data.map(({displaySetInstanceUID:e})=>o.getDisplaySetByUID(e));return await this._getVolumeViewportData(n,i,e.viewportType)}async _getOtherViewportData(e,t,n,o){const[a]=t;a.imageIds||(a.imagesIds=this._getCornerstoneStackImageIds(a,e));const{imageIds:r,viewportType:i}=a;return{viewportType:i||o,data:t}}async _getStackViewportData(e,t,n,o){const{uiNotificationService:a}=this.servicesManager.services,r=t.filter(e=>e.isOverlayDisplaySet);for(const e of r)if(e.load&&e.load instanceof Function){const{userAuthenticationService:t}=this.servicesManager.services,n=t.getAuthorizationHeader();try{await e.load({headers:n})}catch(e){a.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}}const i=[];for(const o of t){const{displaySetInstanceUID:t,StudyInstanceUID:r,isCompositeStack:s}=o;if(o.load&&o.load instanceof Function){const{userAuthenticationService:e}=this.servicesManager.services,t=e.getAuthorizationHeader();try{await o.load({headers:t})}catch(e){a.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}}let l=this.stackImageIds.get(o.displaySetInstanceUID);l||(l=this._getCornerstoneStackImageIds(o,e),o.imageIds=l,this.stackImageIds.set(o.displaySetInstanceUID,l)),i.push({StudyInstanceUID:r,displaySetInstanceUID:t,isCompositeStack:s,imageIds:l,initialImageIndex:n})}return{viewportType:o,data:i}}async _getVolumeViewportData(e,t,n){const o=[];for(const n of t){const{Modality:t}=n,a="PMAP"===t,r="SEG"===t;if(n.load&&n.load instanceof Function){const{userAuthenticationService:e}=this.servicesManager.services,t=e.getAuthorizationHeader();try{await n.load({headers:t})}catch(e){const{uiNotificationService:t}=this.servicesManager.services;t.show({title:"Error loading displaySet",message:e.message,type:"error"}),console.error(e)}if(!a){o.push({studyInstanceUID:n.StudyInstanceUID,displaySetInstanceUID:n.displaySetInstanceUID});continue}}const i=`${n.volumeLoaderSchema??xa}:${n.displaySetInstanceUID}`;let l=this.volumeImageIds.get(n.displaySetInstanceUID),c=s.cache.getVolume(i);a||r||l&&c||(l=this._getCornerstoneVolumeImageIds(n,e),c=await s.volumeLoader.createAndCacheVolume(i,{imageIds:l}),this.volumeImageIds.set(n.displaySetInstanceUID,l),n.imageIds=l),o.push({StudyInstanceUID:n.StudyInstanceUID,displaySetInstanceUID:n.displaySetInstanceUID,volume:c,volumeId:i,imageIds:l,isDynamicVolume:n.isDynamicVolume})}return{viewportType:n,data:o}}_getCornerstoneStackImageIds(e,t){return t.getImageIdsForDisplaySet(e)}_getCornerstoneVolumeImageIds(e,t){if(e.imageIds)return e.imageIds;return this._getCornerstoneStackImageIds(e,t)}}Ja=Ka,Ka.REGISTRATION={name:"cornerstoneCacheService",altName:"CornerstoneCacheService",create:({servicesManager:e})=>new Ja(e)};const Qa=Ka,Za="OHIFCornerstoneRenderingEngine";const Xa="default",er=({data:e,displaySetUID:t,imageId:n,viewport:o})=>{if(n&&e.isCompositeStack&&e.imageIds)return!!e.imageIds.find(e=>e===n);if(n&&(e.volumeId||o instanceof s.VolumeViewport)){if(!!!o.getCurrentImageId())return!1;const e=s.utilities.imageIdToURI(n);if(o.hasImageURI(e))return!0}return e.displaySetInstanceUID===t};const tr=class{constructor(e){this.viewportId="",this.element=void 0,this.viewportOptions=void 0,this.displaySetOptions=void 0,this.viewportData=void 0,this.renderingEngineId=void 0,this.viewReference=void 0,this.destroy=()=>{this.element=null,this.viewportData=null,this.viewportOptions=null,this.displaySetOptions=null},this.viewportId=e,this.setPublicViewportOptions({}),this.setPublicDisplaySetOptions([{}])}contains(e,t){if(!this.viewportData?.data)return!1;const{viewport:n}=(0,s.getEnabledElementByViewportId)(this.viewportId)||{};return this.viewportData.data.length?!!this.viewportData.data.find(o=>er({data:o,displaySetUID:e,imageId:t,viewport:n})):er({data:this.viewportData.data,displaySetUID:e,imageId:t,viewport:n})}setRenderingEngineId(e){this.renderingEngineId=e}getRenderingEngineId(){return this.renderingEngineId}setViewportId(e){this.viewportId=e}setElement(e){this.element=e}setViewportData(e){this.viewportData=e}getViewportData(){return this.viewportData}getElement(){return this.element}getViewportId(){return this.viewportId}getViewReference(){return this.viewportOptions?.viewReference}setPublicDisplaySetOptions(e){const t=this.mapDisplaySetOptions(e);return this.setDisplaySetOptions(t),this.displaySetOptions}hasDisplaySet(e){let t=this.getViewportData();return t.viewportType===s.Enums.ViewportType.ORTHOGRAPHIC||t.viewportType===s.Enums.ViewportType.VOLUME_3D?t.data.some(({displaySetInstanceUID:t})=>t===e):t.data.displaySetInstanceUID===e}setPublicViewportOptions(e,t){const n=t||e.viewportType||"stack",{presentationIds:o}=e;let{toolGroupId:a=Xa}=e;const r=function(e){if(e)switch(e.toLowerCase()){case"axial":return s.Enums.OrientationAxis.AXIAL;case"sagittal":return s.Enums.OrientationAxis.SAGITTAL;case"coronal":return s.Enums.OrientationAxis.CORONAL;default:return s.Enums.OrientationAxis.ACQUISITION}return s.Enums.OrientationAxis.ACQUISITION}(e.orientation),i=Ya(n);return a||(a=Xa),this.setViewportOptions({...e,viewportId:this.viewportId,viewportType:i,orientation:r,toolGroupId:a,presentationIds:o}),this.viewportOptions}setViewportOptions(e){this.viewportOptions=e}getViewportOptions(){return this.viewportOptions}getPresentationIds(){const{presentationIds:e}=this.viewportOptions;return e}setDisplaySetOptions(e){this.displaySetOptions=e}getSyncGroups(){return this.viewportOptions.syncGroups||=[],this.viewportOptions.syncGroups}getDisplaySetOptions(){return this.displaySetOptions}getViewportType(){return this.viewportOptions.viewportType||s.Enums.ViewportType.STACK}getToolGroupId(){return this.viewportOptions.toolGroupId}getBackground(){return this.viewportOptions.background||[0,0,0]}getOrientation(){return this.viewportOptions.orientation}setOrientation(e){this.viewportOptions.orientation=e}getDisplayArea(){return this.viewportOptions.displayArea}getInitialImageOptions(){return this.viewportOptions.initialImageOptions}mapDisplaySetOptions(e=[{}]){const t=[];return e.forEach(e=>{let n=e?.options||e;n||(n={blendMode:void 0,slabThickness:void 0,colormap:void 0,voi:{},voiInverted:!1});const o=function(e){if(!e)return s.Enums.BlendModes.COMPOSITE;if("mip"===e.toLowerCase())return s.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND;if("minip"===e.toLowerCase())return s.Enums.BlendModes.MINIMUM_INTENSITY_BLEND;if("avg"===e.toLowerCase())return s.Enums.BlendModes.AVERAGE_INTENSITY_BLEND;throw new Error(`Unsupported blend mode: ${e}`)}(n.blendMode);t.push({voi:n.voi,voiInverted:n.voiInverted,colormap:n.colormap,slabThickness:n.slabThickness,blendMode:o,displayPreset:n.displayPreset})}),t}};var nr=function(e){return e.First="first",e.Last="last",e.Middle="middle",e}(nr||{});const or=nr;var ar;const rr={VIEWPORT_DATA_CHANGED:"event::cornerstoneViewportService:viewportDataChanged",VIEWPORT_VOLUMES_CHANGED:"event::cornerstoneViewportService:viewportVolumesChanged"},ir={withNavigation:!0,withOrientation:!0};class sr extends p.Rc{constructor(e){super(rr),this.renderingEngine=void 0,this.viewportsById=new Map,this.viewportGridResizeObserver=void 0,this.viewportsDisplaySets=new Map,this.beforeResizePositionPresentations=new Map,this.servicesManager=null,this.resizeQueue=[],this.viewportResizeTimer=null,this.gridResizeDelay=50,this.gridResizeTimeOut=null,this.hangingProtocolService=void 0,this.viewportsInfo=void 0,this.sceneVolumeInputs=void 0,this.viewportDivElements=void 0,this.ViewportPropertiesMap=void 0,this.volumeUIDs=void 0,this.displaySetsNeedRerendering=void 0,this.viewportDisplaySets=void 0,this.renderingEngine=null,this.viewportGridResizeObserver=null,this.servicesManager=e}enableViewport(e,t){const n=new tr(e);n.setElement(t),this.viewportsById.set(e,n)}getViewportIds(){return Array.from(this.viewportsById.keys())}getRenderingEngine(){const e=(0,s.getRenderingEngine)(Za);return e?(this.renderingEngine=e,this.renderingEngine):(e&&!e.hasBeenDestroyed||(this.renderingEngine=new s.RenderingEngine(Za)),this.renderingEngine)}resize(){if(Array.from(this.viewportsById.values()).every(e=>{const t=e.getElement();return 0===t.clientWidth&&0===t.clientHeight}))return void console.warn("Ignoring resize when viewports have size 0");const e=Array.from(this.viewportsById.values()).filter(e=>e.getViewportType()===s.Enums.ViewportType.STACK).length,t=Array.from(this.viewportsById.values()).filter(e=>e.getViewportType()===s.Enums.ViewportType.ORTHOGRAPHIC).length;e<=12&&t<=6?(this.performResize(),this.resetGridResizeTimeout(),this.resizeQueue=[],clearTimeout(this.viewportResizeTimer)):this.enqueueViewportResizeRequest()}destroy(){this._removeResizeObserver(),this.viewportGridResizeObserver=null;try{this.renderingEngine?.destroy?.()}catch(e){console.warn("Rendering engine not destroyed",e)}this.viewportsDisplaySets.clear(),this.renderingEngine=null,s.cache.purgeCache()}disableElement(e){this.renderingEngine?.disableElement(e),this.viewportsById.delete(e),this.viewportsDisplaySets.delete(e)}setPresentations(e,t){const n=this.getCornerstoneViewport(e);if(!n||!t)return;const{lutPresentation:o,positionPresentation:a,segmentationPresentation:r}=t;this._setSegmentationPresentation(n,r),this._setLutPresentation(n,o),this._setPositionPresentation(n,{...a,viewportId:e})}storePresentation({viewportId:e}){const t=this.getPresentationIds(e),{syncGroupService:n}=this.servicesManager.services,o=n.getSynchronizersForViewport(e);if(!t||0===Object.keys(t).length)return null;const{lutPresentationId:a,positionPresentationId:r,segmentationPresentationId:i}=t,s=this._getPositionPresentation(e),l=this._getLutPresentation(e),c=this._getSegmentationPresentation(e),{setLutPresentation:d}=at.I.getState(),{setPositionPresentation:m}=rt.q.getState(),{setSynchronizers:p}=pn.U.getState(),{setSegmentationPresentation:u}=it.v.getState();a&&d(a,l),r&&m(r,s),i&&u(i,c),o?.length&&p(e,o.map(e=>({id:e.id,sourceViewports:[...e.getSourceViewports()],targetViewports:[...e.getTargetViewports()]})))}getPresentations(e){return{positionPresentation:this._getPositionPresentation(e),lutPresentation:this._getLutPresentation(e),segmentationPresentation:this._getSegmentationPresentation(e)}}getPresentationIds(e){const t=this.viewportsById.get(e);return t?t.getPresentationIds():null}_getPositionPresentation(e){const t=this.getCornerstoneViewport(e);if(!t)return;return{viewportType:this.viewportsById.get(e).getViewportType(),viewReference:t instanceof s.VolumeViewport3D?null:t.getViewReference(),viewPresentation:t.getViewPresentation({pan:!0,zoom:!0}),viewportId:e}}_getLutPresentation(e){const t=this.getCornerstoneViewport(e);if(!t)return;const n=e=>(e?.isComputedVOI&&(delete e?.voiRange,delete e?.VOILUTFunction),e?.colormap&&0===e.colormap?.opacity?.length&&delete e.colormap.opacity,e),o=t instanceof s.BaseVolumeViewport?new Map:n(t.getProperties());if(o instanceof Map){const e=t.getAllVolumeIds();e?.forEach(e=>{const a=n(t.getProperties(e));o.set(e,a)})}return{viewportType:this.viewportsById.get(e).getViewportType(),properties:o}}_getSegmentationPresentation(e){const{segmentationService:t}=this.servicesManager.services;return t.getPresentation(e)}setViewportData(e,t,n,o,a){const r=this.getRenderingEngine();if(t.viewportType===s.Enums.ViewportType.STACK&&!t.data[0].imageIds?.length)return;const i=this.viewportsById.get(e);if(this.storePresentation({viewportId:i.getViewportId()}),this.servicesManager.services.segmentationService.clearSegmentationRepresentations(i.getViewportId()),!i)throw new Error("element is not enabled for the given viewportId");const l=i.setPublicDisplaySetOptions(o),c=i.setPublicViewportOptions(n,t.viewportType),d=i.getElement(),m=i.getViewportType(),p=i.getBackground(),u=i.getOrientation(),g=i.getDisplayArea(),S={viewportId:e,element:d,type:m,defaultOptions:{background:p,orientation:u,displayArea:g}};i.setRenderingEngineId(r.id),r.enableElement(S),i.setViewportOptions(c),i.setDisplaySetOptions(l),i.setViewportData(t),i.setViewportId(e),this.viewportsById.set(e,i);const I=r.getViewport(e);this._setDisplaySets(I,t,i,a).then(()=>{this._broadcastEvent(this.EVENTS.VIEWPORT_DATA_CHANGED,{viewportData:t,viewportId:e})})}getViewportOptions(e){return this.viewportsById.get(e).getViewportOptions()}getCornerstoneViewport(e){if(!this.getViewportInfo(e)||!this.renderingEngine||this.renderingEngine.hasBeenDestroyed)return null;return this.renderingEngine.getViewport(e)}getViewportInfo(e){return this.viewportsById.get(e)}getOrientation(e){return this.getViewportInfo(e).getOrientation()}findNavigationCompatibleViewportId(e,t){const n=this.getCornerstoneViewport(e);if(n||console.warn("No active viewport found for",e),n?.isReferenceViewable(t,{withNavigation:!0}))return e;for(const e of this.viewportsById.keys()){const n=this.getCornerstoneViewport(e);if(n?.isReferenceViewable(t,{withNavigation:!0}))return e}if(n?.isReferenceViewable(t,{withNavigation:!0,withOrientation:!0}))return e;for(const e of this.viewportsById.keys()){const n=this.getCornerstoneViewport(e);if(n?.isReferenceViewable(t,{withNavigation:!0,withOrientation:!0}))return e}return null}findUpdateableViewportConfiguration(e,t){const{metadata:n,displaySetInstanceUID:o}=t,{volumeId:a,referencedImageId:r}=n,{displaySetService:i,viewportGridService:l}=this.servicesManager.services,c=i.getDisplaySetByUID(o);let{viewportType:d}=c;if(d||(r&&!c.isReconstructable?d=s.Enums.ViewportType.STACK:a&&(d="volume")),a)for(const e of this.viewportsById.keys()){const t=this.getCornerstoneViewport(e);if(t?.isReferenceViewable(n,{asVolume:!0,withNavigation:!0}))return{viewportId:e,displaySetInstanceUID:o,viewportOptions:{viewportType:d}}}const m={...n,volumeId:null,referencedImageId:null};for(const e of this.viewportsById.keys()){const t=this.getCornerstoneViewport(e),n=l.getDisplaySetsUIDsForViewport(e)?.[0];if(n&&t&&(a&&(m.volumeId=n),m.FrameOfReferenceUID=this._getFrameOfReferenceUID(n),t.isReferenceViewable(m,{asVolume:!0,withNavigation:!0})))return{viewportId:e,displaySetInstanceUID:o,viewportOptions:{viewportType:d}}}return{viewportId:e,displaySetInstanceUID:o,viewportOptions:{viewportType:d}}}async _setOtherViewport(e,t,n,o={}){const[a]=t.data;return e.setDataIds(a.imageIds,{groupId:a.displaySetInstanceUID,viewReference:n.getViewReference()})}async _setStackViewport(e,t,n,o={}){const a=n.getDisplaySetOptions(),r=t.data.map(e=>e.displaySetInstanceUID);this.viewportsDisplaySets.set(e.id,[...r]);const{initialImageIndex:i,imageIds:c}=t.data[0];let d=o?.positionPresentation?.initialImageIndex??i;const{rotation:m,flipHorizontal:p,displayArea:u}=n.getViewportOptions(),g={...o.lutPresentation?.properties};if(!o.lutPresentation?.properties){const{voi:e,voiInverted:t,colormap:n}=a[0];if(e&&(e.windowWidth||e.windowCenter)){const{lower:t,upper:n}=s.utilities.windowLevel.toLowHighRange(e.windowWidth,e.windowCenter);g.voiRange={lower:t,upper:n}}g.invert=t??g.invert,g.colormap=n??g.colormap}e.element.addEventListener(s.Enums.Events.VIEWPORT_NEW_IMAGE_SET,t=>{const{element:n}=t.detail;n===e.element&&l.utilities.stackContextPrefetch.enable(n)});const S=this._processExtraDisplaySetsForViewport(e),I=o?.positionPresentation?.viewReference?.referencedImageId;return I&&(d=c.indexOf(I)),(null==d||d<0)&&(d=this._getInitialImageIndexForViewport(n,c)||0),e.setStack(c,d).then(()=>{e.setProperties({...g}),this.setPresentations(e.id,o,n),S?.length&&S.forEach(e=>{e?.addOverlayFn&&e.addOverlayFn()}),u&&e.setDisplayArea(u),m&&e.setProperties({rotation:m}),p&&e.setCamera({flipHorizontal:!0})})}_getInitialImageIndexForViewport(e,t){const n=e.getInitialImageOptions();if(!n)return;const{index:o,preset:a}=n,r=e.getViewportType();let i;if(r===s.Enums.ViewportType.STACK)i=t.length;else{if(r!==s.Enums.ViewportType.ORTHOGRAPHIC)return;{const t=this.getCornerstoneViewport(e.getViewportId()),n=s.utilities.getImageSliceDataForVolumeViewport(t);if(!n)return;({numberOfSlices:i}=n)}}return this._getInitialImageIndex(i,o,a)}_getInitialImageIndex(e,t,n){const o=e-1;return void 0!==t?s.utilities.clip(t,0,o):n===or.First?0:n===or.Last?o:n===or.Middle?o%2==0?o/2:(o+1)/2:0}async _setVolumeViewport(e,t,n,o={}){const{displaySetService:a}=this.servicesManager.services,r=[],i=n.getDisplaySetOptions(),{hangingProtocolService:s}=this.servicesManager.services,c=[],d=[];for(const[e,n]of t.data.entries()){const{imageIds:t,displaySetInstanceUID:o}=n;let s=n.volume;const m=a.getDisplaySetByUID(o);if(!s&&m.images&&(s=l.utilities.getOrCreateImageVolume(m.images.map(e=>e.imageId))),d.push(o),!s){console.log("Volume display set not found");continue}c.push(s);const p=i[e],{volumeId:u}=s;r.push({imageIds:t,volumeId:u,modality:m.Modality,displaySetInstanceUID:o,blendMode:p.blendMode,slabThickness:this._getSlabThickness(p,u)})}this.viewportsDisplaySets.set(e.id,d);const m=c.filter(e=>!e.loadStatus?.loaded);if(m.length){if(s.getShouldPerformCustomImageLoad())return s.runImageLoadStrategy({viewportId:e.id,volumeInputArray:r});m.forEach(e=>{!e.loadStatus?.loading&&e.load instanceof Function&&e.load()})}return this.setVolumesForViewport(e,r,o)}async setVolumesForViewport(e,t,n){const{displaySetService:o,viewportGridService:a}=this.servicesManager.services,r=this.getViewportInfo(e.id),i=r.getDisplaySetOptions(),l=a.getDisplaySetsUIDsForViewport(e.id),c=o.getDisplaySetByUID(l[0]),d=c?.Modality,m=e=>setTimeout(e,0),p=t.map((e,t)=>({volumeInput:e,displaySetOptions:i[t]})).filter(({volumeInput:e})=>{const t=o.getDisplaySetByUID(e.displaySetInstanceUID);return!t?.isOverlayDisplaySet}),u=p.map(({volumeInput:e,displaySetOptions:t})=>{const{volumeId:n}=e,{voi:o,voiInverted:a,colormap:r,displayPreset:i}=t,l={};if(o&&(o.windowWidth||o.windowCenter)){const{lower:e,upper:t}=s.utilities.windowLevel.toLowHighRange(o.windowWidth,o.windowCenter);l.voiRange={lower:e,upper:t}}return void 0!==a&&(l.invert=a),void 0!==r&&(l.colormap=r),void 0!==i&&(l.preset=i[d]||i.default),{properties:l,volumeId:n}}),g=this._processExtraDisplaySetsForViewport(e)||[];if(!p.length&&g?.length&&g.forEach(({imageIds:t,addOverlayFn:n})=>{if(n){const n=t[0],r=o.getDisplaySetsBy(e=>!e.isOverlayDisplaySet&&e.images?.some(e=>e.imageId===n));if(1!==r.length)throw new Error("Background display set not found");e.type===s.Enums.ViewportType.VOLUME_3D&&m(()=>{a.setDisplaySetsForViewport({viewportId:e.id,displaySetInstanceUIDs:[r[0].displaySetInstanceUID]})})}}),await e.setVolumes(t),g?.length&&g.forEach(({addOverlayFn:e})=>{e&&e()}),e.render(),u.forEach(({properties:t,volumeId:n})=>{m(()=>{e.setProperties(t,n),e.render()})}),this.setPresentations(e.id,n),!n.positionPresentation){const t=this._getInitialImageIndexForViewport(r);void 0!==t&&s.utilities.jumpToSlice(e.element,{imageIndex:t})}this._broadcastEvent(this.EVENTS.VIEWPORT_VOLUMES_CHANGED,{viewportInfo:r})}_processExtraDisplaySetsForViewport(e){const{displaySetService:t}=this.servicesManager.services,n=this.viewportsDisplaySets.get(e.id).map(t.getDisplaySetByUID).filter(e=>e?.isOverlayDisplaySet);if(n?.length)return n.map(n=>{let o;if(n.referencedDisplaySetInstanceUID){o=t.getDisplaySetByUID(n.referencedDisplaySetInstanceUID).images.map(e=>e.imageId)}return{imageIds:o,addOverlayFn:()=>this.addOverlayRepresentationForDisplaySet(n,e)}})}addOverlayRepresentationForDisplaySet(e,t){const{segmentationService:n}=this.servicesManager.services,o=e.displaySetInstanceUID,a="SEG"===e.Modality?l.Enums.SegmentationRepresentations.Labelmap:l.Enums.SegmentationRepresentations.Contour;n.addSegmentationRepresentation(t.id,{segmentationId:o,type:a}),this.storePresentation({viewportId:t.id})}updateViewport(e,t,n=!1){const o=this.getViewportInfo(e),a=this.getCornerstoneViewport(e),r=a.getCamera();let i;(a instanceof s.VolumeViewport||a instanceof s.VolumeViewport3D)&&(i=this._setVolumeViewport(a,t,o).then(()=>{n&&(a.setCamera(r),a.render())})),a instanceof s.StackViewport&&(i=this._setStackViewport(a,t,o)),i.then(()=>{this._broadcastEvent(this.EVENTS.VIEWPORT_DATA_CHANGED,{viewportData:t,viewportId:e})})}_setDisplaySets(e,t,n,o={}){return e instanceof s.StackViewport?this._setStackViewport(e,t,n,o):[s.VolumeViewport,s.VolumeViewport3D].some(t=>e instanceof t)?this._setVolumeViewport(e,t,n,o):this._setOtherViewport(e,t,n,o)}_removeResizeObserver(){this.viewportGridResizeObserver&&this.viewportGridResizeObserver.disconnect()}_getSlabThickness(e,t){const{blendMode:n}=e;if(void 0!==n&&void 0!==e.slabThickness){if("number"==typeof e.slabThickness)return e.slabThickness;if("fullvolume"===e.slabThickness.toLowerCase()){const e=s.cache.getVolume(t),{dimensions:n,spacing:o}=e;return Math.sqrt(Math.pow(n[0]*o[0],2)+Math.pow(n[1]*o[1],2)+Math.pow(n[2]*o[2],2))}}}_getFrameOfReferenceUID(e){const{displaySetService:t}=this.servicesManager.services,n=t.getDisplaySetByUID(e);if(!n)return;if(n.frameOfReferenceUID)return n.frameOfReferenceUID;if("SEG"===n.Modality){const{instance:e}=n;return e.FrameOfReferenceUID}if("RTSTRUCT"===n.Modality){const{instance:e}=n;return e.ReferencedFrameOfReferenceSequence.FrameOfReferenceUID}const{images:o}=n;return o&&o.length?o[0].FrameOfReferenceUID:void 0}enqueueViewportResizeRequest(){this.resizeQueue.push(!1),clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=setTimeout(()=>{this.processViewportResizeQueue()},this.gridResizeDelay)}processViewportResizeQueue(){const e=this.resizeQueue.some(e=>e);this.resizeQueue.length>0&&!e&&!this.gridResizeTimeOut&&this.performResize(),this.resizeQueue=[]}performResize(){const e=!1;try{this.getRenderingEngine().getViewports().forEach(({id:e})=>{const t=this._getPositionPresentation(e);delete t.viewReference?.sliceIndex,this.beforeResizePositionPresentations.set(e,t)});const t=this.renderingEngine;t.resize(e),t.render(),this.beforeResizePositionPresentations.forEach((e,t)=>{this.setPresentations(t,{positionPresentation:e})}),t.resize(e),t.render()}catch(e){console.warn("Caught resize exception",e)}}resetGridResizeTimeout(){clearTimeout(this.gridResizeTimeOut),this.gridResizeTimeOut=setTimeout(()=>{this.gridResizeTimeOut=null},this.gridResizeDelay)}_setLutPresentation(e,t){if(!t)return;const{properties:n}=t;e instanceof s.BaseVolumeViewport&&n instanceof Map?n.forEach((t,n)=>{e.setProperties(t,n)}):e.setProperties(n)}_setPositionPresentation(e,t){const n=t?.viewReference;n&&(e.isReferenceViewable(n,ir)?e.setViewReference(n):console.warn("Unable to apply reference viewable",n));const o=t?.viewPresentation;o&&e.setViewPresentation(o)}_setSegmentationPresentation(e,t){if(!t)return;const{segmentationService:n}=this.servicesManager.services;t.forEach(t=>{const{segmentationId:o,type:a,hydrated:r}=t,{Labelmap:i,Surface:c}=l.Enums.SegmentationRepresentations,d=e.type===s.Enums.ViewportType.VOLUME_3D,m=a!==c||d?a:i;r&&n.addSegmentationRepresentation(e.id,{segmentationId:o,type:m})})}getViewportDisplaySets(e){const{displaySetService:t}=this.servicesManager.services;return(this.viewportsDisplaySets.get(e)||[]).map(e=>t.getDisplaySetByUID(e)).filter(Boolean)}}ar=sr,sr.REGISTRATION={name:"cornerstoneViewportService",altName:"CornerstoneViewportService",create:({servicesManager:e})=>new ar(e)};const lr=sr;let cr=function(e){return e.Removed="removed",e.Added="added",e.Modified="modified",e}({});var dr;class mr extends p.Rc{constructor(e){super(mr.EVENTS),this.colorbars={},this.servicesManager=void 0,this.servicesManager=e}getDataIdForViewport(e,t){if(e.getAllVolumeIds){const n=e.getAllVolumeIds()||[];return n.length>0&&n.find(e=>e.includes(t))||void 0}}addColorbar(e,t,n={}){const{displaySetService:o}=this.servicesManager.services,a=(0,s.getRenderingEngine)(Za).getViewport(e);if(!a)return;const r=a.getActors();if(!r||0===r.length)return;const{activeColormapName:i,colormaps:l}=n;t.forEach(t=>{if(o.getDisplaySetByUID(t).isOverlayDisplaySet)return;const r=this.getDataIdForViewport(a,t),s=r?a.getProperties(r):a.getProperties(),c=s?.colormap;i&&!c&&this.setViewportColormap(e,t,l[i],!0);const d={activeColormapName:c?.name||n?.activeColormapName||"Grayscale",colormaps:n.colormaps?Object.values(n.colormaps):[],volumeId:r,dataId:r};if(this.colorbars[e]){const n=this.colorbars[e].findIndex(e=>e.displaySetInstanceUID===t);-1!==n?this.colorbars[e][n].colorbar=d:this.colorbars[e].push({colorbar:d,displaySetInstanceUID:t})}else this.colorbars[e]=[{colorbar:d,displaySetInstanceUID:t}]}),this._broadcastEvent(mr.EVENTS.STATE_CHANGED,{viewportId:e,changeType:cr.Added})}removeColorbar(e,t){const n=this.colorbars[e];if(n){if(t){const o=n.findIndex(e=>e.displaySetInstanceUID===t);-1!==o&&(n.splice(o,1),0===n.length&&delete this.colorbars[e])}else delete this.colorbars[e];this._broadcastEvent(mr.EVENTS.STATE_CHANGED,{viewportId:e,displaySetInstanceUID:t,changeType:cr.Removed})}}hasColorbar(e){return!!this.colorbars[e]}getState(){return this.colorbars}getViewportColorbar(e){return this.colorbars[e]}onModeExit(){Object.keys(this.colorbars).forEach(e=>{this.removeColorbar(e)})}setViewportColormap(e,t,n,o=!1){const a=(0,s.getRenderingEngine)(Za).getViewport(e),r=a?.getActors();if(!a||!r||0===r.length)return;const i=this.getDataIdForViewport(a,t);a.setProperties({colormap:n},i),o&&a.render()}}dr=mr,mr.EVENTS={STATE_CHANGED:"event::ColorbarService:stateChanged"},mr.REGISTRATION={name:"colorbarService",create:({servicesManager:e})=>new dr(e)};const pr=mr;var ur=n(83562);const gr=e=>{if(e)return"function"==typeof e.getImageId?e.getImageId():e.url},Sr=e=>(Array.isArray(e)?e:[e]).some(e=>!e),Ir=e=>e&&e.images&&e.images[0],vr=e=>gr(e),yr=(e,t=p.ll.getAuthorizationHeader())=>fetch(e,t).then(e=>e.arrayBuffer()),fr=e=>s.imageLoader.loadAndCacheImage(e).then(e=>e&&e.data&&e.data.byteArray.buffer),hr=(e,t,n,o,a=p.ll.getAuthorizationHeader(),r=p.r_.getHTTPErrorHandler())=>{const i={url:e,headers:a,errorInterceptor:r};return new ur.FH.DICOMwebClient(i).retrieveInstance({studyInstanceUID:t,seriesInstanceUID:n,sopInstanceUID:o})};const wr=new class{getLocalData(e,t){const n=Ir(e),o=(e=>e&&e.instance)(e);if(!n&&!o||!o.imageId?.startsWith("dicomfile"))return;let a=vr(n||o);return Sr(a)&&(a=((e,t)=>{const n=e.find(e=>e.displaySets.some(e=>e.displaySetInstanceUID===t)),{series:o=[]}=n,{instances:a=[]}=o[0]||{},r=a[0];return gr(r)})(t,e.displaySetInstanceUID)),Sr(a)?void 0:S.Ay.wadouri.loadFileRequest(a)}getDataByImageType(e){const t=Ir(e);if(t){let e=vr(t),n=yr;const o=(e=>{const t=/^\w+\:/,n=t.exec(e);return 0===t.lastIndex&&n&&n[0]&&n[0].replace(":","")||""})(e);switch(o){case"dicomfile":n=fr.bind(this,e);break;case"wadors":const o=t.getData().wadoRoot,a=t.getStudyInstanceUID(),r=t.getSeriesInstanceUID(),i=t.getSOPInstanceUID();if(Sr([o,a,r,i]))return;n=hr.bind(this,o,a,r,i);break;case"wadouri":if(e=e.substring(e.indexOf(":")+1),Sr(e))return;n=yr.bind(this,e);break;default:return}return n()}}getDataByDatasetType(e){const{StudyInstanceUID:t,SeriesInstanceUID:n,SOPInstanceUID:o,authorizationHeaders:a,wadoRoot:r,wadoUri:i,instance:s}=e;if(!Sr(r))return hr(r,t,n,o,a);if(!Sr(i))return yr(i,{headers:a});if(!Sr(s?.url)){const e=s.url,t=e.startsWith("http")?e:e.substring(e.indexOf(":")+1);return yr(t,{headers:a})}}*getLoaderIterator(e,t,n){yield this.getLocalData(e,t),yield this.getDataByImageType(e),yield this.getDataByDatasetType(e)}findDicomDataPromise(e,t,n){e.authorizationHeaders=n;const o=this.getLoaderIterator(e,t);for(const e of o)if(e)return e;throw new Error("Invalid dicom data loader")}},Er=JSON.parse('{"UU":"@ohif/extension-cornerstone"}').UU,br=(e,t,n)=>{const o=(0,s.getRenderingEngine)(n.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const a=o.getViewport(t.viewportId),{viewportIndex:r}=e.getOptions(n.viewportId),{viewportIndex:i}=e.getOptions(t.viewportId);if(void 0===r||void 0===i)throw new Error("No viewportIndex provided");const l=o.getViewport(n.viewportId),c=a.getSliceIndex()+(Number(r)-Number(i));c!==l.getSliceIndex()&&s.utilities.jumpToSlice(l.element,{imageIndex:c})},Dr=e=>l.SynchronizerManager.createSynchronizer(e,s.EVENTS.STACK_VIEWPORT_SCROLL,br,{auxiliaryEvents:[{name:s.EVENTS.CAMERA_MODIFIED,source:"element"}]});var Tr=n(5842);const{MetadataModules:Cr}=s.Enums,{utils:Or}=p.Ay,{denaturalizeDataset:Nr}=Tr.Ay.data.DicomMetaDictionary,{transferDenaturalizedDataset:Mr,fixMultiValueKeys:Vr}=f.dicomWebUtils,Rr="1.2.840.10008.5.1.4.1.1.77.1.6";function Ur(e,t,n){const o=n.getActiveDataSource()[0];if(!e||!e.length)throw new Error("No instances were provided");const a=e[0];let r=a,i=+r.NumberOfFrames||1;for(const t of e){const e=+t.NumberOfFrames||1;e<i&&(r=t,i=e)}const{FrameOfReferenceUID:l,SeriesDescription:c,ContentDate:d,ContentTime:m,SeriesNumber:p,StudyInstanceUID:u,SeriesInstanceUID:g,SOPInstanceUID:S,SOPClassUID:I}=a,v=(e=e.map(e=>(e.FrameOfReferenceUID=a.FrameOfReferenceUID,e))).filter(e=>e).map(e=>e.FrameOfReferenceUID).filter((e,t,n)=>n.indexOf(e)===t);v.length>1&&console.warn("Expected FrameOfReferenceUID of difference instances within a series to be the same, found multiple different values",v);const y={plugin:"microscopy",Modality:"SM",viewportType:s.Enums.ViewportType.WHOLE_SLIDE,altImageText:"Microscopy",displaySetInstanceUID:Or.guid(),SOPInstanceUID:S,SeriesInstanceUID:g,StudyInstanceUID:u,FrameOfReferenceUID:l,SOPClassHandlerId:"@ohif/extension-cornerstone.sopClassHandlerModule.DicomMicroscopySopClassHandler",SOPClassUID:I,SeriesDescription:c||"Microscopy Data",SeriesDate:d,SeriesTime:m,SeriesNumber:p,firstInstance:r,instance:a,numImageFrames:0,numInstances:1,others:e,instances:e,othersFrameOfReferenceUID:v,imageIds:e.map(e=>e.imageId),getThumbnailSrc:o.retrieve.getGetThumbnailSrc?.(r,r.imageId),label:c||`${kn.A.t("Series")} ${p} - ${kn.A.t("SM")}`},f=o.retrieve.getWadoDicomWebClient?.(),h=new Map;if(e.forEach(e=>h.set(e.imageId,e)),f){const e=Object.create(f);e.getDICOMwebMetadata=Ar.bind(e,h),s.utilities.genericMetadataProvider.addRaw(y.imageIds[0],{type:Cr.WADO_WEB_CLIENT,metadata:e})}return[y]}function Ar(e,t){return e.get(t)?Mr(Nr(Vr(e.get(t)))):(console.warn("Metadata not already found for",t,"in",e),this.super.getDICOMwebMetadata(t))}function xr({servicesManager:e,extensionManager:t}){return{name:"DicomMicroscopySopClassHandler",sopClassUids:[Rr],getDisplaySetsFromSeries:e=>Ur(e,0,t)}}var Pr=n(9234),Fr=n(19214);function Lr(){return Lr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Lr.apply(null,arguments)}const _r=function(e){const{className:t,isActive:n,id:o}=e,a=(0,f.useUIStateStore)(e=>e.uiState.activeSegmentationUtility),r=(0,ut.cn)("w-7 h-7 text-primary hover:text-primary hover:!bg-primary/30",t,n&&"bg-primary/30"),s=(0,i.useCallback)(e=>{a===o&&(e.preventDefault(),e.stopPropagation())},[a,o]);return i.createElement("div",{onPointerDownCapture:s},i.createElement(ut.T0e,Lr({},e,{className:r})))},kr=(e,t)=>{if(!e)return!1;const n=e?.imageIds;if(!n?.length)return!1;if(!n.some(e=>{const t=s.cache.getImage(e)?.getPixelData();if(!t)return!1;for(let e=0;e<t.length;e++)if(0!==t[e])return!0}))return!1;const o=e?.referencedImageIds;if(!o)return!1;const a=o[0],r=s.metaData.get("instance",a);if(!r)return!1;const i=r.SOPInstanceUID||r.SopInstanceUID,l=r.SeriesInstanceUID,c=t.getDisplaySetForSOPInstanceUID(i,l);return c?.isReconstructable},Gr=e=>{if(!e)return!1;const t=e?.annotationUIDsMap;return!!t&&t.size>0};function zr({children:e,segmentationRepresentationType:t}){const{commandsManager:n,servicesManager:o}=(0,p.Jg)(),{customizationService:a,displaySetService:r,viewportGridService:s,toolbarService:l,segmentationService:c}=o.services,{activeViewportId:d}=s.getState(),m={[ot.SegmentationRepresentations.Labelmap]:l.sections.labelMapSegmentationUtilities,[ot.SegmentationRepresentations.Contour]:l.sections.contourSegmentationUtilities},u=Sn(e=>e.selectedSegmentationsForViewport[d]),g=t?u?.get(t):c?.getActiveSegmentation(d)?.segmentationId,S=m[t],{activeToolOptions:I}=(0,p.KP)({buttonSectionId:S}),{segmentationsWithRepresentations:v,disabled:y}=(0,Pr.c)(),h=(0,f.useUIStateStore)(e=>e.setUIState);(0,i.useEffect)(()=>{h("activeSegmentationUtility",null),l.refreshToolbarState({viewportId:d})},[d,h,l]);const w=(0,i.useCallback)(e=>{e||(h("activeSegmentationUtility",null),l.refreshToolbarState({viewportId:d}))},[d,h,l]),E=a.getCustomization("panelSegmentation.tableMode"),b=a.getCustomization("panelSegmentation.onSegmentationAdd"),D=a.getCustomization("panelSegmentation.disableEditing"),T=a.getCustomization("panelSegmentation.showAddSegment"),C=a.getCustomization("panelSegmentation.customDropdownMenuContent"),O=a.getCustomization("panelSegmentation.customSegmentStatisticsHeader"),N={onSegmentationClick:e=>{n.run("setActiveSegmentation",{segmentationId:e})},onSegmentAdd:e=>{n.run("addSegment",{segmentationId:e}),n.run("setActiveSegmentation",{segmentationId:e})},onSegmentClick:(e,t)=>{n.run("setActiveSegmentAndCenter",{segmentationId:e,segmentIndex:t})},onSegmentEdit:(e,t)=>{n.run("editSegmentLabel",{segmentationId:e,segmentIndex:t})},onSegmentationEdit:e=>{n.run("editSegmentationLabel",{segmentationId:e})},onSegmentColorClick:(e,t)=>{n.run("editSegmentColor",{segmentationId:e,segmentIndex:t})},onSegmentDelete:(e,t)=>{n.run("deleteSegment",{segmentationId:e,segmentIndex:t})},onSegmentCopy:t===ot.SegmentationRepresentations.Contour?(e,t)=>{n.run("copyContourSegment",{sourceSegmentInfo:{segmentationId:e,segmentIndex:t}})}:void 0,onToggleSegmentVisibility:(e,t,o)=>{n.run("toggleSegmentVisibility",{segmentationId:e,segmentIndex:t,type:o})},onToggleSegmentLock:(e,t)=>{n.run("toggleSegmentLock",{segmentationId:e,segmentIndex:t})},onToggleSegmentationRepresentationVisibility:(e,t)=>{n.run("toggleSegmentationVisibility",{segmentationId:e,type:t})},onSegmentationDownload:e=>{n.run("downloadSegmentation",{segmentationId:e})},setStyle:(e,t,o,a)=>{n.run("setSegmentationStyle",{segmentationId:e,type:t,key:o,value:a})},toggleRenderInactiveSegmentations:()=>{n.run("toggleRenderInactiveSegmentations")},onSegmentationRemoveFromViewport:e=>{n.run("removeSegmentationFromViewport",{segmentationId:e})},onSegmentationDelete:e=>{n.run("deleteSegmentation",{segmentationId:e})},setFillAlpha:({type:e},t)=>{n.run("setFillAlpha",{type:e,value:t})},setOutlineWidth:({type:e},t)=>{n.run("setOutlineWidth",{type:e,value:t})},setRenderFill:({type:e},t)=>{n.run("setRenderFill",{type:e,value:t})},setRenderOutline:({type:e},t)=>{n.run("setRenderOutline",{type:e,value:t})},setFillAlphaInactive:({type:e},t)=>{n.run("setFillAlphaInactive",{type:e,value:t})},getRenderInactiveSegmentations:()=>n.run("getRenderInactiveSegmentations")},M=v.map(({segmentation:e})=>{const{representationData:t,segmentationId:n}=e,{Labelmap:o,Contour:a}=t;return o||a?kr(o,r)||Gr(a)?{segmentationId:n,isExportable:!0}:{segmentationId:n,isExportable:!1}:{segmentationId:n,isExportable:!0}}),V={disabled:y,data:v,mode:E,title:(t?`${t} `:"")+"Segmentations",exportOptions:M,disableEditing:D,onSegmentationAdd:b,showAddSegment:T,renderInactiveSegmentations:N.getRenderInactiveSegmentations(),segmentationRepresentationType:t,selectedSegmentationIdForType:g,...N},R=()=>S?i.createElement(ut.TNf,{size:"large",IconContainer:_r},i.createElement("div",{className:"flex flex-wrap gap-[3px] bg-transparent pb-[2px] pl-[8px] pt-[6px]"},i.createElement(f.Toolbar,{buttonSection:S}))):null,U=()=>i.createElement(ut.R4h.Segments,null,i.createElement(ut.R4h.SegmentStatistics.Header,null,i.createElement(O,null)),i.createElement(ut.R4h.SegmentStatistics.Body,null));return i.createElement(ut.AMh,{open:!!I,onOpenChange:w},i.createElement(ut.dTQ,null,i.createElement(ut.R4h,V,e,i.createElement(ut.R4h.Config,null),i.createElement(ut.R4h.AddSegmentationRow,null),"collapsed"===V.mode?i.createElement(ut.R4h.Collapsed,null,R(),i.createElement(ut.R4h.Collapsed.Header,null,i.createElement(ut.R4h.Collapsed.DropdownMenu,null,i.createElement(C,null)),i.createElement(ut.R4h.Collapsed.Selector,null),i.createElement(ut.R4h.Collapsed.Info,null)),i.createElement(ut.R4h.Collapsed.Content,null,i.createElement(ut.R4h.AddSegmentRow,null),U())):i.createElement(i.Fragment,null,i.createElement(ut.R4h.Expanded,null,R(),i.createElement(ut.R4h.Expanded.Header,null,i.createElement(ut.R4h.Expanded.DropdownMenu,null,i.createElement(C,null)),i.createElement(ut.R4h.Expanded.Label,null),i.createElement(ut.R4h.Expanded.Info,null)),i.createElement(ut.R4h.Expanded.Content,null,i.createElement(ut.R4h.AddSegmentRow,null),U()))))),I&&i.createElement(ut.hlN,{side:"left",align:"start",className:"w-auto"},i.createElement(ut.k_3,{options:I})))}var Br=n(62051),$r=n.n(Br),jr=n(660);const Wr=(0,s.getWebWorkerManager)(),Hr={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:1e3}},qr=()=>new Worker(new URL(n.p+n.u(3054),n.b),{name:"histogram-worker"}),Yr=(e,t)=>{const n=[];return e.getProperty().getScalarOpacity(0).getNodeValue(t,n),n[1]},Jr=async(e,t,n)=>{if(!e)return[];const o=e.getAllVolumeIds(),a=e.getProperties(),{voiRange:r}=a,i=r?{windowWidth:r.upper-r.lower,windowCenter:r.lower+(r.upper-r.lower)/2}:void 0,l=await Promise.all(o.map(async(o,a)=>{const r=s.cache.getVolume(o),l=n(e,o),{metadata:c,scaling:d}=r,m=c.Modality,p={min:"PT"===m?.1:-999,max:"PT"===m?5:1e4},u=await(async(e,t,n)=>{if(Wr.registerWorker("histogram-worker",qr,Hr),!e.getImageData(t.volumeId))return;let o=t.scalarData;if(t.numTimePoints>1){const e=t.numTimePoints-1;o=t.voxelManager.getTimePointScalarData(e)}else o=t.voxelManager.getCompleteScalarDataArray();if(!o?.length)return;const{dimensions:a,origin:r,direction:i,spacing:s}=t,l=await Wr.executeTask("histogram-worker","getRange",{dimensions:a,origin:r,direction:i,spacing:s,scalarData:o}),{minimum:c,maximum:d}=l;if(c===1/0||d===-1/0)return;const m={numBins:256,min:Math.max(c,n?.min??c),max:Math.min(d,n?.max??d)};return await Wr.executeTask("histogram-worker","calcHistogram",{data:o,options:m})})(e,r,p);if(!u||u.range.min===u.range.max)return null;if(!t.displaySetOptions||!t.displaySetOptions[a])return null;const{voi:g,colormap:S}=t.displaySetOptions[a];let I;S&&(I=s.utilities.colormap.getColormap(S.name)??jr.A.getPresetByName(S.name));const v=a?g:i??g;return{viewportId:t.viewportId,modality:m,volumeId:o,volumeIndex:a,voi:v,histogram:u,colormap:I,step:d?.PT?.05:1,opacity:l,showOpacitySlider:1===a&&void 0!==l}}));return l.filter(Boolean)},{Events:Kr}=s.Enums,Qr=({servicesManager:e,viewportId:t})=>{const{cornerstoneViewportService:n}=e.services,[o,a]=(0,i.useState)([]),[r,l]=(0,i.useState)(!0),c=(0,p.BZ)(),d=(0,i.useCallback)(e=>n.getRenderingEngine().getVolumeViewports().filter(t=>{const n=t instanceof s.BaseVolumeViewport?t.getAllVolumeIds():[];return e.length===n.length&&e.every(e=>n.includes(e))}),[n]),m=(0,i.useCallback)((e,t)=>{const n=e.getActors().find(e=>e.referencedId===t)?.actor;return((e,t)=>{const n=s.cache.getVolume(e);if(!n||"PT"!==n.metadata.Modality)return!1;const o=t.getProperty().getScalarOpacity(0);if(o.getSize()<2)return!1;const a=[],r=[];if(o.getNodeValue(0,a),o.getNodeValue(1,r),0!==a[0]||0!==a[1]||.1!==r[0])return!1;const i=r[1],l=o.getSize(),c=[];for(let e=2;e<l;e++)if(o.getNodeValue(e,c),c[1]!==i)return!1;return!0})(t,n)?Yr(n,1):(e=>{const t=e.getProperty().getScalarOpacity(0),n=t.getSize(),o=[];t.getNodeValue(0,o);const a=o[1];for(let e=0;e<n;e++){const e=[];if(t.getNodeValue(0,e),e[1]!==a)return!1}return!0})(n)?Yr(n,0):void 0},[]),u=(0,i.useCallback)(()=>{const e=n.getCornerstoneViewport(t),o=n.getViewportInfo(t);Jr(e,o,m).then(e=>{a(e)})},[t,n,m]),g=(0,i.useCallback)(e=>{const{detail:t}=e,{volumeId:n,range:r}=t,i=o.find(e=>e.volumeId===n);if(!i)return;const s=i.voi,l=r.upper-r.lower,c=r.lower+l/2;if(l===s.windowWidth&&c===s.windowCenter)return;const d={...i,voi:{windowWidth:l,windowCenter:c}};a(o.map(e=>e===i?d:e))},[o]),S=(0,i.useMemo)(()=>$r()(g,100),[g]),I=(0,i.useCallback)((e,o)=>{const a=n.getCornerstoneViewport(t),r={lower:o.windowCenter-o.windowWidth/2,upper:o.windowCenter+o.windowWidth/2};a.setProperties({voiRange:r},e),a.render()},[n,t]),v=(0,i.useCallback)((e,t,o,a)=>{const r=n.getCornerstoneViewport(e);if(!r)return;const i=r instanceof s.BaseVolumeViewport?r.getAllVolumeIds():[];d(i).forEach(e=>{e.setProperties({colormap:{opacity:a}},o),e.render()})},[d,n]),y=(0,i.useCallback)(()=>{l(!1),u()},[u]);(0,i.useEffect)(()=>{document.addEventListener(Kr.VOI_MODIFIED,S,!0),s.eventTarget.addEventListener(Kr.IMAGE_VOLUME_LOADING_COMPLETED,y);const e=setInterval(()=>{r&&u()},1e3);return()=>{document.removeEventListener(Kr.VOI_MODIFIED,S,!0),s.eventTarget.removeEventListener(Kr.IMAGE_VOLUME_LOADING_COMPLETED,y),clearInterval(e)}},[u,S,y,r]);const f=(0,i.useMemo)(()=>c?.map(e=>e.displaySetInstanceUID).sort()||[],[c]);return(0,i.useEffect)(()=>{const{unsubscribe:e}=n.subscribe(n.EVENTS.VIEWPORT_VOLUMES_CHANGED,({viewportInfo:e})=>{e.viewportId===t&&u()});return f.length&&!r&&u(),()=>{e()}},[t,n,u,f,r]),i.createElement(ut.aUM,{defaultOpen:!0},i.createElement(ut.aUM.Header,null,"Window Level"),i.createElement(ut.aUM.Content,{className:"bg-muted py-1"},o.map((e,t)=>e.histogram?i.createElement(ut.bLr,{key:e.volumeId,histogram:e.histogram,voi:e.voi,step:e.step,showOpacitySlider:e.showOpacitySlider,colormap:e.colormap,onVOIChange:t=>I(e.volumeId,t),opacity:e.opacity,onOpacityChange:n=>v(e.viewportId,t,e.volumeId,n)}):null),0===o.length&&!r&&i.createElement("div",{className:"text-muted-foreground py-2 text-center text-sm"},"No window level data available")))};Qr.propTypes={servicesManager:xt().object.isRequired,viewportId:xt().string.isRequired};const Zr=Qr,Xr=({servicesManager:e})=>{const[t]=(0,ut.ihW)(),{activeViewportId:n}=t;return i.createElement(i.Fragment,null,n&&i.createElement(Zr,{servicesManager:e,viewportId:n}))};Xr.propTypes={servicesManager:xt().object.isRequired};const ei=Xr;var ti=n(65939);const ni=e=>{const{group:t,allChildren:n,children:o,childType:a,defaultTypes:r}=e,s=t?.subType;for(const t of n)if(!s||t.props?.subType===s){if(a&&t.type===a)return i.cloneElement(t,{...e,children:t.props.children});if(-1===r?.indexOf(t.type))return a({...e,children:t})}if(!o)throw new Error(`No children defined for ${e.name} CloneChildren in group ${t?.name}`);return i.cloneElement(o,e)},oi=[ii,si,li];function ai(e){const{grouping:t,items:n,children:o,sourceChildren:a}=e,r=(0,p.Jg)();let s=e.defaultValue;const l=t.groupingFunction(n,t,r);if(!s){const e=l.values().find(e=>e.isSelected);s=e?.key||e?.title}const c=Array.isArray(s)&&s||s&&[s]||[],d=a?i.Children.toArray(a):[],m=o?i.Children.toArray(o):[],u=d.concat(m);return i.createElement(ni,{allChildren:u,groups:l,childType:ii,grouping:t,defaultValue:c,name:"grouping "+t.name},i.createElement(ri,{name:"DefaultAccordion"}))}function ri(e){const{groups:t,defaultValue:n,grouping:o,allChildren:a,asChild:r}=e;return a&&t?Boolean(r)?i.cloneElement(e.children,e):i.createElement(ut.nD3,{type:o.type||"multiple",className:"text-[rgb(var(--text))]",defaultValue:n},[...t.entries()].map(([e,t])=>i.createElement(ut.AsP,{key:t.key+"-i",value:t.key},i.createElement(ni,{allChildren:a,group:t,childType:li,name:"AccordionGroup.Trigger"}),i.createElement(ni,{allChildren:a,group:t,childType:si,defaultTypes:oi,name:"AccordionGroup.Content"})))):null}function ii(e){const{groups:t,children:n}=e;return t?[...t.values()].map(t=>i.cloneElement(n,{...e,children:n.props.children,group:t,...t,key:t.title})):null}function si(e){const{children:t,asChild:n,...o}=e,{group:a}=e;return Object.assign(o,a),a?n?i.cloneElement(t,{...a,...e,children:t.props.children}):i.createElement(ut.ub_,null,i.cloneElement(t,{...a,...e,children:t.props.children})):null}function li(e){const{children:t,asChild:n,...o}=e,{group:a}=e;return Object.assign(o,a),a?n?i.cloneElement(t,o):i.createElement(ut.$m7,{value:a.value,asChild:!0},i.createElement("div",null,i.cloneElement(t,o),i.createElement(ti.D3D,{key:"chevronDown",className:"text-primary h-4 w-4 shrink-0 transition-transform duration-200"}))):null}ai.Content=si,ai.Trigger=li,ai.Accordion=ii;const ci=ai;function di(){return di=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},di.apply(null,arguments)}function mi(e){const{title:t,items:n,group:o,customHeader:a}=e,{commandsManager:r}=(0,p.Jg)();return i.createElement(ut.VaM,di({title:t||"Measurements",data:n,onAction:(e,t,o)=>{r.run(t,{uid:o,annotationUID:o,displayMeasurements:n})}},o,{key:o.key}),i.createElement(ut.VaM.Header,{key:"measurementTableHeader"},a&&o.isFirst&&a({...e,items:e.allItems})),i.createElement(ut.VaM.Body,{key:"measurementTableBody"}))}const{filterNot:pi,filterAdditionalFindings:ui}=p.Wp.MeasurementFilters,gi=[{title:"Measurements",filter:pi(ui)},{title:"Additional Findings",filter:ui}],Si=(e,t)=>{const n=new Map,{namedSets:o}=t;for(const e of o){const o=e.id||e.title;n.set(o,{...t,...e,items:[],isFirst:0===n.size,title:o,key:o})}e.forEach(e=>{for(const t of o)if(t.filter(e)){const o=t.id||t.title;return void n.get(o).items.push(e)}});for(const e of o){const t=e.id||e.title;n.get(t).items.length||n.delete(t)}return n};function Ii(e){const{items:t,children:n,grouping:o={},customHeader:a,group:r,actions:s}=e;return i.createElement(ci,{grouping:{groupingFunction:Si,name:"measurementsOrAdditional",namedSets:gi,StudyInstanceUID:r?.StudyInstanceUID,...o},items:t,sourceChildren:n},i.createElement(ci.Accordion,{noWrapper:"true"},i.createElement(mi,{customHeader:a,allItems:t,actions:s})))}const vi=Ii,{formatDate:yi}=p.Wp;function fi(e){const{StudyInstanceUID:t}=e;if(!t)return null;const n=p.H8.getStudy(t);if(!n?.series?.length)return null;const o=n.series[0].instances[0],{StudyDate:a,StudyDescription:r}=o;return i.createElement(ut.u3f,{date:yi(a),description:r})}function hi({items:e,StudyInstanceUID:t,measurementFilter:n,actions:o}){const{commandsManager:a}=(0,p.Jg)();return!e?.length?null:i.createElement("div",{className:"bg-background flex h-9 w-full items-center rounded pr-0.5"},i.createElement("div",{className:"flex space-x-1"},i.createElement(ut.$nd,{size:"sm",variant:"ghost",className:"pl-1.5",onClick:()=>{a.runCommand("downloadCSVMeasurementsReport",{StudyInstanceUID:t,measurementFilter:n})}},i.createElement(ut.FI1.Download,{className:"h-5 w-5"}),i.createElement("span",{className:"pl-1"},"CSV")),i.createElement(ut.$nd,{size:"sm",variant:"ghost",className:"pl-0.5",onClick:e=>{e.stopPropagation(),o?.createSR?o.createSR({StudyInstanceUID:t,measurementFilter:n}):a.run("promptSaveReport",{StudyInstanceUID:t,measurementFilter:n})}},i.createElement(ut.FI1.Add,null),"Create SR"),i.createElement(ut.$nd,{size:"sm",variant:"ghost",className:"pl-0.5",onClick:e=>{e.stopPropagation(),o?.onDelete?o.onDelete():a.runCommand("clearMeasurements",{measurementFilter:n})}},i.createElement(ut.FI1.Delete,null),"Delete")))}const wi=hi;const Ei=function(e){return i.createElement("div",null,i.createElement(fi,e),i.createElement(wi,e))},{MeasurementFilters:bi}=p.Wp,Di=(e,t,n)=>{const o=new Map,{activeStudyUID:a}=t,{displaySetService:r}=n.servicesManager.services;let i,s;return e.filter(e=>e.displaySetInstanceUID).forEach(e=>{const n=(e=>r.getDisplaySetByUID(e.displaySetInstanceUID).instances[0].StudyInstanceUID)(e);if(!o.has(n)){const e=[],r=bi.filterAnd(bi.filterMeasurementsByStudyUID(n),t.filter),l={...t,items:e,displayMeasurements:e,key:n,isSelected:n===a,StudyInstanceUID:n,filter:r,measurementFilter:r};l.isSelected&&!i&&(i=l),s||=l,o.set(n,l)}!i&&s&&(s.isSelected=!0);o.get(n).items.push(e)}),o};function Ti(e){const{items:t,grouping:n={},children:o}=e,a=(0,p.BZ)(),r=a?.[0]?.StudyInstanceUID;return i.createElement(ai,{grouping:{name:"groupByStudy",groupingFunction:Di,activeStudyUID:r,...n},items:t,value:[r],sourceChildren:o},i.createElement(ai.Trigger,null,i.createElement(Ei,null)),i.createElement(vi,{activeStudyUID:r}))}const Ci=Ti;function Oi(e){const{measurementFilter:t,emptyComponent:n,children:o}=e,a=(0,Fr.d)({measurementFilter:t});if(!a.length)return n?i.createElement(n,{items:a}):i.createElement("span",{className:"text-[rgb(var(--text))]"},"No Measurements");if(o){return i.Children.map(o,e=>i.cloneElement(e,{items:a,filter:t}))}return i.createElement(Ci,{items:a})}const Ni=({commandsManager:e,servicesManager:t,extensionManager:n})=>{const{toolbarService:o}=t.services,a={[ot.SegmentationRepresentations.Labelmap]:o.sections.labelMapSegmentationToolbox,[ot.SegmentationRepresentations.Contour]:o.sections.contourSegmentationToolbox},r=o=>{const{t:r}=(0,gt.Bd)("SegmentationTable"),s=r(`${o.segmentationRepresentationType??"Segmentation"} tools`);return i.createElement(i.Fragment,null,i.createElement(f.Toolbox,{buttonSectionId:a[o.segmentationRepresentationType],title:s}),i.createElement(zr,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o?.configuration},segmentationRepresentationType:o?.segmentationRepresentationType}))};return[{name:"activeViewportWindowLevel",component:()=>i.createElement(ei,{servicesManager:t})},{name:"panelMeasurement",iconName:"tab-linear",iconLabel:"Measure",label:"Measurement",component:Oi},{name:"panelSegmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:o=>i.createElement(zr,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o?.configuration},segmentationRepresentationType:o?.segmentationRepresentationType})},{name:"panelSegmentationNoHeader",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:o=>i.createElement(zr,{commandsManager:e,servicesManager:t,extensionManager:n,configuration:{...o?.configuration},segmentationRepresentationType:o?.segmentationRepresentationType})},{name:"panelSegmentationWithToolsLabelMap",iconName:"tab-segmentation",iconLabel:"Segmentation",label:kn.A.t("SegmentationTable:Labelmap"),component:e=>r({...e,segmentationRepresentationType:ot.SegmentationRepresentations.Labelmap})},{name:"panelSegmentationWithToolsContour",iconName:"tab-contours",iconLabel:"Segmentation",label:kn.A.t("SegmentationTable:Contour"),component:e=>r({...e,segmentationRepresentationType:ot.SegmentationRepresentations.Contour})}]};var Mi=n(73421);var Vi=s.Enums.OrientationAxis;function Ri({segmentationService:e,customizationService:t,commandsManager:n}){let o=!1;const{unsubscribe:a}=e.subscribeDebounced(e.EVENTS.SEGMENTATION_DATA_MODIFIED,async({segmentationId:a})=>{const r=t.getCustomization("panelSegmentation.disableUpdateSegmentationStats"),i=e.getSegmentation(a);if(!i||r)return;const s=t.getCustomization("panelSegmentation.readableText"),c=Object.keys(i.segments).map(e=>parseInt(e)).filter(e=>e>0);for(const e of c){const t=i.segments[e];t?.cachedStats?.namedStats?.bidirectional&&n.runCommand("runSegmentBidirectional",{segmentationId:a,segmentIndex:e})}const d=await async function({segmentation:e,segmentationId:t,readableText:n}){if(!e)return console.debug("No segmentation found for id:",t),null;const o=Object.keys(e.segments).map(e=>parseInt(e)).filter(e=>e>0);if(0===o.length)return console.debug("No segments found in segmentation:",t),null;const a=await l.utilities.segmentation.getStatistics({segmentationId:t,segmentIndices:o,mode:"individual"});if(!a)return null;const r=En()(e);let i=!1;return Object.entries(a).forEach(([e,t])=>{const o=parseInt(e);r.segments[o].cachedStats||(r.segments[o].cachedStats={},i=!0);const a=r.segments[o].cachedStats.namedStats||{};t.array&&(t.array.forEach(e=>{n[e.name]&&e&&e.name&&(a[e.name]={name:e.name,label:n[e.name],value:e.value,unit:e.unit,order:Object.keys(n).indexOf(e.name)})}),n.volume&&t.volume&&!a.volume&&(a.volume={name:"volume",label:"Volume",value:t.volume.value,unit:t.volume.unit,order:Object.keys(n).indexOf("volume")}),r.segments[o].cachedStats.namedStats=a,i=!0)}),i?r:null}({segmentation:i,segmentationId:a,readableText:s});!o&&d&&e.addOrUpdateSegmentation({segmentationId:a,segments:d.segments})},1e3);return{unsubscribe:()=>{o=!0,a()}}}function Ui({segmentationService:e}){const{unsubscribe:t}=e.subscribe(e.EVENTS.SEGMENTATION_MODIFIED,async({segmentationId:t})=>{const n=e.getSegmentation(t);if(!n)return;const o=l.annotation.state.getAllAnnotations().filter(e=>e.metadata.toolName===l.SegmentBidirectionalTool.toolName),a=Object.keys(n.segments).map(e=>parseInt(e)).filter(e=>e>0),r=o.filter(e=>e.metadata.segmentationId===t&&!a.includes(e.metadata.segmentIndex)),i=r.map(e=>e.annotationUID);i.forEach(e=>{l.annotation.state.removeAnnotation(e)})});return{unsubscribe:t}}const Ai="SEG",xi="SR",Pi="RTSTRUCT",Fi=0,Li=5;function _i(e){switch(e){case Pi:return"promptHydrateRT";case Ai:return"promptHydrateSEG";case xi:return"promptHydrateSR";default:return"promptHydrate"}}const ki={handleSegmentChange:({direction:e,segmentationId:t,viewportId:n,selectedSegmentObjectIndex:o,segmentationService:a})=>{const r=a.getSegmentation(t),{segments:i}=r,s=Object.keys(i).length,l=a.getActiveSegment(n);l&&(o=Object.values(i).findIndex(e=>e.segmentIndex===l.segmentIndex));let c=o+e;c>s-1?c=0:c<0&&(c=s-1);const d=Object.values(i)[c]?.segmentIndex;a.setActiveSegment(t,d),a.jumpToSegmentCenter(t,d,n),o=c},isReferenceViewable:(e,t,n,o)=>{const{cornerstoneViewportService:a,displaySetService:r}=e.services;if(!o){return a.getCornerstoneViewport(t).isReferenceViewable(n,{withNavigation:!0,asVolume:!0})}if("stack"===o.viewportType){return r.getDisplaySetByUID(n.displaySetInstanceUID).instances.map(e=>e.imageId).includes(n.referencedImageId)}const{orientation:i}=o,s=function(e,t){const n=e.getDisplaySetByUID(t),o=n.instances[0].ImageOrientationPatient;if(6!==o?.length)return;const a=ln.eR.fromValues(o[0],o[1],o[2]),r=ln.eR.fromValues(o[3],o[4],o[5]),i=ln.eR.cross(ln.eR.create(),a,r),s={[Vi.AXIAL]:ln.eR.fromValues(0,0,1),[Vi.CORONAL]:ln.eR.fromValues(0,1,0),[Vi.SAGITTAL]:ln.eR.fromValues(1,0,0)};let l=0,c="";for(const[e,t]of Object.entries(s)){const n=Math.abs(ln.eR.dot(i,t));n>l&&(l=n,c=e)}return c}(r,n.displaySetInstanceUID);return s===i},setupSegmentationDataModifiedHandler:Ri,setupSegmentationModifiedHandler:Ui,promptHydrationDialog:function({servicesManager:e,viewportId:t,displaySet:n,preHydrateCallbacks:o=[],hydrateCallback:a,type:r}){const{uiViewportDialogService:i,customizationService:s}=e.services,l=e._extensionManager._appConfig,c="standard"===l?.measurementTrackingMode;return new Promise(async function(d,m){const p=(r===xi?c:!l?.disableConfirmationPrompts)?await function(e,t,n,o){return new Promise(function(a,r){const i=function(e){switch(e){case Pi:return"viewportNotification.hydrateRTMessage";case Ai:return"viewportNotification.hydrateSEGMessage";case xi:return"viewportNotification.hydrateSRMessage";default:return"viewportNotification.hydrateMessage"}}(o),s=t.getCustomization(i),l=[{id:"no-hydrate",type:"secondary",text:"No",value:Fi},{id:"yes-hydrate",type:"primary",text:"Yes",value:Li}],c=t=>{e.hide(),a(t)};e.show({id:_i(o),viewportId:n,type:"info",message:s,actions:l,onSubmit:c,onOutsideClick:()=>{e.hide(),a(Fi)},onKeyPress:e=>{"Enter"===e.key&&c(Li)}})})}(i,s,t,r):Li;if(p===Li){if(o?.forEach(e=>{e()}),r===Ai)window.setTimeout(async()=>{const e=await a({segDisplaySet:n,viewportId:t});d(e)},0);else if(r===Pi){const o=await a({rtDisplaySet:n,viewportId:t,servicesManager:e});d(o)}else if(r===xi){const e=await a(n);d({userResponse:p,displaySetInstanceUID:n.displaySetInstanceUID,srSeriesInstanceUID:n.SeriesInstanceUID,viewportId:t,StudyInstanceUID:e?.StudyInstanceUID,SeriesInstanceUIDs:e?.SeriesInstanceUIDs})}}else d(r===xi&&{userResponse:p,displaySetInstanceUID:n.displaySetInstanceUID,srSeriesInstanceUID:n.SeriesInstanceUID,viewportId:t})})},getCenterExtent:Dn,createSegmentationForViewport:Gn},Gi=ki,zi=({servicesManager:e,commandsManager:t})=>{const{segmentationService:n,customizationService:o,displaySetService:a}=e.services,{unsubscribe:r}=Ri({segmentationService:n,customizationService:o,commandsManager:t}),{unsubscribe:i}=Ui({segmentationService:n}),{unsubscribe:s}=n.subscribe(n.EVENTS.SEGMENTATION_ADDED,e=>{const{segmentationId:t}=e;if(a.getDisplaySetByUID(t))return;const o=n.getSegmentation(t),r=o.cachedStats.info,i=o.representationData?.Labelmap?.imageIds??o.representationData?.Contour?.imageIds,s={displaySetInstanceUID:t,SOPClassUID:"1.2.840.10008.5.1.4.1.1.66.4",SOPClassHandlerId:"@ohif/extension-cornerstone-dicom-seg.sopClassHandlerModule.dicom-seg",SeriesDescription:r,Modality:"SEG",numImageFrames:i.length,imageIds:i,isOverlayDisplaySet:!0,label:r,madeInClient:!0,segmentationId:t,isDerived:!0};a.addDisplaySets(s)}),{unsubscribeSelectedSegmentationsForViewportEvents:l}=function({segmentationService:e}){return{unsubscribeSelectedSegmentationsForViewportEvents:[e.EVENTS.SEGMENTATION_MODIFIED,e.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED].map(t=>e.subscribe(t,t=>{const{viewportId:n}=t;if(!n)return;const{selectedSegmentationsForViewport:o,setSelectedSegmentationsForViewport:a}=Sn.getState(),r=e.getSegmentationRepresentations(n).find(e=>e.active),i=o[n]??new Map;r?i.set(r.type,r.segmentationId):i.clear(),a(n,i)})).map(e=>e.unsubscribe)}}({segmentationService:n});return{unsubscriptions:[r,i,s,...l]}};function Bi(e){const{group:t,classNames:n}=e;if(!t.items?.length)return console.log("No items to iterate",t.items),null;const{items:o}=t,[a]=o,{isSelected:r,isVisible:s}=a,l=(0,p.Jg)(),c=(e,t,n)=>{const a=o.map(e=>e.uid);l.commandsManager.run(t,{...n,uid:a,displayMeasurements:o,items:o,event:e})},[d,m]=(0,i.useState)(!1);return i.createElement("div",{className:`relative ml-2 inline-flex items-center space-x-1 ${n}`},i.createElement(ut.$nd,{size:"icon",variant:"ghost",className:"h-6 w-6 transition-opacity "+(r||!s?"opacity-100":"opacity-50 group-hover:opacity-100"),"aria-label":s?"Hide":"Show",onClick:e=>{e.stopPropagation(),c(e,["jumpToMeasurement","toggleVisibilityMeasurement"])}},s?i.createElement(ut.FI1.Hide,{className:"h-6 w-6"}):i.createElement(ut.FI1.Show,{className:"h-6 w-6"})),i.createElement(ut.rId,{onOpenChange:e=>m(e)},i.createElement(ut.tyb,{asChild:!0},i.createElement(ut.$nd,{size:"icon",variant:"ghost",className:"h-6 w-6 transition-opacity "+(r||d?"opacity-100":"opacity-50 group-hover:opacity-100"),"aria-label":"Actions",onClick:e=>e.stopPropagation()},i.createElement(ut.FI1.More,{className:"h-6 w-6"}))),i.createElement(ut.SQm,{align:"end"},i.createElement(ut._26,{onClick:e=>c(e,"removeMeasurement")},i.createElement(ut.FI1.Delete,{className:"text-foreground"}),i.createElement("span",{className:"pl-2"},"Delete")))))}const $i=Bi;function ji(){return ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ji.apply(null,arguments)}function Wi(e){const{group:t,onClick:n=t?.onClick}=this;if(n)return console.log("onClickDefault"),e.preventDefault(),e.stopPropagation(),n(e,t),!1;console.log("No onClick function",t)}function Hi(e){const{marginLeft:t=8,isActive:n=!1,colorHex:o,count:a,text:r,menu:s=null}=e;return i.createElement(ut.$m7,{style:{marginLeft:`${t}px`,padding:0},asChild:!0},i.createElement("div",{className:`inline-flex text-base ${n?"bg-popover":"bg-muted"} flex-grow`},i.createElement("button",{onClick:Wi.bind(e)},i.createElement("span",{className:"inline-flex rounded-l border-r border-black "+(n?"bg-highlight":"bg-muted")},void 0!==a?i.createElement("span",{className:"px-2"},a):null,o&&i.createElement(ut.cd8,{colorHex:o})),i.createElement("span",null,r)),s&&i.createElement(s,ji({},e,{classNames:"justify-end flex-grow"})),i.createElement(ti.D3D,{className:"text-primary h-4 w-4 shrink-0 transition-transform duration-200"})))}function qi(e){const{index:t,item:n}=e;return i.createElement(Hi,{count:t+1,text:n.toolName||n.label||n.title,colorHex:"#f00",isActive:n.isSelected,menu:$i,group:{items:[n],onClick:e.onClick}})}function Yi(e){const{items:t}=e,n=(0,p.Jg)(),o=(e,t)=>{const{items:o}=t;n.commandsManager.run("jumpToMeasurement",{uid:o[0].uid,displayMeasurements:o,group:t})};return i.createElement(ut.nD3,{type:"multiple",className:"flex-shrink-0 overflow-hidden"},t.map((e,t)=>{const{displayText:n={}}=e;return i.createElement(ut.AsP,{key:`measurementAccordion:${e.uid}`,value:e.uid},i.createElement(qi,{item:e,key:`measurementItem:${e.uid}`,index:t,onClick:o}),i.createElement(ut.ub_,{key:`measurementContent:${e.uid}`},i.createElement("div",{className:"ml-7 px-2 py-2"},i.createElement("div",{className:"text-secondary-foreground flex items-center gap-1 text-base leading-normal"},n.primary?.length>0&&n.primary.map((t,n)=>i.createElement("span",{key:`details:${e.uid}:${n}`},t))))))}))}const Ji=(e,t,n)=>{const o=new Map,{displaySetService:a}=n.servicesManager.services,{activeDisplaySetInstanceUID:r}=t;return e.forEach(e=>{const{displaySetInstanceUID:n}=e;if(!o.has(n)){const e=a.getDisplaySetByUID(n);o.set(n,{header:null,isSelected:n==r,...t,items:[],key:n,title:"Series Measurements",displaySet:e})}o.get(n).items.push(e)}),o};function Ki(e){const{group:t,isSelected:n,displaySet:o,menu:a}=e,{SeriesNumber:r=1,SeriesDescription:s}=o;return i.createElement(Hi,{text:`Series #${r} ${s}`,count:t.items.length,isActive:n,group:t,menu:a,marginLeft:"0"})}function Qi(e){const{items:t,grouping:n={},children:o}=e,a=(0,p.Jg)(),r=(0,p.BZ)(a),s=r?.[0]?.displaySetInstanceUID;return i.createElement(ci,{grouping:{groupingFunction:Ji,activeDisplaySetInstanceUID:s,...n,onClick:(e,t)=>{const{items:n}=t;a.commandsManager.run("jumpToMeasurement",{uid:n[0].uid,displayMeasurements:n,group:t})}},items:t,sourceChildren:o},i.createElement(ci.Trigger,{asChild:!0},i.createElement(Ki,{menu:$i})),i.createElement(Yi,null))}function Zi(){return Zi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Zi.apply(null,arguments)}const{imageRetrieveMetadataProvider:Xi}=s.utilities,es=i.lazy(()=>n.e(147).then(n.bind(n,30147))),ts=e=>i.createElement(i.Suspense,{fallback:i.createElement("div",null,"Loading...")},i.createElement(es,e)),ns={retrieveOptions:{single:{streaming:!0,decodeLevel:1}}},os=[],as={id:Er,onModeEnter:({servicesManager:e,commandsManager:t})=>{const{cornerstoneViewportService:n,toolbarService:o,segmentationService:a}=e.services,{unsubscriptions:r}=zi({servicesManager:e,commandsManager:t});os.push(...r),o.registerEventForToolbarUpdate(n,[n.EVENTS.VIEWPORT_DATA_CHANGED]),o.registerEventForToolbarUpdate(a,[a.EVENTS.SEGMENTATION_REMOVED,a.EVENTS.SEGMENTATION_MODIFIED,a.EVENTS.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED]),o.registerEventForToolbarUpdate(s.eventTarget,[l.Enums.Events.TOOL_ACTIVATED]),Xi.clear(),Xi.add("volume",s.ProgressiveRetrieveImages.interleavedRetrieveStages),Xi.add("stack",ns)},getPanelModule:Ni,onModeExit:({servicesManager:e})=>{os.forEach(e=>e()),os.length=0;const{cineService:t,segmentationService:n}=e.services;Object.values(s.Enums.RequestType).forEach(e=>{s.imageLoadPoolManager.clearRequestStack(e),s.imageRetrievalPoolManager.clearRequestStack(e)}),t.setIsCineEnabled(!1),(0,h.cL)(),at.I.getState().clearLutPresentationStore(),rt.q.getState().clearPositionPresentationStore(),pn.U.getState().clearSynchronizersStore(),f.useToggleOneUpViewportGridStore.getState().clearToggleOneUpViewportGridStore(),it.v.getState().clearSegmentationPresentationStore(),Sn.getState().clearSelectedSegmentationsForViewportStore(),n.removeAllSegmentations()},preRegistration:async function(e){const{servicesManager:t}=e;t.registerService(lr.REGISTRATION),t.registerService(va.REGISTRATION),t.registerService(Ua.REGISTRATION),t.registerService(qa.REGISTRATION),t.registerService(Qa.REGISTRATION),t.registerService(pr.REGISTRATION);const{syncGroupService:n}=t.services;n.registerCustomSynchronizer("frameview",Dr),await ct.call(this,e)},getToolbarModule:function({servicesManager:e,extensionManager:t}){const{toolGroupService:n,toolbarService:o,syncGroupService:a,cornerstoneViewportService:r,colorbarService:i,displaySetService:s,viewportGridService:c,segmentationService:d}=e.services;return[{name:"ohif.advancedRenderingControls",defaultComponent:ma},{name:"evaluate.advancedRenderingControls",evaluate:({viewportId:e})=>{if(!r.getCornerstoneViewport(e))return{disabled:!0};return{disabled:!(i?.hasColorbar(e)||!1)}}},{name:"ohif.colorbar",defaultComponent:ra},{name:"ohif.trackingStatus",defaultComponent:Xo},{name:"evaluate.trackingStatus",evaluate:({viewportId:e})=>{const t=c.getDisplaySetsUIDsForViewport(e);return t?.length?{disabled:!1}:{disabled:!0}}},{name:"ohif.modalityLoadBadge",defaultComponent:Ko},{name:"evaluate.modalityLoadBadge",evaluate:({viewportId:e})=>{const t=c.getDisplaySetsUIDsForViewport(e);if(!t?.length)return{disabled:!0};return{disabled:!t.map(e=>s.getDisplaySetByUID(e)).some(e=>"SR"===e?.Modality||"SEG"===e?.Modality||"RTSTRUCT"===e?.Modality)}}},{name:"ohif.navigationComponent",defaultComponent:Zo},{name:"evaluate.navigationComponent",evaluate:({viewportId:t})=>{const{trackedMeasurementsService:n}=e.services,o=c.getDisplaySetsUIDsForViewport(t);if(!o?.length)return{disabled:!0};const a=o.map(e=>s.getDisplaySetByUID(e)),r=d.getSegmentationRepresentations(t).length>0;if(!n)return{disabled:!r};const i=a.some(e=>e?.SeriesInstanceUID&&n.isSeriesTracked(e.SeriesInstanceUID)),l=a.some(e=>"SR"===e?.Modality);return{disabled:!(r||i||l)}}},{name:"ohif.dataOverlayMenu",defaultComponent:vo},{name:"evaluate.dataOverlayMenu",evaluate:({viewportId:e})=>{if(!r.getCornerstoneViewport(e))return{disabled:!0};const t=c.getDisplaySetsUIDsForViewport(e);return t?.length?{disabled:!1}:{disabled:!0}}},{name:"ohif.orientationMenu",defaultComponent:Eo},{name:"evaluate.orientationMenu",evaluate:({viewportId:e})=>{if(!r.getCornerstoneViewport(e))return{disabled:!0};return{disabled:c.getDisplaySetsUIDsForViewport(e).map(s.getDisplaySetByUID).some(e=>!e?.isReconstructable)}}},{name:"ohif.windowLevelMenu",defaultComponent:Lo},{name:"ohif.voiManualControlMenu",defaultComponent:Bo},{name:"ohif.windowLevelMenuEmbedded",defaultComponent:Lo},{name:"evaluate.windowLevelMenuEmbedded",evaluate:()=>({isEmbedded:!0})},{name:"ohif.thresholdMenu",defaultComponent:Wo},{name:"ohif.opacityMenu",defaultComponent:Yo},{name:"evaluate.windowLevelMenu",evaluate:({viewportId:e})=>{if(!r.getCornerstoneViewport(e))return{disabled:!0};return{disabled:!c.getDisplaySetsUIDsForViewport(e).map(s.getDisplaySetByUID).some(e=>e?.supportsWindowLevel),hasEmbeddedVariantToUse:!!o.isInAnySection("windowLevelMenuEmbedded")}}},{name:"evaluate.voiManualControlMenu",evaluate:({viewportId:e})=>{if(!r.getCornerstoneViewport(e))return{disabled:!0};return{disabled:!c.getDisplaySetsUIDsForViewport(e).map(s.getDisplaySetByUID).some(e=>e?.supportsWindowLevel)}}},{name:"evaluate.thresholdMenu",evaluate:({viewportId:e})=>{const t=r.getCornerstoneViewport(e);if(!t)return{disabled:!0};if("orthographic"!==t.type)return{disabled:!0};return c.getDisplaySetsUIDsForViewport(e).length?{disabled:!1}:{disabled:!0}}},{name:"evaluate.opacityMenu",evaluate:({viewportId:e})=>{const t=r.getCornerstoneViewport(e);if(!t||"orthographic"!==t.type)return{disabled:!0};const n=c.getDisplaySetsUIDsForViewport(e);if(n.length<=1)return{disabled:!0};return{disabled:n.map(s.getDisplaySetByUID).some(e=>e?.isOverlayDisplaySet)}}},{name:"evaluate.viewport.supported",evaluate:({viewportId:e,unsupportedViewportTypes:t,disabledText:n})=>{const o=r.getCornerstoneViewport(e);if(o&&t?.includes(o.type))return pa(n)}},{name:"evaluate.modality.supported",evaluate:({viewportId:e,unsupportedModalities:t,supportedModalities:n,disabledText:o})=>{const a=c.getDisplaySetsUIDsForViewport(e);if(!a?.length)return;const r=a.map(s.getDisplaySetByUID);if(t?.length){if(r.some(e=>t.includes(e?.Modality)))return pa(o)}if(n?.length){if(!r.some(e=>n.includes(e?.Modality)))return pa(o||"Tool not available for this modality")}}},{name:"evaluate.cornerstoneTool",evaluate:({viewportId:e,button:t,toolNames:a,disabledText:r})=>{const i=n.getToolGroupForViewport(e);if(!i)return;const s=o.getToolNameForButton(t);if(!i||!i.hasTool(s)&&!a)return pa(r);return{disabled:!1,isActive:a?a.includes(i.getActivePrimaryMouseButtonTool()):i.getActivePrimaryMouseButtonTool()===s}}},{name:"evaluate.action",evaluate:()=>({disabled:!1})},{name:"evaluate.cornerstoneTool.toggle.ifStrictlyDisabled",evaluate:({viewportId:e,button:t,disabledText:a})=>ua({viewportId:e,button:t,toolbarService:o,disabledText:a,offModes:[l.Enums.ToolModes.Disabled],toolGroupService:n})},{name:"evaluate.cornerstoneTool.toggle",evaluate:({viewportId:e,button:t,disabledText:a})=>ua({viewportId:e,button:t,toolbarService:o,disabledText:a,offModes:[l.Enums.ToolModes.Disabled,l.Enums.ToolModes.Passive],toolGroupService:n})},{name:"evaluate.cornerstone.synchronizer",evaluate:({viewportId:e,button:t})=>{let n=a.getSynchronizersForViewport(e);if(!n?.length||n.length<=1)return{className:ut.WpD.getToggledClassName(!1)};const o=Array.isArray(t.props?.commands)?t.props?.commands?.[0].commandOptions.type:t.props?.commands?.commandOptions.type;if(n=a.getSynchronizersOfType(o),!n?.length)return{className:ut.WpD.getToggledClassName(!1)};const r=n[0],i=r?._enabled;return{className:ut.WpD.getToggledClassName(i)}}},{name:"evaluate.viewportProperties.toggle",evaluate:({viewportId:e,button:t})=>{const n=r.getCornerstoneViewport(e);if(!n||n.isDisabled)return;const o=t.id,a=n.getProperties(),i=n.getCamera(),s=i?.[o]||a?.[o];if(!s)return{disabled:!1};const l=s;return{className:ut.WpD.getToggledClassName(l)}}},{name:"evaluate.displaySetIsReconstructable",evaluate:({viewportId:e,disabledText:t="Selected viewport is not reconstructable"})=>{if(!r.getCornerstoneViewport(e))return;return c.getDisplaySetsUIDsForViewport(e).map(s.getDisplaySetByUID).every(e=>e?.isReconstructable)?{disabled:!1}:pa(t)}}]},getHangingProtocolModule:mo,getViewportModule:({servicesManager:e,commandsManager:t})=>[{name:"cornerstone",component:n=>{const{toolbarService:o}=e.services;return i.createElement(ts,Zi({},n,{toolbarService:o,servicesManager:e,commandsManager:t}))},isReferenceViewable:Gi.isReferenceViewable.bind(null,e)}],getCommandsModule:Zn,getCustomizationModule:an,getUtilityModule:({servicesManager:e})=>[{name:"common",exports:{getCornerstoneLibraries:()=>({cornerstone:s,cornerstoneTools:l}),getEnabledElement:h.kJ,dicomLoaderService:wr}},{name:"core",exports:{Enums:s.Enums}},{name:"tools",exports:{toolNames:A,Enums:l.Enums}},{name:"volumeLoader",exports:{getDynamicVolumeInfo:st.getDynamicVolumeInfo}}],getSopClassHandlerModule:function(e){return[xr(e)]}},rs=as},71353:(e,t,n)=>{n.d(t,{cL:()=>i,kJ:()=>r,ye:()=>a});const o={DEFAULT_CONTEXT:"CORNERSTONE",enabledElements:{}},a=(e,t,n)=>{const a=n||o.DEFAULT_CONTEXT;o.enabledElements[e]={element:t,context:a}},r=e=>o.enabledElements[e],i=()=>{o.enabledElements={}}},46026:(e,t,n)=>{n.d(t,{FG:()=>o,H7:()=>r,gS:()=>a});const o="&",a="default",r=(e,t,n,a)=>{if(e.push(0),!a)for(let a=0;a<128;a++){e[e.length-1]=a;const r=e.join(o);if(!Array.from(n.values()).find(e=>e.viewportOptions?.presentationIds?.[t]===r))break}}},10182:(e,t,n)=>{n.d(t,{I:()=>l});var o=n(78713),a=(n(21978),n(46026));const r="lutPresentationId",i=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o})=>{if(e!==r)return;if(!t||!t.viewportOptions||!t.displaySetInstanceUIDs?.length)return;const{displaySetOptions:i,displaySetInstanceUIDs:s}=t,l=[(e=>{if(!e||!e.options)return a.gS;if(e.options.id)return e.options.id;const t=Object.entries(e.options).map(([e,t])=>`${e}=${t}`);return t.length?t.join(a.FG):a.gS})(i[0])];for(const e of s)l.push(e);return(0,a.H7)(l,r,n,o),l.join(a.FG)},s=e=>({type:r,lutPresentationStore:{},setLutPresentation:(t,n)=>e(e=>({lutPresentationStore:{...e.lutPresentationStore,[t]:n}}),!1,"setLutPresentation"),clearLutPresentationStore:()=>e({lutPresentationStore:{}},!1,"clearLutPresentationStore"),getPresentationId:i}),l=(0,o.vt)()(s)},44646:(e,t,n)=>{n.d(t,{q:()=>c});var o=n(78713),a=(n(21978),n(46026));const r="positionPresentationId",i=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o})=>{if(e===r&&t?.viewportOptions&&t.displaySetInstanceUIDs?.length)return s(t,n,o)};function s(e,t,n){const{viewportOptions:o={},displaySetInstanceUIDs:i=[],displaySetOptions:s=[]}=e,{id:l,orientation:c}=o,d=[c||"acquisition"];l&&d.push(l),s?.some(e=>e.options?.blendMode||e.options?.displayPreset)&&d.push("custom");for(const e of i)d.push(e);return t&&t.length&&void 0!==n?(0,a.H7)(d,r,t,n):d.push(0),d.join(a.FG)}const l=e=>({type:r,positionPresentationStore:{},setPositionPresentation:(t,n)=>e(e=>({positionPresentationStore:{...e.positionPresentationStore,[t]:n}}),!1,"setPositionPresentation"),clearPositionPresentationStore:()=>e({positionPresentationStore:{}},!1,"clearPositionPresentationStore"),getPresentationId:i,getPositionPresentationId:s}),c=(0,o.vt)()(l)},2847:(e,t,n)=>{n.d(t,{v:()=>m});var o=n(78713),a=(n(21978),n(46026)),r=n(15327);const{MPR_CAMERA_VALUES:i}=r.CONSTANTS,s="segmentationPresentationId",l=(e,{viewport:t,viewports:n,isUpdatingSameViewport:o,servicesManager:a})=>{if(e===s)return c({viewport:t,servicesManager:a})},c=({viewport:e,servicesManager:t})=>{if(!e?.viewportOptions||!e.displaySetInstanceUIDs?.length)return;const{displaySetInstanceUIDs:n,viewportOptions:o}=e;let s=o.orientation;if(!s){const e=t.services.displaySetService.getDisplaySetByUID(n[0]),o=e.images?.[0],a=o?.ImageOrientationPatient;s=(e=>{if(!e||6!==e.length)return;const t=e.slice(0,3),n=e.slice(3,6),o=[-n[0],-n[1],-n[2]];return r.utilities.isEqual(t,i.axial.viewRight)&&r.utilities.isEqual(o,i.axial.viewUp)?"axial":r.utilities.isEqual(t,i.sagittal.viewRight)&&r.utilities.isEqual(o,i.sagittal.viewUp)?"sagittal":r.utilities.isEqual(t,i.coronal.viewRight)&&r.utilities.isEqual(o,i.coronal.viewUp)?"coronal":void 0})(a)}const l=[];return l.push(...n),l.join(a.FG)},d=e=>({type:s,segmentationPresentationStore:{},clearSegmentationPresentationStore:()=>e({segmentationPresentationStore:{}},!1,"clearSegmentationPresentationStore"),addSegmentationPresentationItem:(t,n)=>e(e=>({segmentationPresentationStore:{...e.segmentationPresentationStore,[t]:[...e.segmentationPresentationStore[t]||[],n]}}),!1,"addSegmentationPresentationItem"),setSegmentationPresentation:(t,n)=>e(e=>({segmentationPresentationStore:{...e.segmentationPresentationStore,[t]:n}}),!1,"setSegmentationPresentation"),getPresentationId:l,getSegmentationPresentationId:c}),m=(0,o.vt)()(d)},68578:(e,t,n)=>{n.d(t,{U:()=>r});var o=n(78713);n(21978);const a=e=>({synchronizersStore:{},type:"synchronizersStoreId",setSynchronizers:(t,n)=>{e(e=>({synchronizersStore:{...e.synchronizersStore,[t]:n}}),!1,"setSynchronizers")},clearSynchronizersStore:()=>{e({synchronizersStore:{}},!1,"clearSynchronizersStore")}}),r=(0,o.vt)()(a)}}]);
//# sourceMappingURL=7948.bundle.05c7936fe9cb99d50384.js.map