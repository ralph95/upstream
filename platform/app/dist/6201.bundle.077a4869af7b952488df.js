"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6201,8402],{82098:(e,n,t)=>{t.r(n),t.d(n,{default:()=>g});const a=JSON.parse('{"UU":"@ohif/extension-cornerstone-dicom-pmap"}').UU,r=`${a}.sopClassHandlerModule.dicom-pmap`;var s=t(86326),o=t(42356),i=t(68523),c=t(15327),l=t(53434),d=t(37948);const u=["1.2.840.10008.5.1.4.1.1.30"];function p(e,n,t){const a=e[0],{StudyInstanceUID:s,SeriesInstanceUID:p,SOPInstanceUID:m,SeriesDescription:I,SeriesNumber:f,SeriesDate:D,SOPClassUID:g,wadoRoot:U,wadoUri:y,wadoUriRoot:h}=a,v={Modality:"PMAP",isReconstructable:!0,displaySetInstanceUID:`pmap.${o.Wp.guid()}`,SeriesDescription:I,SeriesNumber:f,SeriesDate:D,SOPInstanceUID:m,SeriesInstanceUID:p,StudyInstanceUID:s,SOPClassHandlerId:r,SOPClassUID:g,referencedImages:null,referencedSeriesInstanceUID:null,referencedDisplaySetInstanceUID:null,referencedVolumeURI:null,referencedVolumeId:null,isDerivedDisplaySet:!0,loadStatus:{loading:!1,loaded:!1},sopClassUids:u,instance:a,instances:[a],wadoRoot:U,wadoUriRoot:h,wadoUri:y,supportsWindowLevel:!0,label:I||`${i.A.t("Series")} ${f} - ${i.A.t("PMAP")}`},w=a.ReferencedSeriesSequence;if(!w)return void console.error("ReferencedSeriesSequence is missing for the parametric map");const M=w[0]||w;return v.referencedImages=a.ReferencedSeriesSequence.ReferencedInstanceSequence,v.referencedSeriesInstanceUID=M.SeriesInstanceUID,v.getReferenceDisplaySet=()=>{const{displaySetService:e}=n.services;if(v.referencedDisplaySetInstanceUID)return e.getDisplaySetByUID(v.referencedDisplaySetInstanceUID);const t=e.getDisplaySetsForSeries(v.referencedSeriesInstanceUID);if(!t||0===t.length)throw new Error("Referenced displaySet is missing for the parametric map");const a=t[0];return v.referencedDisplaySetInstanceUID=a.displaySetInstanceUID,a},v.getReferencedVolumeId=()=>{if(v.referencedVolumeId)return v.referencedVolumeId;const e=v.getReferenceDisplaySet().displaySetInstanceUID,n=`${d.VOLUME_LOADER_SCHEME}:${e}`;return v.referencedVolumeURI=e,v.referencedVolumeId=n,n},v.load=async({headers:e})=>await async function(e,n,t,a){const r=`${d.VOLUME_LOADER_SCHEME}:${e.displaySetInstanceUID}`,s=c.cache.getVolumeLoadObject(r);if(s)return s.promise;e.loading=!0,e.isLoaded=!1;const o=async function({displaySet:e,headers:n}){const t=await d.dicomLoaderService.findDicomDataPromise(e,null,n),a=e.getReferencedVolumeId(),r=c.cache.getVolume(a);if(!r)throw new Error("Referenced Volume is missing for the PMAP, and stack viewport PMAP is not supported yet");const{imageIds:s}=r,o=await l.X6.Cornerstone3D.ParametricMap.generateToolState(s,t,c.metaData),{pixelData:i}=o,u=i.constructor,p=e.displaySetInstanceUID,m=await c.volumeLoader.createAndCacheDerivedVolume(a,{volumeId:p,targetBuffer:{type:u.name}}),I=new u(i.length);for(let e=0;e<i.length;e++)I[e]=100*i[e];m.voxelManager.setCompleteScalarDataArray(I);const f=S(I),D=c.utilities.windowLevel.toWindowLevel(f[0],f[1]);return m.metadata.voiLut=[D],m.loadStatus={loaded:!0},m}({extensionManager:t,displaySet:e,headers:a});return c.cache.putVolumeLoadObject(r,{promise:o}).catch(e=>{throw e}),o.then(()=>{e.loading=!1,e.isLoaded=!0,n.services.segmentationService._broadcastEvent(n.services.segmentationService.EVENTS.SEGMENTATION_LOADING_COMPLETE,{pmapDisplaySet:e})}).catch(n=>{throw e.loading=!1,e.isLoaded=!1,n}),o}(v,n,t,e),[v]}const S=e=>{let n=e[0],t=e[0];for(let a=1;a<e.length;a++)e[a]<n&&(n=e[a]),e[a]>t&&(t=e[a]);return[n,t]};const m=function(e){const{servicesManager:n,extensionManager:t}=e;return[{name:"dicom-pmap",sopClassUids:u,getDisplaySetsFromSeries:e=>p(e,n,t)}]};function I(){return I=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},I.apply(null,arguments)}const f=s.lazy(()=>t.e(4202).then(t.bind(t,74202))),D=e=>s.createElement(s.Suspense,{fallback:s.createElement("div",null,"Loading...")},s.createElement(f,e)),g={id:a,getViewportModule:({servicesManager:e,extensionManager:n,commandsManager:t})=>[{name:"dicom-pmap",component:a=>s.createElement(D,I({servicesManager:e,extensionManager:n,commandsManager:t},a))}],getSopClassHandlerModule:m}}}]);
//# sourceMappingURL=6201.bundle.077a4869af7b952488df.js.map