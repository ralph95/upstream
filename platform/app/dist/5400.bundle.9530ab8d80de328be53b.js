"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5400],{18262:(t,e,n)=>{n.d(e,{A:()=>h});var i=n(85204),a=n(15327);const o="viewport-element";function s(t,e){if(i.wk.svgNodeCache[t])return i.wk.svgNodeCache[t][e]?i.wk.svgNodeCache[t][e].domRef:void 0}function r(t,e,n,a){if(!i.wk.svgNodeCache[e])return null;i.wk.svgNodeCache[e][a]={touched:!0,domRef:n},t.appendChild(n)}function l(t,e){i.wk.svgNodeCache[t]&&i.wk.svgNodeCache[t][e]&&(i.wk.svgNodeCache[t][e].touched=!0)}function d(t,e){i.wk.svgNodeCache[e]&&Object.keys(i.wk.svgNodeCache[e]).forEach(n=>{const a=i.wk.svgNodeCache[e][n];!a.touched&&a.domRef&&(t.removeChild(a.domRef),delete i.wk.svgNodeCache[e][n])})}const c=function(t){const e=(0,a.getEnabledElement)(t),{viewportId:n,renderingEngineId:c}=e,h=`${n}:${c}`,u=function(t){const e=`.${o}`,n=t.querySelector(e),i=n?.querySelector(":scope > .svg-layer");return i}(t);return Object.keys(i.wk.svgNodeCache[h]).forEach(t=>{i.wk.svgNodeCache[h][t].touched=!1}),{svgLayerElement:u,svgNodeCacheForCanvas:i.wk.svgNodeCache,getSvgNode:s.bind(this,h),appendNode:r.bind(this,u,h),setNodeTouched:l.bind(this,h),clearUntouched:d.bind(this,u,h)}};const h=function(t,e){const n=c(t);e(n),n.clearUntouched()}},12004:(t,e,n)=>{n.d(e,{A:()=>s});var i=n(97181),a=n(85899),o=n(56442);const s=function(t,e,n,s,r,l={},d=""){const{color:c,fill:h,width:u,lineWidth:g,lineDash:m,fillOpacity:v,strokeOpacity:p}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},l),f=g||u,w=(0,i.A)(e,"circle",n),I=t.getSvgNode(w),S={cx:`${s[0]}`,cy:`${s[1]}`,r:`${r}`,stroke:c,fill:h,"stroke-width":f,"stroke-dasharray":m,"fill-opacity":v,"stroke-opacity":p};if(I)(0,a.A)(S,I),t.setNodeTouched(w);else{const e=document.createElementNS("http://www.w3.org/2000/svg","circle");""!==d&&e.setAttribute("data-id",d),(0,o.A)(S,e),t.appendNode(e,w)}}},56745:(t,e,n)=>{n.d(e,{A:()=>a});var i=n(94042);const a=function(t,e,n,a,o={}){a.forEach((a,s)=>{(0,i.A)(t,e,n,a,o,s)})}},1595:(t,e,n)=>{n.d(e,{A:()=>r});var i=n(26290),a=n(92118),o=n(90554);const s=function(t,e,n,i,s,r,l={}){const d=i.length>0?(0,o.A)(i,s):s,c=function(t){const{x:e,y:n,height:i,width:a}=t,o=a/2,s=i/2;return[[e+o,n],[e,n+s],[e+o,n+i],[e+a,n+s]]}(r),h=(0,o.A)(c,d),u=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},l);(0,a.A)(t,e,`link-${n}`,d,h,u)};const r=function(t,e,n,a,o,r,l,d={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},d),h=(0,i.A)(t,e,n,a,o,c);return s(t,e,n,r,o,h,c),h}},97530:(t,e,n)=>{n.d(e,{A:()=>a});n(97181);var i=n(75076);function a(t,e,n,a,o,s={},r=""){const l=[a[0],a[1]],d=[o[0],a[1]],c=[a[0],o[1]],h=[o[0],o[1]];(0,i.A)(t,e,n,[l,d,c,h],s,r)}},92686:(t,e,n)=>{n.d(e,{Y:()=>r});var i=n(67772),a=n(53486),o=n(99737),s=n(15327);const r=new class{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(t,e){const{viewportId:n,segmentationId:i,type:a,segmentIndex:o}=t,s=this.getStyle(t);let r;if(r=n||i?this.copyActiveToInactiveIfNotProvided({...s,...e},a):{...s,...e},!a)throw new Error("Type is required to set a style");if(n){this.config.viewportsStyle[n]||(this.config.viewportsStyle[n]={renderInactiveSegmentations:!1,representations:{}});const t=this.config.viewportsStyle[n].representations;if(i){t[i]||(t[i]={}),t[i][a]||(t[i][a]={});const e=t[i][a];void 0!==o?(e.perSegment||(e.perSegment={}),e.perSegment[o]=r):e.allSegments=r}else{const e="__allSegmentations__";t[e]||(t[e]={}),t[e][a]||(t[e][a]={}),t[e][a].allSegments=r}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][a]||(this.config.segmentations[i][a]={});const t=this.config.segmentations[i][a];void 0!==o?(t.perSegment||(t.perSegment={}),t.perSegment[o]=r):t.allSegments=r}else this.config.global[a]=r}copyActiveToInactiveIfNotProvided(t,e){const n={...t};if(e===o.SegmentationRepresentations.Labelmap){const t=n;t.renderOutlineInactive??=t.renderOutline,t.outlineWidthInactive??=t.outlineWidth,t.renderFillInactive??=t.renderFill,t.fillAlphaInactive??=t.fillAlpha,t.outlineOpacityInactive??=t.outlineOpacity}else if(e===o.SegmentationRepresentations.Contour){const t=n;t.outlineWidthInactive??=t.outlineWidth,t.outlineOpacityInactive??=t.outlineOpacity,t.outlineDashInactive??=t.outlineDash,t.renderOutlineInactive??=t.renderOutline,t.renderFillInactive??=t.renderFill,t.fillAlphaInactive??=t.fillAlpha}return n}getStyle(t){const{viewportId:e,segmentationId:n,type:i,segmentIndex:a}=t;let o=this.getDefaultStyle(i),s=!1;if(this.config.global[i]&&(o={...o,...this.config.global[i]}),this.config.segmentations[n]?.[i]&&(o={...o,...this.config.segmentations[n][i].allSegments},void 0!==a&&this.config.segmentations[n][i].perSegment?.[a]&&(o={...o,...this.config.segmentations[n][i].perSegment[a]})),e&&this.config.viewportsStyle[e]){s=this.config.viewportsStyle[e].renderInactiveSegmentations;const t="__allSegmentations__";this.config.viewportsStyle[e].representations[t]?.[i]&&(o={...o,...this.config.viewportsStyle[e].representations[t][i].allSegments}),n&&this.config.viewportsStyle[e].representations[n]?.[i]&&(o={...o,...this.config.viewportsStyle[e].representations[n][i].allSegments},void 0!==a&&this.config.viewportsStyle[e].representations[n][i].perSegment?.[a]&&(o={...o,...this.config.viewportsStyle[e].representations[n][i].perSegment[a]}))}return o}getRenderInactiveSegmentations(t){return this.config.viewportsStyle[t]?.renderInactiveSegmentations}setRenderInactiveSegmentations(t,e){this.config.viewportsStyle[t]||(this.config.viewportsStyle[t]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[t].renderInactiveSegmentations=e}getDefaultStyle(t){switch(t){case o.SegmentationRepresentations.Labelmap:return(0,a.A)();case o.SegmentationRepresentations.Contour:return(0,i.A)();case o.SegmentationRepresentations.Surface:return{};default:throw new Error(`Unknown representation type: ${t}`)}}clearSegmentationStyle(t){this.config.segmentations[t]&&delete this.config.segmentations[t]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(t){this.config.viewportsStyle[t]&&delete this.config.viewportsStyle[t]}clearAllViewportStyles(){for(const t in this.config.viewportsStyle){const e=this.config.viewportsStyle[t].renderInactiveSegmentations;this.config.viewportsStyle[t]={renderInactiveSegmentations:e,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(t){const{type:e}=t,n=this.getStyle(t),i=this.getDefaultStyle(e);return!s.utilities.deepEqual(n,i)}}},98798:(t,e,n)=>{n.d(e,{Q:()=>s});var i=n(15327),a=n(99737),o=n(64063);function s(t,e,n){const s={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:n};(0,o.HM)(t),(0,i.triggerEvent)(i.eventTarget,a.Events.SEGMENTATION_DATA_MODIFIED,s)}},67165:(t,e,n)=>{n.d(e,{T:()=>a});var i=n(59475);function a(t){return i._6.getActiveSegmentation(t)}},33658:(t,e,n)=>{n.d(e,{I:()=>a});var i=n(59475);function a(t,e){return i._6.getSegmentationRepresentationVisibility(t,e)}},44188:(t,e,n)=>{n.d(e,{A:()=>o});var i=n(33283),a=n(18682);const o=function({segmentationId:t,type:e,data:n}){const o=(0,i.T)(t);if(!o)throw new Error(`Segmentation ${t} not found`);switch(o.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case a.A.Labelmap:case a.A.Contour:case a.A.Surface:n&&(o.representationData[e]=n);break;default:throw new Error(`Invalid representation type ${e}`)}}},65136:(t,e,n)=>{n.d(e,{A:()=>o});var i=n(15327),a=n(85204);const o=function(t,e){e||(e=(0,i.getRenderingEngines)().find(e=>e.getViewports().find(e=>e.id===t))?.id);const n=a.wk.toolGroups.filter(n=>n.viewportsInfo.some(n=>n.renderingEngineId===e&&(!n.viewportId||n.viewportId===t)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only\n      have one tool group per viewport in a renderingEngine.`);return n[0]}}},37590:(t,e,n)=>{n.d(e,{A:()=>r});var i=n(15327),a=n(49906),o=n(28220);class s extends o.A{static{this.toolName="PlanarFreehandContourSegmentationTool"}constructor(t){super(i.utilities.deepMerge({configuration:{calculateStats:!1,allowOpenContours:!1}},t))}isContourSegmentationTool(){return!0}renderAnnotationInstance(t){const e=t.annotation,{invalidated:n}=e,i=super.renderAnnotationInstance(t);if(n){const{segmentationId:t}=e.data.segmentation;(0,a.triggerSegmentationDataModified)(t)}return i}}const r=s},28220:(t,e,n)=>{n.d(e,{A:()=>k});n(85817);var i=n(15327),a=n(3823),o=n(4096),s=n(95527),r=n(13165),l=n(27730),d=n(60810),c=n(58640),h=n(55927),u=n(92400),g=n(57999),m=n(69855),v=n(70734),p=n(58161),f=n(44049),w=n(74347),I=n(473),S=n(92984),C=n(18990),E=n(73262),y=n(93843),b=n(36320),D=n(99737),T=n(40634);const{pointCanProjectOnLine:A}=s.polyline,{EPSILON:M}=i.CONSTANTS,x=1-M;class _ extends b.A{static{this.toolName="PlanarFreehandROI"}constructor(t={},e={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:D.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:N,statsCalculator:E.BasicStatsCalculator}}){super(t,e),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=t=>{const e=t.detail,{element:n}=e,i=this.createAnnotation(t);this.addAnnotation(i,n);const a=(0,d.getViewportIdsWithToolToRender)(n,this.getToolName());return this.activateDraw(t,i,a),t.preventDefault(),(0,c.A)(a),i},this.handleSelectedCallback=(t,e,n)=>{const i=t.detail,{element:a}=i,o=(0,d.getViewportIdsWithToolToRender)(a,this.getToolName());this.activateOpenContourEndEdit(t,e,o,n)},this.toolSelectedCallback=(t,e)=>{const n=t.detail,{element:i}=n,a=(0,d.getViewportIdsWithToolToRender)(i,this.getToolName());e.data.contour.closed?this.activateClosedContourEdit(t,e,a):this.activateOpenContourEdit(t,e,a),t.preventDefault()},this.isPointNearTool=(t,e,n,a)=>{const o=(0,i.getEnabledElement)(t),{viewport:s}=o,{polyline:r}=e.data.contour;let l=s.worldToCanvas(r[0]);for(let t=1;t<r.length;t++){const e=l,i=s.worldToCanvas(r[t]);if(A(n,e,i,a))return!0;l=i}if(!e.data.contour.closed)return!1;const d=s.worldToCanvas(r[0]),c=s.worldToCanvas(r[r.length-1]);return A(n,d,c,a)},this.cancel=t=>{const e=this.isDrawing,n=this.isEditingOpen,i=this.isEditingClosed;e?this.cancelDrawing(t):n?this.cancelOpenContourEdit(t):i&&this.cancelClosedContourEdit(t)},this._calculateCachedStats=(t,e,n,r)=>{const{data:l}=t,{cachedStats:d}=l,{polyline:c,closed:h}=l.contour,u=Object.keys(d);for(let n=0;n<u.length;n++){const r=u[n],g=this.getTargetImageData(r);if(!g)continue;const{imageData:m,metadata:v}=g,p=c.map(t=>e.worldToCanvas(t)),f={isPreScaled:(0,C.u)(e,r),isSuvScaled:this.isSuvScaled(e,r,t.metadata.referencedImageId)},w=(0,T.j)(v.Modality,t.metadata.referencedImageId,f),I=(0,o.Op)(g,()=>{const t=l.contour.polyline,n=t.length,a=new Array(n);for(let i=0;i<n;i++)a[i]=e.worldToCanvas(t[i]);const{maxX:o,maxY:r,minX:d,minY:c}=s.polyline.getAABB(a),h=e.canvasToWorld([d,c]),u=i.utilities.transformWorldToIndex(m,h),g=e.canvasToWorld([o,r]);return[u,i.utilities.transformWorldToIndex(m,g)]}),S=p[0],E=e.canvasToWorld(S),y=e.canvasToWorld([S[0]+1,S[1]]),b=e.canvasToWorld([S[0],S[1]+1]),D=a.eR.distance(E,y),A=a.eR.distance(E,b);h?this.updateClosedCachedStats({targetId:r,viewport:e,canvasCoordinates:p,points:c,imageData:m,metadata:v,cachedStats:d,modalityUnit:w,calibratedScale:I,deltaInX:D,deltaInY:A}):this.updateOpenCachedStats({metadata:v,targetId:r,cachedStats:d,modalityUnit:w,calibratedScale:I,points:c})}const g=t.invalidated;return t.invalidated=!1,g&&(0,f.triggerAnnotationModified)(t,r.viewport.element,D.ChangeTypes.StatsUpdated),d},this._renderStats=(t,e,n,i)=>{const{data:a}=t,o=this.getTargetId(e),s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id,annotationUID:t.annotationUID},r=this.getLinkedTextBoxStyle(s,t);if(!r.visibility)return;const l=this.configuration.getTextLines(a,o);if(!l||0===l.length)return;const d=a.contour.polyline.map(t=>e.worldToCanvas(t));if(!a.handles.textBox.hasMoved){const t=(0,I.getTextBoxCoordsCanvas)(d);a.handles.textBox.worldPosition=e.canvasToWorld(t)}const c=e.worldToCanvas(a.handles.textBox.worldPosition),h=(0,w.drawLinkedTextBox)(i,t.annotationUID??"","1",l,c,d,{},r),{x:u,y:g,width:m,height:v}=h;a.handles.textBox.worldBoundingBox={topLeft:e.canvasToWorld([u,g]),topRight:e.canvasToWorld([u+m,g]),bottomLeft:e.canvasToWorld([u,g+v]),bottomRight:e.canvasToWorld([u+m,g+v])}},(0,h.A)(this),(0,u.A)(this),(0,g.A)(this),(0,m.A)(this),(0,v.A)(this),(0,p.A)(this),this._throttledCalculateCachedStats=(0,l.A)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(t,e){if(!e||!e.length)return;const n=(0,i.getEnabledElement)(t),{viewport:a}=n;let o;if(a instanceof i.VolumeViewport){const t=a.getCamera(),{spacingInNormalDirection:n}=i.utilities.getTargetVolumeAndSpacingInNormalDir(a,t);o=this.filterAnnotationsWithinSlice(e,t,n)}else o=(0,r.filterAnnotationsForDisplay)(a,e);return o}filterAnnotationsWithinSlice(t,e,n){const{viewPlaneNormal:o}=e,s=t.filter(t=>{let n=t.metadata.viewPlaneNormal;if(!t.metadata.referencedImageId&&!n&&t.metadata.FrameOfReferenceUID){for(const n of t.data.contour.polyline){const t=a.eR.sub(a.eR.create(),n,e.focalPoint),o=a.eR.dot(t,e.viewPlaneNormal);if(!i.utilities.isEqual(o,0))return!1}return t.metadata.viewPlaneNormal=e.viewPlaneNormal,t.metadata.cameraFocalPoint=e.focalPoint,!0}if(!n){const{referencedImageId:e}=t.metadata,{imageOrientationPatient:o}=i.metaData.get("imagePlaneModule",e),s=a.eR.fromValues(o[0],o[1],o[2]),r=a.eR.fromValues(o[3],o[4],o[5]);n=a.eR.create(),a.eR.cross(n,s,r),t.metadata.viewPlaneNormal=n}const s=Math.abs(a.eR.dot(o,n))>x;return n&&s});if(!s.length)return[];const r=n/2,{focalPoint:l}=e,d=[];for(const t of s){const e=t.data.contour.polyline[0];if(!t.isVisible)continue;const n=a.eR.create();a.eR.sub(n,l,e);const i=a.eR.dot(n,o);Math.abs(i)<r&&d.push(t)}return d}isContourSegmentationTool(){return!1}createAnnotation(t){const e=t.detail.currentPoints.world,n=super.createAnnotation(t);return i.utilities.deepMerge(n,{data:{contour:{polyline:[[...e]]},label:"",cachedStats:{}},onInterpolationComplete:t=>{t.data.handles.points.length=0}})}getAnnotationStyle(t){return super.getAnnotationStyle(t)}renderAnnotationInstance(t){const{enabledElement:e,targetId:n,svgDrawingHelper:i}=t,a=t.annotation;let o=!1;const{viewport:s,renderingEngine:r}=e,l=this.isDrawing,d=this.isEditingOpen,c=this.isEditingClosed;if(l||d||c){const t=this.commonData.annotation.annotationUID;if(a.annotationUID===t)if(l)this.renderContourBeingDrawn(e,i,a);else if(c)this.renderClosedContourBeingEdited(e,i,a);else{if(!d)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(e,i,a)}else this.configuration.displayOnePointAsCrosshairs&&1===a.data.contour.polyline.length?this.renderPointContourWithMarker(e,i,a):this.renderContour(e,i,a);o=!0}else this.configuration.displayOnePointAsCrosshairs&&1===a.data.contour.polyline.length?this.renderPointContourWithMarker(e,i,a):this.renderContour(e,i,a);if(this.configuration.calculateStats)return this._calculateStatsIfActive(a,n,s,r,e),this._renderStats(a,s,e,i),o}_calculateStatsIfActive(t,e,n,i,a){const o=this.commonData?.annotation.annotationUID;if((t.annotationUID!==o||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:o}=t;o.cachedStats[e]?.unit?t.invalidated&&this._throttledCalculateCachedStats(t,n,i,a):(o.cachedStats[e]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,unit:null},this._calculateCachedStats(t,n,i,a))}}updateClosedCachedStats({viewport:t,points:e,imageData:n,metadata:a,cachedStats:o,targetId:r,modalityUnit:l,canvasCoordinates:d,calibratedScale:c,deltaInX:h,deltaInY:u}){const{scale:g,areaUnit:m,unit:v}=c,{voxelManager:p}=t.getImageData(),f=i.utilities.transformWorldToIndex(n,e[0]);f[0]=Math.floor(f[0]),f[1]=Math.floor(f[1]),f[2]=Math.floor(f[2]);let w=f[0],I=f[0],C=f[1],E=f[1],b=f[2],D=f[2];for(let t=1;t<e.length;t++){const a=i.utilities.transformWorldToIndex(n,e[t]);a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.floor(a[2]),w=Math.min(w,a[0]),I=Math.max(I,a[0]),C=Math.min(C,a[1]),E=Math.max(E,a[1]),b=Math.min(b,a[2]),D=Math.max(D,a[2])}const T=i.utilities.transformWorldToIndex(n,e[1]);T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.floor(T[2]);let A=s.polyline.getArea(d)/g/g;A*=h*u;const M=(0,y.A)(e,closed)/g,x=.01*(I-w),_=.01*(E-C),N=.01*(D-b);w=Math.floor(w-x),I=Math.ceil(I+x),C=Math.floor(C-_),E=Math.ceil(E+_),b=Math.floor(b-N),D=Math.ceil(D+N);const k=[[w,I],[C,E],[b,D]],O=n.indexToWorld([I,E,D]),R=t.worldToCanvas(O);let P,U=0,L=[],W=0;p&&(P=p.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(e,n)=>{let i=!0;const a=t.worldToCanvas(e);return a[1]!=U&&(W=0,U=a[1],L=(0,S.getLineSegmentIntersectionsCoordinates)(d,a,[R[0],a[1]]),L.sort(function(t,e){return t[0]===e[0]?0:t[0]<e[0]?-1:1})),L.length&&a[0]>L[0][0]&&(L.shift(),W++),W%2==0&&(i=!1),i},boundsIJK:k,returnPoints:this.configuration.storePointData}));const B=this.configuration.statsCalculator.getStatistics();o[r]={Modality:a.Modality,area:A,perimeter:M,mean:B.mean?.value,max:B.max?.value,min:B.min?.value,stdDev:B.stdDev?.value,statsArray:B.array,pointsInShape:P,areaUnit:m,modalityUnit:l,unit:v}}updateOpenCachedStats({targetId:t,metadata:e,cachedStats:n,modalityUnit:i,calibratedScale:a,points:o}){const{scale:s,unit:r}=a,l=(0,y.A)(o,closed)/s;n[t]={Modality:e.Modality,length:l,modalityUnit:i,unit:r}}}function N(t,e){const n=t.cachedStats[e],{area:a,mean:o,stdDev:s,length:r,perimeter:l,max:d,min:c,isEmptyArea:h,unit:u,areaUnit:g,modalityUnit:m}=n||{},v=[];if(i.utilities.isNumber(a)){const t=h?"Area: Oblique not supported":`Area: ${i.utilities.roundNumber(a)} ${g}`;v.push(t)}return i.utilities.isNumber(o)&&v.push(`Mean: ${i.utilities.roundNumber(o)} ${m}`),i.utilities.isNumber(d)&&v.push(`Max: ${i.utilities.roundNumber(d)} ${m}`),i.utilities.isNumber(c)&&v.push(`Min: ${i.utilities.roundNumber(c)} ${m}`),i.utilities.isNumber(s)&&v.push(`Std Dev: ${i.utilities.roundNumber(s)} ${m}`),i.utilities.isNumber(l)&&v.push(`Perimeter: ${i.utilities.roundNumber(l)} ${u}`),i.utilities.isNumber(r)&&v.push(`${i.utilities.roundNumber(r)} ${u}`),v}const k=_},4010:(t,e,n)=>{n.d(e,{A:()=>A});var i=n(85817),a=n(15327),o=n(4096),s=n(27730),r=n(6802),l=n(2076),d=n(29601),c=n(44049),h=n(74347),u=n(85204),g=n(99737),m=n(60810),v=n(33657),p=n(473),f=n(35489),w=n(7001),I=n(58640),S=n(40634),C=n(18990),E=n(73262),y=n(76712);const{transformWorldToIndex:b}=a.utilities;class D extends i.EC{static{this.toolName="RectangleROI"}constructor(t={},e={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:T,statsCalculator:E.BasicStatsCalculator}}){super(t,e),this.addNewAnnotation=t=>{const e=t.detail,{currentPoints:n,element:i}=e,o=n.world,s=(0,a.getEnabledElement)(i),{viewport:l}=s;this.isDrawing=!0;const d=this.constructor.createAnnotationForViewport(l,{data:{handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}}});(0,r.lC)(d,i);const c=(0,m.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:d,viewportIdsToRender:c,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,w.hideElementCursor)(i),t.preventDefault(),(0,I.A)(c),d},this.isPointNearTool=(t,e,n,i)=>{const o=(0,a.getEnabledElement)(t),{viewport:s}=o,{data:r}=e,{points:l}=r.handles,d=s.worldToCanvas(l[0]),c=s.worldToCanvas(l[3]),h=this._getRectangleImageCoordinates([d,c]),u=[n[0],n[1]],{left:g,top:m,width:p,height:f}=h;return v.distanceToPoint([g,m,p,f],u)<=i},this.toolSelectedCallback=(t,e)=>{const n=t.detail,{element:i}=n;e.highlighted=!0;const o=(0,m.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:e,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(i),(0,w.hideElementCursor)(i);const s=(0,a.getEnabledElement)(i),{renderingEngine:r}=s;(0,I.A)(o),t.preventDefault()},this.handleSelectedCallback=(t,e,n)=>{const i=t.detail,{element:o}=i,{data:s}=e;e.highlighted=!0;let r,l=!1;n.worldPosition?l=!0:r=s.handles.points.findIndex(t=>t===n);const d=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:e,viewportIdsToRender:d,handleIndex:r,movingTextBox:l},this._activateModify(o),(0,w.hideElementCursor)(o);const c=(0,a.getEnabledElement)(o),{renderingEngine:h}=c;(0,I.A)(d),t.preventDefault()},this._endCallback=t=>{const e=t.detail,{element:n}=e,{annotation:i,viewportIdsToRender:a,newAnnotation:o,hasMoved:s}=this.editData,{data:l}=i;o&&!s||(l.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,w.resetElementCursor)(n),this.doneEditMemo(),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.O8)(i.annotationUID),(0,I.A)(a),o&&(0,c.triggerAnnotationCompleted)(i))},this._dragCallback=t=>{this.isDrawing=!0;const e=t.detail,{element:n}=e,{annotation:i,viewportIdsToRender:o,handleIndex:s,movingTextBox:r,newAnnotation:l}=this.editData;this.createMemo(n,i,{newAnnotation:l});const{data:d}=i;if(r){const{deltaPoints:t}=e,n=t.world,{textBox:i}=d.handles,{worldPosition:a}=i;a[0]+=n[0],a[1]+=n[1],a[2]+=n[2],i.hasMoved=!0}else if(void 0===s){const{deltaPoints:t}=e,n=t.world,{points:a}=d.handles;a.forEach(t=>{t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}),i.invalidated=!0}else{const{currentPoints:t}=e,o=(0,a.getEnabledElement)(n),{worldToCanvas:r,canvasToWorld:l}=o.viewport,c=t.world,{points:h}=d.handles;let u,g,m,v,p,f,w,I;switch(h[s]=[...c],s){case 0:case 3:u=r(h[0]),v=r(h[3]),g=[v[0],u[1]],m=[u[0],v[1]],f=l(g),w=l(m),h[1]=f,h[2]=w;break;case 1:case 2:g=r(h[1]),m=r(h[2]),u=[m[0],g[1]],v=[g[0],m[1]],p=l(u),I=l(v),h[0]=p,h[3]=I}i.invalidated=!0}this.editData.hasMoved=!0;(0,a.getEnabledElement)(n);(0,I.A)(o),i.invalidated&&(0,c.triggerAnnotationModified)(i,n,g.ChangeTypes.HandlesUpdated)},this.cancel=t=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(t),this._deactivateModify(t),(0,w.resetElementCursor)(t);const{annotation:e,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:a}=e;return e.highlighted=!1,a.handles.activeHandleIndex=null,(0,I.A)(n),i&&(0,c.triggerAnnotationCompleted)(e),this.editData=null,e.annotationUID}},this._activateDraw=t=>{u.wk.isInteractingWithTool=!0,t.addEventListener(g.Events.MOUSE_UP,this._endCallback),t.addEventListener(g.Events.MOUSE_DRAG,this._dragCallback),t.addEventListener(g.Events.MOUSE_MOVE,this._dragCallback),t.addEventListener(g.Events.MOUSE_CLICK,this._endCallback),t.addEventListener(g.Events.TOUCH_END,this._endCallback),t.addEventListener(g.Events.TOUCH_DRAG,this._dragCallback),t.addEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=t=>{u.wk.isInteractingWithTool=!1,t.removeEventListener(g.Events.MOUSE_UP,this._endCallback),t.removeEventListener(g.Events.MOUSE_DRAG,this._dragCallback),t.removeEventListener(g.Events.MOUSE_MOVE,this._dragCallback),t.removeEventListener(g.Events.MOUSE_CLICK,this._endCallback),t.removeEventListener(g.Events.TOUCH_END,this._endCallback),t.removeEventListener(g.Events.TOUCH_DRAG,this._dragCallback),t.removeEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._activateModify=t=>{u.wk.isInteractingWithTool=!0,t.addEventListener(g.Events.MOUSE_UP,this._endCallback),t.addEventListener(g.Events.MOUSE_DRAG,this._dragCallback),t.addEventListener(g.Events.MOUSE_CLICK,this._endCallback),t.addEventListener(g.Events.TOUCH_END,this._endCallback),t.addEventListener(g.Events.TOUCH_DRAG,this._dragCallback),t.addEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=t=>{u.wk.isInteractingWithTool=!1,t.removeEventListener(g.Events.MOUSE_UP,this._endCallback),t.removeEventListener(g.Events.MOUSE_DRAG,this._dragCallback),t.removeEventListener(g.Events.MOUSE_CLICK,this._endCallback),t.removeEventListener(g.Events.TOUCH_END,this._endCallback),t.removeEventListener(g.Events.TOUCH_DRAG,this._dragCallback),t.removeEventListener(g.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(t,e)=>{let n=!1;const{viewport:i}=t,{element:o}=i;let s=(0,r.Rh)(this.getToolName(),o);if(!s?.length)return n;if(s=this.filterInteractableAnnotationsForElement(o,s),!s?.length)return n;const c=this.getTargetId(i),u=i.getRenderingEngine(),g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id};for(let o=0;o<s.length;o++){const r=s[o],{annotationUID:m,data:v}=r,{points:f,activeHandleIndex:w}=v.handles,I=f.map(t=>i.worldToCanvas(t));g.annotationUID=m;const{color:S,lineWidth:C,lineDash:E}=this.getAnnotationStyle({annotation:r,styleSpecifier:g}),{viewPlaneNormal:b,viewUp:D}=i.getCamera();if(v.cachedStats[c]&&null!=v.cachedStats[c].areaUnit){if(r.invalidated&&(this._throttledCalculateCachedStats(r,b,D,u,t),i instanceof a.VolumeViewport)){const{referencedImageId:t}=r.metadata;for(const e in v.cachedStats)if(e.startsWith("imageId")){u.getStackViewports().find(e=>{const n=a.utilities.imageIdToURI(t),i=e.hasImageURI(n),o=a.utilities.imageIdToURI(e.getCurrentImageId());return i&&o!==n})&&delete v.cachedStats[e]}}}else v.cachedStats[c]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(r,b,D,u,t);if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let T;if(!(0,d.isAnnotationVisible)(m))continue;(0,l.isAnnotationLocked)(m)||this.editData||null==w||(T=[I[w]]);const A=Boolean((0,y.h)("showHandlesAlways",{}));if(T||A){const t="0";(0,h.drawHandles)(e,m,t,A?I:T,{color:S})}const M=`${m}-rect`,x="0";(0,h.drawRectByCoordinates)(e,m,x,I,{color:S,lineDash:E,lineWidth:C},M),n=!0;const _=this.getLinkedTextBoxStyle(g,r);if(!_.visibility){v.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const N=this.configuration.getTextLines(v,c);if(!N||0===N.length)continue;if(!v.handles.textBox.hasMoved){const t=(0,p.getTextBoxCoordsCanvas)(I);v.handles.textBox.worldPosition=i.canvasToWorld(t)}const k=i.worldToCanvas(v.handles.textBox.worldPosition),O="1",R=(0,h.drawLinkedTextBox)(e,m,O,N,k,I,{},_),{x:P,y:U,width:L,height:W}=R;v.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([P,U]),topRight:i.canvasToWorld([P+L,U]),bottomLeft:i.canvasToWorld([P,U+W]),bottomRight:i.canvasToWorld([P+L,U+W])}}return n},this._getRectangleImageCoordinates=t=>{const[e,n]=t;return{left:Math.min(e[0],n[0]),top:Math.min(e[1],n[1]),width:Math.abs(e[0]-n[0]),height:Math.abs(e[1]-n[1])}},this._calculateCachedStats=(t,e,n,i,a)=>{if(!this.configuration.calculateStats)return;const{data:s}=t,{viewport:r}=a,{element:l}=r,d=s.handles.points[0],h=s.handles.points[3],{cachedStats:u}=s,m=Object.keys(u);for(let i=0;i<m.length;i++){const a=m[i],s=this.getTargetImageData(a);if(!s)continue;const{dimensions:l,imageData:c,metadata:g,voxelManager:v}=s,p=b(c,d);p[0]=Math.floor(p[0]),p[1]=Math.floor(p[1]),p[2]=Math.floor(p[2]);const w=b(c,h);if(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(w[2]),this._isInsideVolume(p,w,l)){this.isHandleOutsideImage=!1;const i=[[Math.min(p[0],w[0]),Math.max(p[0],w[0])],[Math.min(p[1],w[1]),Math.max(p[1],w[1])],[Math.min(p[2],w[2]),Math.max(p[2],w[2])]],{worldWidth:l,worldHeight:m}=(0,f.A)(e,n,d,h),I=[p,w],{scale:E,areaUnit:y}=(0,o.Op)(s,I),b=Math.abs(l*m)/(E*E),D={isPreScaled:(0,C.u)(r,a),isSuvScaled:this.isSuvScaled(r,a,t.metadata.referencedImageId)},T=(0,S.j)(g.Modality,t.metadata.referencedImageId,D);let A;v&&(A=v.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:i,imageData:c,returnPoints:this.configuration.storePointData}));const M=this.configuration.statsCalculator.getStatistics();u[a]={Modality:g.Modality,area:b,mean:M.mean?.value,stdDev:M.stdDev?.value,max:M.max?.value,min:M.min?.value,statsArray:M.array,pointsInShape:A,areaUnit:y,modalityUnit:T}}else this.isHandleOutsideImage=!0,u[a]={Modality:g.Modality}}const v=t.invalidated;return t.invalidated=!1,v&&(0,c.triggerAnnotationModified)(t,l,g.ChangeTypes.StatsUpdated),u},this._isInsideVolume=(t,e,n)=>a.utilities.indexWithinDimensions(t,n)&&a.utilities.indexWithinDimensions(e,n),this._throttledCalculateCachedStats=(0,s.A)(this._calculateCachedStats,100,{trailing:!0})}static{this.hydrate=(t,e,n)=>{const i=(0,a.getEnabledElementByViewportId)(t);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:s,viewPlaneNormal:l,instance:d,viewport:c}=this.hydrateBase(D,i,e,n),{toolInstance:h,...u}=n||{},g={annotationUID:n?.annotationUID||a.utilities.uuidv4(),data:{handles:{points:e,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:d.getToolName(),viewPlaneNormal:l,FrameOfReferenceUID:o,referencedImageId:s,...u}};(0,r.lC)(g,c.element),(0,I.A)([c.id])}}}function T(t,e){const n=t.cachedStats[e],{area:i,mean:o,max:s,stdDev:r,areaUnit:l,modalityUnit:d,min:c}=n;if(null==o)return;const h=[];return a.utilities.isNumber(i)&&h.push(`Area: ${a.utilities.roundNumber(i)} ${l}`),a.utilities.isNumber(o)&&h.push(`Mean: ${a.utilities.roundNumber(o)} ${d}`),a.utilities.isNumber(s)&&h.push(`Max: ${a.utilities.roundNumber(s)} ${d}`),a.utilities.isNumber(c)&&h.push(`Min: ${a.utilities.roundNumber(c)} ${d}`),a.utilities.isNumber(r)&&h.push(`Std Dev: ${a.utilities.roundNumber(r)} ${d}`),h}const A=D},23631:(t,e,n)=>{n.d(e,{A:()=>I});var i=n(15327),a=n(85817),o=n(18682),s=n(67165),r=n(26795),l=n(33283),d=n(97577),c=n(93733),h=n(60740),u=n(99737),g=n(2397),m=n(82056),v=n(13165),p=n(92984),f=n(49906),w=n(99522);class I extends a.oS{static{this.previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1}}constructor(t,e){super(t,e),this.memoMap=new Map,this.acceptedMemoIds=new Map,this.centerSegmentIndexInfo={segmentIndex:null,hasSegmentIndex:!1,hasPreviewIndex:!1,changedIndices:[]}}_historyRedoHandler(t){const{id:e,operationType:n}=t.detail;if("labelmap"===n){if(this.acceptedMemoIds.has(e)){this._hoverData=null;const t=this.acceptedMemoIds.get(e),n=t?.element,a=this.getOperationData(n);a.segmentIndex=t?.segmentIndex,n&&this.applyActiveStrategyCallback((0,i.getEnabledElement)(n),a,u.StrategyCallbacks.AcceptPreview)}this._previewData.isDrag=!0}}get _previewData(){return I.previewData}hasPreviewData(){return!!this._previewData.preview}shouldResolvePreviewRequests(){return("Active"===this.mode||"Enabled"===this.mode)&&this.hasPreviewData()}createMemo(t,e){const n=e.id;if(this.memo&&this.memo.segmentationVoxelManager===e)return this.memo;let i=this.memoMap.get(n);return i?i.redoVoxelManager&&(i=g.createLabelmapMemo(t,e),this.memoMap.set(n,i)):(i=g.createLabelmapMemo(t,e),this.memoMap.set(n,i)),this.memo=i,i}createEditData(t){const e=(0,i.getEnabledElement)(t),{viewport:n}=e,a=(0,s.T)(n.id);if(!a){const t=new CustomEvent(i.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return i.eventTarget.dispatchEvent(t),null}const{segmentationId:o}=a,d=(0,r.getLockedSegmentIndices)(o),{representationData:c}=(0,l.T)(o);return this.getEditData({viewport:n,representationData:c,segmentsLocked:d,segmentationId:o})}getEditData({viewport:t,representationData:e,segmentsLocked:n,segmentationId:a}){if(t instanceof i.BaseVolumeViewport){const{volumeId:a}=e[o.A.Labelmap],s=t.getActors();if(t instanceof i.StackViewport){const t=new CustomEvent(i.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return i.eventTarget.dispatchEvent(t),null}const r=s.map(t=>i.cache.getVolume(t.referencedId)),l=i.cache.getVolume(a),d=r.find(t=>i.utilities.isEqual(t.dimensions,l.dimensions))?.volumeId||r[0]?.volumeId;return{volumeId:a,referencedVolumeId:this.configuration.threshold?.volumeId??d,segmentsLocked:n}}{const e=(0,d.vl)(t.id,a);if(!e)return;return{imageId:e,segmentsLocked:n}}}createHoverData(t,e){const n=(0,i.getEnabledElement)(t),{viewport:a}=n,o=a.getCamera(),{viewPlaneNormal:s,viewUp:r}=o,l=[a.id],{segmentIndex:d,segmentationId:c,segmentColor:h}=this.getActiveSegmentationData(a)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...s],viewUp:[...r],FrameOfReferenceUID:a.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:h},data:{}},centerCanvas:e,segmentIndex:d,viewport:a,segmentationId:c,segmentColor:h,viewportIdsToRender:l}}getActiveSegmentationData(t){const e=t.id,n=(0,s.T)(e);if(!n)return;const{segmentationId:i}=n,a=(0,h.Q)(i);if(!a)return;return{segmentIndex:a,segmentationId:i,segmentColor:(0,c.getSegmentIndexColor)(e,i,a)}}getOperationData(t){const e=this._editData||this.createEditData(t),{segmentIndex:n,segmentationId:a,brushCursor:o}=this._hoverData||this.createHoverData(t),{data:s,metadata:r={}}=o||{},{viewPlaneNormal:l,viewUp:d}=r,h=this.configuration.preview?.previewColors?.[n],{viewport:u}=(0,i.getEnabledElement)(t),g=(0,c.getSegmentIndexColor)(u.id,a,n);if(!h&&!g)return;let m=null,v=null;this.configuration.preview?.enabled&&(m=h||function(t,e,n,i,a=.4){return[Math.round(t+(255-t)*a),Math.round(e+(255-e)*a),Math.round(n+(255-n)*a),i]}(...g),v=255);return{...e,points:s?.handles?.points,segmentIndex:n,viewPlaneNormal:l,previewOnHover:!this._previewData.isDrag,toolGroupId:this.toolGroupId,segmentationId:a,viewUp:d,centerSegmentIndexInfo:this.centerSegmentIndexInfo,activeStrategy:this.configuration.activeStrategy,configuration:this.configuration,previewColor:m,previewSegmentIndex:v,createMemo:this.createMemo.bind(this)}}addPreview(t=this._previewData.element,e){const{_previewData:n}=this,a=e?.acceptReject;!0===a?this.acceptPreview(t):!1===a&&this.rejectPreview(t);const o=(0,i.getEnabledElement)(t),s=this.applyActiveStrategyCallback(o,this.getOperationData(t),u.StrategyCallbacks.AddPreview);return n.isDrag=!0,s?.modified&&(n.preview=s,n.element=t),s}rejectPreview(t=this._previewData.element){if(!t)return;this.doneEditMemo();const e=(0,i.getEnabledElement)(t);this.applyActiveStrategyCallback(e,this.getOperationData(t),u.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(t=this._previewData.element){if(!t)return;const e=this.getOperationData(t);this.memo&&this.memo.id&&this.acceptedMemoIds.set(this.memo.id,{element:t,segmentIndex:e.segmentIndex});const n=(0,i.getEnabledElement)(t);this.applyActiveStrategyCallback(n,e,u.StrategyCallbacks.AcceptPreview),this.doneEditMemo(),this._previewData.preview=null,this._previewData.isDrag=!1}static viewportContoursToLabelmap(t,e){const n=e?.removeContours??!0,i=(0,m.getAllAnnotations)(),a=(0,v.filterAnnotationsForDisplay)(t,i);if(!a?.length)return;const o=a.filter(t=>t.data.contour?.polyline?.length);if(!o.length)return;const s=new I({},{configuration:{strategies:{FILL_INSIDE_CIRCLE:w.fillInsideCircle},activeStrategy:"FILL_INSIDE_CIRCLE"}}).addPreview(t.element),{memo:r,segmentationId:l}=s,d=r?.voxelManager,c=d.sourceVoxelManager||d,{dimensions:u}=d,g=t.getDefaultActor().actor.getMapper().getInputData();for(const t of o){const e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],{polyline:i}=t.data.contour;for(const t of i){g.worldToIndex(t).forEach((t,n)=>{e[n][0]=Math.min(e[n][0],t),e[n][1]=Math.max(e[n][1],t)})}e.forEach((t,e)=>{t[0]=Math.round(Math.max(0,t[0])),t[1]=Math.round(Math.min(u[e]-1,t[1]))});const a=(0,h.Q)(l),o=t.data.handles?.[0]||i[0],s=g.worldToIndex(o).map(Math.round),r=c.getAtIJKPoint(s)||0;let v=!1,f=!1;for(const t of i){const e=g.worldToIndex(t).map(Math.round),n=c.getAtIJKPoint(e);n===r?v=!0:n>=0&&(f=!0)}const w=v&&f?r:0===r?a:0;for(let t=e[0][0];t<=e[0][1];t++)for(let n=e[1][0];n<=e[1][1];n++)for(let a=e[2][0];a<=e[2][1];a++){const e=g.indexToWorld([t,n,a]);(0,p.isPointInsidePolyline3D)(e,i)&&d.setAtIJK(t,n,a,w)}n&&(0,m.removeAnnotation)(t.annotationUID)}const S=d.getArrayOfModifiedSlices();(0,f.triggerSegmentationDataModified)(l,S)}}},52905:(t,e,n)=>{n.d(e,{A:()=>a});var i=n(45217);const a=function(t,e,n){let a,o,s,r,l,d,c=0,h=!1,u=!1,g=!0;const m=!e&&0!==e&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){const n=a,i=o;return a=o=void 0,c=e,r=t.apply(i,n),r}function p(t,e){return m?window.requestAnimationFrame(t):setTimeout(t,e)}function f(t){const n=t-d;return void 0===d||n>=e||n<0||u&&t-c>=s}function w(){const t=Date.now();if(f(t))return I(t);l=p(w,function(t){const n=t-c,i=e-(t-d);return u?Math.min(i,s-n):i}(t))}function I(t){return l=void 0,g&&a?v(t):(a=o=void 0,r)}function S(...t){const n=Date.now(),i=f(n);if(a=t,o=this,d=n,i){if(void 0===l)return function(t){return c=t,l=p(w,e),h?v(t):r}(d);if(u)return l=p(w,e),v(d)}return void 0===l&&(l=p(w,e)),r}return e=Number(e)||0,(0,i.A)(n)&&(h=Boolean(n.leading),u="maxWait"in n,s=u?Math.max(Number(n.maxWait)||0,e):s,g="trailing"in n?Boolean(n.trailing):g),S.cancel=function(){void 0!==l&&function(t){if(m)return window.cancelAnimationFrame(t);clearTimeout(t)}(l),c=0,a=d=o=l=void 0},S.flush=function(){return void 0===l?r:I(Date.now())},S.pending=function(){return void 0!==l},S}},1239:(t,e,n)=>{function i(t){const e=function(t){const e=[t[0],t[1]].sort(s),n=[t[0],t[1]].sort(r),i=e[e.length-1],a=n[0],o=n[n.length-1];return{top:a,bottom:o,right:i};function s(t,e){return t[0]<e[0]?-1:1}function r(t,e){return t[1]<e[1]?-1:1}}(t),n=(e.top[1]+e.bottom[1])/2;return[e.right[0],n]}n.d(e,{A:()=>i})},40133:(t,e,n)=>{n.d(e,{A:()=>a});var i=n(15295);function a(t){const e=(0,i.A)(t);if(!e?.length)return;return e.find(e=>e.getImageIds().some(e=>e===t.metadata.referencedImageId))??e[0]}},45217:(t,e,n)=>{n.d(e,{A:()=>i});const i=function(t){const e=typeof t;return null!==t&&("object"===e||"function"===e)}},62783:(t,e,n)=>{function i(t,e){const{center:n,radius:i}=t,a=t.radius2||i*i;return(e[0]-n[0])*(e[0]-n[0])+(e[1]-n[1])*(e[1]-n[1])+(e[2]-n[2])*(e[2]-n[2])<=a}n.d(e,{d:()=>i})},27730:(t,e,n)=>{n.d(e,{A:()=>o});var i=n(52905),a=n(45217);const o=function(t,e,n){let o=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return(0,a.A)(n)&&(o="leading"in n?Boolean(n.leading):o,s="trailing"in n?Boolean(n.trailing):s),(0,i.A)(t,e,{leading:o,trailing:s,maxWait:e})}},18990:(t,e,n)=>{n.d(e,{u:()=>a});var i=n(15327);function a(t,e){if(t instanceof i.BaseVolumeViewport){const t=i.utilities.getVolumeId(e),n=i.cache.getVolume(t);return!!n?.scaling&&Object.keys(n.scaling).length>0}if(t instanceof i.StackViewport){const{preScale:e}=t.getImageData()||{};return!!e?.scaled}return!1}}}]);
//# sourceMappingURL=5400.bundle.9530ab8d80de328be53b.js.map