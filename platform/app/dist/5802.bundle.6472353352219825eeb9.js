"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5802],{85802:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var r=a(86326),i=a(39548),o=a(55530),n=a.n(o);const s=e=>{const{list:t,itemGenerator:a}=e;if(t)return t.map(t=>{if(!t)return;const r=t.generator||a;if(!r)throw new Error(`No generator for ${t}`);return r({...e,item:t})})};var l=a(14867),c=a.n(l);a(15327);function m(e,t){if(null!==e)return parseFloat(e).toFixed(t)}function u(e,t="MMM D, YYYY"){return c()(e,"YYYYMMDD").format(t)}function d(e,t="HH:mm:ss"){return c()(e,"HH:mm:ss").format(t)}var v=a(42356);const{formatPN:p}=v.Wp,y=e=>{const{item:t}=e,{title:a,value:i,condition:o,contents:n}=t;if(e.image={...e.image,...e.metadata},e.formatDate=u,e.formatTime=d,e.formatPN=p,e.formatNumberPrecision=m,o&&!o(e))return null;if(!n&&!i)return null;const s=i&&i(e),l=n&&n(e)||[{className:"mr-1",value:a},{classname:"mr-1 font-light",value:s}];return r.createElement("div",{key:t.id,className:"flex flex-row"},l.map((e,t)=>r.createElement("span",{key:t,className:e.className},e.value)))},g=({config:e,overlayData:t,...a})=>{const{topLeft:i=[],topRight:o=[],bottomLeft:l=[],bottomRight:c=[]}=t??{},m="absolute pointer-events-none microscopy-viewport-overlay";return r.createElement(r.Fragment,null,i&&i.length>0&&r.createElement("div",{"data-cy":"viewport-overlay-top-left",className:n()(m,"top-viewport left-viewport text-primary-light")},s({...a,list:i,itemGenerator:y})),o&&o.length>0&&r.createElement("div",{"data-cy":"viewport-overlay-top-right",className:n()(m,"top-viewport right-viewport-scrollbar text-primary-light")},s({...a,list:o,itemGenerator:y})),c&&c.length>0&&r.createElement("div",{"data-cy":"viewport-overlay-bottom-right",className:n()(m,"bottom-viewport right-viewport-scrollbar text-primary-light")},s({...a,list:c,itemGenerator:y})),l&&l.length>0&&r.createElement("div",{"data-cy":"viewport-overlay-bottom-left",className:n()(m,"bottom-viewport left-viewport text-primary-light")},s({...a,list:l,itemGenerator:y})))};var f=a(70956),w=a(5842);const h=function({activeViewportId:e,setViewportActive:t,displaySets:a,viewportId:o,dataSource:n,resizeRef:s}){const{servicesManager:l,extensionManager:c}=(0,v.Jg)(),[m,u]=(0,r.useState)(!1),[d,p]=(0,r.useState)(null),[y,h]=(0,r.useState)(null),I=(0,r.useRef)(),S=(0,r.useRef)(),{microscopyService:D,customizationService:b}=l.services,E=b.getCustomization("microscopyViewport.overlay"),M=(0,r.useCallback)(async(e,t)=>{D.clearAnnotations();let a=t;t.isOverlayDisplaySet&&(a=t.getSourceDisplaySet()),console.log("Loading viewer metadata",a),await(async a=>{const r=await D.importDicomMicroscopyViewer(),{viewer:s,metadata:m}=r,u=s.VolumeImageViewer,d=(0,f.A)({extensionManager:c,servicesManager:l}),v=[];a.forEach(e=>{e.ImageType="string"==typeof e.ImageType?e.ImageType.split("\\"):e.ImageType;const t=(0,i.cleanDenaturalizedDataset)(w.Ay.data.DicomMetaDictionary.denaturalizeDataset(e),{StudyInstanceUID:e.StudyInstanceUID,SeriesInstanceUID:e.SeriesInstanceUID,dataSourceConfig:n.getConfig()});t["00480105"]||(t["00480105"]={vr:"SQ",Value:[{"00480106":{vr:"SH",Value:["1"]}}]});const a=new m.VLWholeSlideMicroscopyImage({metadata:t}),r=a.ImageType[2];"VOLUME"!==r&&"THUMBNAIL"!==r||v.push(a)});const y=new u({client:d,metadata:v,retrieveRendered:!1,controls:["overview","position"]});I&&I.current&&y.addViewportOverlay&&y.addViewportOverlay({element:I.current,coordinates:[0,0],navigate:!0,className:"OpenLayersOverlay"}),y.render({container:e});const{StudyInstanceUID:g,SeriesInstanceUID:S}=t,b=D.addViewer(y,o,e,g,S);b.addContextMenuCallback(e=>{}),p(y),h(b)})(a.others),!t.isOverlayDisplaySet||t.isLoaded||t.isLoading||t.load(a)},[n,c,D,l,o]);(0,r.useEffect)(()=>{const e=a[0];return M(S.current,e).then(()=>{u(!0)}),()=>{d&&D.removeViewer(d)}},[]),(0,r.useEffect)(()=>{const e=a[0];if(D.clearAnnotations(),e.isOverlayDisplaySet&&!e.isLoaded&&!e.isLoading){const t=e.getSourceDisplaySet();e.load(t)}},[y,a,D]);const N={width:"100%",height:"100%"},V=a[0],L=V.firstInstance||V.instance,k=b.getCustomization("ui.loadingIndicatorProgress");return r.createElement("div",{className:"DicomMicroscopyViewer",style:N,onClick:()=>{o!==e&&t(o)}},r.createElement("div",{style:{...N,display:"none"}},r.createElement("div",{style:{...N},ref:I},r.createElement("div",{style:{position:"relative",height:"100%",width:"100%"}},V&&L.imageId&&r.createElement(g,{overlayData:E,displaySet:V,instance:V.instance,metadata:V.metadata})))),r.createElement("div",{style:N,ref:e=>{S.current=e,s.current=e}}),m?null:r.createElement(k,{className:"h-full w-full bg-[rgb(var(--background))]"}))}}}]);
//# sourceMappingURL=5802.bundle.6472353352219825eeb9.js.map