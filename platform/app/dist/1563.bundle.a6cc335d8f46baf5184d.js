"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1563],{74690:(t,e,n)=>{n.d(e,{u:()=>u,L:()=>g});var o=n(99737),i=n(21418),r=n(68014),s=n(77609);const{Active:a}=o.ToolModes;function c(t){const{renderingEngineId:e,viewportId:n}=t.detail,o=(0,r.kg)(),c=i.kt.getModifierKey(),l=(0,s.getToolGroupForViewport)(n,e);if(!l)return null;const u=Object.keys(l.toolOptions),d=l.getDefaultMousePrimary();for(let t=0;t<u.length;t++){const e=u[t],n=l.toolOptions[e];if(n.mode!==a)continue;if(n.bindings.length&&n.bindings.some(t=>t.mouseButton===(o??d)&&t.modifierKey===c))return l.getToolInstance(e)}}var l=n(49892);function u(t){const e=c(t);if(e){const{renderingEngineId:n,viewportId:o}=t.detail,i=(0,s.getToolGroupForViewport)(o,n),r=e.getToolName();Object.keys(i.toolOptions).includes(r)&&i.setViewportsCursorByToolName(r)}const n=function(t,e){const n=new Map,{renderingEngineId:o,viewportId:i}=t.detail,r=(0,s.getToolGroupForViewport)(i,o);if(!r)return n;const a=Object.keys(r.toolOptions),c=t.detail.key;for(let t=0;t<a.length;t++){const o=a[t],i=r.getToolInstance(o),s=i.configuration?.actions;if(!s)continue;const l=Object.values(s);if(!l?.length||!e.includes(i.mode))continue;const u=l.find(t=>t.bindings?.some(t=>t.key===c));u&&n.set(i,u)}return n}(t,[l.A.Active]);if(n?.size){const{element:e}=t.detail;for(const[o,i]of[...n.entries()]){("function"==typeof i.method?i.method:o[i.method]).call(o,e,i,t)}}}var d=n(40776);function g(t){const e=c(t);if(!e)return;const{renderingEngineId:n,viewportId:o}=t.detail,i=(0,s.getToolGroupForViewport)(o,n);(0,d.Ud)();const r=e.getToolName();Object.keys(i.toolOptions).includes(r)&&i.setViewportsCursorByToolName(r)}},40100:(t,e,n)=>{n.d(e,{q_:()=>i,LM:()=>r,cT:()=>x,Xd:()=>C,al:()=>k,tG:()=>O,Je:()=>L,rO:()=>F});var o=n(96198);const i=o.A.bind(null,"Mouse","mouseClickCallback"),r=o.A.bind(null,"Mouse","doubleClickCallback");var s=n(85204),a=n(99737),c=n(17343),l=n(2076),u=n(29601),d=n(35486),g=n(57725),h=n(25972),p=n(21418),f=n(77609),m=n(76910);const{Active:v}=a.ToolModes;function I(t){const{renderingEngineId:e,viewportId:n,event:o}=t.detail,i=(0,m.A)(o)||p.kt.getModifierKey(),r=(0,f.getToolGroupForViewport)(n,e);if(!r)return null;const s=Object.keys(r.toolOptions),a=r.getDefaultMousePrimary(),c=t.detail.buttons??o?.buttons??a;for(let t=0;t<s.length;t++){const e=s[t],n=r.toolOptions[e],o=n.bindings.length&&n.bindings.some(t=>t.mouseButton===c&&t.modifierKey===i);if(n.mode===v&&o)return r.getToolInstance(e)}}var P=n(70333),w=n(15327);const{Active:y,Passive:b}=a.ToolModes;function A(t){if(s.wk.isInteractingWithTool)return!1;const e=t.detail,{element:n}=e,o=(0,w.getEnabledElement)(n),{canvas:i}=e.currentPoints;if(!o)return!1;const r=function(t,e){const n=new Map,{renderingEngineId:o,viewportId:i}=t.detail,r=(0,f.getToolGroupForViewport)(i,o);if(!r)return n;const s=Object.keys(r.toolOptions),a=r.getDefaultMousePrimary(),c=t.detail.event,l=c?.buttons??a,u=(0,m.A)(c)||p.kt.getModifierKey();for(let t=0;t<s.length;t++){const o=s[t],i=r.getToolInstance(o),a=i.configuration?.actions??{},c=Object.values(a);if(!c?.length||!e.includes(i.mode))continue;const d=c.find(t=>t.bindings?.length&&t.bindings.some(t=>t.mouseButton===l&&t.modifierKey===u));d&&n.set(i,d)}return n}(t,[y,b]),a=Array.from(r.keys()),c=(0,g.A)(n,a),l=(0,h.A)(n,c,i);if(l.length>0){const{tool:e,annotation:n}=l[0],o=r.get(e);return("string"==typeof o.method?e[o.method]:o.method).call(e,t,n),!0}return!1}const{Active:T,Passive:M}=a.ToolModes;function x(t){if(s.wk.isInteractingWithTool)return;const e=I(t);if(e&&"function"==typeof e.preMouseDownCallback){if(e.preMouseDownCallback(t))return}const n=1===t.detail.event.buttons,o=[...(0,P.A)(t,[T],t.detail.event.buttons)||[],...(n?(0,P.A)(t,[M]):void 0)||[]];if(A(t))return;const i=t.detail,{element:r}=i,a=(0,g.A)(r,o),c=i.currentPoints.canvas,l=(0,d.A)(r,a,c,"mouse"),u=!!t.detail.event.shiftKey;if(l.length>0){const{tool:e,annotation:n,handle:o}=E(l);return _(n.annotationUID,u),void e.handleSelectedCallback(t,n,o,"Mouse")}const p=(0,h.A)(r,a,c,"mouse");if(p.length>0){const{tool:e,annotation:n}=E(p);return _(n.annotationUID,u),void e.toolSelectedCallback(t,n,"Mouse",c)}if(e&&"function"==typeof e.postMouseDownCallback){if(e.postMouseDownCallback(t))return}}function E(t){if(t.length>1){const e=t.find(t=>{const e=!(0,l.isAnnotationLocked)(t.annotation.annotationUID),n=(0,u.isAnnotationVisible)(t.annotation.annotationUID);return e&&n});if(e)return e}return t[0]}function _(t,e=!1){if(e)if((0,c.isAnnotationSelected)(t))(0,c.setAnnotationSelected)(t,!1);else{const e=!0;(0,c.setAnnotationSelected)(t,!0,e)}else{const e=!1;(0,c.setAnnotationSelected)(t,!0,e)}}function C(t){if(s.wk.isInteractingWithTool)return;const e=I(t);if(e&&!s.wk.isMultiPartToolActive&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");(0,c.setAnnotationSelected)(n.annotationUID)}}function k(t){if(s.wk.isInteractingWithTool)return;const e=I(t);!e||"function"!=typeof e.mouseDragCallback||e.mouseDragCallback(t)}var D=n(56069);const{Active:S,Passive:R}=a.ToolModes;function O(t){if(s.wk.isInteractingWithTool||s.wk.isMultiPartToolActive)return;const e=(0,P.A)(t,[S,R]),n=t.detail,{element:o}=n,i=(0,g.A)(o,e),r=e.filter(t=>!i.some(e=>e.tool.getToolName()===t.getToolName()));let a=!1;for(const{tool:e,annotations:n}of i)"function"==typeof e.mouseMoveCallback&&(a=e.mouseMoveCallback(t,n)||a);r.forEach(e=>{"function"==typeof e.mouseMoveCallback&&e.mouseMoveCallback(t)}),!0===a&&(0,D.A)(o)}const L=o.A.bind(null,"Mouse","mouseUpCallback");var N=n(66452);const F=function(t){if(s.wk.isInteractingWithTool)return;t.detail.buttons=N.i.Wheel|(t.detail.event.buttons||0);const e=I(t);return e?e.mouseWheelCallback(t):void 0}},96198:(t,e,n)=>{n.d(e,{A:()=>a});var o=n(85204),i=n(49892),r=n(77609);const{Active:s}=i.A;function a(t,e,n){if(o.wk.isInteractingWithTool)return!1;const{renderingEngineId:i,viewportId:a}=n.detail,c=(0,r.getToolGroupForViewport)(a,i);if(!c)return!1;let l;const u=Object.keys(c.toolOptions);for(let t=0;t<u.length;t++){const n=u[t],o=c.toolOptions[n],i=c.getToolInstance(n);if(o.mode===s&&"function"==typeof i[e]){l=c.getToolInstance(n);break}}l&&l[e](n)}},70333:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(77609);function i(t,e,n){const{renderingEngineId:i,viewportId:r}=t.detail,s=(0,o.getToolGroupForViewport)(r,i);if(!s)return[];const a=[],c=Object.keys(s.toolOptions);for(let t=0;t<c.length;t++){const o=c[t],i=s.toolOptions[o],r=null!=n&&i.bindings.length&&i.bindings.some(t=>t.mouseButton===n);if(e.includes(i.mode)&&(!n||r)){const t=s.getToolInstance(o);a.push(t)}}return a}},84971:(t,e,n)=>{n.d(e,{Oz:()=>A,ls:()=>M,x5:()=>E,gX:()=>P,$F:()=>b,lI:()=>x});var o=n(85204),i=n(99737),r=n(17343),s=n(2076),a=n(29601),c=n(35486),l=n(57725),u=n(25972),d=n(76910),g=n(21418),h=n(77609);const{Active:p}=i.ToolModes;function f(t){const{renderingEngineId:e,viewportId:n}=t.detail,o=t.detail.event,i=(0,h.getToolGroupForViewport)(n,e);if(!i)return null;const r=Object.keys(i.toolOptions),s=Object.keys(o.touches).length,a=(0,d.A)(o)||g.kt.getModifierKey(),c=i.getDefaultMousePrimary();for(let t=0;t<r.length;t++){const e=r[t],n=i.toolOptions[e],o=n.bindings.length&&n.bindings.some(t=>(t.numTouchPoints===s||1===s&&t.mouseButton===c)&&t.modifierKey===a);if(n.mode===p&&o)return i.getToolInstance(e)}}function m(t,e,n){const{renderingEngineId:o,viewportId:i}=t.detail,r=(0,h.getToolGroupForViewport)(i,o);if(!r)return[];const s=[],a=Object.keys(r.toolOptions);for(let t=0;t<a.length;t++){const o=a[t],i=r.toolOptions[o],c=null!=n&&i.bindings.length&&i.bindings.some(t=>t.numTouchPoints===n);if(e.includes(i.mode)&&(!n||c)){const t=r.getToolInstance(o);s.push(t)}}return s}const{Active:v,Passive:I}=i.ToolModes;function P(t){if(o.wk.isInteractingWithTool)return;const e=f(t);if(e&&"function"==typeof e.preTouchStartCallback){if(e.preTouchStartCallback(t))return}const n=1===Object.keys(t.detail.event.touches).length,i=[...m(t,[v],Object.keys(t.detail.event.touches).length)||[],...(n?m(t,[I]):void 0)||[],e],r=t.detail,{element:s}=r,a=(0,l.A)(s,i),d=r.currentPoints.canvas,g=(0,c.A)(s,a,d,"touch"),h=!1;if(g.length>0){const{tool:e,annotation:n,handle:o}=w(g);return y(n.annotationUID,h),void e.handleSelectedCallback(t,n,o,"Touch")}const p=(0,u.A)(s,a,d,"touch");if(p.length>0){const{tool:e,annotation:n}=w(p);return y(n.annotationUID,h),void e.toolSelectedCallback(t,n,"Touch",d)}if(e&&"function"==typeof e.postTouchStartCallback){if(e.postTouchStartCallback(t))return}}function w(t){return t.length>1&&t.find(t=>!(0,s.isAnnotationLocked)(t.annotation.annotationUID)&&(0,a.isAnnotationVisible)(t.annotation.annotationUID))||t[0]}function y(t,e=!1){if(e)if((0,r.isAnnotationSelected)(t))(0,r.setAnnotationSelected)(t,!1);else{const e=!0;(0,r.setAnnotationSelected)(t,!0,e)}else{const e=!1;(0,r.setAnnotationSelected)(t,!0,e)}}function b(t){if(o.wk.isInteractingWithTool)return;const e=f(t);if(e&&!o.wk.isMultiPartToolActive&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"touch");(0,r.setAnnotationSelected)(n.annotationUID)}}function A(t){if(o.wk.isInteractingWithTool)return;const e=f(t);!e||"function"!=typeof e.touchDragCallback||e.touchDragCallback(t)}var T=n(96198);const M=T.A.bind(null,"Touch","touchEndCallback"),x=T.A.bind(null,"Touch","touchTapCallback"),E=T.A.bind(null,"Touch","touchPressCallback")},39595:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(40776);function i(t){t.removeEventListener("keydown",o.Ay)}const r={enable:function(t){i(t),t.addEventListener("keydown",o.Ay)},disable:i,getModifierKey:o.vh}},40776:(t,e,n)=>{n.d(e,{Ay:()=>g,Ud:()=>d,vh:()=>u});var o=n(15327),i=n(94021);const r={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let s={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function a(t){s.element=t.currentTarget;const e=(0,o.getEnabledElement)(s.element),{renderingEngineId:n,viewportId:r}=e;s.renderingEngineId=n,s.viewportId=r,s.key=t.key,s.keyCode=t.keyCode,t.preventDefault();const u={renderingEngineId:s.renderingEngineId,viewportId:s.viewportId,element:s.element,key:s.key,keyCode:s.keyCode};(0,o.triggerEvent)(u.element,i.A.KEY_DOWN,u),document.addEventListener("keyup",l),document.addEventListener("visibilitychange",c),s.element.removeEventListener("keydown",a)}function c(){document.removeEventListener("visibilitychange",c),"hidden"===document.visibilityState&&d()}function l(t){const e={renderingEngineId:s.renderingEngineId,viewportId:s.viewportId,element:s.element,key:s.key,keyCode:s.keyCode};document.removeEventListener("keyup",l),document.removeEventListener("visibilitychange",c),s.element.addEventListener("keydown",a),s=structuredClone(r),(0,o.triggerEvent)(e.element,i.A.KEY_UP,e)}function u(){return s.keyCode}function d(){s.keyCode=void 0}const g=a},99019:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(15327);function i(t,e){const n=e||t.currentTarget,{viewport:i}=(0,o.getEnabledElement)(n)||{};if(!i)return;const r=function(t){return[t.clientX,t.clientY]}(t),s=function(t){return[t.pageX,t.pageY]}(t),a=function(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}(n,s);return{page:s,client:r,canvas:a,world:i.canvasToWorld(a)}}},91099:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(15327),i=n(94021),r=n(99019);const s=function(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:s}=(0,o.getEnabledElement)(e),a=(0,r.A)(t,e),c={event:t,eventName:i.A.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:s,camera:{},element:e,startPoints:a,lastPoints:a,currentPoints:a,deltaPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};!(0,o.triggerEvent)(e,i.A.MOUSE_DOUBLE_CLICK,c)&&(t.stopImmediatePropagation(),t.preventDefault())}},68014:(t,e,n)=>{n.d(e,{Ay:()=>k,DF:()=>C,kg:()=>_});var o=n(15327),i=n(94021),r=n(41343),s=n(99019);const{MOUSE_DOWN:a,MOUSE_DOWN_ACTIVATE:c,MOUSE_CLICK:l,MOUSE_UP:u,MOUSE_DRAG:d}=i.A,g=3,h={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let p={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const f={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function m(t){const e=(0,o.getEnabledElement)(p.element);if(!e?.viewport)return;const n=(0,s.A)(t,p.element),i=M(p.element,p.lastPoints),r=x(n,i);if(f.doubleClickTimeout){if(!P(r.canvas))return;y()}const a={event:t,eventName:d,mouseButton:p.mouseButton,renderingEngineId:p.renderingEngineId,viewportId:p.viewportId,camera:{},element:p.element,startPoints:T(p.startPoints),lastPoints:T(i),currentPoints:n,deltaPoints:r};!(0,o.triggerEvent)(p.element,d,a)&&(t.stopImmediatePropagation(),t.preventDefault()),p.lastPoints=T(n)}function v(t){if(clearTimeout(p.preventClickTimeout),f.doubleClickTimeout)f.mouseUpEvent?A():(f.mouseUpEvent=t,p.element.addEventListener("mousemove",I));else{const e=p.isClickEvent?l:u,n=(0,s.A)(t,p.element),i=x(n,p.lastPoints),r={event:t,eventName:e,mouseButton:p.mouseButton,element:p.element,renderingEngineId:p.renderingEngineId,viewportId:p.viewportId,camera:{},startPoints:T(p.startPoints),lastPoints:T(p.lastPoints),currentPoints:n,deltaPoints:i};(0,o.triggerEvent)(r.element,e,r),A()}document.removeEventListener("mousemove",m)}function I(t){P(x((0,s.A)(t,p.element),M(p.element,p.lastPoints)).canvas)&&(y(),(0,r.A)(t))}function P(t){return Math.abs(t[0])+Math.abs(t[1])>g}function w(){p.isClickEvent=!1}function y(){f.ignoreDoubleClick=!0;const t=f.mouseDownEvent,e=f.mouseUpEvent;b(),function(t){const e=x(p.startPoints,p.startPoints),n={event:t,eventName:a,element:p.element,mouseButton:p.mouseButton,renderingEngineId:p.renderingEngineId,viewportId:p.viewportId,camera:{},startPoints:p.startPoints,lastPoints:p.startPoints,currentPoints:p.startPoints,deltaPoints:e};p.lastPoints=T(n.lastPoints),(0,o.triggerEvent)(n.element,a,n)&&(0,o.triggerEvent)(n.element,c,n)}(t),e&&v(e)}function b(){f.doubleClickTimeout&&(clearTimeout(f.doubleClickTimeout),f.doubleClickTimeout=null),f.mouseDownEvent=null,f.mouseUpEvent=null}function A(){document.removeEventListener("mouseup",v),p.element?.removeEventListener("mousemove",I),p.element?.addEventListener("mousemove",r.A),b(),p=JSON.parse(JSON.stringify(h))}function T(t){return JSON.parse(JSON.stringify(t))}function M(t,e){const{viewport:n}=(0,o.getEnabledElement)(t)||{};if(!n)return e;const i=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:i}}function x(t,e){return t&&e?{page:E(t.page,e.page),client:E(t.client,e.client),canvas:E(t.canvas,e.canvas),world:(n=t.world,o=e.world,[n[0]-o[0],n[1]-o[1],n[2]-o[2]])}:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]};var n,o}function E(t,e){return[t[0]-e[0],t[1]-e[1]]}function _(){return p.mouseButton}function C(t){f.ignoreDoubleClick?(f.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):A()}const k=function(t){if(f.doubleClickTimeout){if(t.buttons===f.mouseDownEvent.buttons)return;return f.mouseDownEvent=t,void y()}f.doubleClickTimeout=setTimeout(y,1===t.buttons?400:150),f.mouseDownEvent=t,f.ignoreDoubleClick=!1,p.element=t.currentTarget,p.mouseButton=t.buttons;const e=(0,o.getEnabledElement)(p.element),{renderingEngineId:n,viewportId:i}=e;p.renderingEngineId=n,p.viewportId=i,p.preventClickTimeout=setTimeout(w,p.clickDelay),p.element.removeEventListener("mousemove",r.A);const a=(0,s.A)(t,p.element);p.startPoints=T(a),p.lastPoints=T(a),document.addEventListener("mouseup",v),document.addEventListener("mousemove",m)}},41343:(t,e,n)=>{n.d(e,{A:()=>a});var o=n(15327),i=n(94021),r=n(99019);const s=i.A.MOUSE_MOVE;const a=function(t){const e=t.currentTarget,n=(0,o.getEnabledElement)(e);if(!n)return;const{renderingEngineId:i,viewportId:a}=n,c={renderingEngineId:i,viewportId:a,camera:{},element:e,currentPoints:(0,r.A)(t),eventName:s,event:t};!(0,o.triggerEvent)(e,s,c)&&(t.stopImmediatePropagation(),t.preventDefault())}},41666:(t,e,n)=>{n.d(e,{A:()=>f});const o=0,i=1;let r,s;function a(t,e){const n=Date.now();if(t!==r){if(n-s<=2e3)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;r=t}s=n}const c=a.bind(null,o),l=a.bind(null,i);function u(t,e,n){const o=n?c:l;e.forEach(function(e){t.addEventListener(e,o,{passive:!1})})}function d(t,e,n){const o=n?c:l;e.forEach(function(e){t.removeEventListener(e,o)})}const g=["mousedown","mouseup","mousemove"],h=["touchstart","touchend"];function p(t){d(t,g,o),d(t,h,i)}const f={enable:function(t){p(t),u(t,g,o),u(t,h,i)},disable:p}},82603:(t,e,n)=>{n.d(e,{A:()=>M});var o=n(15327),i=n(94021),r=n(10401);function s(t,e){const n=e||t.currentTarget,i="touchend"===t.type?t.changedTouches:t.touches;return Object.keys(i).map(t=>{const e=function(t){return[t.clientX,t.clientY]}(i[t]),r=function(t){return[t.pageX,t.pageY]}(i[t]),s=function(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}(n,r),{viewport:a}=(0,o.getEnabledElement)(n);return{page:r,client:e,canvas:s,world:a.canvasToWorld(s),touch:{identifier:t,radiusX:i[t].radiusX,radiusY:i[t].radiusY,force:i[t].force,rotationAngle:i[t].rotationAngle}}})}var a=n(76260);o.Settings.getRuntimeSettings();const{TOUCH_START:c,TOUCH_START_ACTIVATE:l,TOUCH_PRESS:u,TOUCH_DRAG:d,TOUCH_END:g,TOUCH_TAP:h,TOUCH_SWIPE:p}=i.A,f={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},m={page:0,client:0,canvas:0,world:0},v={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...f,touch:null}],lastPointsList:[{...f,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:m,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},I={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...f,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let P=JSON.parse(JSON.stringify(v)),w=JSON.parse(JSON.stringify(I));function y(t,e,n){return(0,o.triggerEvent)(t,e,n)}function b(t){const e=s(t,P.element),n=T(P.element,P.lastPointsList),o=e.length===n.length?(0,a.getDeltaPoints)(e,n):f,i=e.length===n.length?(0,a.getDeltaDistanceBetweenIPoints)(e,n):m,c=e.length===n.length?(0,a.getDeltaDistance)(e,P.lastPointsList):m;P.accumulatedDistance={page:P.accumulatedDistance.page+c.page,client:P.accumulatedDistance.client+c.client,canvas:P.accumulatedDistance.canvas+c.canvas,world:P.accumulatedDistance.world+c.world};const l={event:t,eventName:d,renderingEngineId:P.renderingEngineId,viewportId:P.viewportId,camera:{},element:P.element,startPoints:(0,a.getMeanTouchPoints)(P.startPointsList),lastPoints:(0,a.getMeanTouchPoints)(n),currentPoints:(0,a.getMeanTouchPoints)(e),startPointsList:(0,a.copyPointsList)(P.startPointsList),lastPointsList:(0,a.copyPointsList)(n),currentPointsList:e,deltaPoints:o,deltaDistance:i};y(P.element,d,l),function(t,e){const n=(new Date).getTime(),o=P.startTime.getTime();if(P.swiped||n-o>P.swipeToleranceMs)return;const[i,s]=e.canvas,a={event:t,eventName:p,renderingEngineId:P.renderingEngineId,viewportId:P.viewportId,camera:{},element:P.element,swipe:null};Math.abs(i)>P.swipeDistanceThreshold&&(a.swipe=i>0?r.H.RIGHT:r.H.LEFT,y(a.element,p,a),P.swiped=!0);Math.abs(s)>P.swipeDistanceThreshold&&(a.swipe=s>0?r.H.DOWN:r.H.UP,y(a.element,p,a),P.swiped=!0)}(t,o),P.lastPointsList=(0,a.copyPointsList)(e)}function A(t){clearTimeout(P.pressTimeout);const e=s(t,P.element),n=T(P.element,P.lastPointsList),o=e.length===n.length?(0,a.getDeltaPoints)(e,n):(0,a.getDeltaPoints)(e,e),i=e.length===n.length?(0,a.getDeltaDistanceBetweenIPoints)(e,n):(0,a.getDeltaDistanceBetweenIPoints)(e,e),r={event:t,eventName:g,element:P.element,renderingEngineId:P.renderingEngineId,viewportId:P.viewportId,camera:{},startPointsList:(0,a.copyPointsList)(P.startPointsList),lastPointsList:(0,a.copyPointsList)(n),currentPointsList:e,startPoints:(0,a.getMeanTouchPoints)(P.startPointsList),lastPoints:(0,a.getMeanTouchPoints)(n),currentPoints:(0,a.getMeanTouchPoints)(e),deltaPoints:o,deltaDistance:i};y(r.element,g,r),function(t){const e=(new Date).getTime(),n=P.startTime.getTime();if(e-n>w.tapToleranceMs)return;0===w.taps&&(w.element=P.element,w.renderingEngineId=P.renderingEngineId,w.viewportId=P.viewportId,w.startPointsList=P.startPointsList);if(w.taps>0&&(w.element!=P.element||w.renderingEngineId!=P.renderingEngineId||w.viewportId!=P.viewportId))return;const o=s(t,w.element),i=(0,a.getDeltaDistance)(o,w.startPointsList).canvas;if(i>w.tapMaxDistance)return;clearTimeout(w.tapTimeout),w.taps+=1,w.tapTimeout=setTimeout(()=>{const e={event:t,eventName:h,element:w.element,renderingEngineId:w.renderingEngineId,viewportId:w.viewportId,camera:{},currentPointsList:o,currentPoints:(0,a.getMeanTouchPoints)(o),taps:w.taps};y(e.element,h,e),w=JSON.parse(JSON.stringify(I))},w.tapToleranceMs)}(t),P=JSON.parse(JSON.stringify(v)),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",A)}function T(t,e){const{viewport:n}=(0,o.getEnabledElement)(t);return e.map(t=>{const e=n.canvasToWorld(t.canvas);return{page:t.page,client:t.client,canvas:t.canvas,world:e,touch:t.touch}})}const M=function(t){P.element=t.currentTarget;const e=(0,o.getEnabledElement)(P.element),{renderingEngineId:n,viewportId:i}=e;P.renderingEngineId=n,P.viewportId=i,P.isTouchStart||(clearTimeout(P.pressTimeout),P.pressTimeout=setTimeout(()=>function(t){if(P.accumulatedDistance.canvas>P.pressMaxDistance)return;const e={event:t,eventName:u,renderingEngineId:P.renderingEngineId,viewportId:P.viewportId,camera:{},element:P.element,startPointsList:(0,a.copyPointsList)(P.startPointsList),lastPointsList:(0,a.copyPointsList)(P.lastPointsList),startPoints:(0,a.copyPoints)((0,a.getMeanTouchPoints)(P.startPointsList)),lastPoints:(0,a.copyPoints)((0,a.getMeanTouchPoints)(P.lastPointsList))};y(e.element,u,e)}(t),P.pressDelay),function(t){P.isTouchStart=!0,P.startTime=new Date;const e=s(t,P.element),n=(0,a.getMeanTouchPoints)(e),o=f,i=m,r={event:t,eventName:c,element:P.element,renderingEngineId:P.renderingEngineId,viewportId:P.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:o,deltaDistance:i};P.startPointsList=(0,a.copyPointsList)(r.startPointsList),P.lastPointsList=(0,a.copyPointsList)(r.lastPointsList);y(r.element,c,r)&&y(r.element,l,r)}(t),document.addEventListener("touchmove",b),document.addEventListener("touchend",A))}},17806:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(15327);var i=n(94021),r=n(99019);const s=function(t){const e=t.currentTarget,n=(0,o.getEnabledElement)(e),{renderingEngineId:s,viewportId:a}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:c,spinY:l,pixelX:u,pixelY:d}=function(t){let e=0,n=0,o=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),o=10*e,i=10*n,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(o=t.deltaX),(o||i)&&t.deltaMode&&(1===t.deltaMode?(o*=40,i*=40):(o*=800,i*=800)),o&&!e&&(e=o<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:o,pixelY:i}}(t),g=l<0?-1:1,h={event:t,eventName:i.A.MOUSE_WHEEL,renderingEngineId:s,viewportId:a,element:e,camera:{},detail:t,wheel:{spinX:c,spinY:l,pixelX:u,pixelY:d,direction:g},points:(0,r.A)(t)};(0,o.triggerEvent)(e,i.A.MOUSE_WHEEL,h)}},6802:(t,e,n)=>{n.d(e,{O8:()=>o.removeAnnotation,Rh:()=>o.getAnnotations,gw:()=>o.getAnnotation,lC:()=>o.addAnnotation});n(67013),n(2076),n(17343);var o=n(82056);n(97)},6273:(t,e,n)=>{n.d(e,{p:()=>r});var o=n(59475),i=n(49906);async function r(t){const e=(0,o.cC)(t);return(0,i.triggerSegmentationModified)(t.segmentationId),e}},98149:(t,e,n)=>{n.d(e,{X:()=>c});var o=n(15327),i=n(99737),r=n(33283),s=n(49906),a=n(74283);async function c({segmentationId:t,viewportId:e,imageIds:n,options:c}){const l=(0,r.T)(t);if(c?.removeOriginal){const t=l.representationData.Labelmap;o.cache.getVolume(t.volumeId)&&o.cache.removeVolumeLoadObject(t.volumeId),l.representationData.Labelmap={imageIds:n}}else l.representationData.Labelmap={...l.representationData.Labelmap,imageIds:n};await(0,a.gR)(e,[{segmentationId:t,type:i.SegmentationRepresentations.Labelmap}]),o.eventTarget.addEventListenerOnce(i.Events.SEGMENTATION_RENDERED,()=>(0,s.triggerSegmentationDataModified)(t))}},25972:(t,e,n)=>{function o(t,e,n,o="mouse"){const i="touch"===o?36:6,r=[];return e.forEach(({tool:e,annotations:s})=>{for(const a of s){if(a.isLocked||!a.isVisible)continue;if(e.isPointNearTool(t,a,n,i,o)){r.push({tool:e,annotation:a});break}}}),r}n.d(e,{A:()=>o})},57725:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(82056);function i(t,e){const n=[];for(let i=0;i<e.length;i++){const r=e[i];if(!r){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let s=(0,o.getAnnotations)(r.constructor.toolName,t);s?.length&&("function"==typeof r.filterInteractableAnnotationsForElement&&(s=r.filterInteractableAnnotationsForElement(t,s)),s?.length>0&&n.push({tool:r,annotations:s}))}return n}},35486:(t,e,n)=>{function o(t,e,n,o="mouse"){const i="touch"===o?36:6,r=[];return e.forEach(({tool:e,annotations:o})=>{for(const s of o){if(s.isLocked||!s.isVisible)continue;const o=e.getHandleNearImagePoint(t,s,n,i);if(o){r.push({tool:e,annotation:s,handle:o});break}}}),r}n.d(e,{A:()=>o})},16175:(t,e,n)=>{n.d(e,{A:()=>l});var o=n(3823),i=n(15327),r=n(13271),s=n(74347),a=n(95527);class c{constructor(){this.toolInfo={toolSize:null,maxToolSize:null}}static{this.shapeName="Circle"}static{this.CHAIN_MAINTENANCE_ITERATIONS=3}static{this.CHAIN_PULL_STRENGTH_FACTOR=.3}static{this.MAX_INTER_DISTANCE_FACTOR=1.2}renderShape(t,e,n){(0,s.drawCircle)(t,"SculptorTool","0",e,this.toolInfo.toolSize,n)}pushHandles(t,e){const{points:n,mouseCanvasPoint:o}=e,i={first:void 0,last:void 0},r=a.point.distanceToPoint(t.canvasToWorld(o),t.canvasToWorld([o[0]+this.toolInfo.toolSize,o[1]]));for(let s=0;s<n.length;s++){const c=t.worldToCanvas(n[s]);a.point.distanceToPoint(c,o)>this.toolInfo.toolSize||(this.pushOneHandle(s,r,e),void 0===i.first?(i.first=s,i.last=s):i.last=s)}if(void 0!==i.first&&void 0!==i.last)for(let t=0;t<c.CHAIN_MAINTENANCE_ITERATIONS;t++)this.maintainChainStructure(e,i);return i}configureToolSize(t){const e=this.toolInfo;if(e.toolSize&&e.maxToolSize)return;const n=t.detail.element,o=Math.min(n.clientWidth,n.clientHeight)/12;e.toolSize=o,e.maxToolSize=o}updateToolSize(t,e,n){const o=this.toolInfo,i=(0,r.X)(e,n,t);i>0&&(o.toolSize=Math.min(o.maxToolSize,i))}getMaxSpacing(t){return Math.max(this.toolInfo.toolSize/4,t)}getInsertPosition(t,e,n){let o;const{points:r,element:s,mouseCanvasPoint:c}=n,l=this.toolInfo.toolSize,u=(0,i.getEnabledElement)(s),{viewport:d}=u,g=d.worldToCanvas(r[t]),h=d.worldToCanvas(r[e]),p=[(g[0]+h[0])/2,(g[1]+h[1])/2],f=a.point.distanceToPoint(c,p);if(f<l){const t={x:(p[0]-c[0])/f,y:(p[1]-c[1])/f};o=[c[0]+l*t.x,c[1]+l*t.y]}else o=p;return d.canvasToWorld(o)}pushOneHandle(t,e,n){const{points:i,mousePoint:r}=n,s=i[t],a=this.directionalVector(r,s),c=o.eR.scaleAndAdd(o.eR.create(),r,a,e);s[0]=c[0],s[1]=c[1],s[2]=c[2]}directionalVector(t,e){return o.eR.normalize(o.eR.create(),[e[0]-t[0],e[1]-t[1],e[2]-t[2]])}calculateMeanConsecutiveDistance(t){if(t.length<2)return 0;let e=0;const n=t.length;for(let o=0;o<n;o++){const i=(o+1)%n;e+=a.point.distanceToPoint(t[o],t[i])}return e/n}maintainChainStructure(t,e){const{points:n}=t,o=e.first,i=e.last,r=Math.round((o+i)/2),s=n.length;t.meanDistance||(t.meanDistance=this.calculateMeanConsecutiveDistance(n));const l=t.meanDistance*c.MAX_INTER_DISTANCE_FACTOR;for(let e=r;e>=0;e--){if(e>=s-1||e<0)continue;const o=e+1,i=a.point.distanceToPoint(n[e],n[o]);if(i>l){const r=this.directionalVector(n[e],n[o]),s=(i-t.meanDistance)/t.meanDistance*t.meanDistance*c.CHAIN_PULL_STRENGTH_FACTOR;n[e][0]+=r[0]*s,n[e][1]+=r[1]*s,n[e][2]+=r[2]*s}}for(let e=r+1;e<s;e++){if(e>=s||e<=0)continue;const o=e-1,i=a.point.distanceToPoint(n[e],n[o]);if(i>l){const r=this.directionalVector(n[e],n[o]),s=(i-t.meanDistance)/t.meanDistance*t.meanDistance*c.CHAIN_PULL_STRENGTH_FACTOR;n[e][0]+=r[0]*s,n[e][1]+=r[1]*s,n[e][2]+=r[2]*s}}}}const l=c},10639:(t,e,n)=>{n.d(e,{A:()=>m});var o=n(15327),i=n(85817),r=n(99737),s=n(55126),a=n(49906),c=n(10564),l=n(86644),u=n(67912),d=n(93759),g=n(97577);const{transformWorldToIndex:h,transformIndexToWorld:p}=o.utilities;class f extends i.oS{static{this.lastGrowCutCommand=null}constructor(t,e){super(t,o.utilities.deepMerge({configuration:{positiveStdDevMultiplier:c.ee,shrinkExpandIncrement:.1,islandRemoval:{enabled:!1}}},e))}async preMouseDownCallback(t){const e=t.detail,{element:n,currentPoints:i}=e,{world:r}=i,s=(0,o.getEnabledElement)(n),{viewport:a,renderingEngine:c}=s,{viewUp:l}=a.getCamera(),{segmentationId:u,segmentIndex:d,labelmapVolumeId:g,referencedVolumeId:h}=await this.getLabelmapSegmentationData(a);if(!this._isOrthogonalView(a,h))throw new Error("Oblique view is not supported yet");return this.growCutData={metadata:{...a.getViewReference({points:[r]}),viewUp:l},segmentation:{segmentationId:u,segmentIndex:d,labelmapVolumeId:g,referencedVolumeId:h},viewportId:a.id,renderingEngineId:c.id},t.preventDefault(),!0}shrink(){this._runLastCommand({shrinkExpandAmount:-this.configuration.shrinkExpandIncrement})}expand(){this._runLastCommand({shrinkExpandAmount:this.configuration.shrinkExpandIncrement})}refresh(){this._runLastCommand()}async getGrowCutLabelmap(t){throw new Error("Not implemented")}async runGrowCut(){const{growCutData:t,configuration:e}=this,{segmentation:{segmentationId:n,segmentIndex:i,labelmapVolumeId:r}}=t,s=o.cache.getVolume(r);let a=0;const l=async({shrinkExpandAmount:o=0}={})=>{0!==o&&(this.seeds=null),a+=o;const r=Math.max(.1,e.positiveStdDevMultiplier+a),l=o<0?Math.max(1,c.BX-3*Math.abs(a)):c.BX+3*a,u={...t,options:{...t.options||{},positiveSeedValue:i,negativeSeedValue:255,positiveStdDevMultiplier:r,negativeSeedMargin:l}},d=await this.getGrowCutLabelmap(u),{isPartialVolume:g}=e;(g?this.applyPartialGrowCutLabelmap:this.applyGrowCutLabelmap)(n,i,s,d),this._removeIslands(u)};await l(),f.lastGrowCutCommand=l,this.growCutData=null}applyPartialGrowCutLabelmap(t,e,n,o){const i=o.voxelManager.getCompleteScalarDataArray(),r=n.voxelManager,[s,c,l]=o.dimensions,[u,d]=n.dimensions,g=s*c,f=u*d;for(let t=0;t<l;t++)for(let a=0;a<c;a++){const c=[0,a,t],l=p(o.imageData,c),d=h(n.imageData,l),[m,v,I]=d,P=a*s+t*g,w=m+v*u+I*f;for(let t=0;t<s;t++){const n=i[P+t]===e?e:0;r.setAtIndex(w+t,n)}}(0,a.triggerSegmentationDataModified)(t)}applyGrowCutLabelmap(t,e,n,o){const i=n.voxelManager;o.voxelManager.forEach(({value:t,index:n})=>{t===e&&i.setAtIndex(n,t)}),(0,a.triggerSegmentationDataModified)(t)}_runLastCommand({shrinkExpandAmount:t=0}={}){const e=f.lastGrowCutCommand;e&&e({shrinkExpandAmount:t})}async getLabelmapSegmentationData(t){const e=s.activeSegmentation.getActiveSegmentation(t.id);if(!e)throw new Error("No active segmentation found");const{segmentationId:n}=e,i=s.segmentIndex.getActiveSegmentIndex(n),{representationData:a}=s.state.getSegmentation(n),c=a[r.SegmentationRepresentations.Labelmap];let{volumeId:l,referencedVolumeId:u}=c;if(!l){const e=t.getImageIds();if(o.utilities.isValidVolume(e)){l=(0,d.getOrCreateSegmentationVolume)(n).volumeId}else{const e=t.getCurrentImageId(),i=o.cache.getImage(e),r=o.imageLoader.createAndCacheDerivedImage(e);u=this._createFakeVolume([i.imageId,r.imageId]).volumeId;const s=(0,g.vl)(t.id,n),a=o.imageLoader.createAndCacheDerivedImage(s);l=this._createFakeVolume([s,a.imageId]).volumeId}}if(!u){const{imageIds:t}=c,e=t.map(t=>o.cache.getImage(t).referencedImageId),n=o.cache.generateVolumeId(e),i=o.cache.getVolume(n);u=i?i.volumeId:(await o.volumeLoader.createAndCacheVolumeFromImagesSync(n,e)).volumeId}return{segmentationId:n,segmentIndex:i,labelmapVolumeId:l,referencedVolumeId:u}}_createFakeVolume(t){const e=o.cache.generateVolumeId(t),n=o.cache.getVolume(e);if(n)return n;const i=o.utilities.generateVolumePropsFromImageIds(t,e),r=i.spacing;0===r[2]&&(r[2]=1);const s=new o.ImageVolume({volumeId:e,dataType:i.dataType,metadata:structuredClone(i.metadata),dimensions:i.dimensions,spacing:i.spacing,origin:i.origin,direction:i.direction,referencedVolumeId:i.referencedVolumeId,imageIds:i.imageIds,referencedImageIds:i.referencedImageIds});return o.cache.putVolumeSync(e,s),s}_isOrthogonalView(t,e){const n=o.cache.getVolume(e).imageData,i=t.getCamera(),{ijkVecColDir:r,ijkVecSliceDir:s}=o.utilities.getVolumeDirectionVectors(n,i);return[r,s].every(t=>o.utilities.isEqual(Math.abs(t[0]),1)||o.utilities.isEqual(Math.abs(t[1]),1)||o.utilities.isEqual(Math.abs(t[2]),1))}getRemoveIslandData(t){}_removeIslands(t){const{islandRemoval:e}=this.configuration;if(!e.enabled)return;const{segmentation:{segmentIndex:n,labelmapVolumeId:i},renderingEngineId:r,viewportId:s}=t,a=o.cache.getVolume(i),c=this.getRemoveIslandData(t);if(!c)return;const[l,d]=a.dimensions,g=l*d,{worldIslandPoints:p=[],islandPointIndexes:f=[]}=c;let m=[...c?.ijkIslandPoints??[]];const v=(0,o.getRenderingEngine)(r).getViewport(s),{voxelManager:I}=a,P=new u.A;m=m.concat(p.map(t=>h(a.imageData,t))),m=m.concat(f.map(t=>[t%l,Math.floor(t/l)%d,Math.floor(t/g)])),P.initialize(v,I,{points:m,previewSegmentIndex:n,segmentIndex:n}),P.floodFillSegmentIsland(),P.removeExternalIslands(),P.removeInternalIslands()}getSegmentStyle({segmentationId:t,viewportId:e,segmentIndex:n}){return(0,l.u)({segmentationId:t,segmentIndex:n,viewportId:e})}}f.toolName="GrowCutBaseTool";const m=f},13271:(t,e,n)=>{n.d(e,{X:()=>i});var o=n(95527);const i=(t,e,n)=>{if(!e?.data?.contour?.polyline?.length)return;const{polyline:i}=e.data.contour,{length:r}=i;let s=1/0;for(let e=0;e<r;e++){const r=t.worldToCanvas(i[e]),a=o.point.distanceToPoint(r,n);s=Math.min(s,a)}return s===1/0||isNaN(s)?void 0:s}},47347:(t,e,n)=>{n.d(e,{M:()=>r});var o=n(10088);function i(t,e,n=!0){const i=Object.assign({},e,{segmentIndex:0});(0,o.pY)(t,i)}function r(t,e){i(t,e,!0)}},5565:(t,e,n)=>{function o(t){if(!Array.isArray(t)||9!==t.length)throw new Error("Matrix must be an array of 9 numbers");if(!t.every(t=>"number"==typeof t&&!isNaN(t)))throw new Error("Matrix must contain only valid numbers")}function i(t){o(t);const e=[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]]],n=e[0][0]*(e[1][1]*e[2][2]-e[1][2]*e[2][1])-e[0][1]*(e[1][0]*e[2][2]-e[1][2]*e[2][0])+e[0][2]*(e[1][0]*e[2][1]-e[1][1]*e[2][0]);if(Math.abs(n)<1e-10)throw new Error("Matrix is not invertible (determinant is zero)");const i=[[e[1][1]*e[2][2]-e[1][2]*e[2][1],-(e[0][1]*e[2][2]-e[0][2]*e[2][1]),e[0][1]*e[1][2]-e[0][2]*e[1][1]],[-(e[1][0]*e[2][2]-e[1][2]*e[2][0]),e[0][0]*e[2][2]-e[0][2]*e[2][0],-(e[0][0]*e[1][2]-e[0][2]*e[1][0])],[e[1][0]*e[2][1]-e[1][1]*e[2][0],-(e[0][0]*e[2][1]-e[0][1]*e[2][0]),e[0][0]*e[1][1]-e[0][1]*e[1][0]]],r=[];for(let t=0;t<3;t++)for(let e=0;e<3;e++)r.push(i[t][e]/n);return r}function r(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t.map(t=>t/e)}function s(t){o(t);const e=t.slice(0,3),n=t.slice(3,6),s=t.slice(6,9),a=r(e),c=r(n),l=r(s),u={x:[1,0,0],y:[0,1,0],z:[0,0,1]},d=1e-10,g=a.every((t,e)=>Math.abs(t-u.x[e])<d)&&c.every((t,e)=>Math.abs(t-u.y[e])<d)&&l.every((t,e)=>Math.abs(t-u.z[e])<d);return{isStandard:g,rotationMatrix:g?[...u.x,...u.y,...u.z]:i([...a,...c,...l])}}function a(t,e,n){const o=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return[n[0]*o+n[1]*i+n[2]*r+e[0],n[3]*o+n[4]*i+n[5]*r+e[1],n[6]*o+n[7]*i+n[8]*r+e[2]]}function c(t,e,n){const o=[];for(let i=0;i<n.length;i+=3){const r=a(n.slice(i,i+3),e,t);o.push(...r)}return o}n.r(e),n.d(e,{checkStandardBasis:()=>s,inverse3x3Matrix:()=>i,rotatePoints:()=>c})},39848:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(15327),i=n(77609);function r(t,e){const n=(0,o.getEnabledElement)(t),{renderingEngineId:r,viewportId:s}=n,a=(0,i.getToolGroupForViewport)(s,r);if(!a)return[];const c=[],l=Object.keys(a.toolOptions);for(let t=0;t<l.length;t++){const n=l[t],o=a.toolOptions[n];if(o&&e.includes(o.mode)){const t=a.getToolInstance(n);c.push(t)}}return c}},22658:(t,e,n)=>{n.d(e,{j:()=>s});var o=n(15327),i=n(19027);const r=4;function s(t,e,n){if("PT"===o.utilities.getViewportModality(t,e)){const{clientWidth:o,clientHeight:s}=t.element,a=5/Math.max(o,s),c=(0,i.isViewportPreScaled)(t,e),{fixedPTWindowWidth:l=!0}=n??{},u=l?0:a;return c?[u,a]:[u,r]}return[r,r]}},38776:(t,e,n)=>{n.d(e,{j:()=>o});class o{constructor(t,e){this.pointArray=t?t.slice():[],this._controlPointIndexes=e?e.slice():[]}getPoint(t){return this.pointArray[t]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(t){const e=this.pointArray.indexOf(t);if(-1!==e)return-1!==this._controlPointIndexes.indexOf(e);throw new Error("Error: isControlPoint called with not in list point.")}addPoint(t){this.pointArray.push(t)}addControlPoint(t){const e=this.pointArray.indexOf(t);if(-1===e)throw new Error("Cannot mark a non registered point as control point.");this._controlPointIndexes.push(e)}getControlPoints(){return this._controlPointIndexes.map(t=>this.pointArray[t])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(t){this.pointArray.splice(this.pointArray.length-t,t)}addPoints(t){this.pointArray=this.pointArray.concat(t)}prependPath(t){const e=t.pointArray.length,n=[];this.pointArray=t.pointArray.concat(this.pointArray);for(let t=0;t<this._controlPointIndexes.length;++t)n[t]=this._controlPointIndexes[t]+e;this._controlPointIndexes=t._controlPointIndexes.concat(n)}appendPath(t){this.addPoints(t.pointArray),t._controlPointIndexes.forEach(t=>this._controlPointIndexes.push(t))}}},78044:(t,e,n)=>{n.d(e,{f:()=>c});var o=n(15327);class i{constructor({numBits:t,getPriority:e,areEqual:n}){this._bucketCount=1<<t,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=void 0!==e?e:t=>t,this._areEqual="function"==typeof n?n:(t,e)=>t===e}push(t){const e=this._getBucketIndex(t),n={value:t,next:this._buckets[e]};this._buckets[e]=n,this._size++}pop(){if(0===this._size)throw new Error("Cannot pop because the queue is empty.");for(;null===this._buckets[this._currentBucketIndex];)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const t=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=t.next,this._size--,t.value}remove(t){if(!t)return!1;const e=this._getBucketIndex(t),n=this._buckets[e];let o,i=n;for(;null!==i&&!this._areEqual(t,i.value);)o=i,i=i.next;return null!==i&&(i===n?this._buckets[e]=i.next:o.next=i.next,this._size--,!0)}isEmpty(){return 0===this._size}_getBucketIndex(t){return this._getPriority(t)&this._mask}_buildArray(t){const e=new Array(t);return e.fill(null),e}}const{isEqual:r}=o.utilities,s=4294967295,a=2/(3*Math.PI);class c{constructor(t,e,n){this._getPointIndex=(t,e)=>{const{width:n}=this;return t*n+e},this._getPointCoordinate=t=>[t%this.width,Math.floor(t/this.width)],this._getPointCost=t=>Math.round(this.searchGranularity*this.costs[t]);const o=t.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=e,this.height=n,this.grayscalePixelData=t,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(o),this.parents=new Uint32Array(o),this.costs=new Float32Array(o)}startSearch(t){const e=this._getPointIndex(t[1],t[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(s),this.costs.fill(1/0),this.priorityQueueNew=new i({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=t,this.costs[e]=0,this.priorityQueueNew.push(e)}findMinNearby(t,e=2){const[n,o]=t,{costs:i}=this,r=[Math.max(0,n-e),Math.min(n+e+1,this.width)],s=[Math.max(0,o-e),Math.min(o+e+1,this.height)];let a=.8*i[this._getPointIndex(o,n)],c=t;for(let n=r[0];n<r[1];n++)for(let o=s[0];o<s[1];o++){const r=1-(Math.abs(n-t[0])+Math.abs(o-t[1]))/e/2,s=.8*i[this._getPointIndex(o,n)]+.2*r;s<a&&(c=[n,o],a=s)}return c}findPathToPoint(t){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:e,_getPointIndex:n,_getPointCoordinate:o}=this,i=n(e[1],e[0]),r=n(t[1],t[0]),{visited:a,parents:c,costs:l,priorityQueueNew:u}=this;if(r===i)return[];for(;!u.isEmpty()&&c[r]===s;){const t=u.pop();if(a[t])continue;const e=o(t),i=this._getNeighborPoints(e);a[t]=!0;for(let o=0,r=i.length;o<r;o++){const r=i[o],s=n(r[1],r[0]),a=this._getWeightedDistance(e,r),d=l[t]+a;d<l[s]&&(l[s]!==1/0&&u.remove(s),l[s]=d,c[s]=t,u.push(s))}}const d=[];let g=r;for(;g!==s;)d.push(o(g)),g=c[g];return d.reverse()}_getDeltaX(t,e){const{grayscalePixelData:n,width:o}=this;let i=this._getPointIndex(e,t);return t+1===o&&i--,n[i+1]-n[i]}_getDeltaY(t,e){const{grayscalePixelData:n,width:o,height:i}=this;let r=this._getPointIndex(e,t);return e+1===i&&(r-=o),n[r]-n[r+o]}_getGradientMagnitude(t,e){const n=this._getDeltaX(t,e),o=this._getDeltaY(t,e);return Math.sqrt(n*n+o*o)}_getLaplace(t,e){const{grayscalePixelData:n,_getPointIndex:o}=this;let i=n[o(e-2,t)];return i+=n[o(e-1,t-1)]+2*n[o(e-1,t)]+n[o(e-1,t+1)],i+=n[o(e,t-2)]+2*n[o(e,t-1)]-16*n[o(e,t)]+2*n[o(e,t+1)]+n[o(e,t+2)],i+=n[o(e+1,t-1)]+2*n[o(e+1,t)]+n[o(e+1,t+1)],i+=n[o(e+2,t)],i}_computeGradient(){const{width:t,height:e}=this,n=new Float32Array(t*e);let o=0,i=0,r=0,s=0;for(s=0;s<e-1;s++){for(r=0;r<t-1;r++)n[o]=this._getGradientMagnitude(r,s),i=Math.max(n[o],i),o++;n[o]=n[o-1],o++}for(let e=n.length;o<e;o++)n[o]=n[o-t];for(let t=0,e=n.length;t<e;t++)n[t]=1-n[t]/i;return n}_computeLaplace(){const{width:t,height:e,_getPointIndex:n}=this,o=new Float32Array(t*e);o.fill(1,0,n(2,0));for(let i=2;i<e-2;i++){o[n(i,0)]=1,o[n(i,1)]=1;for(let e=2;e<t-2;e++)o[n(i,e)]=this._getLaplace(e,i)>.33?0:1;o[n(i,t-2)]=1,o[n(i,t-1)]=1}return o.fill(1,n(e-2,0)),o}_computeGradientX(){const{width:t,height:e}=this,n=new Float32Array(t*e);let o=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++)n[o++]=this._getDeltaX(e,i);return n}_computeGradientY(){const{width:t,height:e}=this,n=new Float32Array(t*e);let o=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++)n[o++]=this._getDeltaY(e,i);return n}_getGradientUnitVector(t,e){const{gradXNew:n,gradYNew:o,_getPointIndex:i}=this,r=n[i(e,t)],s=o[i(e,t)];let a=Math.sqrt(r*r+s*s);return a=Math.max(a,1e-100),[r/a,s/a]}_getGradientDirection(t,e,n,o){const i=this._getGradientUnitVector(t,e),r=this._getGradientUnitVector(n,o);let s=i[1]*(n-t)-i[0]*(o-e),c=r[1]*(n-t)-r[0]*(o-e);s<0&&(s=-s,c=-c),t!==n&&e!==o&&(s*=Math.SQRT1_2,c*=Math.SQRT1_2),c=Math.min(Math.max(c,-1),1);const l=a*(Math.acos(Math.min(s,1))+Math.acos(c));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",t,e,n,o,s,c,l),1):l}getCost(t,e){return this._getWeightedDistance(t,e)}_getWeightedDistance(t,e){const{_getPointIndex:n,width:o,height:i}=this,[r,s]=t,[a,c]=e;if(a<0||a>=o||c<0||c>=i)return 1;if(r<0||s<0||r>=o||s>=i)return 0;const l=n(c,a);let u=this.gradMagnitude[l];r!==a&&s!==c||(u*=Math.SQRT1_2);return.43*u+.43*this.laplace[l]+.11*this._getGradientDirection(r,s,a,c)}_getNeighborPoints(t){const{width:e,height:n}=this,o=[],i=Math.max(t[0]-1,0),r=Math.max(t[1]-1,0),s=Math.min(t[0]+1,e-1),a=Math.min(t[1]+1,n-1);for(let e=r;e<=a;e++)for(let n=i;n<=s;n++)n===t[0]&&e===t[1]||o.push([n,e]);return o}static createInstanceFromRawPixelData(t,e,n,o){const i=t.length,r=new Float32Array(i),{lower:s,upper:a}=o,l=a-s;for(let e=0,n=t.length;e<n;e++)r[e]=Math.max(0,Math.min(1,(t[e]-s)/l));return new c(r,e,n)}}},88638:(t,e,n)=>{function o(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}function i(t,e){const n=t.maxX-t.minX,o=t.maxY-t.minY,i=[n,o],r=[t.minX+n/2,t.minY+o/2],s=[Math.abs(e[0]-r[0]),Math.abs(e[1]-r[1])],a=s[0]-.5*i[0],c=s[1]-.5*i[1];if(a>0&&c>0)return a*a+c*c;const l=Math.max(a,0)+Math.max(c,0);return l*l}function r(t,e){return Math.sqrt(i(t,e))}n.r(e),n.d(e,{distanceToPoint:()=>r,distanceToPointSquared:()=>i,intersectAABB:()=>o})},25963:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(3823);function i(t,e){return 3===t[0].length?function(t,e){const[n,i]=t,[r,s]=e,a=o.eR.sub(o.eR.create(),i,n),c=o.eR.sub(o.eR.create(),r,s),l=o.eR.dot(a,c)/(o.eR.length(a)*o.eR.length(c));return 180*Math.acos(l)/Math.PI}(t,e):function(t,e){const[n,i]=t,[r,s]=e,a=o.Zc.sub(o.Zc.create(),i,n),c=o.Zc.sub(o.Zc.create(),r,s),l=o.Zc.dot(a,c)/(o.Zc.length(a)*o.Zc.length(c));return Math.acos(l)*(180/Math.PI)}(t,e)}},83923:(t,e,n)=>{n.r(e),n.d(e,{angleBetweenLines:()=>o.A});var o=n(25963)},28364:(t,e,n)=>{n.d(e,{I:()=>i,t:()=>o});class o{}class i{constructor(t){this.storePointData=t.storePointData}getStatistics(){console.debug("InstanceCalculator getStatistics called")}}},73262:(t,e,n)=>{n.r(e),n.d(e,{BasicStatsCalculator:()=>o.O,Calculator:()=>i.t,InstanceBasicStatsCalculator:()=>o.B,InstanceCalculator:()=>i.I});var o=n(69013),i=n(28364)},77081:(t,e,n)=>{n.r(e),n.d(e,{getCanvasCircleCorners:()=>r,getCanvasCircleRadius:()=>i});var o=n(82216);function i(t){const[e,n]=t;return(0,o.distanceToPoint)(e,n)}function r(t){const[e,n]=t,i=(0,o.distanceToPoint)(e,n);return[[e[0]-i,e[1]-i],[e[0]+i,e[1]+i]]}},87009:(t,e,n)=>{function o(t,e,n={}){return n.precalculated||i(t,n),n.precalculated(e)}n.r(e),n.d(e,{getCanvasEllipseCorners:()=>r,pointInEllipse:()=>o,precalculatePointInEllipse:()=>i});const i=(t,e={})=>{const{xRadius:n,yRadius:o,zRadius:i}=t;void 0!==e.invXRadiusSq&&void 0!==e.invYRadiusSq&&void 0!==e.invZRadiusSq||(e.invXRadiusSq=0!==n?1/n**2:0,e.invYRadiusSq=0!==o?1/o**2:0,e.invZRadiusSq=0!==i?1/i**2:0);const{invXRadiusSq:r,invYRadiusSq:s,invZRadiusSq:a}=e,{center:c}=t,[l,u,d]=c;return e.precalculated=t=>{const e=t[0]-l;let n=e*e*r;if(n>1)return!1;const o=t[1]-u;if(n+=o*o*s,n>1)return!1;const i=t[2]-d;return n+=i*i*a,n<=1},e};function r(t){const[e,n,o,i]=t;return[[o[0],n[1]],[i[0],e[1]]]}},17787:(t,e,n)=>{function o(t,e){const n=e[0]-t[0],o=e[1]-t[1];return function(t){return(t%360+360)%360}(Math.atan2(o,n)*(180/Math.PI))}function i(t,e){const n=o(t,e[0]),i=o(t,e[1]);return n<i?[n,i]:[i,n]}function r(t){if(!t.length)return[];t.sort((t,e)=>t[0]-e[0]);const e=[t[0].slice()];for(let n=1;n<t.length;n++){const o=e[e.length-1],i=t[n];i[0]<=o[1]?o[1]=Math.max(o[1],i[1]):e.push(i.slice())}return e}function s(t,e){const[n,o]=e;if(o<=n)return[];const i=t.map(([t,e])=>[Math.max(t,n),Math.min(e,o)]).filter(([t,e])=>e>t);if(0===i.length)return[[n,o]];i.sort((t,e)=>t[0]-e[0]);const r=[];let[s,a]=i[0];for(let t=1;t<i.length;t++){const[e,n]=i[t];e<=a?a=Math.max(a,n):(r.push([s,a]),[s,a]=[e,n])}r.push([s,a]);const c=[];let l=n;for(const[t,e]of r)t>l&&c.push([l,t]),l=Math.max(l,e);return l<o&&c.push([l,o]),c}function a(t,e){const n=[];for(const o of e){const e=Math.max(t[0],o[0]),i=Math.min(t[1],o[1]);e<i&&n.push([e,i])}return n}function c(t,e,n){const o=r(e.map(e=>i(t,e))),s=o.reduce((t,[e,n])=>t+(n-e),0);if(0===s)return 0;const c=[];for(const e of n){const n=a(i(t,e),o);c.push(...n)}const l=r(c).reduce((t,[e,n])=>t+(n-e),0)/s*100;return Math.min(100,Math.max(0,l))}n.d(e,{IM:()=>a,Mo:()=>c,R3:()=>i,V0:()=>s,l7:()=>r,xA:()=>o})},18989:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(73149);function i(t,e,n){return(0,o.A)(t,e,n).distanceSquared}},73149:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(82216);function i(t,e,n){let i;const r=(0,o.distanceToPointSquared)(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(i=t),!i){const o=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/r;i=o<0?t:o>1?e:[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}return{point:[...i],distanceSquared:(0,o.distanceToPointSquared)(n,i)}}},91818:(t,e,n)=>{n.d(e,{A:()=>i});const o=.01;function i(t,e,n){const i=t[0]<=e[0]?t[0]:e[0],r=t[0]>=e[0]?t[0]:e[0],s=t[1]<=e[1]?t[1]:e[1],a=t[1]>=e[1]?t[1]:e[1];if(!(n[0]>=i-o&&n[0]<=r+o&&n[1]>=s-o&&n[1]<=a+o))return!1;const c=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return(c>=0?c:-c)<=o}},82983:(t,e,n)=>{n.d(e,{f:()=>i});const o=(...t)=>{const e=2===t[0].length?[0,0]:[0,0,0],n=t.length;for(const o of t)e[0]+=o[0]/n,e[1]+=o[1]/n,3===e.length&&(e[2]+=o[2]/n);return e},i=o},82216:(t,e,n)=>{function o(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[n,o,i=0]=t,[r,s,a=0]=e,c=r-n,l=s-o,u=a-i;return c*c+l*l+u*u}function i(t,e){return Math.sqrt(o(t,e))}function r(t,e){const[n,o]=t,[i,r]=e;return[2*i-n,2*r-o]}n.r(e),n.d(e,{distanceToPoint:()=>i,distanceToPointSquared:()=>o,mirror:()=>r})},97792:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(15327),i=n(3823);const r=(t,e,n,r)=>{const{xDir:s,yDir:a,spacing:c}=r,l=(0,o.getEnabledElement)(t),{viewport:u}=l;if(!e.length)return e.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const d=u.canvasToWorld(e[e.length-1]),g=u.canvasToWorld(n),h=i.eR.create();i.eR.subtract(h,g,d);const p=Math.abs(i.eR.dot(h,s)),f=Math.abs(i.eR.dot(h,a)),m=Math.max(Math.floor(p/c[0]),Math.floor(f/c[0]));if(m>1){const t=e[e.length-1],o=i.Zc.dist(t,n),r=i.Zc.create();i.Zc.subtract(r,n,t),i.Zc.set(r,r[0]/o,r[1]/o);const s=o/m;for(let n=1;n<=m;n++)e.push([t[0]+s*r[0]*n,t[1]+s*r[1]*n])}else e.push(n);return m}},56777:(t,e,n)=>{function o(t,e,n,o){let s=!1;const a=t[0]<e[0]?t[0]:e[0],c=t[1]<e[1]?t[1]:e[1],l=t[0]>e[0]?t[0]:e[0],u=t[1]>e[1]?t[1]:e[1],d=n[0]<o[0]?n[0]:o[0],g=n[1]<o[1]?n[1]:o[1],h=n[0]>o[0]?n[0]:o[0],p=n[1]>o[1]?n[1]:o[1];if(a>h||l<d||c>p||u<g)return!1;const f=[i(t,e,n),i(t,e,o),i(n,o,t),i(n,o,e)];return f[0]!==f[1]&&f[2]!==f[3]||((0===f[0]&&r(t,n,e)||0===f[1]&&r(t,o,e)||0===f[2]&&r(n,t,o)||0===f[3]&&r(n,e,o))&&(s=!0),s)}function i(t,e,n){const o=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return 0===o?0:o>0?1:2}function r(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}n.d(e,{A:()=>o})},68385:(t,e,n)=>{n.d(e,{S:()=>f});var o,i,r,s=n(82216),a=n(37135),c=n(46513),l=n(42436),u=n(405),d=n(11377),g=n(3823),h=n(10812);function p(t){for(let e=0,n=t.length;e<n;e++){const o=t[e];o.next||(o.next=t[e===n-1?0:e+1])}}function f(t,e){const n=(0,d.A)(t),f=(0,d.A)(e),m=g.eR.dot(f,n);g.Fd.equals(1,m)||(e=e.slice().reverse());if(!(0,u.A)(e,t)&&(0,l.A)(e,t))return e.slice();const{targetPolylinePoints:v}=function(t,e){const n=[],l=[],u=new Map;let d=(0,c.A)(e,t[0])?r.Exiting:r.Entering;for(let l=0,g=t.length;l<g;l++){const p=t[l],f=(0,c.A)(e,p),m={type:o.Vertex,coordinates:p,position:f?i.Inside:i.Outside,visited:!1,next:null};n.push(m);const v=t[l===g-1?0:l+1],I=(0,a.A)(e,p,v).map(t=>{const n=t[0],o=e[t[0]],i=e[t[1]],r=(0,h.A)(p,v,o,i);return{sourceLineSegmentId:n,coordinate:r,targetStartPointDistSquared:s.distanceToPointSquared(p,r)}});I.sort((t,e)=>t.targetStartPointDistSquared-e.targetStartPointDistSquared),I.forEach(t=>{const{sourceLineSegmentId:e,coordinate:s}=t,a={type:o.Intersection,coordinates:s,position:i.Edge,direction:d,visited:!1,next:null},c={...a,direction:r.Unknown,cloned:!0};d===r.Entering?a.next=c:c.next=a;let l=u.get(e);l||(l=[],u.set(e,l)),n.push(a),l.push(c),d*=-1})}for(let t=0,n=e.length;t<n;t++){const n=t,i=e[t],r={type:o.Vertex,coordinates:i,visited:!1,next:null};l.push(r);const a=u.get(n);a?.length&&a.map(t=>({intersectionPoint:t,lineSegStartDistSquared:s.distanceToPointSquared(i,t.coordinates)})).sort((t,e)=>t.lineSegStartDistSquared-e.lineSegStartDistSquared).map(({intersectionPoint:t})=>t).forEach(t=>l.push(t))}return p(n),p(l),{targetPolylinePoints:n,sourcePolylinePoints:l}}(t,e),I=function(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];if(!n.visited&&n.position===i.Outside&&n.type===o.Vertex)return n}for(let e=0,n=t.length;e<n;e++){const n=t[e];if(!n.visited&&n.position===i.Outside)return n}}(v);if(!I)return t.slice();const P=[I.coordinates];let w=I.next,y=0;const b=t.length+e.length+1e3;for(;w!==I&&y<b;)if(y++,w.type===o.Intersection&&w.cloned)w=w.next;else if(P.push(w.coordinates),w=w.next,!w){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}return y>=b&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),P}!function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"}(o||(o={})),function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"}(i||(i={})),function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"}(r||(r={}))},46513:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(19246);function i(t,e,n={closed:void 0}){if(t.length<3)return!1;const r=t.length;let s=0;const{closed:a,holes:c}=n;if(c?.length)for(const t of c)if(i(t,e))return!1;const l=!(void 0===a?(0,o.A)(t):a),u=t.length-(l?1:2);for(let n=0;n<=u;n++){const o=t[n],i=t[n===r-1?0:n+1],a=o[0]>=i[0]?o[0]:i[0],c=o[1]>=i[1]?o[1]:i[1],l=o[1]<=i[1]?o[1]:i[1];if(e[0]<=a&&e[1]>=l&&e[1]<c){let t=o[0]===i[0];if(!t){const n=(e[1]-o[1])*(i[0]-o[0])/(i[1]-o[1])+o[0];t=e[0]<=n}s+=t?1:0}}return!!(s%2)}},58754:(t,e,n)=>{function o(t){if(t.length<3)return t.slice();const e=t.map(t=>[t[0],t[1]]).sort((t,e)=>t[0]===e[0]?t[1]-e[1]:t[0]-e[0]);function n(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}const o=[];for(const t of e){for(;o.length>=2&&n(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}const i=[];for(let t=e.length-1;t>=0;t--){const o=e[t];for(;i.length>=2&&n(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}return o.pop(),i.pop(),o.concat(i)}n.d(e,{A:()=>o})},98122:(t,e,n)=>{function o(t,e){let n=t;const o=e?.numDimensions||2,i=3===o;if(!Array.isArray(t[0])){const e=t,r=e.length/o;n=new Array(e.length/o);for(let t=0,s=r;t<s;t++)n[t]=[e[t*o],e[t*o+1]],i&&n[t].push(e[t*o+2])}let r=1/0,s=1/0,a=-1/0,c=-1/0,l=1/0,u=-1/0;for(let t=0,e=n.length;t<e;t++){const[e,o,d]=n[t];r=r<e?r:e,s=s<o?s:o,a=a>e?a:e,c=c>o?c:o,i&&(l=l<d?l:d,u=u>d?u:d)}return i?{minX:r,maxX:a,minY:s,maxY:c,minZ:l,maxZ:u}:{minX:r,maxX:a,minY:s,maxY:c}}n.d(e,{A:()=>o})},86909:(t,e,n)=>{function o(t){const e=t.length;let n=0,o=e-1;for(let i=0;i<e;i++)n+=(t[o][0]+t[i][0])*(t[o][1]-t[i][1]),o=i;return Math.abs(n/2)}n.d(e,{A:()=>o})},32979:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(3823),i=n(56777);function r(t,e,n,r=!0){let s,a;r?(a=t.length-1,s=0):(a=0,s=1);const c=[];for(let o=s;o<t.length;o++){const r=t[a],s=t[o];(0,i.A)(e,n,r,s)&&c.push([a,o]),a=o}if(0===c.length)return;const l=[];c.forEach(n=>{const i=[t[n[0]],t[n[1]]],r=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];l.push(o.Zc.distance(r,e))});const u=Math.min(...l);return{segment:c[l.indexOf(u)],distance:u}}},4338:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(56777);function i(t,e,n,i=!0){let r,s;i?(s=t.length-1,r=0):(s=0,r=1);for(let i=r;i<t.length;i++){const r=t[s],a=t[i];if((0,o.A)(e,n,r,a))return[s,i];s=i}}},50932:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(37135),i=n(10812);function r(t,e,n,r=!0){const s=[],a=(0,o.A)(t,e,n,r);for(let o=0;o<a.length;o++){const r=t[a[o][0]],c=t[a[o][1]],l=(0,i.A)(e,n,r,c);s.push(l)}return s}},37135:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(56777);function i(t,e,n,i=!0){const r=[],s=t.length,a=s-(i?1:2);for(let i=0;i<=a;i++){const a=t[i],c=i===s-1?0:i+1,l=t[c];(0,o.A)(e,n,a,l)&&r.push([i,c])}return r}},10812:(t,e,n)=>{n.d(e,{A:()=>r});var o=n(93258);const i=.01;function r(t,e,n,r){const s=[e[0]-t[0],e[1]-t[1]],a=[r[0]-n[0],r[1]-n[1]],c=a[1]*s[0]-a[0]*s[1];if((c>=0?c:-c)<i){const i=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],s=[n[0]<r[0]?n[0]:r[0],n[0]>r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[1]>r[1]?n[1]:r[1]];if(!(i[0]<=s[1]&&i[1]>=s[0]&&i[2]<=s[3]&&i[3]>=s[2]))return;if(!(o.isPointOnLineSegment(t,e,n)||o.isPointOnLineSegment(t,e,r)||o.isPointOnLineSegment(n,r,t)))return;return[.5*((i[0]>s[0]?i[0]:s[0])+(i[1]<s[1]?i[1]:s[1])),.5*((i[2]>s[2]?i[2]:s[2])+(i[3]<s[3]?i[3]:s[3]))]}let l=t[1]-n[1],u=t[0]-n[0];const d=s[0]*l-s[1]*u;l=(a[0]*l-a[1]*u)/c,u=d/c;return[t[0]+l*s[0],t[1]+l*s[1]]}},11377:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(63113);function i(t){const e=(0,o.A)(t);return[0,0,e/Math.abs(e)]}},43490:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(3823);function i(t){const e=function(t){const e=o.eR.create(),n=t[0];for(let o=0,i=t.length;o<i;o++){const r=t[o],s=t[o===i-1?0:o+1],a=r[0]-n[0],c=r[1]-n[1],l=r[2]-n[2],u=s[0]-n[0],d=s[1]-n[1],g=s[2]-n[2];e[0]+=c*g-l*d,e[1]+=l*u-a*g,e[2]+=a*d-c*u}return o.eR.scale(e,e,.5),e}(t);return o.eR.normalize(e,e)}},61785:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(15327),i=n(3823);const r=.001,s=(t,e)=>{let n,s,a;if(t instanceof o.StackViewport){const e=t.getImageData();if(!e)return;s=e.direction.slice(0,3),a=e.direction.slice(3,6),n=e.spacing}else{const e=t.getImageData(),{direction:o,spacing:c}=e,{viewPlaneNormal:l,viewUp:u}=t.getCamera(),d=o.slice(0,3),g=o.slice(3,6),h=o.slice(6,9),p=i.eR.create();i.eR.cross(p,u,l);const f=Math.abs(i.eR.dot(p,d)),m=Math.abs(i.eR.dot(p,g)),v=Math.abs(i.eR.dot(p,h));let I;if(Math.abs(1-f)<r)I=c[0],s=d;else if(Math.abs(1-m)<r)I=c[1],s=g;else{if(!(Math.abs(1-v)<r))throw new Error("No support yet for oblique plane planar contours");I=c[2],s=h}const P=Math.abs(i.eR.dot(u,d)),w=Math.abs(i.eR.dot(u,g)),y=Math.abs(i.eR.dot(u,h));let b;if(Math.abs(1-P)<r)b=c[0],a=d;else if(Math.abs(1-w)<r)b=c[1],a=g;else{if(!(Math.abs(1-y)<r))throw new Error("No support yet for oblique plane planar contours");b=c[2],a=h}n=[I,b]}return{spacing:[n[0]/e,n[1]/e],xDir:s,yDir:a}}},4239:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(63113);function i(t){return(0,o.A)(t)>=0?1:-1}},405:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(4338);function i(t,e){for(let n=0,i=t.length;n<i;n++){const r=t[n],s=t[n===i-1?0:n+1],a=(0,o.A)(e,r,s);if(2===a?.length)return!0}return!1}},70112:(t,e,n)=>{n.d(e,{A:()=>a});var o=n(3823),i=n(46513),r=n(63113),s=n(36039);function a(t,e){if(t.length<3||e.length<3)return[];let n=e.slice();const a=(0,r.A)(t),c=(0,r.A)(n);if(Math.abs(a)<s.p8||Math.abs(c)<s.p8)return[];a<0&&(t=t.slice().reverse()),c<0&&(n=n.slice().reverse());const l=n,u=[];for(let e=0;e<t.length;e++){const i=t[e],r=t[(e+1)%t.length];for(let t=0;t<n.length;t++){const a=n[t],c=n[(t+1)%n.length],l=(0,s.O4)(i,r,a,c);if(l){const n=Math.sqrt(o.Zc.squaredDistance(i,r)),d=Math.sqrt(o.Zc.squaredDistance(a,c));u.push({coord:[...l],seg1Idx:e,seg2Idx:t,alpha1:n<s.p8?0:Math.sqrt(o.Zc.squaredDistance(i,l))/n,alpha2:d<s.p8?0:Math.sqrt(o.Zc.squaredDistance(a,l))/d})}}}if(0===u.length)return(0,i.A)(l,t[0])&&t.every(t=>(0,i.A)(l,t))?[[...t.map(t=>[...t])]]:(0,i.A)(t,n[0])&&n.every(e=>(0,i.A)(t,e))?[[...n.map(t=>[...t])]]:[];const d=(t,e,n)=>{const o=[];let i=0;for(let r=0;r<t.length;r++){const a=t[r];o.push({id:`${e}_v${i++}`,coordinates:[...a],type:s.n7.Vertex,originalPolyIndex:e,originalVertexIndex:r,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:s.lG.Unknown});const c=n.filter(t=>(0===e?t.seg1Idx:t.seg2Idx)===r).sort((t,n)=>(0===e?t.alpha1:t.alpha2)-(0===e?n.alpha1:n.alpha2));for(const t of c){if(o.length>0&&(0,s.Sk)(o[o.length-1].coordinates,t.coord)){const n=o[o.length-1];n.isIntersection||(n.isIntersection=!0,n.intersectionInfo=t,n.alpha=0===e?t.alpha1:t.alpha2,n.type=s.n7.Intersection);continue}o.push({id:`${e}_i${i++}`,coordinates:[...t.coord],type:s.n7.Intersection,originalPolyIndex:e,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:0===e?t.alpha1:t.alpha2,intersectionInfo:t,intersectionDir:s.lG.Unknown})}}const r=[];if(o.length>0){r.push(o[0]);for(let t=1;t<o.length;t++)if((0,s.Sk)(o[t].coordinates,r[r.length-1].coordinates)){const e=r[r.length-1];o[t].isIntersection&&o[t].intersectionInfo&&(e.isIntersection=!0,e.intersectionInfo=o[t].intersectionInfo,e.alpha=o[t].alpha,e.type=s.n7.Intersection)}else r.push(o[t])}if(r.length>1&&(0,s.Sk)(r[0].coordinates,r[r.length-1].coordinates)){const t=r[0],e=r.pop();e.isIntersection&&!t.isIntersection&&e.intersectionInfo&&(t.isIntersection=!0,t.intersectionInfo=e.intersectionInfo,t.alpha=e.alpha,t.type=s.n7.Intersection)}if(r.length>0)for(let t=0;t<r.length;t++)r[t].next=r[(t+1)%r.length],r[t].prev=r[(t-1+r.length)%r.length];return r},g=d(t,0,u),h=d(n,1,u);if(0===g.length||0===h.length)return[];g.forEach(t=>{if(t.isIntersection&&t.intersectionInfo){const e=t.intersectionInfo,n=h.find(n=>n.isIntersection&&n.intersectionInfo&&(0,s.Sk)(n.coordinates,t.coordinates)&&n.intersectionInfo.seg1Idx===e.seg1Idx&&n.intersectionInfo.seg2Idx===e.seg2Idx);if(n){t.partnerNode=n,n.partnerNode=t;const e=o.Zc.subtract(o.Zc.create(),t.coordinates,t.prev.coordinates),r=o.Zc.subtract(o.Zc.create(),n.next.coordinates,n.coordinates),a=e[0]*r[1]-e[1]*r[0];if(a>s.p8)t.intersectionDir=s.lG.Entering,n.intersectionDir=s.lG.Exiting;else if(a<-s.p8)t.intersectionDir=s.lG.Exiting,n.intersectionDir=s.lG.Entering;else{const e=[(t.prev.coordinates[0]+t.coordinates[0])/2,(t.prev.coordinates[1]+t.coordinates[1])/2];(0,i.A)(l,e)?(t.intersectionDir=s.lG.Exiting,n.intersectionDir=s.lG.Entering):(t.intersectionDir=s.lG.Entering,n.intersectionDir=s.lG.Exiting)}}else t.isIntersection=!1,t.intersectionInfo=void 0}});const p=[];for(const t of g){if(!t.isIntersection||t.visited||t.intersectionDir!==s.lG.Entering)continue;let e=[],n=t,o=!0;const i=t;let c=0;const l=2*(g.length+h.length);g.forEach(t=>t.processedInPath=!1),h.forEach(t=>t.processedInPath=!1);do{if(c++>l){console.warn("Intersection: Max iterations in path tracing.",i.id,n.id),e=[];break}if(n.processedInPath&&n!==i){console.warn("Intersection: Path processing loop detected, discarding path segment.",i.id,n.id),e=[];break}n.processedInPath=!0,n.visited=!0,0!==e.length&&(0,s.Sk)(e[e.length-1],n.coordinates)||e.push([...n.coordinates]);let t=!1;n.isIntersection&&n.partnerNode&&(o?(n=n.partnerNode,o=!1,t=!0):(n=n.partnerNode,o=!0,t=!0)),n=n.next}while(n!==i||o&&0!==n.originalPolyIndex||!o&&1!==n.originalPolyIndex);if(c>l||0===e.length||e.length>0&&(0,s.Sk)(e[0],e[e.length-1])&&e.pop(),e.length>=3){const t=(0,r.A)(e);(a>0&&t<0||a<0&&t>0)&&e.reverse(),p.push(e.map(t=>[...t]))}}return p}},8361:(t,e,n)=>{n.d(e,{i:()=>r});var o=n(46513),i=n(28502);function r(t,e,n={}){const{sharedDimensionIndex:r,projectedPolyline:s}=(0,i.p)(e),{holes:a}=n,c=[];if(a)for(let t=0;t<a.length;t++){const e=a[t],n=[];for(let t=0;t<e.length;t++)n.push([e[t][(r+1)%3],e[t][(r+2)%3]]);c.push(n)}const l=[t[(r+1)%3],t[(r+2)%3]];return(0,o.A)(s,l,{holes:c})}},80514:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(3823);const i=(t,e,n,i)=>{const r=[t[0]-e[0],t[1]-e[1]],s=[n[0]-e[0],n[1]-e[1]],a=r[0]*s[0]+r[1]*s[1];if(a<0)return!1;const c=Math.sqrt(s[0]*s[0]+s[1]*s[1]);if(0===c)return!1;const l=a/c,u=[s[0]/c,s[1]/c],d=[u[0]*l,u[1]*l],g=[e[0]+d[0],e[1]+d[1]];return!(o.Zc.distance(t,g)>i)&&!(o.Zc.distance(e,g)>o.Zc.distance(e,n))}},82265:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(3823);const i=(t,e,n)=>o.Zc.dist(t,e)<n},28502:(t,e,n)=>{n.d(e,{p:()=>r});var o=n(15327);const i=1e-6;function r(t){let e;const n=o.utilities.getRandomSampleFromArray(t,50);for(let t=0;t<3;t++)if(n.every((e,n,o)=>Math.abs(e[t]-o[0][t])<i)){e=t;break}if(void 0===e)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],s=(e+1)%3,a=(e+2)%3;for(let e=0;e<t.length;e++)r.push([t[e][s],t[e][a]]);return{sharedDimensionIndex:e,projectedPolyline:r}}},36039:(t,e,n)=>{n.d(e,{O4:()=>c,Sk:()=>a,lG:()=>u,n7:()=>l,p8:()=>r});var o=n(15327),i=n(3823);const r=1e-7;function s(t,e){return t[0]*e[1]-t[1]*e[0]}function a(t,e){return o.utilities.isEqual(t,e,r)}function c(t,e,n,o){const c=i.Zc.subtract(i.Zc.create(),e,t),l=i.Zc.subtract(i.Zc.create(),o,n),u=s(c,l),d=i.Zc.subtract(i.Zc.create(),n,t),g=s(d,c);if(Math.abs(u)<r){if(Math.abs(g)<r){const s=i.Zc.dot(c,c),u=i.Zc.dot(l,l);if(s<r||u<r)return a(t,n)||a(t,o)?t:a(e,n)||a(e,o)?e:null;const d=i.Zc.dot(i.Zc.subtract(i.Zc.create(),n,t),c)/s,g=i.Zc.dot(i.Zc.subtract(i.Zc.create(),o,t),c)/s,h=i.Zc.dot(i.Zc.subtract(i.Zc.create(),t,n),l)/u,p=i.Zc.dot(i.Zc.subtract(i.Zc.create(),e,n),l)/u,f=t=>t>=-r&&t<=1+r;if(f(d)){if(a(n,i.Zc.scaleAndAdd(i.Zc.create(),t,c,d)))return n}if(f(g)){if(a(o,i.Zc.scaleAndAdd(i.Zc.create(),t,c,g)))return o}if(f(h)){if(a(t,i.Zc.scaleAndAdd(i.Zc.create(),n,l,h)))return t}if(f(p)){if(a(e,i.Zc.scaleAndAdd(i.Zc.create(),n,l,p)))return e}}return null}const h=s(d,l)/u,p=g/u;return h>=-r&&h<=1+r&&p>=-r&&p<=1+r?[t[0]+h*c[0],t[1]+h*c[1]]:null}var l,u;!function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"}(l||(l={})),function(t){t[t.Entering=0]="Entering",t[t.Exiting=1]="Exiting",t[t.Unknown=2]="Unknown"}(u||(u={}))},6521:(t,e,n)=>{n.d(e,{A:()=>c});var o=n(3823),i=n(63113),r=n(36039),s=n(46513),a=n(15346);function c(t,e){if(t.length<3)return[];if(e.length<3)return[t.slice()];const n=e.slice();if((0,a.A)(t,e))return[];const c=(0,i.A)(t),l=(0,i.A)(n);Math.sign(c)===Math.sign(l)&&Math.abs(l)>r.p8&&n.reverse();const u=[];for(let e=0;e<t.length;e++){const i=t[e],s=t[(e+1)%t.length];for(let t=0;t<n.length;t++){const a=n[t],c=n[(t+1)%n.length],l=(0,r.O4)(i,s,a,c);if(l){const n=Math.sqrt(o.Zc.squaredDistance(i,s)),d=Math.sqrt(o.Zc.squaredDistance(a,c));u.push({coord:l,seg1Idx:e,seg2Idx:t,alpha1:n<r.p8?0:Math.sqrt(o.Zc.squaredDistance(i,l))/n,alpha2:d<r.p8?0:Math.sqrt(o.Zc.squaredDistance(a,l))/d})}}}const d=(t,e,n)=>{const o=[];let i=0;for(let s=0;s<t.length;s++){const a=t[s];o.push({id:`${e}_v${i++}`,coordinates:a,type:r.n7.Vertex,originalPolyIndex:e,originalVertexIndex:s,next:null,prev:null,isIntersection:!1,visited:!1});const c=n.filter(t=>(0===e?t.seg1Idx:t.seg2Idx)===s).sort((t,n)=>(0===e?t.alpha1:t.alpha2)-(0===e?n.alpha1:n.alpha2));for(const t of c)o.length>0&&(0,r.Sk)(o[o.length-1].coordinates,t.coord)?o[o.length-1].isIntersection||(o[o.length-1].isIntersection=!0,o[o.length-1].intersectionInfo=t,o[o.length-1].alpha=0===e?t.alpha1:t.alpha2):o.push({id:`${e}_i${i++}`,coordinates:t.coord,type:r.n7.Intersection,originalPolyIndex:e,next:null,prev:null,isIntersection:!0,visited:!1,alpha:0===e?t.alpha1:t.alpha2,intersectionInfo:t})}const s=[];if(o.length>0){s.push(o[0]);for(let t=1;t<o.length;t++)(0,r.Sk)(o[t].coordinates,s[s.length-1].coordinates)?o[t].isIntersection&&(s[s.length-1].isIntersection=!0,s[s.length-1].intersectionInfo=o[t].intersectionInfo,s[s.length-1].alpha=o[t].alpha):s.push(o[t])}if(s.length>0)for(let t=0;t<s.length;t++)s[t].next=s[(t+1)%s.length],s[t].prev=s[(t-1+s.length)%s.length];return s},g=d(t,0,u),h=d(n,1,u);g.forEach(t=>{if(t.isIntersection){const n=t.intersectionInfo,i=h.find(e=>e.isIntersection&&(0,r.Sk)(e.coordinates,t.coordinates)&&e.intersectionInfo.seg1Idx===n.seg1Idx&&e.intersectionInfo.seg2Idx===n.seg2Idx);if(i){t.partnerNode=i,i.partnerNode=t;const n=t.prev.coordinates,a=t.coordinates,c=i.next.coordinates,l=(o.Zc.subtract(o.Zc.create(),a,n),o.Zc.subtract(o.Zc.create(),c,a),[(t.prev.coordinates[0]+t.coordinates[0])/2,(t.prev.coordinates[1]+t.coordinates[1])/2]),u=(0,s.A)(e,l);t.intersectionDir=u?r.lG.Exiting:r.lG.Entering}else t.isIntersection=!1}}),g.forEach(t=>delete t.intersectionInfo),h.forEach(t=>delete t.intersectionInfo);const p=[];for(let t=0;t<g.length;t++){const n=g[t];if(n.visited||n.isIntersection)continue;if((0,s.A)(e,n.coordinates))continue;const o=[];let i=n,a=!0,c=0;const l=2*(g.length+h.length);do{if(c++>l){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}i.visited=!0,0!==o.length&&(0,r.Sk)(o[o.length-1],i.coordinates)||o.push(i.coordinates),i.isIntersection&&(a?i.intersectionDir===r.lG.Entering&&i.partnerNode&&(i=i.partnerNode,a=!1):i.partnerNode?(i=i.partnerNode,a=!0):console.warn("Subtraction: Intersection on source without partner.")),i=i.next}while(i!==n||!a);o.length>=3&&((0,r.Sk)(o[0],o[o.length-1])&&o.pop(),o.length>=3&&p.push(o))}return p}},33657:(t,e,n)=>{n.r(e),n.d(e,{distanceToPoint:()=>o.A});var o=n(87105)},23324:(t,e,n)=>{n.r(e),n.d(e,{findClosestPoint:()=>o.A,liangBarksyClip:()=>i.A});var o=n(90554),i=n(35381)},35381:(t,e,n)=>{n.d(e,{A:()=>a});const o=1e-6,i=1,r=0;function s(t,e,n){const[i,r]=n;if(Math.abs(e)<o)return t<0;const s=t/e;if(e>0){if(s>r)return 0;s>i&&(n[0]=s)}else{if(s<i)return 0;s<r&&(n[1]=s)}return 1}function a(t,e,n,a,c){const[l,u]=t,[d,g]=e,h=d-l,p=g-u;if(void 0===a||void 0===c?(a=t,c=e):(a[0]=t[0],a[1]=t[1],c[0]=e[0],c[1]=e[1]),Math.abs(h)<o&&Math.abs(p)<o&&l>=n[0]&&l<=n[2]&&u>=n[1]&&u<=n[3])return i;const f=[0,1];if(s(n[0]-l,h,f)&&s(l-n[2],-h,f)&&s(n[1]-u,p,f)&&s(u-n[3],-p,f)){const[t,e]=f;return e<1&&(c[0]=l+e*h,c[1]=u+e*p),t>0&&(a[0]+=t*h,a[1]+=t*p),i}return r}},61587:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(3823),i=n(61768);function r(t,e=Math.floor(Math.random()*(t.length-1))){if(0===e)return 0;const n=[...t],{length:o}=t;for(let i=0;i<o;i++)t[i]=n[(i+e+o)%o];return e}function s(t,e){if(function(t,e){const n=e?.knotsRatioPercentage||30;return!t?.data?.contour?.polyline?.length||n<=0}(t,e))return!1;const{viewPlaneNormal:n}=t.metadata,{closed:s,polyline:a}=t.data.contour,c=function(t,e){const n=o.pB.create(),i=o.eR.add(o.eR.create(),e,t),r=Math.abs(t[0])>.1?o.eR.fromValues(-t[1],t[0],0):o.eR.fromValues(0,-t[2],t[1]);return o.pB.lookAt(n,e,i,r),n}(n,t.data.contour.polyline[0]),l=t.data.contour.polyline.map(t=>{const e=o.eR.transformMat4(o.eR.create(),t,c);return[e[0],e[1]]});let u=s?r(l):0,d=(0,i.A)(l,0,l.length-1,e?.knotsRatioPercentage||30);if(d===l)return!1;r(d,-u);for(let t=1;t<e?.loop;t++)u=s?r(d):0,d=(0,i.A)(d,0,d.length-1,e?.knotsRatioPercentage||30),r(d,-u);const g=o.pB.invert(o.pB.create(),c);return t.data.contour.polyline=d.map(t=>o.eR.transformMat4([0,0,0],[...t,0],g)),!0}},13165:(t,e,n)=>{n.r(e),n.d(e,{default:()=>u,filterAnnotationsForDisplay:()=>r.A,filterAnnotationsWithinSamePlane:()=>l.W,filterAnnotationsWithinSlice:()=>o.A,getPointInLineOfSightWithCriteria:()=>a.R,getPointsInLineOfSight:()=>a.p,getWorldWidthAndHeightFromCorners:()=>i.A,getWorldWidthAndHeightFromTwoPoints:()=>s.A,isPlaneIntersectingAABB:()=>c.Y});var o=n(36374),i=n(35489),r=n(94418),s=n(62514),a=n(57063),c=n(30698),l=n(40770);const u={filterAnnotationsWithinSlice:o.A,getWorldWidthAndHeightFromCorners:i.A,getWorldWidthAndHeightFromTwoPoints:s.A,filterAnnotationsForDisplay:r.A,getPointInLineOfSightWithCriteria:a.R,isPlaneIntersectingAABB:c.Y,filterAnnotationsWithinSamePlane:l.W,getPointsInLineOfSight:a.p}},10564:(t,e,n)=>{n.d(e,{BX:()=>c,Sp:()=>r,VD:()=>o,Zi:()=>l,ag:()=>a,bs:()=>i,ee:()=>s,gN:()=>u});const o=254,i=255,r=1,s=1.8,a=3.2,c=30,l=70,u=50},94762:(t,e,n)=>{n.d(e,{Lr:()=>s,Pg:()=>d,bV:()=>l,m0:()=>u,y1:()=>a,y9:()=>r,zo:()=>c});var o=n(15327),i=n(30045);const r=o.Enums.RequestType.Prefetch,s=0;function a(t,e){t=Math.round(t)||0;const n=[];let o=(e=Math.round(e)||0)-t+1;if(o<=0)return n;for(;o--;)n[o]=e--;return n}function c(t,e){let n=0,o=t.length-1;return t.forEach((t,i)=>{t<e?n=Math.max(i,n):t>e&&(o=Math.min(i,o))}),{low:n,high:o}}function l(t){const e=(0,o.getEnabledElement)(t);if(!e)return null;const{viewport:n}=e;return n instanceof o.StackViewport?{currentImageIdIndex:n.getCurrentImageIdIndex(),imageIds:n.getImageIds()}:null}function u(t){return function(e){const n=e.detail;let o;try{o=l(t)}catch(t){return}if(!o||!o.imageIds||0===o.imageIds.length)return;const r=o.imageIds.indexOf(n.imageId);if(r<0)return;const s=(0,i.k)(t);s&&s.indicesToRequest&&s.indicesToRequest.length&&s.indicesToRequest.push(r)}}const d=t=>{const e=new Set(t.imageIds);return t=>t.type!==r||!e.has(t.additionalDetails.imageId)}},30045:(t,e,n)=>{n.d(e,{P:()=>r,k:()=>s});var o=n(15327);const i={};function r(t,e){const n=(0,o.getEnabledElement)(t),{viewportId:r}=n;i[r]=e}function s(t){const e=(0,o.getEnabledElement)(t),{viewportId:n}=e;return i[n]}},33517:(t,e,n)=>{n.d(e,{n:()=>a});var o=n(15327);const i=(t,e,n)=>[t[0]*(1-n)+e[0]*n,t[1]*(1-n)+e[1]*n,t[2]*(1-n)+e[2]*n];var r=n(57227);const{clamp:s}=o.utilities;class a{constructor(t){a.validateProps(t);const{colormap:e,size:n={width:20,height:100},imageRange:o={lower:0,upper:1},voiRange:i={lower:0,upper:1},container:r,showFullPixelValueRange:s=!1}=t;this._colormap=e,this._imageRange=o,this._voiRange=i,this._showFullImageRange=s,this._canvas=this._createRootElement(n),r&&this.appendTo(r)}get colormap(){return this._colormap}set colormap(t){this._colormap=t,this.render()}get size(){const{width:t,height:e}=this._canvas;return{width:t,height:e}}set size(t){const{_canvas:e}=this;(0,r.Au)(t)&&!(0,r.fG)(e,t)&&(this._setCanvasSize(e,t),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(t){(0,r.kB)(t)&&!(0,r.bh)(t,this._imageRange)&&(this._imageRange=t,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(t){(0,r.kB)(t)&&!(0,r.bh)(t,this._voiRange)&&(this._voiRange=t,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(t){t!==this._showFullImageRange&&(this._showFullImageRange=t,this.render())}appendTo(t){t.appendChild(this._canvas),this.render()}dispose(){const{_canvas:t}=this,{parentElement:e}=t;e?.removeChild(t)}static validateProps(t){const{size:e,imageRange:n,voiRange:o}=t;if(e&&!(0,r.Au)(e))throw new Error('Invalid "size"');if(n&&!(0,r.kB)(n))throw new Error('Invalid "imageRange"');if(o&&!(0,r.kB)(o))throw new Error('Invalid "voiRange"')}_setCanvasSize(t,e){const{width:n,height:o}=e;t.width=n,t.height=o,Object.assign(t.style,{width:`${n}px`,height:`${o}px`})}_createRootElement(t){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(e,t),e}render(){if(!this._canvas.isConnected)return;const{_colormap:t}=this,{RGBPoints:e}=t,n=e.length/4,o=t=>{const o=4*t;if(!(t<0||t>=n))return{index:t,position:e[o],color:[e[o+1],e[o+2],e[o+3]]}},{width:r,height:a}=this._canvas,c=this._canvas.getContext("2d");if(!c)return;const l=r>a,u=l?r:a,{_voiRange:d}=this,g=this._showFullImageRange?this._imageRange:{...d};let h,p=o(0);const f=(g.upper-g.lower)/(u-1);let m=g.lower;for(let t=0;t<u;t++){const e=(m-d.lower)/Math.abs(d.upper-d.lower);if(p)for(let t=p.index;t<n&&!(e<=p.position);t++)h=p,p=o(t+1);let u;if(h)if(p){const t=(e-h.position)/(p.position-h.position);u=i(h.color,p.color,t)}else u=[...h.color];else u=[...p.color];const g=u.map(t=>s(Math.round(255*t),0,255));c.fillStyle=`rgb(${g[0]}, ${g[1]}, ${g[2]})`,l?c.fillRect(t,0,1,a):c.fillRect(0,a-t-1,r,1),m+=f}}}},62184:(t,e,n)=>{n.d(e,{f:()=>s});var o=n(57227),i=n(20646);const r={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class s{constructor(t){s.validateProps(t);const{top:e=0,left:n=0,size:o={width:20,height:100},imageRange:a={lower:0,upper:1},voiRange:c={lower:0,upper:1},ticks:l,container:u,showFullPixelValueRange:d=!1}=t,{style:g,position:h}=l??{};this._imageRange=a,this._voiRange=c,this._font=g?.font??r.FONT,this._color=g?.color??r.COLOR,this._tickSize=g?.tickSize??r.TICK_SIZE,this._tickWidth=g?.tickWidth??r.TICK_WIDTH,this._labelMargin=g?.labelMargin??r.TICK_LABEL_MARGIN,this._maxNumTicks=g?.maxNumTicks??r.MAX_NUM_TICKS,this._rangeTextPosition=h??i.U.Right,this._showFullPixelValueRange=d,this._canvas=this._createCanvasElement(o,e,n),u&&this.appendTo(u)}get size(){const{width:t,height:e}=this._canvas;return{width:t,height:e}}set size(t){const{_canvas:e}=this;(0,o.Au)(t)&&!(0,o.fG)(e,t)&&(this._setCanvasSize(e,t),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(t){const{_canvas:e}=this;t!==this.top&&(e.style.top=`${t}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(t){const{_canvas:e}=this;t!==this.left&&(e.style.left=`${t}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(t){(0,o.kB)(t)&&!(0,o.bh)(t,this._imageRange)&&(this._imageRange=t,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(t){(0,o.kB)(t)&&!(0,o.bh)(t,this._voiRange)&&(this._voiRange=t,this.render())}get tickSize(){return this._tickSize}set tickSize(t){t!==this._tickSize&&(this._tickSize=t,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(t){t!==this._tickWidth&&(this._tickWidth=t,this.render())}get color(){return this._color}set color(t){t!==this._color&&(this._color=t,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(t){t!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=t,this.render())}get visible(){return"block"===this._canvas.style.display}set visible(t){t!==this.visible&&(this._canvas.style.display=t?"block":"none",t&&this.render())}appendTo(t){t.appendChild(this._canvas),this.render()}static validateProps(t){const{size:e,imageRange:n,voiRange:i}=t;if(e&&!(0,o.Au)(e))throw new Error('Invalid "size"');if(n&&!(0,o.kB)(n))throw new Error('Invalid "imageRange"');if(i&&!(0,o.kB)(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(t,e){const{width:n,height:o}=e;t.width=n,t.height=o,Object.assign(t.style,{width:`${n}px`,height:`${o}px`})}_createCanvasElement(t,e,n){const o=document.createElement("canvas");return Object.assign(o.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${e}px`,left:`${n}px`}),this._setCanvasSize(o,t),o}_getTicks(t){const{lower:e,upper:n}=t,o=(n-e)/(this._maxNumTicks-1),i=Math.pow(10,-Math.floor(Math.log10(Math.abs(o)))),s=o*i,a=r.TICKS_STEPS.find(t=>t>=s)/i,c=Math.ceil(n/a)*a,l=Math.floor(e/a)*a,u=Math.round((c-l)/a)+1,d=[];for(let t=0;t<u;t++)d.push(l+t*a);return{scaleMin:l,scaleMax:c,step:a,ticks:d}}_getLeftTickInfo({position:t,labelMeasure:e}){const{width:n}=this._canvas;return{labelPoint:[n-this.tickSize-e.width-this._labelMargin,t],tickPoints:{start:[n-this._tickSize,t],end:[n,t]}}}_getRightTickInfo({position:t}){return{labelPoint:[this._tickSize+this._labelMargin,t],tickPoints:{start:[0,t],end:[this._tickSize,t]}}}_getTopTickInfo({position:t,labelMeasure:e}){const{height:n}=this._canvas;return{labelPoint:[t,n-this.tickSize-this._labelMargin],tickPoints:{start:[t,n-this._tickSize],end:[t,n]}}}_getBottomTickInfo({position:t,labelMeasure:e}){return{labelPoint:[t,this._tickSize+this._labelMargin],tickPoints:{start:[t,0],end:[t,this._tickSize]}}}render(){const{_canvas:t}=this;if(!t.isConnected||!this.visible)return;const{width:e,height:n}=t,o=e>=n,r=o?e:n,s=t.getContext("2d"),{_voiRange:a}=this,c=this._showFullPixelValueRange?this._imageRange:{...a},l=c.upper-c.lower,{ticks:u}=this._getTicks(c);s.clearRect(0,0,e,n),s.font=this._font,s.textBaseline=o?"top":"middle",s.textAlign=o?"center":"left",s.fillStyle=this._color,s.strokeStyle=this._color,s.lineWidth=this.tickWidth,u.forEach(t=>{let e=Math.round(r*((t-c.lower)/l));if(o||(e=n-e),e<0||e>r)return;const a=t.toString(),u=s.measureText(a);let d;d=o?this._rangeTextPosition===i.U.Top?this._getTopTickInfo({position:e,labelMeasure:u}):this._getBottomTickInfo({position:e,labelMeasure:u}):this._rangeTextPosition===i.U.Left?this._getLeftTickInfo({position:e,labelMeasure:u}):this._getRightTickInfo({position:e});const{labelPoint:g,tickPoints:h}=d,{start:p,end:f}=h;return s.beginPath(),s.moveTo(p[0],p[1]),s.lineTo(f[0],f[1]),s.fillText(a,g[0],g[1]),s.stroke(),e})}}},57227:(t,e,n)=>{n.d(e,{bh:()=>r,fG:()=>s,Au:()=>i,kB:()=>o});const o=t=>t&&t.upper>t.lower,i=t=>!!t&&t.width>0&&t.height>0,r=(t,e)=>!!t&&!!e&&t.lower===e.lower&&t.upper===e.upper,s=(t,e)=>!!t&&!!e&&t.width===e.width&&t.height===e.height},79457:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(51807);function i(t,e,n){return(t>=e?[o.ColorbarRangeTextPosition.Top,o.ColorbarRangeTextPosition.Bottom]:[o.ColorbarRangeTextPosition.Left,o.ColorbarRangeTextPosition.Right]).includes(n)}},44845:(t,e,n)=>{n.d(e,{A:()=>o});class o{constructor({id:t,container:e}){this._containerResizeCallback=t=>{let e,n;const{contentRect:o,contentBoxSize:i}=t[0];o?(e=o.width,n=o.height):i?.length&&(e=i[0].inlineSize,n=i[0].blockSize),this._containerSize={width:e,height:n},this.onContainerResize()},this._id=t,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(t),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),e&&this.appendTo(e)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(t){const{_rootElement:e,_containerResizeObserver:n}=this,{parentElement:o}=e;t&&t!==o&&(o&&n.unobserve(o),t.appendChild(e),n.observe(t))}destroy(){const{_rootElement:t,_containerResizeObserver:e}=this,{parentElement:n}=t;n?.removeChild(t),e.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(t){const e=document.createElement("div");return e.id=t,e.classList.add("widget"),Object.assign(e.style,{width:"100%",height:"100%"}),e}onContainerResize(){}}},1060:(t,e,n)=>{n.d(e,{Ay:()=>c});var o=n(28906),i=n(87275),r=n(42008);const s={radius:.5,latLongTessellation:!1,thetaResolution:8,startTheta:0,endTheta:360,phiResolution:8,startPhi:0,endPhi:180,center:[0,0,0],pointType:"Float64Array"};function a(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,s,n),o.m.obj(t,e),o.m.setGet(t,e,["radius","latLongTessellation","thetaResolution","startTheta","endTheta","phiResolution","startPhi","endPhi"]),o.m.setGetArray(t,e,["center"],3),o.m.algo(t,e,0,1),function(t,e){e.classHierarchy.push("vtkSphereSource"),t.requestData=(t,n)=>{if(e.deleted)return;let s=n[0];const a=s?s.getPoints().getDataType():e.pointType;s=i.Ay.newInstance();let c=0,{thetaResolution:l}=e,u=e.startTheta<e.endTheta?e.startTheta:e.endTheta;u*=Math.PI/180;let d=e.endTheta>e.startTheta?e.endTheta:e.startTheta;d*=Math.PI/180;let g=e.startPhi<e.endPhi?e.startPhi:e.endPhi;g*=Math.PI/180;let h=e.endPhi>e.startPhi?e.endPhi:e.startPhi;h*=Math.PI/180,Math.abs(u-d)<2*Math.PI&&++l;const p=(d-u)/e.thetaResolution,f=e.startPhi<=0?1:0,m=e.phiResolution+(e.endPhi>=180?-1:0),v=e.phiResolution*l+2,I=2*e.phiResolution*e.thetaResolution;let P=0,w=o.m.newTypedArray(a,3*v),y=new Float32Array(3*v),b=0,A=new Uint32Array(5*I);e.startPhi<=0&&(w[3*P+0]=e.center[0],w[3*P+1]=e.center[1],w[3*P+2]=e.center[2]+e.radius,y[3*P+0]=0,y[3*P+1]=0,y[3*P+2]=1,P++,c++),e.endPhi>=180&&(w[3*P+0]=e.center[0],w[3*P+1]=e.center[1],w[3*P+2]=e.center[2]-e.radius,y[3*P+0]=0,y[3*P+1]=0,y[3*P+2]=-1,P++,c++);const T=e.phiResolution-c,M=(h-g)/(e.phiResolution-1);for(let t=0;t<l;t++){const n=u+t*p;for(let t=f;t<m;t++){const o=g+t*M,i=e.radius*Math.sin(o);y[3*P+0]=i*Math.cos(n),y[3*P+1]=i*Math.sin(n),y[3*P+2]=e.radius*Math.cos(o),w[3*P+0]=y[3*P+0]+e.center[0],w[3*P+1]=y[3*P+1]+e.center[1],w[3*P+2]=y[3*P+2]+e.center[2];let r=Math.sqrt(y[3*P+0]*y[3*P+0]+y[3*P+1]*y[3*P+1]+y[3*P+2]*y[3*P+2]);r=0===r?1:r,y[3*P+0]/=r,y[3*P+1]/=r,y[3*P+2]/=r,P++}}const x=T*l;if(Math.abs(u-d)<2*Math.PI&&--l,e.startPhi<=0)for(let t=0;t<l;t++)A[b++]=3,A[b++]=T*t+c,A[b++]=T*(t+1)%x+c,A[b++]=0;if(e.endPhi>=180){const t=T-1+c;for(let e=0;e<l;e++)A[b++]=3,A[b++]=T*e+t,A[b++]=c-1,A[b++]=T*(e+1)%x+t}for(let t=0;t<l;t++)for(let n=0;n<T-1;n++){const o=T*t+n+c,i=o+1,r=(T*(t+1)+n)%x+c+1;e.latLongTessellation?(A[b++]=4,A[b++]=o,A[b++]=i,A[b++]=r,A[b++]=r-1):(A[b++]=3,A[b++]=o,A[b++]=i,A[b++]=r,A[b++]=3,A[b++]=o,A[b++]=r,A[b++]=r-1)}w=w.subarray(0,3*P),s.getPoints().setData(w,3),y=y.subarray(0,3*P);const E=r.Ay.newInstance({name:"Normals",values:y,numberOfComponents:3});s.getPointData().setNormals(E),A=A.subarray(0,b),s.getPolys().setData(A,1),n[0]=s}}(t,e)}var c={newInstance:o.m.newInstance(a,"vtkSphereSource"),extend:a}},25161:(t,e,n)=>{n.d(e,{Ay:()=>u});var o=n(28906),i=n(50036);var r={Corners:{TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"}};const{vtkErrorMacro:s}=o.m,{Corners:a}=r;const c={viewportCorner:r.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function l(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,c,n),o.m.obj(t,e),o.m.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),o.m.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),o.m.get(t,e,["actor"]),o.m.moveToProtected(t,e,["interactor"]),function(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const n={...t},o=[],r=i.Ay.newInstance(),c=new ResizeObserver(e=>{t.updateViewport()});let l=null,u=null,d=null,g=null,h=null;function p(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const t=e.parentRenderer||e._interactor.getCurrentRenderer(),[n,o,i,r]=t.getViewport(),c=e._interactor.getView(),l=c.getSize(),[u,d]=c.getViewportSize(t),g=Math.min(u,d);let h=e.viewportSize*g;h=Math.max(Math.min(e.minPixelSize,g),Math.min(e.maxPixelSize,h));const p=h/l[0],f=h/l[1];switch(e.viewportCorner){case a.TOP_LEFT:return[n,r-f,n+p,r];case a.TOP_RIGHT:return[i-p,r-f,i,r];case a.BOTTOM_LEFT:return[n,o,n+p,o+f];case a.BOTTOM_RIGHT:return[i-p,o,i,o+f];default:return s("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(r.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const t=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!t)return;const n=t.getReferenceByName("position"),i=t.getReferenceByName("focalPoint"),s=t.getReferenceByName("viewUp");if(o[0]!==n[0]||o[1]!==n[1]||o[2]!==n[2]||o[3]!==i[0]||o[4]!==i[1]||o[5]!==i[2]||o[6]!==s[0]||o[7]!==s[1]||o[8]!==s[2]){o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=i[0],o[4]=i[1],o[5]=i[2],o[6]=s[0],o[7]=s[1],o[8]=s[2];const t=r.getActiveCamera();t.setPosition(n[0],n[1],n[2]),t.setFocalPoint(i[0],i[1],i[2]),t.setViewUp(s[0],s[1],s[2]),r.resetCamera()}},t.setEnabled=n=>{if(n){if(e.enabled)return;if(!e.actor)return void s("Must set actor before enabling orientation marker.");if(!e._interactor)return void s("Must set interactor before enabling orientation marker.");const n=e.parentRenderer||e._interactor.getCurrentRenderer(),o=n.getRenderWindow();o.addRenderer(r),o.getNumberOfLayers()<2&&o.setNumberOfLayers(2),r.setLayer(o.getNumberOfLayers()-1),r.setInteractive(e.interactiveRenderer),r.addViewProp(e.actor),e.actor.setVisibility(!0),l=n.onEvent(t=>{"ActiveCameraEvent"===t.type&&(u&&u.unsubscribe(),u=t.camera.onModified(p))}),u=n.getActiveCamera().onModified(p),d=e._interactor.onAnimation(t.updateMarkerOrientation),g=e._interactor.onEndAnimation(t.updateMarkerOrientation),c.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,c.disconnect(),l.unsubscribe(),l=null,u.unsubscribe(),u=null,d.unsubscribe(),d=null,g.unsubscribe(),g=null,e.actor.setVisibility(!1),r.removeViewProp(e.actor);const t=e._interactor?.findPokedRenderer()?.getRenderWindow();t&&t.removeRenderer(r)}t.modified()},t.setViewportCorner=n=>{n!==e.viewportCorner&&(e.viewportCorner=n,t.updateViewport())},t.setViewportSize=n=>{const o=Math.min(1,Math.max(0,n));o!==e.viewportSize&&(e.viewportSize=o,t.updateViewport())},t.setActor=n=>{const o=e.enabled;t.setEnabled(!1),e.actor=n,t.setEnabled(o)},t.getRenderer=()=>r,t.delete=()=>{n.delete(),h&&(h.unsubscribe(),h=null),l&&(l.unsubscribe(),l=null),u&&(u.unsubscribe(),u=null),d&&(d.unsubscribe(),d=null),g&&(g.unsubscribe(),g=null),c.disconnect()},h=t.onModified(t.updateViewport)}(t,e)}var u={newInstance:o.m.newInstance(l,"vtkOrientationMarkerWidget"),extend:l,...r}},85825:(t,e,n)=>{n.d(e,{Ay:()=>I});var o=n(28906),i=n(7019),r=n(82409),s=n(61433),a=n(56748),c=n(58498),l=n(42008);function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];const[n,o,i,r]=e,s=t.getContext("2d").getImageData(n,o,i||t.width,r||t.height),a=c.Ay.newInstance({type:"vtkImageData"});a.setOrigin(0,0,0),a.setSpacing(1,1,1),a.setExtent(0,(i||t.width)-1,0,(r||t.height)-1,0,0);const u=l.Ay.newInstance({numberOfComponents:4,values:new Uint8Array(s.data.buffer)});return u.setName("scalars"),a.getPointData().setScalars(u),a}var d={canvasToImageData:u,imageToImageData:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const o=n.getContext("2d"),{flipX:i,flipY:r,rotate:s}=e;return o.translate(n.width/2,n.height/2),o.scale(i?-1:1,r?-1:1),o.rotate(s*Math.PI/180),o.drawImage(t,-t.width/2,-t.height/2),u(n)}};const g={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:t=>t/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function h(t,e){e.set(t)}var p={applyDefinitions:h,applyPreset:function(t,e){return h(g[t],e)},registerStylePreset:function(t,e){g[t]=e}};const f={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};const m={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:t=>t/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function v(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,m,n),i.Ay.extend(t,e,n),o.m.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),function(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty={...e.xPlusFaceProperty},e.xMinusFaceProperty={...e.xMinusFaceProperty},e.yPlusFaceProperty={...e.yPlusFaceProperty},e.yMinusFaceProperty={...e.yMinusFaceProperty},e.zPlusFaceProperty={...e.zPlusFaceProperty},e.zMinusFaceProperty={...e.zMinusFaceProperty};let n=null;const o=document.createElement("canvas"),i=r.Ay.newInstance(),c=s.Ay.newInstance();function l(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i&&Object.assign(e[`${n}FaceProperty`],i);const r={...e.defaultStyle,...e[`${n}FaceProperty`]};o.width=r.resolution,o.height=r.resolution;const s=o.getContext("2d");s.fillStyle=r.faceColor,s.fillRect(0,0,o.width,o.height),r.edgeThickness>0&&(s.strokeStyle=r.edgeColor,s.lineWidth=r.edgeThickness*o.width,s.strokeRect(0,0,o.width,o.height)),s.save(),s.translate(0,o.height),s.scale(1,-1),s.translate(o.width/2,o.height/2),s.rotate(-Math.PI*(r.faceRotation/180));const a=r.fontSizeScale(r.resolution);s.fillStyle=r.fontColor,s.textAlign="center",s.textBaseline="middle",s.font=`${r.fontStyle} ${a}px "${r.fontFamily}"`,s.fillText(r.text,0,0),s.restore();const l=d.canvasToImageData(o);c.setInputData(l,f[n]),t.modified()}function u(){n=a.Ay.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(n.getOutputPort()),l("xPlus"),l("xMinus"),l("yPlus"),l("yMinus"),l("zPlus"),l("zMinus")}c.setInterpolate(!0),t.setDefaultStyle=t=>{e.defaultStyle={...e.defaultStyle,...t},u()},t.setXPlusFaceProperty=t=>l("xPlus",t),t.setXMinusFaceProperty=t=>l("xMinus",t),t.setYPlusFaceProperty=t=>l("yPlus",t),t.setYMinusFaceProperty=t=>l("yMinus",t),t.setZPlusFaceProperty=t=>l("zPlus",t),t.setZMinusFaceProperty=t=>l("zMinus",t),u(),i.setInputConnection(n.getOutputPort()),t.setMapper(i),t.addTexture(c)}(t,e)}var I={newInstance:o.m.newInstance(v,"vtkAnnotatedCubeActor"),extend:v,Presets:p}},45700:(t,e,n)=>{n.d(e,{Ay:()=>k});var o=n(28906),i=n(89265),r=n(42008),s=n(7019),a=n(82409),c=n(74966),l=n(87275),u=n(62612),d=n(28914);const{vtkErrorMacro:g}=o.m;function h(t,e,n,o){t.set(function(t,e){let n=0;return t.map((t,o)=>o===n?(n+=t+1,t):t+e)}(e,n),o)}const p={outputPointsPrecision:u.kP.DEFAULT};function f(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,p,n),o.m.setGet(t,e,["outputPointsPrecision"]),o.m.obj(t,e),o.m.algo(t,e,1,1),function(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(n,o)=>{const i=t.getNumberOfInputPorts();if(!i)return void g("No input specified.");if(1===i)return void(o[0]=n[0]);const s=l.Ay.newInstance();let a=0,p=0,f=1,m=1,v=0,I=0,P=0,w=0,y=!0,b=!0,A=!0;for(let t=0;t<i;t++){const e=n[t];if(!e)continue;const o=e.getPoints().getNumberOfPoints();a+=o,v+=e.getVerts().getNumberOfValues(),I+=e.getLines().getNumberOfValues(),P+=e.getStrips().getNumberOfValues(),w+=e.getPolys().getNumberOfValues(),o&&(m&&(m=0,p=e.getPoints().getDataType()),f=e.getPoints().getDataType(),p=p>f?p:f);const i=e.getPointData();i?(y=y&&null!==i.getNormals(),b=b&&null!==i.getTCoords(),A=A&&null!==i.getScalars()):(y=!1,b=!1,A=!1)}e.outputPointsPrecision===u.kP.SINGLE?p=d.JA.FLOAT:e.outputPointsPrecision===u.kP.DOUBLE&&(p=d.JA.DOUBLE);const T=c.Ay.newInstance({dataType:p});T.setNumberOfPoints(a);const M=T.getData(),x=new Uint32Array(v),E=new Uint32Array(I),_=new Uint32Array(P),C=new Uint32Array(w);let k=null,D=null,S=null;const R=n[i-1];if(y){const t=R.getPointData().getNormals();k=r.Ay.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:t.getDataType(),name:t.getName()})}if(b){const t=R.getPointData().getTCoords();D=r.Ay.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:t.getDataType(),name:t.getName()})}if(A){const t=R.getPointData().getScalars();S=r.Ay.newInstance({numberOfComponents:t.getNumberOfComponents(),numberOfTuples:a,size:a*t.getNumberOfComponents(),dataType:t.getDataType(),name:t.getName()})}a=0,v=0,I=0,P=0,w=0;for(let t=0;t<i;t++){const e=n[t];M.set(e.getPoints().getData(),3*a),h(x,e.getVerts().getData(),a,v),v+=e.getVerts().getNumberOfValues(),h(E,e.getLines().getData(),a,I),I+=e.getLines().getNumberOfValues(),h(_,e.getStrips().getData(),a,P),P+=e.getStrips().getNumberOfValues(),h(C,e.getPolys().getData(),a,w),w+=e.getPolys().getNumberOfValues();const o=e.getPointData();if(y){const t=o.getNormals();k.getData().set(t.getData(),3*a)}if(b){const t=o.getTCoords();D.getData().set(t.getData(),2*a)}if(A){const t=o.getScalars();S.getData().set(t.getData(),a*S.getNumberOfComponents())}a+=e.getPoints().getNumberOfPoints()}s.setPoints(T),s.getVerts().setData(x),s.getLines().setData(E),s.getStrips().setData(_),s.getPolys().setData(C),k&&s.getPointData().setNormals(k),D&&s.getPointData().setTCoords(D),S&&s.getPointData().setScalars(S),o[0]=s}}(t,e)}var m={newInstance:o.m.newInstance(f,"vtkAppendPolyData"),extend:f};const v={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function I(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,v,n),o.m.obj(t,e),o.m.setGet(t,e,["height","radius","resolution","capping"]),o.m.setGetArray(t,e,["center","direction"],3),o.m.algo(t,e,0,1),function(t,e){e.classHierarchy.push("vtkConeSource"),t.requestData=function(t,n){if(e.deleted)return;let r=n[0];const s=2*Math.PI/e.resolution,a=-e.height/2,c=e.resolution+1,u=4*e.resolution+1+e.resolution;let d=0;const g=o.m.newTypedArray(e.pointType,3*c);let h=0;const p=new Uint32Array(u);g[0]=e.height/2,g[1]=0,g[2]=0,e.capping&&(p[h++]=e.resolution);for(let t=0;t<e.resolution;t++)d++,g[3*d+0]=a,g[3*d+1]=e.radius*Math.cos(t*s),g[3*d+2]=e.radius*Math.sin(t*s),e.capping&&(p[e.resolution-h+++1]=d);for(let t=0;t<e.resolution;t++)p[h++]=3,p[h++]=0,p[h++]=t+1,p[h++]=t+2>e.resolution?1:t+2;i.A.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(g),r=l.Ay.newInstance(),r.getPoints().setData(g,3),r.getPolys().setData(p,1),n[0]=r}}(t,e)}var P={newInstance:o.m.newInstance(I,"vtkConeSource"),extend:I};const w={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function y(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,w,n),o.m.obj(t,e),o.m.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),o.m.setGetArray(t,e,["center","direction"],3),o.m.algo(t,e,0,1),function(t,e){e.classHierarchy.push("vtkCylinderSource"),t.requestData=function(t,n){if(e.deleted)return;let s=n[0];const a=2*Math.PI/e.resolution;let c=2*e.resolution,u=5*e.resolution;e.capping&&(c=4*e.resolution,u=7*e.resolution+2);const d=o.m.newTypedArray(e.pointType,3*c);let g=0;const h=new Uint32Array(u),p=new Float32Array(3*c),f=r.Ay.newInstance({numberOfComponents:3,values:p,name:"Normals"}),m=new Float32Array(2*c),v=r.Ay.newInstance({numberOfComponents:2,values:m,name:"TCoords"}),I=[0,0,0],P=[0,0,0],w=[0,0,0],y=[0,0,0],b=[0,0],A=[0,0],T=null==e.otherRadius?e.radius:e.otherRadius;for(let t=0;t<e.resolution;t++){I[0]=Math.cos(t*a+e.initAngle),P[0]=I[0],w[0]=e.radius*I[0]+e.center[0],y[0]=w[0],b[0]=Math.abs(2*t/e.resolution-1),A[0]=b[0],w[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],b[1]=0,A[1]=1,I[2]=-Math.sin(t*a+e.initAngle),P[2]=I[2],w[2]=T*I[2]+e.center[2],y[2]=w[2];const n=2*t;for(let t=0;t<3;t++)p[3*n+t]=I[t],p[3*(n+1)+t]=P[t],d[3*n+t]=w[t],d[3*(n+1)+t]=y[t],t<2&&(m[2*n+t]=b[t],m[2*(n+1)+t]=A[t])}for(let t=0;t<e.resolution;t++){h[g++]=4,h[g++]=2*t,h[g++]=2*t+1;const n=(2*t+3)%(2*e.resolution);h[g++]=n,h[g++]=n-1}if(e.capping){for(let t=0;t<e.resolution;t++){w[0]=e.radius*Math.cos(t*a+e.initAngle),y[0]=w[0],b[0]=w[0],A[0]=w[0],w[0]+=e.center[0],y[0]+=e.center[0],I[1]=1,P[1]=-1,w[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],w[2]=-T*Math.sin(t*a+e.initAngle),y[2]=w[2],b[1]=w[2],A[1]=w[2],w[2]+=e.center[2],y[2]+=e.center[2];const n=2*e.resolution+t,o=3*e.resolution+e.resolution-t-1;for(let t=0;t<3;t++)p[3*n+t]=I[t],p[3*o+t]=P[t],d[3*n+t]=w[t],d[3*o+t]=y[t],t<2&&(m[2*n+t]=b[t],m[2*o+t]=A[t])}h[g++]=e.resolution;for(let t=0;t<e.resolution;t++)h[g++]=2*e.resolution+t;h[g++]=e.resolution;for(let t=0;t<e.resolution;t++)h[g++]=3*e.resolution+t}i.A.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(t=>-1*t)).apply(d),s=l.Ay.newInstance(),s.getPoints().setData(d,3),s.getPolys().setData(h,1),s.getPointData().setNormals(f),s.getPointData().setTCoords(v),n[0]=s}}(t,e)}var b={newInstance:o.m.newInstance(y,"vtkCylinderSource"),extend:y};const A={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function T(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,A,n),o.m.obj(t,e),o.m.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),o.m.setGetArray(t,e,["direction"],3),o.m.algo(t,e,0,1),function(t,e){e.classHierarchy.push("vtkArrowSource"),t.requestData=function(t,n){if(e.deleted)return;const o=b.newInstance({capping:!0});o.setResolution(e.shaftResolution),o.setRadius(e.shaftRadius),o.setHeight(1-e.tipLength),o.setCenter(0,.5*(1-e.tipLength),0);const r=o.getOutputData(),s=r.getPoints().getData(),a=r.getPointData().getNormals().getData();i.A.buildFromDegree().rotateZ(-90).apply(s).apply(a);const c=P.newInstance();c.setResolution(e.tipResolution),c.setHeight(e.tipLength),c.setRadius(e.tipRadius);const l=c.getOutputData(),u=l.getPoints().getData();i.A.buildFromRadian().translate(1-.5*e.tipLength,0,0).apply(u);const d=m.newInstance();d.setInputData(r),d.addInputData(l);const g=d.getOutputData(),h=g.getPoints().getData();i.A.buildFromRadian().translate(.5*e.tipLength-.5,0,0).apply(h),e.invert?(i.A.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(h),n[0]=g):(i.A.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(h),n[0]=d.getOutputData())}}(t,e)}var M={newInstance:o.m.newInstance(T,"vtkArrowSource"),extend:T};function x(t){const e=t.getPoints().getBounds(),n=[.5*-(e[0]+e[1]),.5*-(e[2]+e[3]),.5*-(e[4]+e[5])];i.A.buildFromDegree().translate(...n).apply(t.getPoints().getData())}function E(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=t.getPoints().getBounds(),r=[0,0,0];r[e]=n?-o[2*e+1]:-o[2*e],i.A.buildFromDegree().translate(...r).apply(t.getPoints().getData())}function _(t,e,n,o){const i=t.getPoints().getData().length,s=new Uint8ClampedArray(i);let a=0;for(;a<i;)s[a++]=e,s[a++]=n,s[a++]=o;t.getPointData().setScalars(r.Ay.newInstance({name:"color",numberOfComponents:3,values:s}))}function C(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s.Ay.extend(t,e,function(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t?.config},xConfig:{color:[255,0,0],invert:!1,...t?.xConfig},yConfig:{color:[255,255,0],invert:!1,...t?.yConfig},zConfig:{color:[0,128,0],invert:!1,...t?.zConfig}}}(n)),o.m.setGet(t,e,["config","xConfig","yConfig","zConfig"]),function(t,e){e.classHierarchy.push("vtkAxesActor");const n=a.Ay.newInstance();t.setMapper(n),t.update=()=>{let t={...e.config,...e.xConfig};const o=M.newInstance({direction:[1,0,0],...t}).getOutputData();e.config.recenter?x(o):E(o,0,t.invert),_(o,...t.color),t={...e.config,...e.yConfig};const i=M.newInstance({direction:[0,1,0],...t}).getOutputData();e.config.recenter?x(i):E(i,1,t.invert),_(i,...t.color),t={...e.config,...e.zConfig};const r=M.newInstance({direction:[0,0,1],...t}).getOutputData();e.config.recenter?x(r):E(r,2,t.invert),_(r,...t.color);const s=m.newInstance();s.setInputData(o),s.addInputData(i),s.addInputData(r),n.setInputConnection(s.getOutputPort())},t.update();const i=o.m.debounce(t.update,0);t.setXAxisColor=e=>t.setXConfig({...t.getXConfig(),color:e}),t.setYAxisColor=e=>t.setYConfig({...t.getYConfig(),color:e}),t.setZAxisColor=e=>t.setZConfig({...t.getZConfig(),color:e}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=i,e._onXConfigChanged=i,e._onYConfigChanged=i,e._onZConfigChanged=i}(t,e)}var k={newInstance:o.m.newInstance(C,"vtkAxesActor"),extend:C}}}]);
//# sourceMappingURL=1563.bundle.a6cc335d8f46baf5184d.js.map