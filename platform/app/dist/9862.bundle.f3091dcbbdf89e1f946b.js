"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9862],{49862:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(86326),s=n(97598),i=n.n(s),a=(n(96283),n(37948)),o=n(4667),l=n(55844),c=n(15327),u=n(42356);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(null,arguments)}function E(e){const{servicesManager:t}=(0,u.Jg)(),{displaySets:n,viewportId:s}=e,{measurementService:i,cornerstoneViewportService:E,viewportGridService:S,toolbarService:f}=t.services,p=n[0],[v,I]=(0,l.B)(),[b,m]=(0,r.useState)(!1),[g,w]=(0,r.useState)(null),[D,T]=(0,r.useState)(null),{trackedSeries:V}=v.context,{SeriesInstanceUID:h}=p,y=(0,r.useCallback)(()=>{V.includes(h)!==b&&m(!b)},[b,h,V]),R=(0,r.useCallback)(e=>{e.detail.element!==D&&(e.detail.element?.addEventListener(c.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,y),T(e.detail.element))},[y,D]),U=(0,r.useCallback)(()=>{D?.removeEventListener(c.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,y)},[y,D]);(0,r.useEffect)(y,[y]),(0,r.useEffect)(()=>{const{unsubscribe:e}=E.subscribe(E.EVENTS.VIEWPORT_DATA_CHANGED,e=>{e.viewportId===s&&y()});return()=>{e()}},[y,s]),(0,r.useEffect)(()=>b?(o.annotation.config.style.setViewportToolStyles(s,{ReferenceLines:{lineDash:"4,4"},global:{lineDash:""}}),void E.getRenderingEngine().renderViewport(s)):(o.annotation.config.style.setViewportToolStyles(s,{global:{lineDash:"4,4"}}),E.getRenderingEngine().renderViewport(s),()=>{o.annotation.config.style.setViewportToolStyles(s,{})}),[b]),(0,r.useEffect)(()=>{const e=i.EVENTS.MEASUREMENT_ADDED,t=i.EVENTS.RAW_MEASUREMENT_ADDED,n=[];return[e,t].forEach(e=>{n.push(i.subscribe(e,({source:e,measurement:t})=>{const{activeViewportId:n}=S.getState();if(s===n){const{referenceStudyUID:e,referenceSeriesUID:n,uid:r,toolName:i}=t;I("SET_DIRTY",{SeriesInstanceUID:n}),I("TRACK_SERIES",{viewportId:s,StudyInstanceUID:e,SeriesInstanceUID:n,measurementId:r,toolName:i})}}).unsubscribe)}),()=>{n.forEach(e=>{e()})}},[i,I,s,S]);(0,r.useCallback)(e=>{const n=function(e,t,n,r){const{measurementService:s,viewportGridService:i}=t.services,a=s.getMeasurements(),{activeViewportId:o,viewports:l}=i.getState(),{displaySetInstanceUIDs:c}=l.get(o),{trackedSeries:u}=r.context,d=a.filter(e=>u.includes(e.referenceSeriesUID)&&c.includes(e.displaySetInstanceUID));if(!d.length)return;const E=d.length,S=d.map(e=>e.uid);let f=S.findIndex(e=>e===n);-1===f?f=0:(f+=e,f<0?f=E-1:f===E&&(f=0));return S[f]}(e,t,g,v);n&&(w(n),i.jumpToMeasurement(s,n))},[i,t,g,v,s]);return r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},r.createElement(a.OHIFCornerstoneViewport,d({},e,{onElementEnabled:t=>{e.onElementEnabled?.(t),R(t)},onElementDisabled:U})))}E.propTypes={displaySets:i().arrayOf(i().object.isRequired).isRequired,viewportId:i().string.isRequired,dataSource:i().object,children:i().node};const S=E}}]);
//# sourceMappingURL=9862.bundle.f3091dcbbdf89e1f946b.js.map