"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[2701],{62701:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var r=n(97598),a=n.n(r),s=n(86326),i=n(42356),o=n(76654),l=n(92643),c=n(37948),u=n(96283),d=n(83641);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(null,arguments)}function m(e){const{servicesManager:t}=(0,d.Jg)(),{children:n,dataSource:r,displaySets:a,viewportOptions:i}=e,{displaySetService:m}=t.services,f=i.viewportId;if(a.length>1)throw new Error("SR viewport should only have a single display set");const S=a[0],{setPositionPresentation:y}=(0,c.usePositionPresentationStore)(),[I,g]=(0,u.ihW)(),[b,v]=(0,s.useState)(0),[E,w]=(0,s.useState)(null),[D,T]=(0,s.useState)(null),[h,N]=(0,s.useState)(null),{viewports:O,activeViewportId:C}=I,M=(0,s.useCallback)(e=>{const{measurements:t}=S;(0,o.m1)(h,t.map(e=>e.TrackingUniqueIdentifier),e)},[h,b,S]),j=(0,s.useCallback)(e=>{const{StudyInstanceUID:t,displaySetInstanceUID:n}=S;t&&n&&async function(e,t,n){const{measurements:r}=e,a=r[t],{displaySetInstanceUID:s}=a;e.keyImageDisplaySet||(e.keyImageDisplaySet=(0,l.A)(n,e));if(!s)return{referencedDisplaySetMetadata:null,referencedDisplaySet:null};const i=n.getDisplaySetByUID(s);if(!i?.images)return{referencedDisplaySetMetadata:null,referencedDisplaySet:null};const o=i.images[0],c={PatientID:o.PatientID,PatientName:o.PatientName,PatientSex:o.PatientSex,PatientAge:o.PatientAge,SliceThickness:o.SliceThickness,StudyDate:o.StudyDate,SeriesDescription:o.SeriesDescription,SeriesInstanceUID:o.SeriesInstanceUID,SeriesNumber:o.SeriesNumber,ManufacturerModelName:o.ManufacturerModelName,SpacingBetweenSlices:o.SpacingBetweenSlices};return{referencedDisplaySetMetadata:c,referencedDisplaySet:i}}(S,e,m).then(({referencedDisplaySet:t,referencedDisplaySetMetadata:n})=>{if(!t||!n)return;v(e),w(t),T(n);const{presentationIds:r}=i,a=S.measurements[e];y(r.positionPresentationId,{viewReference:a.viewReference||{referencedImageId:a.imageId}})})},[r,S,E,f]),P=(0,s.useCallback)(()=>{if(!E)return null;const{measurements:t}=S;return t[b]?s.createElement(c.OHIFCornerstoneViewport,p({},e,{displaySets:[E],viewportOptions:{...i,toolGroupId:"SRToolGroup",viewportType:"stack",positionIds:null},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{N(e.detail.element)})(t)},isJumpToMeasurementDisabled:!0})):null},[E,f,b]);(0,s.useEffect)(()=>{const e=m.subscribe(m.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=O.get(C);e.includes(t.displaySetInstanceUID)&&g.setDisplaySetsForViewport({viewportId:C,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe()}},[]),(0,s.useEffect)(()=>{(async()=>{S.isLoaded||await S.load(),j(b)})()},[S]),(0,s.useEffect)(()=>{(async()=>{S.isLoaded||await S.load(),h&&S.isLoaded&&M(b)})()},[b,h,M,S]);let x=null;return E&&D?(n&&n.length&&(x=n.map((e,t)=>e&&s.cloneElement(e,{viewportId:f,key:t}))),s.createElement(s.Fragment,null,s.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},P(),x))):null}m.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object};const f=m;var S=n(74137);const y={TEXT:e=>e.TextValue,CODE:e=>e.ConceptCodeSequence?.[0]?.CodeMeaning,UIDREF:e=>e.UID,NUM:e=>{const t=e.MeasuredValueSequence?.[0];if(!t)return;const{NumericValue:n,MeasurementUnitsCodeSequence:r}=t,{CodeValue:a}=r;return`${n} ${a}`},PNAME:e=>{const t=e.PersonName?.[0];return t?i.Wp.formatPN(t):void 0},DATE:e=>{const{Date:t}=e;return t?i.Wp.formatDate(t):void 0},TIME:e=>{const{Time:t}=e;return t?i.Wp.formatTime(t):void 0},DATETIME:e=>{const{DateTime:t}=e;if("string"!=typeof t)return;if(t.length<14)return t;const n=t.substring(0,8),r=t.substring(8,14);return`${i.Wp.formatDate(n)} ${i.Wp.formatTime(r)}`}};function I(e){const{contentItem:t,nodeIndexesTree:n,continuityOfContent:r}=e,{ConceptNameCodeSequence:a}=t,{CodeValue:i,CodeMeaning:o}=a,l=0===n[n.length-1],c=function(e){const{ValueType:t}=e,n=y[t];return n?n(e):`[${t} is not supported]`}(t)??"[empty]",u="CONTINUOUS"===r,d=i===S.n7.Finding,p=u&&!l&&/^[a-zA-Z0-9]/.test(c?.[0]);let m="whitespace-pre-line";return i===S.n7.Finding&&(m="whitespace-pre-wrap"),u?s.createElement(s.Fragment,null,s.createElement("span",{className:m,title:o},p?" ":"",c)):s.createElement(s.Fragment,null,s.createElement("div",{className:"mb-2"},s.createElement("span",{className:"font-bold"},o,": "),d?s.createElement("pre",null,c):s.createElement("span",{className:m},c)))}function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},g.apply(null,arguments)}function b(e){const{container:t,nodeIndexesTree:n=[0],containerNumberedTree:r=[1]}=e,{ContinuityOfContent:a,ConceptNameCodeSequence:i}=t,{CodeMeaning:o}=i??{};let l=1;const c=t.ContentSequence?.map((e,t)=>{const{ValueType:i}=e,o=[...n,t],c=o.join(".");let u,d;if("CONTAINER"===i){u=b,d={container:e,nodeIndexesTree:o,containerNumberedTree:[...r,l++]}}else u=I,d={contentItem:e,nodeIndexesTree:o,continuityOfContent:a};return s.createElement(u,g({key:c},d))});return s.createElement("div",null,s.createElement("div",{className:"font-bold"},r.join("."),".Â ",o),s.createElement("div",{className:"ml-4 mb-2"},c))}function v(e){const{displaySets:t}=e,n=t[0].instances[0];return s.createElement("div",{className:"relative flex h-full w-full flex-col overflow-auto p-4 text-[rgb(var(--text))]"},s.createElement("div",null,s.createElement(b,{container:n})))}I.propTypes={contentItem:a().object,nodeIndexesTree:a().arrayOf(a().number),continuityOfContent:a().string},b.propTypes={container:a().object,nodeIndexesTree:a().arrayOf(a().number),containerNumberedTree:a().arrayOf(a().number)},v.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object,servicesManager:a().object.isRequired,extensionManager:a().instanceOf(i.nH).isRequired};const E=v;function w(e){const{displaySets:t}=e,{isImagingMeasurementReport:n}=t[0];return n?s.createElement(f,e):s.createElement(E,e)}w.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object,servicesManager:a().object.isRequired,extensionManager:a().instanceOf(i.nH).isRequired};const D=w}}]);
//# sourceMappingURL=2701.bundle.4d35181eea6ce8f9bf19.js.map