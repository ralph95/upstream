"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[147],{30147:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var r=n(86326),i=n(15327),o=n(42356),a=n(96283),s=n(71353),l=n(97598),c=n.n(l);function u({viewportData:e,viewportId:t,element:n,imageSliceData:o,setImageSliceData:s,scrollbarHeight:l,servicesManager:c}){const{cineService:u,cornerstoneViewportService:m}=c.services;return(0,r.useEffect)(()=>{if(!e)return;const n=m.getCornerstoneViewport(t);if(n&&!(n instanceof i.VolumeViewport3D))try{const e=n.getCurrentImageIdIndex(),t=n.getNumberOfSlices();s({imageIndex:e,numberOfSlices:t})}catch(e){console.warn(e)}},[t,e]),(0,r.useEffect)(()=>{if(!e)return;const{viewportType:r}=e,o=r===i.Enums.ViewportType.STACK&&i.Enums.Events.STACK_NEW_IMAGE||r===i.Enums.ViewportType.ORTHOGRAPHIC&&i.Enums.Events.VOLUME_NEW_IMAGE||i.Enums.Events.IMAGE_RENDERED,a=e=>{const n=m.getCornerstoneViewport(t);if(!n||n instanceof i.VolumeViewport3D)return;const{imageIndex:r,newImageIdIndex:o=r,imageIdIndex:a}=e.detail,l=n.getNumberOfSlices();s({imageIndex:o??a,numberOfSlices:l})};return n.addEventListener(o,a),()=>{n.removeEventListener(o,a)}},[e,n]),r.createElement(a.uqr,{onChange:e=>((e,t)=>{const r=m.getCornerstoneViewport(t),{isCineEnabled:o}=u.getState();o&&(u.stopClip(n,{viewportId:t}),u.setCine({id:t,isPlaying:!1})),i.utilities.jumpToSlice(r.element,{imageIndex:e,debounceLoading:!0})})(e,t),max:o.numberOfSlices?o.numberOfSlices-1:0,height:l,value:o.imageIndex||0})}u.propTypes={viewportData:c().object,viewportId:c().string.isRequired,element:c().instanceOf(Element),scrollbarHeight:c().string,imageSliceData:c().object.isRequired,setImageSliceData:c().func.isRequired,servicesManager:c().object.isRequired};const m=u;var p=n(3823),d=n(4667),v=n(14867),E=n.n(v);function g(e,t=0){if(null!==e)return parseFloat(e).toFixed(t)}function f(e,t="MMM D, YYYY"){return E()(e,"YYYYMMDD").format(t)}function w(e,t="HH:mm:ss"){return E()(e,"HH:mm:ss").format(t)}var I=n(38007);const S=1e-4,{formatPN:b}=o.Wp,y={"ohif.overlayItem":function(e){const{instance:t,customization:n={}}=e,{color:i,attribute:o,title:a,label:s,background:l}=n,c=n.contentF?.(e,n)??t?.[o];if(null==c)return null;return r.createElement("div",{className:"overlay-item flex flex-row",style:{color:i,background:l},title:a},s?r.createElement("span",{className:"mr-1 shrink-0"},s):null,r.createElement("span",{className:"ml-0 mr-2 shrink-0"},c))},"ohif.overlayItem.windowLevel":function({voi:e,customization:t}){const{windowWidth:n,windowCenter:i}=e;if("number"!=typeof i||"number"!=typeof n)return null;return r.createElement("div",{className:"overlay-item flex flex-row",style:{color:t?.color}},r.createElement("span",{className:"mr-0.5 shrink-0 opacity-[0.70]"},"W:"),r.createElement("span",{className:"mr-2.5 shrink-0"},n.toFixed(0)),r.createElement("span",{className:"mr-0.5 shrink-0 opacity-[0.70]"},"L:"),r.createElement("span",{className:"shrink-0"},i.toFixed(0)))},"ohif.overlayItem.zoomLevel":function({scale:e,customization:t}){return r.createElement("div",{className:"overlay-item flex flex-row",style:{color:t&&t.color||void 0}},r.createElement("span",{className:"mr-0.5 shrink-0 opacity-[0.70]"},"Zoom:"),r.createElement("span",null,e.toFixed(2),"x"))},"ohif.overlayItem.instanceNumber":function({instanceNumber:e,imageSliceData:t,customization:n}){const{imageIndex:i,numberOfSlices:o}=t;return r.createElement("div",{className:"overlay-item flex flex-row",style:{color:n&&n.color||void 0}},r.createElement("span",null,null!=e?r.createElement(r.Fragment,null,r.createElement("span",{className:"mr-0.5 shrink-0 opacity-[0.70]"},"I:"),r.createElement("span",null,`${e} (${i+1}/${o})`)):`${i+1}/${o}`))}};function h({element:e,viewportData:t,imageSliceData:n,viewportId:o,servicesManager:s}){const{cornerstoneViewportService:l,customizationService:c,toolGroupService:u,displaySetService:m}=s.services,[p,v]=(0,r.useState)({windowCenter:null,windowWidth:null}),[E,S]=(0,r.useState)(1),[h,M]=(0,r.useState)(0),{isViewportBackgroundLight:R}=(0,I.eH)(o),{imageIndex:C}=n,T=c.getCustomization("viewportOverlay.topLeft"),N=c.getCustomization("viewportOverlay.topRight"),V=c.getCustomization("viewportOverlay.bottomLeft"),O=c.getCustomization("viewportOverlay.bottomRight"),L=(0,r.useMemo)(()=>t?D(t,o,C,l):null,[t,o,C,l]),A=(0,r.useMemo)(()=>{const e=function(e,t){if(!e?.data?.length)return null;const n=e.data.map(e=>t.getDisplaySetByUID(e.displaySetInstanceUID)).filter(e=>!!e);if(!n.length)return null;return n}(t,m);if(!e)return null;const[n]=e,{instances:r,instance:i}=n;return{displaySets:e,displaySet:n,instance:r?.[C],instances:r,referenceInstance:i}},[t,o,L,l]);(0,r.useEffect)(()=>{const t=e=>{const{range:t}=e.detail;if(!t)return;const{lower:n,upper:r}=t,{windowWidth:o,windowCenter:a}=i.utilities.windowLevel.toWindowLevel(n,r);v({windowCenter:a,windowWidth:o})};return e.addEventListener(i.Enums.Events.VOI_MODIFIED,t),()=>{e.removeEventListener(i.Enums.Events.VOI_MODIFIED,t)}},[o,t,p,e]);const P=(0,r.useCallback)(e=>{e.detail.annotation.metadata.toolName===d.UltrasoundPleuraBLineTool.toolName&&M(e=>e+1)},[]);(0,r.useEffect)(()=>(i.eventTarget.addEventListener(d.Enums.Events.ANNOTATION_MODIFIED,P),()=>{i.eventTarget.removeEventListener(d.Enums.Events.ANNOTATION_MODIFIED,P)}),[P]),(0,r.useEffect)(()=>{const t=e=>{const{previousCamera:t,camera:n}=e.detail;if(t.parallelScale!==n.parallelScale||t.scale!==n.scale){const e=l.getCornerstoneViewport(o);if(!e)return;const t=e.getZoom();S(t)}};return e.addEventListener(i.Enums.Events.CAMERA_MODIFIED,t),()=>{e.removeEventListener(i.Enums.Events.CAMERA_MODIFIED,t)}},[o,t,l,e]);const _=(0,r.useCallback)((i,a)=>{const l={...a,element:e,viewportData:t,imageSliceData:n,viewportId:o,servicesManager:s,customization:i,isLight:R,formatters:{formatPN:b,formatDate:f,formatTime:w,formatNumberPrecision:g}};if(!i)return null;const{inheritsFrom:u}=i,m=y[u];if(m)return r.createElement(m,l);{const e=c.transform(i);if("function"==typeof e.contentF)return e.contentF(l)}},[e,t,n,o,s,c,A,p,E,L,h]),x=(0,r.useCallback)((e,t)=>{const n={...A,formatters:{formatDate:f},voi:p,scale:E,instanceNumber:L,viewportId:o,toolGroupService:u,isLight:R};return r.createElement(r.Fragment,null,e.map((e,i)=>r.createElement("div",{key:`${t}_${i}`},(!e?.condition||e.condition(n))&&_(e,n)||null)))},[_]);return r.createElement(a.pUj,{topLeft:x(T,"topLeftOverlayItem"),topRight:x(N,"topRightOverlayItem"),bottomLeft:x(V,"bottomLeftOverlayItem"),bottomRight:x(O,"bottomRightOverlayItem"),color:R?"text-neutral-dark":"text-neutral-light",shadowClass:R?"shadow-light":"shadow-dark"})}const D=(e,t,n,r)=>{let o;switch(e.viewportType){case i.Enums.ViewportType.STACK:o=function(e,t){const n=e.data[0].imageIds,r=n[t];if(!r)return;const o=i.metaData.get("generalImageModule",r)||{},{instanceNumber:a}=o;if(n.length<=1)return;return parseInt(a)}(e,n);break;case i.Enums.ViewportType.ORTHOGRAPHIC:o=function(e,t,n,r){const o=e.data;if(!o)return;const{volume:a}=o[0];if(!a)return;const{direction:s,imageIds:l}=a,c=n.getCornerstoneViewport(t);if(!c)return;const u=c.getCamera(),{viewPlaneNormal:m}=u,d=s.slice(6,9),v=p.eR.cross(p.eR.create(),m,d);if(p.eR.length(v)<S){const e=l[r];if(!e)return{};const{instanceNumber:t}=i.metaData.get("generalImageModule",e)||{};return parseInt(t)}}(e,t,r,n)}return o??null};h.propTypes={viewportData:c().object,imageIndex:c().number,viewportId:c().string};const M=h;var R=n(55530),C=n.n(R);const{getOrientationStringLPS:T,invertOrientationStringLPS:N}=d.utilities.orientation;const V=function({element:e,viewportData:t,imageSliceData:n,viewportId:o,servicesManager:a,orientationMarkers:s=["top","left"]}){const[l,c]=(0,r.useState)(0),{isViewportBackgroundLight:u}=(0,I.eH)(o),{cornerstoneViewportService:m}=a.services;(0,r.useEffect)(()=>{const t=()=>c(Date.now());return e.addEventListener(i.Enums.Events.CAMERA_MODIFIED,t),()=>{e.removeEventListener(i.Enums.Events.CAMERA_MODIFIED,t)}},[e]);const d=(0,r.useMemo)(()=>{if(!t||0===l)return"";if(!e||!(0,i.getEnabledElement)(e))return console.log(`ViewportOrientationMarkers :: Viewport element not enabled (${o})`),"";if(!m.getViewportInfo(o))return console.log(`ViewportOrientationMarkers :: No viewport (${o})`),"";if("stack"===t.viewportType){const e=n.imageIndex,r=t.data[0].imageIds?.[e];if(!r)return!1;const{isDefaultValueSetForRowCosine:o,isDefaultValueSetForColumnCosine:a}=i.metaData.get("imagePlaneModule",r)||{};if(a||o)return""}const{viewport:a}=(0,i.getEnabledElement)(e),c=a.canvasToWorld([0,0]),d=a.canvasToWorld([1,0]),v=a.canvasToWorld([0,1]),E=p.eR.sub(p.eR.create(),d,c),g=p.eR.sub(p.eR.create(),v,c);p.eR.normalize(E,E),p.eR.normalize(g,g);const f=function(e,t){const n=T(e),r=T(t),i=N(n),o={top:N(r),left:i,right:n,bottom:r};return o}(E,g);return s.map((e,t)=>r.createElement("div",{className:C()("overlay-text",`${e}-mid orientation-marker`,u?"text-neutral-dark/70":"text-neutral-light/70",u?"shadow-light":"shadow-dark","text-base","leading-5"),key:`${e}-mid orientation-marker`},r.createElement("div",{className:"orientation-marker-value"},f[e])))},[t,n,l,s,e,u]);return r.createElement("div",{className:"ViewportOrientationMarkers select-none"},d)};function O({viewportData:e,element:t}){const[n,o]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u=e=>{clearTimeout(l.current),l.current=setTimeout(()=>{o(!0)},50)},m=e=>{clearTimeout(l.current),o(!1)},p=e=>{clearTimeout(l.current),c.current===e.detail.imageId&&(s(e.detail.error),c.current=null)};return(0,r.useEffect)(()=>(t.addEventListener(i.Enums.Events.STACK_VIEWPORT_SCROLL,u),t.addEventListener(i.Enums.Events.IMAGE_LOAD_ERROR,p),t.addEventListener(i.Enums.Events.STACK_NEW_IMAGE,m),()=>{t.removeEventListener(i.Enums.Events.STACK_VIEWPORT_SCROLL,u),t.removeEventListener(i.Enums.Events.STACK_NEW_IMAGE,m),t.removeEventListener(i.Enums.Events.IMAGE_LOAD_ERROR,p)}),[t,e]),a?r.createElement(r.Fragment,null,r.createElement("div",{className:"absolute top-0 left-0 h-full w-full bg-[rgb(var(--background))] opacity-50"},r.createElement("div",{className:"transparent flex h-full w-full items-center justify-center"},r.createElement("p",{className:"text-primary-light text-xl font-light"},r.createElement("h4",null,"Error Loading Image"),r.createElement("p",null,"An error has occurred."),r.createElement("p",null,a))))):n?r.createElement("div",{className:"pointer-events-none absolute top-0 left-0 h-full w-full bg-[rgb(var(--background))] opacity-50"},r.createElement("div",{className:"transparent flex h-full w-full items-center justify-center"},r.createElement("p",{className:"text-primary-light text-xl font-light"},"Loading..."))):null}O.propTypes={error:c().object,element:c().object};const L=O;const A=function(e){const{viewportId:t,element:n,scrollbarHeight:i,servicesManager:o}=e,{cornerstoneViewportService:a}=o.services,[s,l]=(0,r.useState)({imageIndex:0,numberOfSlices:0}),[c,u]=(0,r.useState)(null);if((0,r.useEffect)(()=>{const{unsubscribe:e}=a.subscribe(a.EVENTS.VIEWPORT_DATA_CHANGED,e=>{e.viewportId===t&&u(e.viewportData)});return()=>{e()}},[t]),!n)return null;if(c){const e=a.getViewportInfo(t);if(e?.viewportOptions?.customViewportProps?.hideOverlays)return null}return r.createElement("div",{className:"noselect"},r.createElement(m,{viewportId:t,viewportData:c,element:n,imageSliceData:s,setImageSliceData:l,scrollbarHeight:i,servicesManager:o}),r.createElement(M,{imageSliceData:s,viewportData:c,viewportId:t,servicesManager:o,element:n}),r.createElement(L,{viewportData:c,element:n}),r.createElement(V,{imageSliceData:s,element:n,viewportData:c,servicesManager:o,viewportId:t}))};var P=n(45981);function _({viewportId:e,cineService:t,newStackFrameRate:n,isPlaying:o,dynamicInfo:a,customizationService:s}){const l=s.getCustomization("cinePlayer"),[c,u]=(0,r.useState)(a);(0,r.useEffect)(()=>{u(a)},[a]),(0,r.useEffect)(()=>{if(!c)return;const e=e=>{const{volumeId:t,dimensionGroupNumber:n,numDimensionGroups:r,splittingTag:i}=e.detail;u({volumeId:t,dimensionGroupNumber:n,numDimensionGroups:r,label:i})};return i.eventTarget.addEventListener(i.Enums.Events.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED,e),()=>{i.eventTarget.removeEventListener(i.Enums.Events.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED,e)}},[c]),(0,r.useEffect)(()=>{if(!c)return;const{volumeId:e,dimensionGroupNumber:t,numDimensionGroups:n,splittingTag:r}=c||{};i.cache.getVolume(e,!0).dimensionGroupNumber=t,u({volumeId:e,dimensionGroupNumber:t,numDimensionGroups:n,label:r})},[]);const m=(0,r.useCallback)(e=>{const{volumeId:t,dimensionGroupNumber:n}=e;i.cache.getVolume(t,!0).dimensionGroupNumber=n},[]);return r.createElement(l,{className:"absolute left-1/2 bottom-3 -translate-x-1/2",frameRate:n,isPlaying:o,onClose:()=>{t.setCine({id:e,isPlaying:!1}),t.setIsCineEnabled(!1),t.setViewportCineClosed(e)},onPlayPauseChange:n=>{t.setCine({id:e,isPlaying:n})},onFrameRateChange:n=>t.setCine({id:e,frameRate:n}),dynamicInfo:c,updateDynamicInfo:m})}const x=function({enabledVPElement:e,viewportId:t,servicesManager:n}){const{customizationService:o,displaySetService:s,viewportGridService:l}=n.services,[{isCineEnabled:c,cines:u},m]=(0,a.tqw)(),[p,d]=(0,r.useState)(24),[v,E]=(0,r.useState)(null),[g]=(0,P.r)(),f=(0,r.useRef)(null),w=()=>{if(!u?.[t]||!e)return;const{isPlaying:n=!1,frameRate:r=24}=u[t],i=Math.max(r,1);return n?m.playClip(e,{framesPerSecond:i,viewportId:t}):m.stopClip(e)},I=(0,r.useCallback)(()=>{if(!e||!c)return;const{viewports:n}=l.getState(),{displaySetInstanceUIDs:r}=n.get(t);let i=24,o=u[t]?.isPlaying||!1;r.forEach(e=>{const t=s.getDisplaySetByUID(e);if(t.FrameRate&&(i=Math.round(1e3/t.FrameRate),o||=!!g.autoPlayCine),t.isDynamicVolume){const{dynamicVolumeInfo:e}=t,n=e.timePoints.length,r=e.splittingTag,i=e.dimensionGroupNumber||1;E({volumeId:t.displaySetInstanceUID,dimensionGroupNumber:i,numDimensionGroups:n,label:r})}else E(null)}),o&&m.setIsCineEnabled(o),m.setCine({id:t,isPlaying:o,frameRate:i}),d(i)},[s,t,l,u,c,e]);if((0,r.useEffect)(()=>(f.current=!0,I(),()=>{f.current=!1}),[c,I]),(0,r.useEffect)(()=>{c&&w()},[c,w,e]),(0,r.useEffect)(()=>{if(e)return e.addEventListener(i.Enums.Events.VIEWPORT_NEW_IMAGE_SET,I),e.addEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,I),()=>{m.setCine({id:t,isPlaying:!1}),e.removeEventListener(i.Enums.Events.VIEWPORT_NEW_IMAGE_SET,I),e.removeEventListener(i.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,I)}},[e,I,t]),(0,r.useEffect)(()=>{if(u&&u[t]&&e&&f.current)return w(),()=>{m.stopClip(e,{viewportId:t})}},[u,t,m,e,w]),!c)return null;const S=u[t],b=S?.isPlaying||!1;return r.createElement(_,{viewportId:t,cineService:m,newStackFrameRate:p,isPlaying:b,dynamicInfo:v,customizationService:o})};var k=n(20528),G=n(93813);function F({viewportId:e}){const{isHovered:t,isActive:n}=(0,I.uY)(e);return t||n?r.createElement(a.TNf,{size:"medium",IconContainer:a.T0e,containerProps:{size:"tiny",className:"font-normal text-primary hover:bg-primary/25"}},r.createElement(a.R2R.Container,null,r.createElement(a.R2R.TopLeft,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.topLeft",viewportId:e,location:G.ij.TopLeft})),r.createElement(a.R2R.TopMiddle,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.topMiddle",viewportId:e,location:G.ij.TopMiddle})),r.createElement(a.R2R.TopRight,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.topRight",viewportId:e,location:G.ij.TopRight})),r.createElement(a.R2R.LeftMiddle,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.leftMiddle",viewportId:e,location:G.ij.LeftMiddle})),r.createElement(a.R2R.RightMiddle,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.rightMiddle",viewportId:e,location:G.ij.RightMiddle})),r.createElement(a.R2R.BottomLeft,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.bottomLeft",viewportId:e,location:G.ij.BottomLeft})),r.createElement(a.R2R.BottomMiddle,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.bottomMiddle",viewportId:e,location:G.ij.BottomMiddle})),r.createElement(a.R2R.BottomRight,null,r.createElement(k.M,{buttonSection:"viewportActionMenu.bottomRight",viewportId:e,location:G.ij.BottomRight})))):null}const z=(0,r.memo)(F);var W=n(44646),H=n(10182),U=n(2847);var j=n(68578);const B=(0,r.memo)(({servicesManager:e,viewportId:t})=>{const{displaySetService:n,cineService:i,viewportGridService:o,customizationService:a,cornerstoneViewportService:s}=e.services,[l,c]=(0,r.useState)(t),u=(0,r.useCallback)(()=>{if(i.isViewportCineClosed(l))return;const e=o.getDisplaySetsUIDsForViewport(l);if(!e)return;const t=e.map(e=>n.getDisplaySetByUID(e));if(!t.length)return;const r=t.map(e=>e?.Modality),s=t.some(e=>e?.isDynamicVolume),c=a.getCustomization("autoCineModalities");!r.some(e=>c.includes(e))&&!s||i.getState().isCineEnabled||i.setIsCineEnabled(!0)},[l,i,o,n,a]);return(0,r.useEffect)(()=>{const e=o.subscribe(o.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,({viewportId:e})=>c(e));return()=>e.unsubscribe()},[t,o]),(0,r.useEffect)(()=>{const e=s.subscribe(s.EVENTS.VIEWPORT_DATA_CHANGED,()=>{const e=o.getActiveViewportId();c(e),u()});return()=>e.unsubscribe()},[t,s,o,u]),(0,r.useEffect)(()=>{u()},[u]),null},Y);function Y(e,t){return e.viewportId===t.viewportId&&e.servicesManager===t.servicesManager}B.displayName="ActiveViewportBehavior";const $=B,K=new Map,q=r.memo(e=>{const{displaySets:t,dataSource:n,viewportOptions:l,displaySetOptions:c,servicesManager:u,onElementEnabled:m,onElementDisabled:p,isJumpToMeasurementDisabled:d=!1,initialImageIndex:v,isHangingProtocolLayout:E}=e,g=l.viewportId;if(!g)throw new Error("Viewport ID is required");for(;c.length<t.length;)c.push({});l.viewportType=t.some(e=>e.isDynamicVolume&&e.isReconstructable)?"volume":l.viewportType;const[f,w]=(0,r.useState)("100px"),[I,S]=(0,r.useState)(null),b=(0,r.useRef)(),y=(0,o.bs)(g),{displaySetService:h,toolbarService:D,toolGroupService:M,syncGroupService:R,cornerstoneViewportService:C,segmentationService:T,cornerstoneCacheService:N,customizationService:V,measurementService:O}=u.services,[L]=(0,a.ORo)(),P=(0,r.useCallback)(()=>{const e=b.current.clientHeight-10+"px";w(e)},[b]),_=(0,r.useCallback)(e=>{if(b.current&&e?.length){const t=e[0],{width:n,height:r}=t.contentRect,i=K.get(g)||{width:0,height:0},o=i.width!==n||i.height!==r;n>0&&r>0&&o&&(K.set(g,{width:n,height:r}),C.resize(),P())}},[g,b,C,P]);(0,r.useEffect)(()=>{const e=b.current;if(!e)return;const t=new ResizeObserver(_);return t.observe(e),()=>{t.unobserve(e),t.disconnect()}},[_]);const k=(0,r.useCallback)(e=>{const t=e.getRenderingEngineId(),n=e.getSyncGroups();M.removeViewportFromToolGroup(g,t),R.removeViewportFromSyncGroup(g,t,n),T.clearSegmentationRepresentations(g)},[g,T,R,M]),G=(0,r.useCallback)(e=>{if(e.detail.element!==b.current)return;const{viewportId:t,element:n}=e.detail,r=C.getViewportInfo(t);if(!r)return;(0,s.ye)(t,n),S(n);const i=r.getRenderingEngineId(),o=r.getToolGroupId(),a=r.getSyncGroups();M.addViewportToToolGroup(t,i,o),R.addViewportToSyncGroup(t,i,a);const{synchronizersStore:l}=j.U.getState();l?.[t]?.length&&!E&&function(e,t){const{synchronizersStore:n}=j.U.getState(),r=n[e];if(!r)return;r.forEach(n=>{if(!n.id)return;const{id:r,sourceViewports:i,targetViewports:o}=n,a=t.getSynchronizer(r);if(!a)return;const s=i.find(t=>t.viewportId===e),l=o.find(t=>t.viewportId===e),c=a.getSourceViewports().find(t=>t.viewportId===e),u=a.getTargetViewports().find(t=>t.viewportId===e);s&&!c&&a.addSource({viewportId:s.viewportId,renderingEngineId:s.renderingEngineId}),l&&!u&&a.addTarget({viewportId:l.viewportId,renderingEngineId:l.renderingEngineId})})}(t,R),m&&"function"==typeof m&&m(e)},[g,m,M]);(0,r.useEffect)(()=>(C.enableViewport(g,b.current),i.eventTarget.addEventListener(i.Enums.Events.ELEMENT_ENABLED,G),P(),()=>{const e=C.getViewportInfo(g);e&&(C.storePresentation({viewportId:g}),k(e),p&&"function"==typeof p&&p(e),C.disableElement(g),y.unregister(),i.eventTarget.removeEventListener(i.Enums.Events.ELEMENT_ENABLED,G))}),[]),(0,r.useEffect)(()=>{const{unsubscribe:e}=h.subscribe(h.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,async({displaySetInstanceUID:e,invalidateData:t})=>{if(!t)return;const r=C.getViewportInfo(g);if(r.hasDisplaySet(e)){const t=r.getViewportData(),i=await N.invalidateViewportData(t,e,n,h),o=!0;C.updateViewport(g,i,o)}});return()=>{e()}},[g]),(0,r.useEffect)(()=>{l.viewportType||(l.viewportType="stack");(async()=>{const e=await N.createViewportData(t,l,n,v),r=function(e,t){const{lutPresentationStore:n}=H.I.getState(),{positionPresentationStore:r}=W.q.getState(),{segmentationPresentationStore:i}=U.v.getState(),{presentationIds:o}=t;if(!o)return{positionPresentation:null,lutPresentation:null,segmentationPresentation:null};const{lutPresentationId:a,positionPresentationId:s,segmentationPresentationId:l}=o;return{positionPresentation:r[s],lutPresentation:n[a],segmentationPresentation:i[l]}}(0,l);l.needsRerendering&&(l.needsRerendering=!1),C.setViewportData(g,e,l,c,r)})()},[l,t,n]);const F=V.getCustomization("ui.notificationComponent");return r.createElement(r.Fragment,null,r.createElement("div",{className:"viewport-wrapper"},r.createElement("div",{className:"cornerstone-viewport-element",style:{height:"100%",width:"100%"},onContextMenu:e=>e.preventDefault(),onMouseDown:e=>e.preventDefault(),"data-viewportid":g,ref:e=>{b.current=e,e&&y.register(e)}}),r.createElement(A,{viewportId:g,toolBarService:D,element:b.current,scrollbarHeight:f,servicesManager:u}),r.createElement(x,{enabledVPElement:I,viewportId:g,servicesManager:u}),r.createElement($,{viewportId:g,servicesManager:u})),r.createElement("div",{className:"absolute top-[24px] w-full"},L.viewportId===g&&r.createElement(F,{id:"viewport-notification",message:L.message,type:L.type,actions:L.actions,onSubmit:L.onSubmit,onOutsideClick:L.onOutsideClick,onKeyPress:L.onKeyPress})),r.createElement(z,{viewportId:g}))},Z);function Z(e,t){if(t.needsRerendering)return!1;if(e.displaySets.length!==t.displaySets.length)return!1;if(e.viewportOptions.orientation!==t.viewportOptions.orientation)return!1;if(e.viewportOptions.toolGroupId!==t.viewportOptions.toolGroupId)return!1;if(t.viewportOptions.viewportType&&e.viewportOptions.viewportType!==t.viewportOptions.viewportType)return!1;if(t.viewportOptions.needsRerendering)return!1;const n=e.displaySets,r=t.displaySets;if(n.length!==r.length)return!1;for(let e=0;e<n.length;e++){const t=n[e],i=r.find(e=>e.displaySetInstanceUID===t.displaySetInstanceUID);if(!i)return!1;if(i.images?.length!==t.images?.length)return!1;if(i.images?.length)for(let e=0;e<i.images.length;e++)if(i.images[e].imageId!==t.images[e].imageId)return!1}return!0}q.displayName="OHIFCornerstoneViewport";const J=q}}]);
//# sourceMappingURL=147.bundle.36c64d2920a2ac6c51a7.js.map